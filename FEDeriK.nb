(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[    252094,       6012]
NotebookOptionsPosition[    241234,       5801]
NotebookOutlinePosition[    241688,       5819]
CellTagsIndexPosition[    241645,       5816]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
   RowBox[{"AutoGeneratedPackage", "->", "\"\<FEDeriK.m\>\""}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.933907062001917*^9, 3.933907088477437*^9}, 
   3.9356618434708548`*^9, 3.935744927606638*^9, {3.935833716539812*^9, 
   3.93583371672362*^9}, {3.9507222866535883`*^9, 3.95072228934137*^9}, {
   3.950850838405504*^9, 3.950850842475651*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"33cd48af-4550-42b3-9c95-127f2f1ee635"],

Cell[CellGroupData[{

Cell["Global variables", "Section",
 CellChangeTimes->{{3.9509597231601686`*^9, 3.950959732923991*^9}, {
  3.951108540108012*^9, 3.9511085438759727`*^9}, {3.951210853720582*^9, 
  3.95121085660688*^9}},ExpressionUUID->"d65e8f2b-6500-4348-8918-\
912b67b13cd9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$OrderedObjects", "=", 
   RowBox[{"{", 
    RowBox[{"Propagator", ",", "GammaN", ",", "Rdot"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$indexedObjects", "=", 
   RowBox[{"{", 
    RowBox[{
    "ABasis", ",", "VBasis", ",", "GammaN", ",", "Propagator", ",", "Rdot"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$MaxDerivativeIterations", "=", "500"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$CanonicalOrdering", "=", "\"\<f>af>b\>\""}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951210756011141*^9, 3.951210767816422*^9}, {
  3.951210812202783*^9, 3.951210812369783*^9}, {3.9512108663431187`*^9, 
  3.9512108750394697`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"f9a54712-bc7e-4f67-94ba-c436d6c2a287"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$FunKitDirectory", "=", 
   RowBox[{
    RowBox[{"SelectFirst", "[", 
     RowBox[{
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$UserBaseDirectory", ",", "\"\<Applications\>\"", ",", 
             "\"\<FunKit\>\""}], "}"}], "]"}], ",", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$BaseDirectory", ",", "\"\<Applications\>\"", ",", 
             "\"\<FunKit\>\""}], "}"}], "]"}], ",", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$InstallationDirectory", ",", "\"\<AddOns\>\"", ",", 
             "\"\<Applications\>\"", ",", "\"\<FunKit\>\""}], "}"}], "]"}], 
          ",", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$InstallationDirectory", ",", "\"\<AddOns\>\"", ",", 
             "\"\<Packages\>\"", ",", "\"\<FunKit\>\""}], "}"}], "]"}], ",", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$InstallationDirectory", ",", "\"\<AddOns\>\"", ",", 
             "\"\<ExtraPackages\>\"", ",", "\"\<FunKit\>\""}], "}"}], "]"}]}],
          "}"}], ",", 
        RowBox[{"Select", "[", 
         RowBox[{"$Path", ",", 
          RowBox[{
           RowBox[{"StringContainsQ", "[", 
            RowBox[{"#", ",", "\"\<FunKit\>\""}], "]"}], "&"}]}], "]"}]}], 
       "]"}], ",", 
      RowBox[{
       RowBox[{"DirectoryQ", "[", "#", "]"}], "&"}]}], "]"}], "<>", 
    "\"\</\>\""}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951226996707944*^9, 3.951227003475544*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"66c68510-764b-433f-bf11-01c5d6a5e9c2"]
}, Open  ]],

Cell[CellGroupData[{

Cell["FDOp, FTerm and FEq definitions ", "Section",
 CellChangeTimes->{{3.9509597231601686`*^9, 3.950959732923991*^9}, {
  3.951108540108012*^9, 
  3.9511085438759727`*^9}},ExpressionUUID->"e03db448-7a6c-4e73-9ddc-\
3b1976a84a81"],

Cell[CellGroupData[{

Cell["Basic definitions", "Subsection",
 CellChangeTimes->{{3.950959776616251*^9, 3.950959779850823*^9}, 
   3.9509598524176817`*^9},ExpressionUUID->"35360acd-1ab3-48dc-b387-\
960ef784c1b9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "FTerm", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "FTerm", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FTimesPowerPatternaToFTermb", "=", 
   TagBox[
    StyleBox[
     RowBox[{"Power", "[", 
      RowBox[{"a", ",", 
       RowBox[{"FTerm", "[", "b_", "]"}]}], "]"}],
     ShowSpecialCharacters->False,
     ShowStringCharacters->True,
     NumberMarks->True],
    FullForm]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTimesPowerPatternFTermbtoa", "=", 
    TagBox[
     StyleBox[
      RowBox[{"Power", "[", 
       RowBox[{"a", ",", 
        RowBox[{"FTerm", "[", "b_", "]"}]}], "]"}],
      ShowSpecialCharacters->False,
      ShowStringCharacters->True,
      NumberMarks->True],
     FullForm]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "::", "TimesError"}], "=", 
   "\"\<An FTerm cannot be multiplied using Times[__]. To multiply FTerms, \
use term1**term2, also with scalars, a**term. Error in expression\n`1`\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FTerm", "::", "FTermPowerError"}], "=", 
    "\"\<An FTerm cannot be taken to a power of an FTerm.\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Multiplication", " ", "of", " ", "FTerms"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"FTerm", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "a__", "]"}], ",", 
    RowBox[{"FTerm", "[", "b__", "]"}]}], "]"}], ":=", 
  RowBox[{"FTerm", "[", 
   RowBox[{"a", ",", "b"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", "]"}], ":=", 
   RowBox[{"FTerm", "[", "1", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Pre", "-", 
    RowBox[{"reduction", " ", "of", " ", "zero", " ", "FTerms"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FTerm", "[", 
   RowBox[{"___", ",", "0", ",", "___"}], "]"}], ":=", 
  RowBox[{"FTerm", "[", "0", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FTerm", "[", 
   RowBox[{"pre___", ",", "a_", ",", 
    RowBox[{"b", ":", 
     RowBox[{"(", 
      RowBox[{"_Integer", "|", "_Real", "|", "_Rational", "|", "_Complex"}], 
      ")"}]}], ",", "post___"}], "]"}], ":=", 
  RowBox[{"FTerm", "[", 
   RowBox[{"pre", ",", 
    RowBox[{"a", "*", "b"}], ",", "post"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{
     RowBox[{"a", ":", 
      RowBox[{"(", 
       RowBox[{"_Integer", "|", "_Real", "|", "_Rational", "|", "_Complex"}], 
       ")"}]}], ",", "b_", ",", "post___"}], "]"}], ":=", 
   RowBox[{"FTerm", "[", 
    RowBox[{
     RowBox[{"a", "*", "b"}], ",", "post"}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Reduction", " ", "of", " ", "immediately", " ", "nested", " ", "FTerms"}],
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{"pre___", ",", 
     RowBox[{"FTerm", "[", "in__", "]"}], ",", "post___"}], "]"}], ":=", 
   RowBox[{"FTerm", "[", 
    RowBox[{"pre", ",", "in", ",", "post"}], "]"}]}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "/:", 
    RowBox[{"Power", "[", 
     RowBox[{
      RowBox[{"FTerm", "[", "a___", "]"}], ",", 
      RowBox[{"FTerm", "[", "b___", "]"}]}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"FTerm", "::", "FTermPowerError"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FTerm", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951108570921122*^9, 3.9511086067410803`*^9}, {
  3.9511206459063587`*^9, 3.951120660081051*^9}, {3.951195864716386*^9, 
  3.951195886154029*^9}, {3.951196961507043*^9, 3.951197010834494*^9}, {
  3.951197041118517*^9, 3.9511971060976057`*^9}, {3.951197479182197*^9, 
  3.951197519394229*^9}, {3.951219979402542*^9, 3.951219993857942*^9}, {
  3.951220337986998*^9, 3.9512203916636333`*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"9610d6bd-1c3a-4143-88dc-cb4244676cae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "FEq", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "FEq", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FEq", "::", "TimesError"}], "=", 
    "\"\<A FEq cannot be multiplied using Times[__]. To multiply FEqs, use \
eq1**eq2, also with scalars, a**eq. Error in expression\n`1`\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Removal", " ", "of", " ", "zero", " ", "FTerms"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "[", 
   RowBox[{"pre___", ",", 
    RowBox[{"FTerm", "[", 
     RowBox[{"___", ",", "0", ",", "___"}], "]"}], ",", "post___"}], "]"}], ":=", 
  RowBox[{"FEq", "[", 
   RowBox[{"pre", ",", "post"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"pre___", ",", 
     RowBox[{"FTerm", "[", "]"}], ",", "post___"}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"pre", ",", "post"}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Sum", " ", "splitting", " ", "of", " ", "FTerms"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"preEq___", ",", 
     RowBox[{"FTerm", "[", 
      RowBox[{"preTerm___", ",", 
       RowBox[{"Plus", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], ",", "postTerm___"}], "]"}], ",", 
     "postEq___"}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"preEq", ",", 
     RowBox[{"FTerm", "[", 
      RowBox[{"preTerm", ",", "a", ",", "postTerm"}], "]"}], ",", 
     RowBox[{"FTerm", "[", 
      RowBox[{"preTerm", ",", 
       RowBox[{"Plus", "[", "b", "]"}], ",", "postTerm"}], "]"}], ",", 
     "postEq"}], "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Sums", " ", "of", " ", "FTerms"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "[", 
   RowBox[{"preEq___", ",", 
    RowBox[{"Plus", "[", 
     RowBox[{
      RowBox[{"FTerm", "[", "a__", "]"}], ",", 
      RowBox[{"FTerm", "[", "b__", "]"}], ",", "c___"}], "]"}], ",", 
    "postEq___"}], "]"}], ":=", 
  RowBox[{"FEq", "[", 
   RowBox[{"preEq", ",", 
    RowBox[{"FTerm", "[", "a", "]"}], ",", 
    RowBox[{"Plus", "[", 
     RowBox[{
      RowBox[{"FTerm", "[", "b", "]"}], ",", "c"}], "]"}], ",", "postEq"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "/:", 
   RowBox[{"Plus", "[", 
    RowBox[{
     RowBox[{"FEq", "[", "a___", "]"}], ",", 
     RowBox[{"FTerm", "[", "b__", "]"}]}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"a", ",", 
     RowBox[{"FTerm", "[", "b", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Sums", " ", "of", " ", "FEqs"}], "*)"}]}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{"FEq", "/:", 
   RowBox[{"Plus", "[", 
    RowBox[{"preEq___", ",", 
     RowBox[{"FEq", "[", "terms1___", "]"}], ",", "midEq___", ",", 
     RowBox[{"FEq", "[", "terms2___", "]"}], ",", "postEq___"}], "]"}], ":=", 
   
   RowBox[{"Plus", "[", 
    RowBox[{"preEq", ",", "midEq", ",", "postEq", ",", 
     RowBox[{"FEq", "[", 
      RowBox[{"terms1", ",", "terms2"}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Multiplication", " ", "of", " ", "FEqs"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"Times", "[", 
   RowBox[{"pre___", ",", 
    RowBox[{"FEq", "[", "a__", "]"}], ",", "post___"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"FEq", "::", "TimesError"}], ",", 
      RowBox[{"{", 
       RowBox[{"pre", ",", 
        RowBox[{"FEq", "[", "a", "]"}], ",", "post"}], "}"}]}], "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"prefeq__", ",", 
     RowBox[{"Times", "[", 
      RowBox[{"pre___", ",", 
       RowBox[{"FTerm", "[", "a__", "]"}], ",", "post___"}], "]"}], ",", 
     "postfeq__"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"FTerm", "::", "TimesError"}], ",", 
       RowBox[{"{", 
        RowBox[{"pre", ",", 
         RowBox[{"FTerm", "[", "a", "]"}], ",", "post"}], "}"}]}], "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "b__", "]"}], ",", 
    RowBox[{"FEq", "[", "c__", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"FTerm", "[", "b", "]"}], "**", "#"}], "&"}], ",", 
     RowBox[{"FEq", "[", "c", "]"}]}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FEq", "[", "a__", "]"}], ",", 
    RowBox[{"FEq", "[", "b__", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "@@", 
   RowBox[{"(", 
    RowBox[{"Flatten", "@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"FEq", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "a", "}"}], "[", 
          RowBox[{"[", "i", "]"}], "]"}], "**", 
         RowBox[{
          RowBox[{"{", "b", "}"}], "[", 
          RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"{", "a", "}"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"{", "b", "}"}], "]"}]}], "}"}]}], "]"}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "b___", "]"}], ",", 
    RowBox[{"FEq", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "[", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "]"}], ",", 
    RowBox[{"FEq", "[", "b___", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "[", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "/:", 
   RowBox[{"NonCommutativeMultiply", "[", 
    RowBox[{
     RowBox[{"FTerm", "[", "0", "]"}], ",", 
     RowBox[{"FEq", "[", "b___", "]"}]}], "]"}], ":=", 
   RowBox[{"FEq", "[", "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  
  RowBox[{"(*", 
   RowBox[{
   "Reduction", " ", "of", " ", "immediately", " ", "nested", " ", "FEqs"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "[", 
   RowBox[{"pre___", ",", 
    RowBox[{"FEq", "[", "in___", "]"}], ",", "post___"}], "]"}], ":=", 
  RowBox[{"FEq", "[", 
   RowBox[{"pre", ",", "in", ",", "post"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"pre___", ",", 
     RowBox[{"FTerm", "[", "]"}], ",", "post___"}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"pre", ",", "post"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FEq", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509578761709423`*^9, 3.950957973036676*^9}, {
   3.9509590689899607`*^9, 3.9509591157318487`*^9}, {3.9509591472919817`*^9, 
   3.950959252858809*^9}, {3.9509592907067623`*^9, 3.9509592957039757`*^9}, {
   3.950959501450481*^9, 3.95095951130514*^9}, {3.950959686410345*^9, 
   3.950959714174095*^9}, 3.950959773470724*^9, {3.951034884384832*^9, 
   3.951034890869*^9}, {3.951035198689001*^9, 3.951035207408928*^9}, {
   3.951035268197209*^9, 3.951035301400906*^9}, {3.951035981870775*^9, 
   3.9510360006370783`*^9}, {3.951036246658142*^9, 3.95103626460588*^9}, {
   3.95103649033849*^9, 3.951036598302443*^9}, {3.951036633594223*^9, 
   3.951036785006905*^9}, {3.9510368169549932`*^9, 3.951036830730741*^9}, {
   3.951037206113153*^9, 3.95103734490982*^9}, {3.951037380987048*^9, 
   3.951037383677424*^9}, {3.951037439125901*^9, 3.951037496838653*^9}, {
   3.95103754050202*^9, 3.9510375690137587`*^9}, {3.9510376206837482`*^9, 
   3.951037625335888*^9}, {3.95103780882169*^9, 3.951037937002328*^9}, {
   3.951045322817977*^9, 3.95104532318824*^9}, {3.9510453867665377`*^9, 
   3.9510456103940287`*^9}, {3.95104564974853*^9, 3.951045666800379*^9}, {
   3.9510457134141083`*^9, 3.951045873397193*^9}, {3.951045915058331*^9, 
   3.9510460013306837`*^9}, {3.95104607626162*^9, 3.951046274552978*^9}, {
   3.951046466112495*^9, 3.951046728989846*^9}, {3.951046767530278*^9, 
   3.951046934066455*^9}, {3.9511072891096373`*^9, 3.951107324549317*^9}, {
   3.951107379842474*^9, 3.951107392161078*^9}, {3.951107584300604*^9, 
   3.95110759264114*^9}, {3.951107680371338*^9, 3.951107740154788*^9}, {
   3.951107781351058*^9, 3.9511077883787947`*^9}, {3.951107886223928*^9, 
   3.951107886588614*^9}, {3.951107926025846*^9, 3.951107950114067*^9}, {
   3.951108556054607*^9, 3.951108598328257*^9}, {3.9511196059065237`*^9, 
   3.951119683559124*^9}, {3.9511198861915407`*^9, 3.951119888700102*^9}, {
   3.951195813278051*^9, 3.95119584540624*^9}, {3.9511975255885773`*^9, 
   3.9511975266179333`*^9}, {3.95121043539817*^9, 3.951210463363813*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"d8c7ad92-008a-409f-951b-580a3ca827cd"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.951119605235899*^9},
 CellLabel->
  "In[102]:=",ExpressionUUID->"0efd2ca7-491d-441e-bc6b-0b881437e71d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "FDOp", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "FDOp", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FDOp", "::", "invalidArgument"}], "=", 
    "\"\<The argument \\\"`1`\\\" is not a valid argument for an FDOp. Only \
single fields with indices are allowed!\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FDOp", "[", 
    RowBox[{"a_", ",", "b__"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"FDOp", "::", "invalidArgument"}], ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "b"}], "}"}]}], "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FDOp", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951108610832852*^9, 3.9511087726146603`*^9}, {
   3.951109007109483*^9, 3.951109104718912*^9}, 3.951109283448956*^9, 
   3.951109315260315*^9, 3.951109665778265*^9},
 CellLabel->"In[39]:=",ExpressionUUID->"3041f1c9-2084-4cb2-9ca5-98c287d5c642"]
}, Closed]],

Cell[CellGroupData[{

Cell["Power expansions", "Subsection",
 CellChangeTimes->{{3.9511983853072557`*^9, 
  3.951198388520007*^9}},ExpressionUUID->"82ef4885-2b2a-47d1-8963-\
133ee7a68a33"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FExpand", "[", 
    RowBox[{"expr_", ",", "order_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ret", "=", "expr"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ret", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"ret", "//.", 
          RowBox[{
           RowBox[{"Power", "[", 
            RowBox[{"a_FTerm", ",", "b_"}], "]"}], ":>", 
           RowBox[{"Series", "[", 
            RowBox[{
             RowBox[{"a", "^", "b"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}], "//.", 
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_", ",", "b_FTerm"}], "]"}], ":>", 
          RowBox[{"Series", "[", 
           RowBox[{
            RowBox[{"a", "^", "b"}], ",", 
            RowBox[{"{", 
             RowBox[{"b", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}], "//", 
        "Normal"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ret", "=", 
       RowBox[{"ret", "//.", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"FTerm", "[", "a__", "]"}], ",", "b_Integer"}], "]"}], "/;", 
          RowBox[{"b", ">", "0"}]}], ":>", 
         RowBox[{"FTerm", "[", 
          RowBox[{"a", ",", 
           SuperscriptBox[
            RowBox[{"FTerm", "[", "a", "]"}], 
            RowBox[{"b", "-", "1"}]]}], "]"}]}]}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951198400665941*^9, 3.951198539982102*^9}, {
  3.95119858122998*^9, 3.951198629997539*^9}, {3.951198840630013*^9, 
  3.951199103563139*^9}, {3.951199144182513*^9, 3.951199153264168*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"c5f93900-11a5-40d3-92c2-259b2094122d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Checks and assertions", "Subsection",
 CellChangeTimes->{{3.932178009618313*^9, 3.932178022055203*^9}, {
  3.950801118933737*^9, 
  3.950801121691584*^9}},ExpressionUUID->"23b7e69d-dcbb-4fb0-a77e-\
b8638a031ad4"],

Cell[CellGroupData[{

Cell["FTerm and FEq", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, {
  3.950964433513967*^9, 
  3.9509644360831413`*^9}},ExpressionUUID->"d438b387-4f31-41ce-a117-\
795b628d69b9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FTermQ", "[", "expr_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Head", "[", "expr", "]"}], "===", "FTerm"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "::", "notFTerm"}], "=", 
   "\"\<The term `1` is not an FTerm.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AssertFTerm", "[", "expr_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"Not", "@", 
       RowBox[{"FTermQ", "[", "expr", "]"}]}], ",", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"FTerm", "::", "notFTerm"}], ",", "expr"}], "]"}], ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEqQ", "[", "expr_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Head", "[", "expr", "]"}], "===", "FEq"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "::", "notFEq"}], "=", 
   "\"\<The term `1` is not an FEq.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AssertFEq", "[", "expr_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"FEqQ", "[", "expr", "]"}]}], ",", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"FEq", "::", "notFEq"}], ",", "expr"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950959791226129*^9, 3.950959819925836*^9}, {
  3.950959877202113*^9, 3.950959965968995*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"63fbe29b-4af8-405d-80e3-5cbc9aa8d1d5"]
}, Closed]],

Cell[CellGroupData[{

Cell["Field Space", "Subsubsection",
 CellChangeTimes->{{3.950801271735565*^9, 3.95080128037481*^9}, {
  3.9508933727376747`*^9, 
  3.950893373722165*^9}},ExpressionUUID->"f52392a8-ad40-44db-871d-\
0651868db7ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Check", " ", "if", " ", "a", " ", "given", " ", "field", " ", 
     "definition", " ", "is", " ", 
     RowBox[{"valid", ".", " ", "Can"}], " ", "be", " ", "either", " ", "its",
      " ", "own", " ", "anti"}], "-", 
    RowBox[{"field", " ", "or", " ", "a", " ", "pair", " ", 
     RowBox[{"{", 
      RowBox[{"af", ",", "f"}], "}"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FieldDefQ", "[", "expr_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "expr", "]"}], "===", "List"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "expr", "]"}], "=!=", "2"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<A field definition must be either of form f[x...] or \
{af[x...],f[x...]}. \\\"\>\"", ",", "expr", ",", 
                "\"\<\\\" does not fit.\>\""}], "]"}], ";", 
              RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{"expr", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "===", 
              RowBox[{"Head", "[", 
               RowBox[{"expr", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<A field definition {af[x...],f[x...]} must have different \
field names af and f. \\\"\>\"", ",", "expr", ",", 
                "\"\<\\\" does not fit.\>\""}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Not", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"List", "@@", 
                 RowBox[{"(", 
                  RowBox[{"expr", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "===", 
                RowBox[{"List", "@@", 
                 RowBox[{"(", 
                  RowBox[{"expr", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ")"}]}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<A field definition {af[x...],f[x...]} must have identical \
indices. \\\"\>\"", ",", "expr", ",", "\"\<\\\" does not fit.\>\""}], "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Not", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MatchQ", "[", 
                   RowBox[{
                    RowBox[{"expr", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"_Symbol", "[", 
                    RowBox[{"_", ",", 
                    RowBox[{"{", "__Symbol", "}"}]}], "]"}]}], "]"}], "||", 
                  RowBox[{"MatchQ", "[", 
                   RowBox[{
                    RowBox[{"expr", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"_Symbol", "[", "_", "]"}]}], "]"}]}], ")"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{
                 "\"\<A field definition f[x...] must have indices f[p] or \
f[p,{a,b,...}]. \\\"\>\"", ",", 
                  RowBox[{"expr", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  "\"\<\\\" does not fit.\>\""}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "True", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"_Symbol", "[", 
                RowBox[{"_", ",", 
                 RowBox[{"{", "__Symbol", "}"}]}], "]"}]}], "]"}], "||", 
             RowBox[{"MatchQ", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"_Symbol", "[", "_", "]"}]}], "]"}]}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<A field definition f[x...] must have indices f[p] or \
f[p,{a,b,...}]. \\\"\>\"", ",", "expr", ",", "\"\<\\\" does not fit.\>\""}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FieldDef", "::", "invalidFieldDefinition"}], "=", 
     "\"\<The given field definition `1` is not valid.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssertFieldDef", "[", "expr_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"FieldDefQ", "[", "expr", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FieldDefinition", "::", "invalidFieldDefinition"}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509723959533377`*^9, 3.950972498533544*^9}, {
  3.9509725391754503`*^9, 3.950972839103818*^9}, {3.95097289590053*^9, 
  3.950973043727556*^9}, {3.9509730775238113`*^9, 3.9509730807717524`*^9}, {
  3.950973155496664*^9, 3.950973196313613*^9}, {3.950973268996133*^9, 
  3.950973292848659*^9}, {3.950973323914188*^9, 3.950973407746553*^9}, {
  3.9509734394970713`*^9, 3.950973519577339*^9}, {3.950973729052182*^9, 
  3.9509737667166567`*^9}, {3.950976938011018*^9, 3.950976940198797*^9}},
 CellLabel->"In[51]:=",ExpressionUUID->"d2be4365-2a9f-4170-90b1-81e044dec426"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Check", " ", "if", " ", "a", " ", "given", " ", "field", " ", "space", 
    " ", "definition", " ", "is", " ", "valid"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FieldSpaceDefQ", "[", "fieldSpace_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "fieldSpace", "]"}], "=!=", "Association"}], 
          ",", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<An FSetup must be an association\>\"", "]"}], 
           ";", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Keys", "[", "fieldSpace", "]"}], "===", 
             RowBox[{"{", 
              RowBox[{"\"\<cField\>\"", ",", "\"\<Grassmann\>\""}], "}"}]}], 
            ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<fields must contain the two keys \
{\\\"cField\\\",\\\"Grassmann\\\"}!\>\"", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"ListQ", "[", 
            RowBox[{"fieldSpace", "[", "\"\<cField\>\"", "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<fields[\\\"cField\\\"] must be a list!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{"And", "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"FieldDefQ", ",", 
               RowBox[{"fieldSpace", "[", "\"\<cField\>\"", "]"}]}], "]"}]}], 
            ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<fields[\\\"cField\\\"] must contain valid fields!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"ListQ", "[", 
            RowBox[{"fieldSpace", "[", "\"\<Grassmann\>\"", "]"}], "]"}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<fields[\\\"Grassmann\\\"] must be a list!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{"And", "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"FieldDefQ", ",", 
               RowBox[{"fieldSpace", "[", "\"\<Grassmann\>\"", "]"}]}], 
              "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<fields[\\\"Grassmann\\\"] must contain valid fields!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FieldSpaceDefinition", "::", "invalidFieldDefinition"}], "=", 
     "\"\<The given field space definition is invalid.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssertFieldSpaceDef", "[", "fields_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"FieldSpaceDefQ", "[", "fields", "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FieldSpaceDefinition", "::", "invalidFieldDefinition"}], 
         "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950785803281868*^9, 3.950785830855114*^9}, {
   3.950786297997837*^9, 3.9507864029709253`*^9}, {3.950787129958323*^9, 
   3.9507871301602573`*^9}, {3.950795998774166*^9, 3.950796005485301*^9}, {
   3.9507965324786587`*^9, 3.950796562931445*^9}, {3.950796680245487*^9, 
   3.950796684703451*^9}, 3.950801142187722*^9, {3.9508637092253017`*^9, 
   3.950863710048918*^9}, {3.9508933587966433`*^9, 3.950893362683991*^9}, {
   3.950964560883992*^9, 3.9509647260060463`*^9}, 3.9509709919521027`*^9, {
   3.95097119902899*^9, 3.950971269684161*^9}, {3.950972406057185*^9, 
   3.950972419055738*^9}, {3.9509729891057043`*^9, 3.9509729901532373`*^9}, {
   3.950973052932276*^9, 3.950973069072235*^9}, {3.950973542193096*^9, 
   3.9509735933051243`*^9}, {3.9509736291278887`*^9, 
   3.9509737236713676`*^9}, {3.950973781220873*^9, 3.950973802678894*^9}, {
   3.950973984287372*^9, 3.950974058340818*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"ffdc8015-4beb-4a8a-9712-899076a5bcad"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.9509737011024*^9},
 CellLabel->
  "In[121]:=",ExpressionUUID->"e6fda6fb-9bcb-45a5-b801-7e006569f014"]
}, Closed]],

Cell[CellGroupData[{

Cell["FSetup", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, 
   3.950964437586562*^9, 
   3.9509736149796743`*^9},ExpressionUUID->"432ab124-4161-47f8-a56b-\
8db469a3db21"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FSetup", "::", "notFSetup"}], "=", 
    "\"\<The given setup is not valid!\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FSetupQ", "[", "setup_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Head", "[", "setup", "]"}], "===", "Association"}], 
           ")"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<A valid setup must be an Association!\>\"", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"Keys", "[", "setup", "]"}], ",", "\"\<FieldSpace\>\""}], 
           "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<A valid setup must have the key \\\"FieldSpace\\\"!\>\"", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"FieldSpaceDefQ", "[", 
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AssertFSetup", "[", "setup_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Head", "[", "setup", "]"}], "===", "Association"}], 
          ")"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "Print", "[", "\"\<A valid setup must be an Association!\>\"", "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"Message", "[", 
          RowBox[{"FSetup", "::", "notFSetup"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Keys", "[", "setup", "]"}], ",", "\"\<FieldSpace\>\""}], 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<A valid setup must have the key \\\"FieldSpace\\\"!\>\"", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Message", "[", 
          RowBox[{"FSetup", "::", "notFSetup"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"AssertFieldSpaceDef", "[", 
       RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950864013876114*^9, 3.950864178121345*^9}, {
  3.950866123517272*^9, 3.9508661552146883`*^9}, {3.95096155740795*^9, 
  3.950961589920692*^9}, {3.9509635332623377`*^9, 3.95096359322543*^9}, {
  3.9509709220279417`*^9, 3.950970986439794*^9}, {3.9509710317799788`*^9, 
  3.950971170043336*^9}, {3.950973871588525*^9, 3.950973901835678*^9}, {
  3.9509739679684*^9, 3.950973970944644*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"11470f5d-e2db-4aaa-9b7e-0a8c11da0687"]
}, Closed]],

Cell[CellGroupData[{

Cell["Existence of a field", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, 
   3.950964437586562*^9, 3.9509736149796743`*^9, {3.951109567275919*^9, 
   3.951109569556551*^9}},ExpressionUUID->"73595dfd-e53e-4d4e-a700-\
40ff68a78e58"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Check", " ", "if", " ", "a", " ", "given", " ", "field", " ", 
     "definition", " ", "is", " ", 
     RowBox[{"valid", ".", " ", "Can"}], " ", "be", " ", "either", " ", "its",
      " ", "own", " ", "anti"}], "-", 
    RowBox[{"field", " ", "or", " ", "a", " ", "pair", " ", 
     RowBox[{"{", 
      RowBox[{"af", ",", "f"}], "}"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FieldQ", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"_Symbol", "[", 
                RowBox[{"_", ",", 
                 RowBox[{"{", "__Symbol", "}"}]}], "]"}]}], "]"}], "||", 
             RowBox[{"MatchQ", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"_Symbol", "[", "_", "]"}]}], "]"}]}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<A field f[x...] must have indices f[p] or f[p,{a,b,...}]. \\\
\"\>\"", ",", "expr", ",", "\"\<\\\" does not fit.\>\""}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Head", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "//", 
                  "Values"}], "//", "Flatten"}]}], "]"}], ",", 
              RowBox[{"Head", "[", "expr", "]"}]}], "]"}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<The field \\\"\>\"", ",", "expr", ",", 
             "\"\<\\\" is not contained in the field space.\>\""}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Field", "::", "invalidField"}], "=", 
     "\"\<The given field `1` does not exist.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssertField", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"FieldQ", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FieldDefinition", "::", "invalidField"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509723959533377`*^9, 3.950972498533544*^9}, {
  3.9509725391754503`*^9, 3.950972839103818*^9}, {3.95097289590053*^9, 
  3.950973043727556*^9}, {3.9509730775238113`*^9, 3.9509730807717524`*^9}, {
  3.950973155496664*^9, 3.950973196313613*^9}, {3.950973268996133*^9, 
  3.950973292848659*^9}, {3.950973323914188*^9, 3.950973407746553*^9}, {
  3.9509734394970713`*^9, 3.950973519577339*^9}, {3.950973729052182*^9, 
  3.9509737667166567`*^9}, {3.9509741552332573`*^9, 3.9509741985720987`*^9}, {
  3.9509742355449142`*^9, 3.9509742565395184`*^9}, {3.9509766019032183`*^9, 
  3.9509766041301928`*^9}, {3.9509766344861717`*^9, 3.950976637210259*^9}, {
  3.9509766769979153`*^9, 3.950976779031054*^9}, {3.9509769256787357`*^9, 
  3.9509769282539797`*^9}, {3.9510498517763968`*^9, 3.951049854349081*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"8025941a-3caa-4a8b-a6f7-d19c65a09782"]
}, Closed]],

Cell[CellGroupData[{

Cell["Derivative List", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, {
  3.950893338644219*^9, 
  3.950893340478217*^9}},ExpressionUUID->"4586692a-ee51-46b9-b58e-\
43bcdb604423"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Check", " ", "a", " ", "derivative", " ", "list", " ", "for", " ", 
    "correct", " ", 
    RowBox[{"formatting", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DerivativeListQ", "[", 
      RowBox[{"setup_", ",", "derivativeList_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Head", "[", "derivativeList", "]"}], "===", "List"}], 
            ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<A valid derivativeList must be an List!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"AllTrue", "[", 
            RowBox[{"derivativeList", ",", 
             RowBox[{
              RowBox[{"FieldQ", "[", 
               RowBox[{"setup", ",", "#"}], "]"}], "&"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<A valid derivativeList must be an List of fields \
f_[p_,{___}] of f_[p_] which have been defined in the setup!\>\"", "]"}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DeriveEquation", "::", "invalidDerivativeList"}], "=", 
     "\"\<The given derivativeList `1` is not valid.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssertDerivativeList", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"DerivativeListQ", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"DeriveEquation", "::", "invalidDerivativeList"}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950864234236211*^9, 3.9508644603567677`*^9}, {
   3.950864514373273*^9, 3.950864523736723*^9}, {3.950865674724793*^9, 
   3.9508656803898973`*^9}, {3.950866001476939*^9, 3.950866011277586*^9}, {
   3.950866277809552*^9, 3.950866291301694*^9}, 3.9508663653146677`*^9, 
   3.95086639713623*^9, {3.95097396076858*^9, 3.950973963799748*^9}, {
   3.9509740743483953`*^9, 3.95097409846065*^9}, {3.9509767888540382`*^9, 
   3.95097688937116*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"d04f551f-63ba-4c59-827e-89539a889eb6"]
}, Closed]],

Cell[CellGroupData[{

Cell["FDOp", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, {
  3.950964433513967*^9, 3.9509644360831413`*^9}, {3.951109340007738*^9, 
  3.9511093407521*^9}},ExpressionUUID->"bb6d67ae-94ea-4de9-ad33-f49796906916"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FDOpQ", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Head", "[", "expr", "]"}], "===", "FDOp"}], ")"}], "&&", 
       RowBox[{"MatchQ", "[", 
        RowBox[{"expr", ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"_", "[", 
            RowBox[{"_", ",", 
             RowBox[{"{", "__", "}"}]}], "]"}], "|", 
           RowBox[{"_", "[", "_", "]"}]}], ")"}]}], "]"}], "&&", 
       RowBox[{"FieldQ", "[", 
        RowBox[{"setup", ",", "#"}], "]"}]}], "&"}], "@@", "expr"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FDOp", "::", "invalid"}], "=", 
    "\"\<`1` is not a valid FDOp.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AssertFDOp", "[", 
    RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"FDOpQ", "[", 
       RowBox[{"setup", ",", "expr"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"FDOp", "::", "invalid"}], ",", "expr"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950959791226129*^9, 3.950959819925836*^9}, {
  3.950959877202113*^9, 3.950959965968995*^9}, {3.951109344001295*^9, 
  3.9511093512403717`*^9}, {3.951109385069475*^9, 3.951109490384367*^9}, {
  3.951109575180601*^9, 3.951109623509289*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"cec32202-2ccb-4a54-a11b-3d74e2fc5239"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Utilities", "Section",
 CellChangeTimes->{{3.932177970725307*^9, 
  3.9321779720559883`*^9}},ExpressionUUID->"bdee160a-1c91-4de1-b52d-\
86eb572207e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{
   "GammaN", ",", "Propagator", ",", "AnyField", ",", "ABasis", ",", 
    "VBasis"}], "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950894219634593*^9, 3.950894225625526*^9}, {
   3.9508945494140673`*^9, 3.9508945506586037`*^9}, 3.950940101789105*^9, {
   3.95097703546941*^9, 3.95097703915795*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"8b16408f-667b-4fec-b260-6fb6db16586b"],

Cell[CellGroupData[{

Cell["Getting symbols", "Subsubsection",
 CellChangeTimes->{{3.951227382795168*^9, 
  3.9512273921081133`*^9}},ExpressionUUID->"d002c263-ec1e-44d9-8d95-\
a0c4fe2e8e78"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"exclusions", "[", "a_", "]"}], ":=", 
  RowBox[{"And", "@@", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"a", "=!=", "List"}], ",", 
     RowBox[{"a", "=!=", "Complex"}], ",", 
     RowBox[{"a", "=!=", "Plus"}], ",", 
     RowBox[{"a", "=!=", "Power"}], ",", 
     RowBox[{"a", "=!=", "Times"}]}], "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetAllSymbols", "[", "expr_", "]"}], ":=", 
  RowBox[{"DeleteDuplicates", "@", 
   RowBox[{"Cases", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "expr", "}"}], "//.", 
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{"a_", ",", "b__"}], "]"}], ":>", 
         RowBox[{"{", 
          RowBox[{"a", ",", "b"}], "}"}]}]}], "//.", 
       RowBox[{
        RowBox[{
         RowBox[{"a_Symbol", "[", "b__", "]"}], "/;", 
         RowBox[{"exclusions", "[", "a", "]"}]}], ":>", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}]}]}], "]"}], ",", 
     "\[IndentingNewLine]", "_Symbol", ",", "\[IndentingNewLine]", 
     "Infinity"}], "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9510242717398663`*^9, 3.951024280343438*^9}, 
   3.951024444887616*^9, {3.951229169059124*^9, 3.9512291793424377`*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"f4704157-c7f9-402c-bf7c-77513ac8ecc7"]
}, Open  ]],

Cell[CellGroupData[{

Cell["FunctionalD", "Subsection",
 CellChangeTimes->{{3.932178009618313*^9, 3.932178022055203*^9}, {
  3.950801118933737*^9, 
  3.950801154023693*^9}},ExpressionUUID->"5193f3f7-8901-4525-bbbc-\
d3fa4695bea7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FunctionalD", "::", "malformed"}], "=", 
    "\"\<Cannot take a derivative of `1`. Expression is either malformed or \
this is a bug.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearAll", "[", "FunctionalD", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FunctionalD", "[", 
     RowBox[{"expr_", ",", 
      RowBox[{"v", ":", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"f_", "[", "_", "]"}], "|", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"f_", "[", "_", "]"}], ",", "_Integer"}], "}"}]}], ")"}], 
        ".."}]}], ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"Internal`InheritedBlock", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "f", ",", "GammaN", ",", "Propagator", ",", "nonConst", ",", "FTerm", 
        ",", "FEq"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nonConst", "=", 
        RowBox[{"Sort", "@", 
         RowBox[{"{", 
          RowBox[{"f", ",", "GammaN", ",", "Propagator", ",", "Power"}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Rule", " ", "for", " ", "normal", " ", "functional", " ", 
         "derivatives"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"f", "[", "x_", "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"\[Gamma]", "[", 
         RowBox[{
          RowBox[{"-", "y"}], ",", "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Ignore", " ", "fields", " ", "without", " ", 
         RowBox[{"indices", ".", " ", "These"}], " ", "are", " ", "usually", 
         " ", "tags"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{"f", ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", "0"}], 
       ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Delta]", "[", 
           RowBox[{"#", ",", "y"}], "]"}], "&"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Unprotect", "[", 
        RowBox[{"GammaN", ",", "Propagator", ",", "FTerm", ",", "FEq"}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Derivative", " ", "rule", " ", "for", " ", "GammaN"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"GammaN", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"GammaN", "[", 
           RowBox[{
            RowBox[{"{", "a__", "}"}], ",", 
            RowBox[{"{", "b__", "}"}]}], "]"}], ",", 
          RowBox[{"f", "[", "if_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"GammaN", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", ",", "a"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "if"}], ",", "b"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Derivative", " ", "rule", " ", "for", " ", "Propagators"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Propagator", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Propagator", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"b_", ",", "a_"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"ib_", ",", "ia_"}], "}"}]}], "]"}], ",", 
          RowBox[{"f", "[", "if_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"Module", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ic", ",", "id", ",", "ie"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Propagator", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"b", ",", "AnyField"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ib", ",", "ic"}], "}"}]}], "]"}], 
           RowBox[{"GammaN", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"f", ",", "AnyField", ",", "AnyField"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "if"}], ",", 
               RowBox[{"-", "ic"}], ",", 
               RowBox[{"-", "id"}]}], "}"}]}], "]"}], 
           RowBox[{"Propagator", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"AnyField", ",", "a"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"id", ",", "ie"}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], 
           RowBox[{"\[Gamma]", "[", 
            RowBox[{"ia", ",", 
             RowBox[{"-", "ie"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"No", " ", "derivatives", " ", "of", " ", "FTerm"}], ",", 
         " ", "FEq"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FTerm", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"FTerm", "[", "a___", "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"FunctionalD", "::", "malformed"}], ",", 
            RowBox[{"FTerm", "[", "a", "]"}]}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"FEq", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"FEq", "[", "a___", "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"FunctionalD", "::", "malformed"}], ",", 
            RowBox[{"FEq", "[", "a", "]"}]}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Chain", " ", "rules"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"g_", "[", 
           RowBox[{"FTerm", "[", "a___", "]"}], "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"g", "'"}], "[", 
            RowBox[{"FTerm", "[", "a", "]"}], "]"}], "]"}], "**", 
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"FDOp", "[", 
             RowBox[{"f", "[", "y", "]"}], "]"}], ",", "a"}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"FTerm", "[", "a___", "]"}], ",", "b_"}], "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"FTerm", "[", 
           RowBox[{"b", ",", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"FTerm", "[", "a", "]"}], ",", 
              RowBox[{"b", "-", "1"}]}], "]"}]}], "]"}], "**", 
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"FDOp", "[", 
             RowBox[{"f", "[", "y", "]"}], "]"}], ",", "a"}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_", ",", 
            RowBox[{"FTerm", "[", "b___", "]"}]}], "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"Log", "[", "a", "]"}], ",", 
            RowBox[{"Power", "[", 
             RowBox[{"a", ",", 
              RowBox[{"FTerm", "[", "b", "]"}]}], "]"}]}], "]"}], "**", 
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"FDOp", "[", 
             RowBox[{"f", "[", "y", "]"}], "]"}], ",", "b"}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Protect", "[", 
        RowBox[{"GammaN", ",", "Propagator", ",", "FTerm", ",", "FEq"}], 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"D", "[", 
        RowBox[{"expr", ",", "v", ",", 
         RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FunctionalD", "::", "badArgumentFTerm"}], "=", 
   "\"\<Cannot take derivative of an FTerm. Use DeriveFunctional \
instead.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FunctionalD", "[", 
     RowBox[{
      RowBox[{"FTerm", "[", "expr_", "]"}], ",", 
      RowBox[{"v", ":", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"f_", "[", "_", "]"}], "|", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"f_", "[", "_", "]"}], ",", "_Integer"}], "}"}]}], ")"}], 
        ".."}]}], ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"FunctionalD", "::", "badArgumentFTerm"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FunctionalD", "::", "badArgumentFEq"}], "=", 
   "\"\<Cannot take derivative of an FEq. Use DeriveFunctional \
instead.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FunctionalD", "[", 
    RowBox[{
     RowBox[{"FEq", "[", "___", "]"}], ",", 
     RowBox[{"v", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"f_", "[", "_", "]"}], "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"f_", "[", "_", "]"}], ",", "_Integer"}], "}"}]}], ")"}], 
       ".."}]}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"FunctionalD", "::", "badArgumentFEq"}], "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950801155924999*^9, 3.950801156180604*^9}, 
   3.9508745541091022`*^9, {3.950874630546281*^9, 3.9508746344224*^9}, {
   3.9508746716147623`*^9, 3.950874843953817*^9}, {3.950874911320944*^9, 
   3.950874967970771*^9}, {3.9508750098040237`*^9, 3.9508750233744373`*^9}, {
   3.9508750787554817`*^9, 3.950875148206582*^9}, 3.9508752181802464`*^9, {
   3.9508940369998207`*^9, 3.9508941754057407`*^9}, {3.950894207218882*^9, 
   3.950894268707493*^9}, {3.9508943099823914`*^9, 3.950894364887673*^9}, {
   3.950894405287778*^9, 3.9508945587833138`*^9}, {3.9508969076834803`*^9, 
   3.9508969664507713`*^9}, {3.950897004655106*^9, 3.950897015070427*^9}, 
   3.9508971564032593`*^9, {3.950897870040359*^9, 3.950897884551845*^9}, {
   3.950897973224579*^9, 3.9508980022919607`*^9}, {3.9509326427332706`*^9, 
   3.95093266159977*^9}, {3.950939662750992*^9, 3.950939674049011*^9}, {
   3.950939753193946*^9, 3.950939895705489*^9}, {3.95093993866444*^9, 
   3.950939957812808*^9}, {3.9509401218698893`*^9, 3.9509401363101273`*^9}, {
   3.950952533276232*^9, 3.950952545138974*^9}, {3.95095258820336*^9, 
   3.950952722829163*^9}, {3.950952869771017*^9, 3.950953031163056*^9}, {
   3.950977047894329*^9, 3.950977350633822*^9}, {3.951195240203231*^9, 
   3.951195388802322*^9}, {3.951195471889974*^9, 3.951195473766608*^9}, {
   3.9511956520381613`*^9, 3.951195788170877*^9}, {3.9511959410810537`*^9, 
   3.951196141638171*^9}, {3.951196344392086*^9, 3.951196366474864*^9}, {
   3.951196844077084*^9, 3.951196875012323*^9}, {3.951197122093006*^9, 
   3.9511971892386637`*^9}, {3.951197222455007*^9, 3.9511972662623672`*^9}, 
   3.951197330985343*^9, {3.951197540127527*^9, 3.951197713002768*^9}, {
   3.9511977856706*^9, 3.951197818994656*^9}, {3.951197859170909*^9, 
   3.9511978849442472`*^9}, {3.951197917748715*^9, 3.951197953999455*^9}, {
   3.951198041247632*^9, 3.951198053693543*^9}, {3.951198099815494*^9, 
   3.951198115660613*^9}, {3.951198148168233*^9, 3.9511981579505587`*^9}, {
   3.9511981890961323`*^9, 3.95119819493015*^9}, {3.951198226487218*^9, 
   3.9511983610114326`*^9}, {3.951212249172265*^9, 3.9512122738997297`*^9}, {
   3.951212336789455*^9, 3.95121235450749*^9}, {3.9512124129764843`*^9, 
   3.951212432487711*^9}, {3.951212477416629*^9, 3.951212621805851*^9}, {
   3.951212679266748*^9, 3.951212717406486*^9}, {3.9512127594075603`*^9, 
   3.951212800564825*^9}, {3.951212848069742*^9, 3.951212852984906*^9}, {
   3.9512128925965843`*^9, 3.9512128932405643`*^9}, 3.951212942528529*^9, {
   3.951213304723278*^9, 3.9512133814804163`*^9}, {3.9512135401374474`*^9, 
   3.9512135831050463`*^9}, {3.9512136829537783`*^9, 3.95121377398514*^9}, {
   3.951213841275055*^9, 3.9512138820107107`*^9}, {3.951214165220489*^9, 
   3.951214166107987*^9}, {3.951214264868593*^9, 3.951214265319968*^9}, {
   3.951214410771542*^9, 3.951214552289424*^9}, {3.951214666616063*^9, 
   3.951214683032452*^9}, {3.9512147251411657`*^9, 3.9512148731638536`*^9}, 
   3.951214948313456*^9, {3.951215032782189*^9, 3.9512150650325613`*^9}, 
   3.9512151161690197`*^9, {3.9512152756823273`*^9, 3.951215285333046*^9}, 
   3.951215323874226*^9, {3.951215389461582*^9, 3.951215459245329*^9}, {
   3.9512155060238323`*^9, 3.9512155379434958`*^9}, {3.95121557326906*^9, 
   3.951215573427577*^9}, {3.9512156059663343`*^9, 3.95121587158613*^9}, {
   3.951215903365415*^9, 3.951215904513631*^9}, {3.951215980269064*^9, 
   3.9512159890299873`*^9}, {3.9512160291775017`*^9, 3.95121607124547*^9}, {
   3.951216118275013*^9, 3.95121623279858*^9}, {3.951219946242391*^9, 
   3.951219968247802*^9}, {3.951220438913568*^9, 3.9512204416073923`*^9}, {
   3.9512205345107737`*^9, 3.95122053549841*^9}, {3.951231437902248*^9, 
   3.9512314416134233`*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"428f55da-c8db-4d63-89da-51a880a4e13f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field and index information", "Subsection",
 CellChangeTimes->{{3.932178009618313*^9, 3.932178022055203*^9}, {
  3.95097752282972*^9, 
  3.950977525821363*^9}},ExpressionUUID->"a703f905-419d-403f-a28c-\
a63b6e5d0fbc"],

Cell[CellGroupData[{

Cell["Fields", "Subsubsection",
 CellChangeTimes->{{3.950977858978568*^9, 
  3.9509778685688467`*^9}},ExpressionUUID->"807846d5-0a8e-42e1-8499-\
9436b99fe5c0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetcFields", "[", "setup_", "]"}], ":=", 
   RowBox[{"Map", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
        RowBox[{"Head", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
      "\"\<cField\>\"", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetAnticFields", "[", "setup_", "]"}], ":=", 
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
           RowBox[{"Head", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", "}"}]}], "]"}], "&"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
         "\"\<cField\>\"", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
      RowBox[{
       RowBox[{"#", "=!=", 
        RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetGrassmanns", "[", "setup_", "]"}], ":=", 
   RowBox[{"Map", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
        RowBox[{"Head", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
      "\"\<Grassmann\>\"", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetAntiGrassmanns", "[", "setup_", "]"}], ":=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"Map", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
          RowBox[{"Head", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", "}"}]}], "]"}], "&"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
        "\"\<Grassmann\>\"", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
     RowBox[{
      RowBox[{"#", "=!=", 
       RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.932178093219666*^9, {3.932220707851465*^9, 3.932220747249592*^9}, {
   3.950800893485785*^9, 3.950800987632131*^9}, {3.9508016274975567`*^9, 
   3.950801660952232*^9}, {3.95086373016462*^9, 3.95086377625705*^9}, {
   3.950977908402094*^9, 3.9509779098545*^9}, {3.95097858078232*^9, 
   3.950978634866104*^9}, {3.950978675954303*^9, 3.9509786993099747`*^9}, 
   3.950978744078698*^9, {3.951022968366856*^9, 3.951023141306739*^9}, {
   3.9510232320318317`*^9, 3.951023236902824*^9}, {3.951023401747789*^9, 
   3.951023405927434*^9}, {3.951023697339532*^9, 3.9510237141319427`*^9}, {
   3.9510240171202173`*^9, 3.951024058934989*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"3518af78-5ff7-49ca-9232-57a8cda2059b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetFieldPairs", "[", "setup_", "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Head", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
         RowBox[{"Head", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Select", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
           "\"\<Grassmann\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
           "\"\<cField\>\"", "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "===", "List"}], "&"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetSingleFields", "[", "setup_", "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "#", "]"}], "&"}], ",", 
      RowBox[{"Select", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
           "\"\<Grassmann\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
           "\"\<cField\>\"", "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "=!=", "List"}], "&"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetAllFields", "[", "setup_", "]"}], ":=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Flatten", "@", 
       RowBox[{"GetFieldPairs", "[", "setup", "]"}]}], ",", 
      RowBox[{"GetSingleFields", "[", "setup", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HasPartnerField", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Flatten", "@", 
      RowBox[{"GetFieldPairs", "[", "setup", "]"}]}], ",", 
     "\[IndentingNewLine]", "field"}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HasPartnerField", "[", 
     RowBox[{"setup_", ",", 
      RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
    RowBox[{"HasPartnerField", "[", 
     RowBox[{"setup", ",", "field"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsGrassmann", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"GetGrassmanns", "[", "setup", "]"}], ",", "field", ",", 
     "Infinity"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IsGrassmann", "[", 
     RowBox[{"setup_", ",", 
      RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
    RowBox[{"IsGrassmann", "[", 
     RowBox[{"setup", ",", "field"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsAntiGrassmann", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"GetAntiGrassmanns", "[", "setup", "]"}], ",", "field", ",", 
     "Infinity"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IsAntiGrassmann", "[", 
     RowBox[{"setup_", ",", 
      RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
    RowBox[{"IsAntiGrassmann", "[", 
     RowBox[{"setup", ",", "field"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IscField", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"GetcFields", "[", "setup", "]"}], ",", "field", ",", 
     "Infinity"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IscField", "[", 
     RowBox[{"setup_", ",", 
      RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
    RowBox[{"IscField", "[", 
     RowBox[{"setup", ",", "field"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsAnticField", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"GetAnticFields", "[", "setup", "]"}], ",", "field", ",", 
     "Infinity"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsAnticField", "[", 
    RowBox[{"setup_", ",", 
     RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
   RowBox[{"IsAnticField", "[", 
    RowBox[{"setup", ",", "field"}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951023163939932*^9, 3.951023253706765*^9}, {
  3.9510232893183107`*^9, 3.9510233580953617`*^9}, {3.951023414375457*^9, 
  3.951023635439684*^9}, {3.951023724604463*^9, 3.951023800417603*^9}, {
  3.951024061485753*^9, 3.9510240986479816`*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"51b5119b-7ed2-4d4e-8157-9da88d9e51a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetPartnerField", "[", 
    RowBox[{"setup_", ",", "field_Symbol"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pairs", ",", "sel"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"HasPartnerField", "[", 
          RowBox[{"setup", ",", "field"}], "]"}]}], ",", 
        RowBox[{"Return", "[", "field", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"pairs", "=", 
       RowBox[{"GetFieldPairs", "[", "setup", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"sel", "=", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"pairs", ",", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"#", ",", "field", ",", "Infinity"}], "]"}], "&"}]}], 
         "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sel", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"sel", ",", "field"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "sel", "]"}], ">", "0"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"sel", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<field \>\"", ",", "field", ",", "\"\< not found!\>\""}], 
       "]"}], ";", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetPartnerField", "[", 
   RowBox[{"setup_", ",", 
    RowBox[{"field_Symbol", "[", "i__", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"GetPartnerField", "[", 
    RowBox[{"setup", ",", "field"}], "]"}], "[", "i", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.932310703182301*^9, {3.9508008732217073`*^9, 3.950800905255765*^9}, 
   3.950874299413641*^9, {3.951023598531598*^9, 3.951023612563867*^9}, {
   3.951023642999547*^9, 3.9510236672477427`*^9}, {3.951023815416168*^9, 
   3.951023941927535*^9}},
 CellLabel->"In[96]:=",ExpressionUUID->"f9e7b8dd-479d-4f1c-b30c-43e82a8f1466"]
}, Closed]],

Cell[CellGroupData[{

Cell["Checking field content of expressions", "Subsubsection",
 CellChangeTimes->{{3.9510239782885523`*^9, 
  3.951023985187344*^9}},ExpressionUUID->"d2a5f7e9-fbf3-48fd-896b-\
3c3a13529cd2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExtractFields", "[", 
    RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "symbols", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"symbols", "=", 
       RowBox[{"GetAllSymbols", "[", "expr", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "@", 
       RowBox[{"Select", "[", 
        RowBox[{"symbols", ",", 
         RowBox[{
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"GetAllFields", "[", "setup", "]"}], ",", "#"}], "]"}], 
          "&"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtractFieldsWithIndex", "[", 
    RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"fields", ",", "extracted"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fields", "=", 
       RowBox[{"ExtractFields", "[", 
        RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"extracted", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"expr", "//.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"a_", "[", "b_", "]"}], "/;", 
          RowBox[{"MemberQ", "[", 
           RowBox[{"fields", ",", "a"}], "]"}]}], ":>", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"extracted", ",", 
             RowBox[{"a", "[", "b", "]"}]}], "]"}], ";", "1"}], ")"}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "extracted", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951024006516164*^9, 3.951024008440085*^9}, {
  3.951024116163844*^9, 3.951024187756226*^9}, {3.951024231427863*^9, 
  3.951024239820277*^9}, {3.951024468384468*^9, 3.951024487333744*^9}},
 CellLabel->"In[98]:=",ExpressionUUID->"84ac980c-3e5a-487b-a821-389318a8bd26"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ContainsGrassmann", "[", 
   RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "fields", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fields", "=", 
      RowBox[{"ExtractFields", "[", 
       RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "\[IndentingNewLine]", 
      RowBox[{"AnyTrue", "[", 
       RowBox[{"fields", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"IsGrassmann", "[", 
           RowBox[{"setup", ",", "#"}], "]"}], "||", 
          RowBox[{"IsAntiGrassmann", "[", 
           RowBox[{"setup", ",", "#"}], "]"}]}], "&"}]}], "]"}], 
      "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GrassmannCount", "[", 
   RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "fields", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fields", "=", 
      RowBox[{"ExtractFieldsWithIndex", "[", 
       RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Length", "@", "\[IndentingNewLine]", 
       RowBox[{"Select", "[", 
        RowBox[{"fields", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"IsGrassmann", "[", 
            RowBox[{"setup", ",", 
             RowBox[{"Head", "[", "#", "]"}]}], "]"}], "||", 
           RowBox[{"IsAntiGrassmann", "[", 
            RowBox[{"setup", ",", 
             RowBox[{"Head", "[", "#", "]"}]}], "]"}]}], "&"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950801014829342*^9, 3.950801089487433*^9}, {
   3.9508016734862947`*^9, 3.950801789647143*^9}, {3.950802396390094*^9, 
   3.95080251586098*^9}, {3.9508025705613623`*^9, 3.9508025986163673`*^9}, {
   3.950802685581463*^9, 3.950802850019553*^9}, {3.95080288950806*^9, 
   3.950802891116541*^9}, 3.950977841322421*^9, 3.9510239548515882`*^9, {
   3.951047050359741*^9, 3.951047092694622*^9}},
 CellLabel->
  "In[100]:=",ExpressionUUID->"e0675219-06d7-4260-b88e-aecc77330bb2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Indices", "Subsubsection",
 CellChangeTimes->{{3.950801271735565*^9, 3.95080128037481*^9}, {
  3.950854198551154*^9, 
  3.950854199116568*^9}},ExpressionUUID->"4d34a9f6-835b-4d0e-bded-\
e4ef20d68c82"],

Cell[CellGroupData[{

Cell[BoxData["a"], "Input",
 CellChangeTimes->{{3.951233238315844*^9, 3.951233252303179*^9}},
 CellLabel->
  "In[386]:=",ExpressionUUID->"c5165d89-fc29-4ad4-97f2-1fb3dee0e16e"],

Cell[BoxData["a"], "Output",
 CellChangeTimes->{{3.951233239609692*^9, 3.951233252724235*^9}},
 CellLabel->
  "Out[386]=",ExpressionUUID->"b595cd4d-42e9-403e-975e-1d70a7d367cf"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Get", " ", "a", " ", "list", " ", "of", " ", "all", " ", "unique", " ", 
     "super"}], "-", 
    RowBox[{
    "indices", " ", "within", " ", "the", " ", "expression", " ", "expr"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"GetAllSuperIndices", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"fields", ",", "indices", ",", "i", ",", "j"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fields", "=", 
        RowBox[{"ExtractFieldsWithIndex", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"indices", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"fields", "//.", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"p_", "[", 
            RowBox[{"Times", "[", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "a_"}], "]"}], "]"}], "/;", 
           RowBox[{"exclusions", "[", "p", "]"}]}], ":>", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"indices", ",", "a"}], "]"}], ";", "1"}], ")"}]}]}], "//.",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"p_", "[", "a_", "]"}], "/;", 
          RowBox[{"exclusions", "[", "p", "]"}]}], ":>", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"indices", ",", "a"}], "]"}], ";", "1"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"expr", "//.", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"$indexedObjects", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{
               RowBox[{"{", "f__", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 TagBox[
                  StyleBox[
                   RowBox[{"Times", "[", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", 
                    RowBox[{"a", ":", 
                    RowBox[{"(", 
                    RowBox[{
                    "_Symbol", "|", "_Subscript", "|", "_Superscript"}], 
                    ")"}]}]}], "]"}],
                   ShowSpecialCharacters->False,
                   ShowStringCharacters->True,
                   NumberMarks->True],
                  FullForm], ",", "b___"}], "}"}]}], "]"}], ":>", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"AppendTo", "[", 
                RowBox[{"indices", ",", "a"}], "]"}], ";", 
               RowBox[{
                RowBox[{"$indexedObjects", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"{", "f", "}"}], ",", 
                 RowBox[{"{", "b", "}"}]}], "]"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"$indexedObjects", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", 
              RowBox[{
               RowBox[{"{", "f__", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 TagBox[
                  RowBox[{"a", ":", 
                   RowBox[{"(", 
                    RowBox[{
                    "_Symbol", "|", "_Subscript", "|", "_Superscript"}], 
                    ")"}]}],
                  FullForm], ",", "b___"}], "}"}]}], "]"}], ":>", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"AppendTo", "[", 
                RowBox[{"indices", ",", "a"}], "]"}], ";", 
               RowBox[{
                RowBox[{"$indexedObjects", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"{", "f", "}"}], ",", 
                 RowBox[{"{", "b", "}"}]}], "]"}]}], ")"}]}]}], 
           "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "$indexedObjects", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"expr", "//.", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Delta]", "[", 
            RowBox[{
             TagBox[
              StyleBox[
               RowBox[{"Times", "[", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", 
                 RowBox[{"a", ":", 
                  RowBox[{"(", 
                   RowBox[{
                   "_Symbol", "|", "_Subscript", "|", "_Superscript"}], 
                   ")"}]}]}], "]"}],
               ShowSpecialCharacters->False,
               ShowStringCharacters->True,
               NumberMarks->True],
              FullForm], ",", "b___"}], "]"}], ":>", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"indices", ",", "a"}], "]"}], ";", 
             RowBox[{"\[Delta]", "[", "b", "]"}]}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\[Delta]", "[", 
            RowBox[{
             RowBox[{"a", ":", 
              RowBox[{"(", 
               RowBox[{"_Symbol", "|", "_Subscript", "|", "_Superscript"}], 
               ")"}]}], ",", "b___"}], "]"}], ":>", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"indices", ",", "a"}], "]"}], ";", 
             RowBox[{"\[Delta]", "[", "b", "]"}]}], ")"}]}]}], 
         "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"expr", "//.", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Gamma]", "[", 
            RowBox[{
             TagBox[
              StyleBox[
               RowBox[{"Times", "[", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", 
                 RowBox[{"a", ":", 
                  RowBox[{"(", 
                   RowBox[{
                   "_Symbol", "|", "_Subscript", "|", "_Superscript"}], 
                   ")"}]}]}], "]"}],
               ShowSpecialCharacters->False,
               ShowStringCharacters->True,
               NumberMarks->True],
              FullForm], ",", "b___"}], "]"}], ":>", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"indices", ",", "a"}], "]"}], ";", 
             RowBox[{"\[Gamma]", "[", "b", "]"}]}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\[Gamma]", "[", 
            RowBox[{
             RowBox[{"a", ":", 
              RowBox[{"(", 
               RowBox[{"_Symbol", "|", "_Subscript", "|", "_Superscript"}], 
               ")"}]}], ",", "b___"}], "]"}], ":>", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"indices", ",", "a"}], "]"}], ";", 
             RowBox[{"\[Gamma]", "[", "b", "]"}]}], ")"}]}]}], 
         "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"indices", "//", "DeleteDuplicates"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951107115870104*^9, 3.951107119664289*^9}, {
   3.951232666728512*^9, 3.9512327307721777`*^9}, {3.951232768256838*^9, 
   3.951232797687828*^9}, {3.951232852977048*^9, 3.951232854904772*^9}, 
   3.951232896832637*^9, {3.951233051337117*^9, 3.9512330784720984`*^9}, {
   3.9512331145693483`*^9, 3.951233116819352*^9}, {3.951233193304516*^9, 
   3.9512332286202087`*^9}, {3.9512332870017033`*^9, 3.951233461017544*^9}},
 CellLabel->
  "In[421]:=",ExpressionUUID->"935d09a0-331b-40fc-a467-f0134b7e4304"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExtractObjectsWithIndex", "[", 
    RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"indices", ",", "flattened", ",", "objects"}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"indices", "=", 
       RowBox[{"GetAllSuperIndices", "[", 
        RowBox[{"Setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FTermQ", "[", "expr", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"flattened", "=", 
          RowBox[{"Times", "@@", "expr"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"objects", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"flattened", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_Symbol", "[", "b__", "]"}], "/;", 
            RowBox[{
             RowBox[{"ContainsAny", "[", 
              RowBox[{
               RowBox[{"Flatten", "@", 
                RowBox[{"{", "b", "}"}]}], ",", 
               RowBox[{"indices", "\[Union]", 
                RowBox[{"(", 
                 RowBox[{"-", "indices"}], ")"}]}]}], "]"}], "&&", 
             RowBox[{"exclusions", "[", "a", "]"}]}]}], ":>", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"objects", ",", 
               RowBox[{"a", "[", "b", "]"}]}], "]"}], ";", "1"}], ")"}]}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "objects", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FEqQ", "[", "expr", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"flattened", "=", 
          RowBox[{"Times", "@@", 
           RowBox[{"(", 
            RowBox[{"Join", "@@", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"List", "@@", "#"}], "&"}], ",", "expr"}], "]"}]}], 
            ")"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"objects", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"flattened", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_Symbol", "[", "b__", "]"}], "/;", 
            RowBox[{
             RowBox[{"ContainsAny", "[", 
              RowBox[{
               RowBox[{"{", "b", "}"}], ",", 
               RowBox[{"indices", "\[Union]", 
                RowBox[{"(", 
                 RowBox[{"-", "indices"}], ")"}]}]}], "]"}], "&&", 
             RowBox[{"exclusions", "[", "a", "]"}]}]}], ":>", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"objects", ",", 
               RowBox[{"a", "[", "b", "]"}]}], "]"}], ";", "1"}], ")"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"flattened", "//.", 
          RowBox[{
           RowBox[{
            RowBox[{"a_Symbol", "[", 
             RowBox[{
              RowBox[{"{", "f__", "}"}], ",", 
              RowBox[{"{", "i__", "}"}]}], "]"}], "/;", 
            RowBox[{
             RowBox[{"ContainsAny", "[", 
              RowBox[{
               RowBox[{"{", "i", "}"}], ",", 
               RowBox[{"indices", "\[Union]", 
                RowBox[{"(", 
                 RowBox[{"-", "indices"}], ")"}]}]}], "]"}], "&&", 
             RowBox[{"exclusions", "[", "a", "]"}]}]}], ":>", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"objects", ",", 
               RowBox[{"a", "[", 
                RowBox[{
                 RowBox[{"{", "f", "}"}], ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], "]"}], ";", "1"}], 
            ")"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "objects", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Expression \\\"\>\"", ",", "expr", ",", 
        "\"\<\\\" is neither an FTerm nor an FEq!\>\""}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950854493144973*^9, 3.950854569452779*^9}, {
   3.950854604452739*^9, 3.950854680324503*^9}, {3.950854996656869*^9, 
   3.9508550481848717`*^9}, {3.950859645548572*^9, 3.950859785007856*^9}, {
   3.950860303344551*^9, 3.9508603107335377`*^9}, {3.950861168268649*^9, 
   3.950861274048501*^9}, {3.950861304120777*^9, 3.9508613153605413`*^9}, {
   3.950861367012312*^9, 3.9508614126049147`*^9}, {3.950861453960935*^9, 
   3.9508615591409407`*^9}, {3.950861602551324*^9, 3.9508616765664988`*^9}, {
   3.950873227322419*^9, 3.950873227634747*^9}, {3.9508733445328627`*^9, 
   3.9508733890321093`*^9}, {3.9508734300279284`*^9, 
   3.9508735030787888`*^9}, {3.950873533774803*^9, 3.950873574626863*^9}, {
   3.950873628353125*^9, 3.950873634368539*^9}, {3.9508736653917418`*^9, 
   3.950873725638062*^9}, {3.950977542870824*^9, 3.950977615051394*^9}, 
   3.950977666576852*^9, {3.950977824426978*^9, 3.950977824803349*^9}, {
   3.951048475057866*^9, 3.9510485002012367`*^9}, {3.951048586276622*^9, 
   3.951048595044265*^9}, {3.95104863795863*^9, 3.951048654139003*^9}, {
   3.951048871382616*^9, 3.951049094164*^9}, {3.951049522508106*^9, 
   3.951049543225523*^9}, {3.95104967655072*^9, 3.9510497051863403`*^9}, {
   3.9511067302213497`*^9, 3.951106791491743*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"f8e80e20-24a8-4ec6-ba4f-132db5be82fc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SuperIndices", "::", "undeterminedSums"}], "=", 
    "\"\<There are indices with count > 2 in the expression\n    `1`\nThis is \
not allowed for valid terms/equation. Problematic indices:\n    `2`\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"hideSubSuper", "[", "expr_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"expr", "//.", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"a_Symbol", ",", 
            RowBox[{"b_", ":", 
             RowBox[{"(", 
              RowBox[{"_Integer", "|", "_Symbol"}], ")"}]}]}], "]"}], ":>", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "a", "]"}], "<>", "\"\<SUBSCRIPT\>\"", "<>", 
            RowBox[{"ToString", "[", "b", "]"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Superscript", "[", 
           RowBox[{"a_Symbol", ",", 
            RowBox[{"b_", ":", 
             RowBox[{"(", 
              RowBox[{"_Integer", "|", "_Symbol"}], ")"}]}]}], "]"}], ":>", 
          RowBox[{"Symbol", "[", 
           RowBox[{
            RowBox[{"ToString", "[", "a", "]"}], "<>", "\"\<SUPERSCRIPT\>\"", 
            "<>", 
            RowBox[{"ToString", "[", "b", "]"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Get", " ", "a", " ", "list", " ", "of", " ", "all", " ", "open", " ", 
     "super"}], "-", 
    RowBox[{
    "indices", " ", "within", " ", "the", " ", "expression", " ", "expr"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetOpenIndices", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"objects", ",", "indices", ",", "count", ",", "pick"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"objects", "=", 
        RowBox[{"ExtractObjectsWithIndex", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"indices", "=", 
        RowBox[{"GetAllSuperIndices", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"count", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{"objects", "//", "hideSubSuper"}], ",", "#", ",", 
             "Infinity"}], "]"}], "&"}], ",", 
          RowBox[{"indices", "//", "hideSubSuper"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pick", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", " ", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"count", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "2"}], "]"}], "==", 
             "0"}], ",", "False", ",", "True"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "indices", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"AnyTrue", "[", 
          RowBox[{"count", ",", 
           RowBox[{
            RowBox[{"#", ">", "2"}], "&"}]}], "]"}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SuperIndices", "::", "undeterminedSums"}], ",", "expr", 
            ",", 
            RowBox[{"Pick", "[", 
             RowBox[{"indices", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", ">", "2"}], "&"}], "/@", "count"}]}], "]"}]}], 
           "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Pick", "[", 
         RowBox[{"indices", ",", "pick"}], "]"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Get", " ", "a", " ", "list", " ", "of", " ", "all", " ", "closed", " ", 
     "super"}], "-", 
    RowBox[{
    "indices", " ", "within", " ", "the", " ", "expression", " ", "expr"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetClosedSuperIndices", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"objects", ",", "indices", ",", "count", ",", "pick"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"objects", "=", 
        RowBox[{"ExtractObjectsWithIndex", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"indices", "=", 
        RowBox[{"GetAllSuperIndices", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"count", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{"objects", "//", "hideSubSuper"}], ",", "#", ",", 
             "Infinity"}], "]"}], "&"}], ",", 
          RowBox[{"indices", "//", "hideSubSuper"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"AnyTrue", "[", 
          RowBox[{"count", ",", 
           RowBox[{
            RowBox[{"#", ">", "2"}], "&"}]}], "]"}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SuperIndices", "::", "undeterminedSums"}], ",", "expr", 
            ",", 
            RowBox[{"Pick", "[", 
             RowBox[{"indices", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", ">", "2"}], "&"}], "/@", "count"}]}], "]"}]}], 
           "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"pick", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", " ", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"count", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "2"}], "]"}], "!=", 
             "0"}], ",", "False", ",", "True"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "indices", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Pick", "[", 
         RowBox[{"indices", ",", "pick"}], "]"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Get", " ", "a", " ", "list", " ", "of", " ", "all", " ", "open", " ", 
     "super"}], "-", 
    RowBox[{
    "indices", " ", "within", " ", "the", " ", "expression", " ", "expr"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SuperIndicesValid", "[", 
    RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"objects", ",", "indices", ",", "count"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"objects", "=", 
       RowBox[{"ExtractObjectsWithIndex", "[", 
        RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", 
       RowBox[{"GetAllSuperIndices", "[", 
        RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"count", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Count", "[", 
           RowBox[{
            RowBox[{"objects", "//", "hideSubSuper"}], ",", "#", ",", 
            "Infinity"}], "]"}], "&"}], ",", 
         RowBox[{"indices", "//", "hideSubSuper"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"AnyTrue", "[", 
         RowBox[{"count", ",", 
          RowBox[{
           RowBox[{"#", ">", "2"}], "&"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"SuperIndices", "::", "undeterminedSums"}], ",", "expr", 
           ",", 
           RowBox[{"Pick", "[", 
            RowBox[{"indices", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", ">", "2"}], "&"}], "/@", "count"}]}], "]"}]}], 
          "]"}], ";", 
         RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9508542004410467`*^9, 3.9508544749252157`*^9}, {
   3.950861781076435*^9, 3.950861866017157*^9}, {3.950861904572686*^9, 
   3.950862122741899*^9}, 3.950862250128793*^9, {3.9508623533294363`*^9, 
   3.950862473344803*^9}, {3.950862503549046*^9, 3.950862504168859*^9}, {
   3.950862808761071*^9, 3.95086284882382*^9}, {3.9508724621909122`*^9, 
   3.9508725163422728`*^9}, {3.950872679755715*^9, 3.950872742486643*^9}, {
   3.950873274979582*^9, 3.9508733202595463`*^9}, {3.9508736487671967`*^9, 
   3.950873654067449*^9}, {3.9510491583749323`*^9, 3.951049163421998*^9}, {
   3.951049235218823*^9, 3.951049243994762*^9}, {3.951049428748899*^9, 
   3.951049437502572*^9}, {3.951049503039259*^9, 3.951049505389997*^9}, 
   3.9510495609135113`*^9, {3.9510495984105787`*^9, 3.9510496300825567`*^9}, {
   3.9510497431225443`*^9, 3.951049751762602*^9}, 3.951049797343923*^9, 
   3.951057349023424*^9, {3.951106795019677*^9, 3.951106799162589*^9}, {
   3.951106990904499*^9, 3.951107063520145*^9}, {3.951229079559609*^9, 
   3.9512291363161707`*^9}, {3.951229194557047*^9, 3.9512291970249243`*^9}, {
   3.9512309838719883`*^9, 3.9512310891132097`*^9}, {3.95123115620091*^9, 
   3.951231159935547*^9}, {3.951232161292356*^9, 3.9512322491452513`*^9}, {
   3.951232297416614*^9, 3.951232398748467*^9}},
 CellLabel->
  "In[307]:=",ExpressionUUID->"9f3b0ea7-2af5-48b1-84b3-46146be887b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Check", " ", "whether", " ", "all", " ", "indices", " ", "are", " ", 
     "closed", " ", "within", " ", 
     RowBox[{"expr", ".", " ", "\[IndentingNewLine]", "This"}], " ", 
     "disallows", " ", "also", " ", "multiple", " ", "use", " ", "of", " ", 
     "a", " ", "single", " ", "index", " ", "name"}], ",", " ", 
    RowBox[{"!", 
     RowBox[{"anywhere", "!"}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"AllIndicesClosed", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"objects", ",", "indices", ",", "count", ",", "valid"}], "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"objects", "=", 
        RowBox[{"ExtractObjectsWithIndex", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"indices", "=", 
        RowBox[{"GetAllSuperIndices", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"count", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{"objects", "//", "hideSubSuper"}], ",", "#", ",", 
             "Infinity"}], "]"}], "&"}], ",", 
          RowBox[{"indices", "//", "hideSubSuper"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"valid", "=", 
        RowBox[{"AllTrue", "[", 
         RowBox[{"count", ",", 
          RowBox[{
           RowBox[{"#", "==", "2"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "valid", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.950862410027896*^9, {3.9508628529163237`*^9, 3.9508628920401497`*^9}, 
   3.9510491668196583`*^9, {3.951232402828401*^9, 3.9512324069834948`*^9}},
 CellLabel->
  "In[312]:=",ExpressionUUID->"3edfcfc0-c624-46bc-ab09-a08de412f0d7"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Ordering", "Subsection",
 CellChangeTimes->{{3.932178009618313*^9, 3.932178022055203*^9}, {
  3.950801118933737*^9, 3.950801154023693*^9}, {3.9509401502822638`*^9, 
  3.950940151040942*^9}},ExpressionUUID->"1785af53-7c89-486a-9e5f-\
2cc90ee5d4f8"],

Cell[CellGroupData[{

Cell["Setting the canonical ordering", "Subsubsection",
 CellChangeTimes->{{3.950940652516369*^9, 
  3.950940658984301*^9}},ExpressionUUID->"6b5ad42c-f028-4331-8dd5-\
edca6279d9c9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$AvailableCanonicalOrderings", "=", 
    RowBox[{"{", 
     RowBox[{
     "\"\<f>af>b\>\"", ",", "\"\<af>f>b\>\"", ",", "\"\<b>f>af\>\"", ",", 
      "\"\<b>af>f\>\""}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CanonicalOrdering", "::", "unknownInteger"}], "=", 
   "\"\<The integer `1` should be between 1 and 4.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CanonicalOrdering", "::", "unknownString"}], "=", 
    RowBox[{"\"\<The expression `1` should be one of \>\"", "<>", 
     RowBox[{"ToString", "[", "$AvailableCanonicalOrderings", "]"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SetCanonicalOrdering", "[", "a_Integer", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Switch", "[", 
        RowBox[{"a", ",", "\[IndentingNewLine]", "1", ",", 
         RowBox[{"$CanonicalOrdering", "=", "\"\<f>af>b\>\""}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "2", ",", 
         RowBox[{"$CanonicalOrdering", "=", "\"\<af>f>b\>\""}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "3", ",", 
         RowBox[{"$CanonicalOrdering", "=", "\"\<b>f>af\>\""}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "4", ",", 
         RowBox[{"$CanonicalOrdering", "=", "\"\<b>af>f\>\""}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "_", ",", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"CanonicalOrdering", "::", "unknownInteger"}], ",", "a"}], 
          "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<Canonical ordering set to \>\"", ",", "$CanonicalOrdering"}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetCanonicalOrdering", "[", "a_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Switch", "[", 
       RowBox[{"a", ",", "\[IndentingNewLine]", "\"\<f>af>b\>\"", ",", 
        RowBox[{"$CanonicalOrdering", "=", "\"\<f>af>b\>\""}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\"\<af>f>b\>\"", ",", 
        RowBox[{"$CanonicalOrdering", "=", "\"\<af>f>b\>\""}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\"\<b>f>af\>\"", ",", 
        RowBox[{"$CanonicalOrdering", "=", "\"\<b>f>af\>\""}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\"\<b>af>f\>\"", ",", 
        RowBox[{"$CanonicalOrdering", "=", "\"\<b>af>f\>\""}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "_", ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"CanonicalOrdering", "::", "unknownString"}], ",", "a"}], 
         "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Canonical ordering set to \>\"", ",", "$CanonicalOrdering"}], 
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950940153137643*^9, 3.950940313248869*^9}, {
  3.950940364396865*^9, 3.950940626082654*^9}, {3.950947877407638*^9, 
  3.9509478851616173`*^9}, {3.950947925430534*^9, 3.950947963989278*^9}, {
  3.951210780223824*^9, 3.9512107812072353`*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"8223ffc8-f59e-4c33-b04f-02db6763d2e2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Ordering expressions", "Subsubsection",
 CellChangeTimes->{{3.950940652516369*^9, 
  3.950940676916478*^9}},ExpressionUUID->"25f821ed-484b-44c3-bb3d-\
2285af151ba5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Returns", " ", "true", " ", "if", " ", "f1"}], " ", "<", " ", 
     "f2"}], ",", " ", 
    RowBox[{
     RowBox[{"and", " ", "false", " ", "if", " ", "f1"}], " ", ">", " ", 
     "f2"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"FieldOrderLess", "[", 
     RowBox[{"setup_", ",", "f1_Symbol", ",", "f2_Symbol"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kind1", ",", "kind2", ",", "\[IndentingNewLine]", "idxOrder", ",", 
        "\[IndentingNewLine]", "n1", ",", "n2"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"kind1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"IsGrassmann", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IsAntiGrassmann", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IscField", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IsAnticField", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"#", "===", "AnyField"}]}], "}"}], "&"}], "[", "f1", 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kind2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"IsGrassmann", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IsAntiGrassmann", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IscField", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IsAnticField", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"#", "===", "AnyField"}]}], "}"}], "&"}], "[", "f2", 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
        "$CanonicalOrdering", ",", "\[IndentingNewLine]", "\"\<f>af>b\>\"", 
         ",", "\[IndentingNewLine]", 
         RowBox[{"idxOrder", "=", 
          RowBox[{"{", 
           RowBox[{"4", ",", "3", ",", "2", ",", "1", ",", "0"}], "}"}]}], 
         ",", "\[IndentingNewLine]", "\"\<af>f>b\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"idxOrder", "=", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4", ",", "1", ",", "2", ",", "0"}], "}"}]}], 
         ",", "\[IndentingNewLine]", "\"\<b>f>af\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"idxOrder", "=", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "4", ",", "3", ",", "0"}], "}"}]}], 
         ",", "\[IndentingNewLine]", "\"\<b>af>f\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"idxOrder", "=", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "0"}], "}"}]}], 
         ",", "\[IndentingNewLine]", "_", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<Order failure: order \\\"\>\"", "<>", "$CanonicalOrdering", 
            "<>", "\"\<\\\" unknown.\>\""}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"n1", "=", 
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"idxOrder", ",", "kind1"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"n2", "=", 
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"idxOrder", ",", "kind2"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"n1", "<", "n2"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509469386341343`*^9, 3.9509471834252987`*^9}, {
   3.950947223313903*^9, 3.950947224742805*^9}, {3.950947263353957*^9, 
   3.950947275621757*^9}, {3.950947319094739*^9, 3.9509474205587378`*^9}, 
   3.95094746109451*^9, {3.950947500069725*^9, 3.950947678289824*^9}, {
   3.950947722074582*^9, 3.950947766347187*^9}, {3.950947800639678*^9, 
   3.9509478705099792`*^9}, {3.9509479131384983`*^9, 3.950947918497128*^9}, {
   3.950947973835105*^9, 3.950948031631962*^9}, 3.950948064688114*^9, {
   3.951053680094369*^9, 3.951053686753499*^9}, {3.951054284810362*^9, 
   3.9510543614021463`*^9}, {3.951054405821702*^9, 3.951054431637821*^9}, {
   3.9510544720659943`*^9, 3.951054727167162*^9}, {3.951211269076701*^9, 
   3.951211288852489*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"4b678c74-7d06-4764-a1d3-b462e6b01ccf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Returns", " ", "the", " ", "sign", " ", "that", " ", "results", " ", 
    "from", " ", "exchanging", " ", "the", " ", "two", " ", "fields", " ", 
    "f1", " ", "and", " ", "f2"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"CommuteSign", "[", 
     RowBox[{"setup_", ",", "f1_", ",", "f2_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"kind1", ",", "kind2"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"kind1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"IsGrassmann", "[", 
              RowBox[{"setup", ",", "#"}], "]"}], "||", 
             RowBox[{"IsAntiGrassmann", "[", 
              RowBox[{"setup", ",", "#"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"IscField", "[", 
              RowBox[{"setup", ",", "#"}], "]"}], "||", 
             RowBox[{"IsAnticField", "[", 
              RowBox[{"setup", ",", "#"}], "]"}]}]}], "}"}], "&"}], "[", "f1",
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kind2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"IsGrassmann", "[", 
              RowBox[{"setup", ",", "#"}], "]"}], "||", 
             RowBox[{"IsAntiGrassmann", "[", 
              RowBox[{"setup", ",", "#"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"IscField", "[", 
              RowBox[{"setup", ",", "#"}], "]"}], "||", 
             RowBox[{"IsAnticField", "[", 
              RowBox[{"setup", ",", "#"}], "]"}]}]}], "}"}], "&"}], "[", "f2",
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"kind1", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&&", 
           RowBox[{"kind2", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509491238971243`*^9, 3.950949126229731*^9}, {
  3.950949179705824*^9, 3.950949242101665*^9}, {3.9509494626505527`*^9, 
  3.950949470925414*^9}, {3.950951603853833*^9, 3.9509516215042048`*^9}, {
  3.951054737038*^9, 3.951054767618724*^9}},
 CellLabel->
  "In[115]:=",ExpressionUUID->"18065f13-e208-4ab7-83f1-35e867d53bcb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Find", " ", "all", " ", "instances", " ", "of", " ", "$OrderedObjects", 
    " ", "and", " ", "order", " ", "their", " ", "field", " ", "value", " ", 
    "according", " ", "to", " ", "the", " ", "canonical", " ", "scheme"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"OrderObject", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", "expr"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderObject", "[", 
      RowBox[{"setup_", ",", 
       RowBox[{
        RowBox[{"obj_", "[", 
         RowBox[{"fields_List", ",", "indices_List"}], "]"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"$OrderedObjects", ",", "obj"}], "]"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "i", ",", "j", ",", "curi", ",", "prefactor", ",", "pref", ",", 
         "reverse", ",", "\[IndentingNewLine]", 
         RowBox[{"nfields", "=", "fields"}], ",", 
         RowBox[{"nindices", "=", "indices"}], ",", "\[IndentingNewLine]", 
         "trackedField"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "The", " ", "propagator", " ", "gets", " ", "a", " ", "reverse", " ", 
         "ordering"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"reverse", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"obj", "===", "Propagator"}], ",", "True", ",", "False"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pref", "=", 
         RowBox[{"If", "[", 
          RowBox[{"reverse", ",", "Identity", ",", "Not"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"prefactor", "=", "1"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Always", " ", "compare", " ", "the", " ", "ith", " ", "field", " ",
            "with", " ", "all", " ", "previous", " ", "fields", " ", "and", 
           " ", "put", " ", "it", " ", "in", " ", "the", " ", "right", " ", 
           RowBox[{"place", ".", "\[IndentingNewLine]", "Iterate"}], " ", 
           "until", " ", "one", " ", "reaches", " ", "the", " ", "end", " ", 
           "of", " ", "the", " ", "array"}], ",", " ", 
          RowBox[{"then", " ", "it", " ", "is", " ", 
           RowBox[{"sorted", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<=", 
           RowBox[{"Length", "[", "nfields", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"curi", "=", "i"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "Check", " ", "if", " ", "we", " ", "should", " ", "switch", " ",
               "curi", " ", "and", " ", "curi"}], "-", "1"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"While", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"curi", ">=", "2"}], "&&", 
              RowBox[{"pref", "@", 
               RowBox[{"FieldOrderLess", "[", 
                RowBox[{"setup", ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", "curi", "]"}], "]"}], ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", 
                   RowBox[{"curi", "-", "1"}], "]"}], "]"}]}], "]"}]}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"nfields", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"curi", ",", 
                   RowBox[{"curi", "-", "1"}]}], "}"}], "]"}], "]"}], "=", 
               RowBox[{"nfields", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"curi", "-", "1"}], ",", "curi"}], "}"}], "]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"nindices", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"curi", ",", 
                   RowBox[{"curi", "-", "1"}]}], "}"}], "]"}], "]"}], "=", 
               RowBox[{"nindices", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"curi", "-", "1"}], ",", "curi"}], "}"}], "]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"prefactor", "*=", 
               RowBox[{"CommuteSign", "[", 
                RowBox[{"setup", ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", "curi", "]"}], "]"}], ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", 
                   RowBox[{"curi", "-", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"curi", "--"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"prefactor", "*", 
          RowBox[{"obj", "[", 
           RowBox[{"nfields", ",", "nindices"}], "]"}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderFields", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"OrderObject", "[", 
         RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr", ",", 
       "Infinity"}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950940680637898*^9, 3.950940703340807*^9}, {
   3.950940753433639*^9, 3.950940770880921*^9}, {3.950940820604183*^9, 
   3.9509408314803343`*^9}, {3.950946867725016*^9, 3.950946867879279*^9}, {
   3.950946910845818*^9, 3.950946916669503*^9}, {3.950948080113351*^9, 
   3.950948364054194*^9}, {3.950948431170244*^9, 3.9509484424895906`*^9}, {
   3.9509487711183453`*^9, 3.9509487713973417`*^9}, {3.950948804373925*^9, 
   3.95094881228995*^9}, {3.950948873358161*^9, 3.950948881330065*^9}, {
   3.950948915158443*^9, 3.950948973463738*^9}, {3.9509490347704144`*^9, 
   3.950949146503368*^9}, {3.950949262758871*^9, 3.9509492803297586`*^9}, {
   3.9509493130620728`*^9, 3.950949346226811*^9}, {3.950949378638241*^9, 
   3.950949437598216*^9}, {3.950949479001645*^9, 3.950949676303194*^9}, {
   3.950949797286953*^9, 3.950949915654313*^9}, {3.95095042176271*^9, 
   3.95095044922293*^9}, {3.950951143743619*^9, 3.950951153673574*^9}, {
   3.9509511839493093`*^9, 3.950951479581605*^9}, {3.950951572049883*^9, 
   3.9509515917025433`*^9}, {3.9509516327864656`*^9, 3.950951696541771*^9}, {
   3.950977443735013*^9, 3.950977444242279*^9}, {3.951054819394979*^9, 
   3.951054841695517*^9}, 3.95121074104852*^9},
 CellLabel->
  "In[116]:=",ExpressionUUID->"4a073111-7191-4734-b32b-1a96840d6461"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["QMeS Compatibility", "Subsection",
 CellChangeTimes->{{3.950951779978003*^9, 
  3.9509517862440367`*^9}},ExpressionUUID->"94391a5f-eb5e-4478-a534-\
7016e4a3f9d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Compatibility", ":", " ", 
    RowBox[{
    "Output", " ", "any", " ", "expression", " ", "in", " ", "a", " ", "Form",
      " ", "which", " ", "looks", " ", "like", " ", "QMeS", " ", "output"}]}],
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"QMeSNaming", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", "expr"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"QMeSNaming", "[", 
      RowBox[{"setup_", ",", 
       RowBox[{
        RowBox[{"obj_", "[", 
         RowBox[{"fields_List", ",", "indices_List"}], "]"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"$OrderedObjects", ",", "obj"}], "]"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "oldCanonicalOrdering", ",", "transf", ",", "prefactor", ",", 
         "\[IndentingNewLine]", "mobj", ",", "mfields", ",", "mindices", ",", 
         "\[IndentingNewLine]", "prefix", ",", "fieldPart", ",", 
         "indexPart"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"QMeS", " ", "follows", " ", "b"}], ">", "af", ">", "f"}], 
         ",", " ", 
         RowBox[{"so", " ", "we", " ", "switch", " ", 
          RowBox[{"temporarily", "!"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", "$CanonicalOrdering", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$CanonicalOrdering", "=", "\"\<b>af>f\>\""}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"transf", "=", 
            RowBox[{"OrderObject", "[", 
             RowBox[{"setup", ",", 
              RowBox[{"obj", "[", 
               RowBox[{"fields", ",", "indices"}], "]"}]}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"prefactor", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{"transf", ",", 
            RowBox[{"Times", "[", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "a_"}], "]"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"prefactor", "=", 
            RowBox[{"-", "1"}]}], ";", 
           RowBox[{"transf", "=", 
            RowBox[{"-", "transf"}]}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"mobj", "=", 
         RowBox[{"Head", "[", "transf", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"mfields", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", "@@", "transf"}], ")"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"mindices", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", "@@", "transf"}], ")"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"prefix", "=", 
         RowBox[{"Switch", "[", 
          RowBox[{
          "obj", ",", "\[IndentingNewLine]", "Propagator", ",", "\"\<G\>\"", 
           ",", "\[IndentingNewLine]", "GammaN", ",", 
           "\"\<\[CapitalGamma]\>\""}], "\[IndentingNewLine]", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fieldPart", "=", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"Map", "[", 
           RowBox[{"ToString", ",", "mfields"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"indexPart", "=", 
         RowBox[{"Flatten", "[", "mindices", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"prefactor", "*", 
          RowBox[{
           RowBox[{"Symbol", "[", 
            RowBox[{"prefix", "<>", "fieldPart"}], "]"}], "[", "indexPart", 
           "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"QMeSForm", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"QMeSNaming", "[", 
          RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}]}], "]"}], "//.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FEq", ":>", "List"}], ",", 
        RowBox[{"FTerm", ":>", "List"}]}], "}"}]}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950950511202754*^9, 3.950950754493911*^9}, {
  3.9509507857536583`*^9, 3.9509511203631363`*^9}, {3.950951490001182*^9, 
  3.950951554042407*^9}, {3.950951710976829*^9, 3.950951737477071*^9}, {
  3.951054861758219*^9, 3.95105491628331*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"ac314d00-9b25-4da1-be23-eabaa3a126f2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Reduce FTerms and FEqs, fix Indices", "Subsection",
 CellChangeTimes->{{3.950867995958111*^9, 3.9508679992839813`*^9}, {
  3.951108367695386*^9, 3.9511083702282677`*^9}, {3.951108500371646*^9, 
  3.95110850408386*^9}},ExpressionUUID->"e5244ec3-f22c-466c-9873-\
92eb903637b0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Given", " ", "a", " ", "user"}], "-", 
     RowBox[{
     "defined", " ", "term", " ", "or", " ", "master", " ", "equation"}]}], 
    ",", " ", 
    RowBox[{"give", " ", "all", " ", 
     RowBox[{"(", "closed", ")"}], " ", "indices", " ", "unique", " ", 
     RowBox[{"names", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"FixIndices", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
       "indices", ",", "newIndices", ",", "replacements", ",", 
        "indexedObjects", ",", "\[IndentingNewLine]", 
        RowBox[{"ret", "=", "expr"}]}], "\[IndentingNewLine]", "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Indices", " ", "should", " ", "be", " ", "fixed", " ", "on", " ", 
          "a", " ", "per"}], "-", 
         RowBox[{
         "term", " ", "basis", " ", "to", " ", "ensure", " ", "we", " ", "do",
           " ", "not", " ", "mess", " ", "up", " ", "things"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FEqQ", "[", "ret", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"FixIndices", "[", 
              RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", "ret"}], "]"}],
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FTermQ", "[", "ret", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"First", ",", " ", 
           RowBox[{
            RowBox[{
            "take", " ", "care", " ", "of", " ", "nested", " ", "sub"}], "-", 
            "terms"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ret", "=", 
           RowBox[{"FTerm", "@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"List", "@@", "ret"}], ")"}], "/.", 
              RowBox[{
               RowBox[{"FTerm", "[", "a__", "]"}], ":>", 
               RowBox[{"FixIndices", "[", 
                RowBox[{"setup", ",", 
                 RowBox[{"FTerm", "[", "a", "]"}]}], "]"}]}]}], ")"}]}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Now", " ", "check", " ", "if", " ", "everything", " ", "is", " ", 
            "alright"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "@", 
             RowBox[{"SuperIndicesValid", "[", 
              RowBox[{"setup", ",", "ret"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<Invalid superindices: \>\"", ",", "ret"}], "]"}], 
             ";", 
             RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"indices", "=", 
           RowBox[{"GetClosedSuperIndices", "[", 
            RowBox[{"setup", ",", "ret"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"newIndices", "=", 
           RowBox[{"Map", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Unique", "[", "\[IndentingNewLine]", 
               RowBox[{"StringReplace", "[", 
                RowBox[{
                 RowBox[{"ToString", "[", "#", "]"}], ",", 
                 RowBox[{
                  RowBox[{"i", ":", 
                   RowBox[{"DigitCharacter", ".."}]}], ":>", "\"\<\>\""}]}], 
                "]"}], "\[IndentingNewLine]", "]"}], "&"}], ",", 
             "\[IndentingNewLine]", "indices"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"replacements", "=", 
           RowBox[{"Thread", "[", 
            RowBox[{"indices", "->", "newIndices"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"ret", "/.", "replacements"}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<Expression \\\"\>\"", ",", "expr", ",", 
         "\"\<\\\" is neither a term nor a master equation!\>\""}], "]"}], 
       ";", 
       RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950861714841454*^9, 3.950861755216401*^9}, {
   3.950862487948318*^9, 3.950862798308673*^9}, {3.950862895840537*^9, 
   3.9508630357163677`*^9}, {3.9508724419777927`*^9, 
   3.9508724466302547`*^9}, {3.950872529157947*^9, 3.9508725448503036`*^9}, {
   3.9508725902304573`*^9, 3.950872613199347*^9}, {3.950872648512635*^9, 
   3.950872688616452*^9}, 3.950874347073372*^9, {3.950964034760331*^9, 
   3.950964062155575*^9}, {3.950964146531177*^9, 3.95096414932693*^9}, {
   3.950964196491962*^9, 3.950964291440217*^9}, {3.9510571582595263`*^9, 
   3.9510571726616507`*^9}, {3.95105728303815*^9, 3.951057297698251*^9}, {
   3.951106831163007*^9, 3.951106891415176*^9}, {3.951107069173294*^9, 
   3.951107093464375*^9}, {3.951107127992262*^9, 3.9511071448735332`*^9}, 
   3.951107181155599*^9, {3.9512004831787*^9, 3.951200640317047*^9}, {
   3.9512006715440273`*^9, 3.9512006882442102`*^9}, {3.95120072501525*^9, 
   3.95120073073527*^9}, {3.9512007738520927`*^9, 3.9512007765353394`*^9}, 
   3.951200836520123*^9, {3.951200877343849*^9, 3.951200929974958*^9}, {
   3.95120098569306*^9, 3.951201005326355*^9}, {3.951201043734188*^9, 
   3.951201076755189*^9}, {3.951201114535118*^9, 3.951201142462575*^9}},
 CellLabel->
  "In[122]:=",ExpressionUUID->"3500ee75-7244-4321-ae5e-82e6897e10d7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FTerm", "::", "GrassmannCountError"}], "=", 
    "\"\<The term `1` has a multiple Grassmanns in a single factor.\>\""}], 
   ";", 
   RowBox[{
    RowBox[{"FTerm", "::", "GrassmannOpen"}], "=", 
    "\"\<The term `1` has open Grassmann factors.\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Simplify", " ", "a", " ", "term", " ", "appearing", " ", "in", " ", "an",
      " ", 
     RowBox[{"equation", ".", " ", "Try"}], " ", "to", " ", "merge", " ", 
     "as", " ", "many", " ", "factors", " ", "as", " ", "possible"}], ",", 
    " ", 
    RowBox[{
    "while", " ", "not", " ", "changing", " ", "the", " ", "Grassmann", " ", 
     "structure", " ", "of", " ", "the", " ", 
     RowBox[{"term", "."}]}]}], "\[IndentingNewLine]", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReduceFTerm", "[", 
    RowBox[{"setup_", ",", "term_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"reduced", "=", 
        RowBox[{"List", "@@", "term"}]}], ",", "mergeGrassmanFactors", ",", 
       "i"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AssertFTerm", "[", "term", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Reduce", " ", "nested", " ", "FTerms", " ", "and", " ", "such", " ", 
        "first"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"reduced", "//.", 
        RowBox[{
         RowBox[{"FEq", "[", "a__", "]"}], ":>", 
         RowBox[{"ReduceFEq", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"FEq", "[", "a", "]"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"TODO", ":", " ", 
        RowBox[{
        "find", " ", "a", " ", "way", " ", "to", " ", "not", " ", "reduce", 
         " ", "terms", " ", "twice"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"reduced", "//.", 
        RowBox[{
         RowBox[{"FTerm", "[", "a__", "]"}], ":>", 
         RowBox[{"ReduceFTerm", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"FTerm", "[", "a", "]"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"TODO", ":", " ", 
        RowBox[{
         RowBox[{
         "Ensure", " ", "that", " ", "nested", " ", "terms", " ", "are", " ", 
          "Grassmann"}], "-", "neutral"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"reduced", "//.", 
       RowBox[{
        RowBox[{"FTerm", "[", "a__", "]"}], ":>", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{"GrassmannCount", "[", 
              RowBox[{"setup", ",", 
               RowBox[{"FTerm", "[", "a", "]"}]}], "]"}], ",", "2"}], "]"}], "=!=",
            "0"}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"FTerm", "::", "GrassmannOpen"}], ",", 
             RowBox[{"FTerm", "[", "a", "]"}]}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Merge", " ", "scalar", " ", "terms", " ", "with", " ", "the", " ", 
         "closest", " ", "Grassman", " ", 
         RowBox[{"term", ".", " ", "We"}], " ", "need", " ", "to", " ", 
         "\"\<vanish\>\"", " ", "nested", " ", "FTerms"}], ",", " ", 
        RowBox[{
        "to", " ", "make", " ", "sure", " ", "we", " ", "do", " ", "not", " ", 
         RowBox[{"overcount", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"GrassmannCount", "[", 
          RowBox[{"setup", ",", 
           RowBox[{
            RowBox[{"reduced", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "//.", 
            RowBox[{
             RowBox[{"FTerm", "[", "__", "]"}], ":>", "1"}]}]}], "]"}], ">", 
         "1"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"FTerm", "::", "GrassmannCountError"}], ",", "term"}], 
          "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"GrassmannCount", "[", 
            RowBox[{"setup", ",", 
             RowBox[{
              RowBox[{"reduced", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "//.", 
              RowBox[{
               RowBox[{"FTerm", "[", "__", "]"}], ":>", "1"}]}]}], "]"}], "===",
            "0"}], "&&", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Length", "[", "reduced", "]"}], ">", "1"}], "&&", 
          "\[IndentingNewLine]", 
          RowBox[{"FreeQ", "[", 
           RowBox[{
            RowBox[{"reduced", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "FDOp", ",", "Infinity"}], 
           "]"}], "&&", "\[IndentingNewLine]", 
          RowBox[{"FreeQ", "[", 
           RowBox[{
            RowBox[{"reduced", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "FDOp", ",", "Infinity"}], 
           "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"reduced", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"reduced", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "*", 
              RowBox[{"reduced", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"reduced", "[", 
             RowBox[{"[", 
              RowBox[{"3", ";;"}], "]"}], "]"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"i", "=", "2"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"i", "<=", 
         RowBox[{"Length", "[", "reduced", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"GrassmannCount", "[", 
             RowBox[{"setup", ",", 
              RowBox[{
               RowBox[{"reduced", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "//.", 
               RowBox[{
                RowBox[{"FTerm", "[", "__", "]"}], ":>", "1"}]}]}], "]"}], 
            ">", "1"}], ",", 
           RowBox[{
            RowBox[{"Message", "[", 
             RowBox[{
              RowBox[{"FTerm", "::", "GrassmannCountError"}], ",", "term"}], 
             "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"GrassmannCount", "[", 
               RowBox[{"setup", ",", 
                RowBox[{
                 RowBox[{"reduced", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "//.", 
                 RowBox[{
                  RowBox[{"FTerm", "[", "__", "]"}], ":>", "1"}]}]}], "]"}], "==",
               "0"}], "&&", "\[IndentingNewLine]", 
             RowBox[{"FreeQ", "[", 
              RowBox[{
               RowBox[{"reduced", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "FDOp", ",", 
               "Infinity"}], "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"FreeQ", "[", 
               RowBox[{
                RowBox[{"reduced", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", "-", "1"}], "]"}], "]"}], ",", "FDOp", ",", 
                "Infinity"}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"reduced", "=", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"reduced", "[", 
                  RowBox[{"[", 
                   RowBox[{";;", 
                    RowBox[{"i", "-", "2"}]}], "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"reduced", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"reduced", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "}"}], ",", 
                 RowBox[{"reduced", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"i", "+", "1"}], ";;"}], "]"}], "]"}]}], "]"}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"i", "++"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"i", "++"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"OrderFields", "[", 
        RowBox[{"setup", ",", "reduced"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"FTerm", "@@", "reduced"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950868021337243*^9, 3.950868021665371*^9}, {
   3.95086835724666*^9, 3.9508683710297613`*^9}, 3.9508700517983923`*^9, 
   3.950870106727509*^9, {3.9508701471559877`*^9, 3.9508701622890987`*^9}, 
   3.950872629945331*^9, {3.9509518447947407`*^9, 3.950951851247134*^9}, {
   3.950952161983356*^9, 3.950952217083837*^9}, {3.950953229162822*^9, 
   3.950953297847208*^9}, {3.950953495548379*^9, 3.950953510434524*^9}, 
   3.950953659948514*^9, {3.9509537192506933`*^9, 3.9509537569466476`*^9}, 
   3.95095976117029*^9, {3.950960003047349*^9, 3.950960004176173*^9}, {
   3.9509615265046177`*^9, 3.950961540864068*^9}, {3.950963643675329*^9, 
   3.9509636614251423`*^9}, {3.950963711154449*^9, 3.950963717584083*^9}, {
   3.950963775682248*^9, 3.950963816155239*^9}, {3.950963860300707*^9, 
   3.950963929362384*^9}, {3.951107234846871*^9, 3.951107272579007*^9}, {
   3.951107477640152*^9, 3.951107555487331*^9}, {3.951107981249464*^9, 
   3.951108000501011*^9}, {3.951108345993602*^9, 3.9511083754220457`*^9}, {
   3.951108466123753*^9, 3.951108473001584*^9}, {3.951120018973323*^9, 
   3.951120141322135*^9}, {3.951120175696308*^9, 3.951120258293839*^9}, {
   3.9511993173301573`*^9, 3.951199386830797*^9}, {3.951199702330996*^9, 
   3.951199863935121*^9}, {3.951199941828017*^9, 3.951200206596088*^9}, {
   3.9512007873999853`*^9, 3.951200800152265*^9}, {3.951211180189704*^9, 
   3.9512112247413692`*^9}, {3.951211306550591*^9, 3.951211312108625*^9}},
 CellLabel->
  "In[123]:=",ExpressionUUID->"c85cfa76-e8b5-439f-9ca0-f24e64c44725"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReduceFEq", "[", 
    RowBox[{"setup_", ",", "equation_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"reduced", "=", "equation"}], "}"}], ",", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AssertFEq", "[", "equation", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Amend", " ", "the", " ", "index", " ", "structure"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"FixIndices", "[", 
        RowBox[{"setup", ",", "reduced"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Make", " ", "sure", " ", "all", " ", "terms", " ", "are", " ", 
        "reduced"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"ReduceFTerm", "[", 
          RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", "reduced"}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "reduced", "]"}], ";"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.95087005673455*^9, 3.9508700859297953`*^9}, {
   3.95087011800534*^9, 3.950870131605879*^9}, {3.950870213341543*^9, 
   3.950870277473693*^9}, {3.950870399615657*^9, 3.950870405389082*^9}, {
   3.950870442661482*^9, 3.950870496553628*^9}, {3.950870560603696*^9, 
   3.95087057682275*^9}, {3.950870622601573*^9, 3.9508706298192472`*^9}, {
   3.950870882690217*^9, 3.950870893085442*^9}, {3.950872136372311*^9, 
   3.9508721384388733`*^9}, {3.95087218393355*^9, 3.950872184825736*^9}, {
   3.950872366461809*^9, 3.950872410282044*^9}, 3.9508726043827133`*^9, {
   3.950872638854124*^9, 3.9508726391619997`*^9}, 3.950874165123219*^9, {
   3.9508742127501917`*^9, 3.950874219718197*^9}, 3.9508742837279673`*^9, {
   3.950875436534375*^9, 3.9508754560376596`*^9}, {3.950953413239159*^9, 
   3.9509534267784367`*^9}, {3.950953462892211*^9, 3.950953463787467*^9}, 
   3.950953644035307*^9, {3.9509639545923243`*^9, 3.95096400898311*^9}, {
   3.951108380757312*^9, 3.951108460175194*^9}, {3.951200372211622*^9, 
   3.951200414587019*^9}, {3.951201152993251*^9, 3.951201155424082*^9}, {
   3.9512111606396103`*^9, 3.951211178344079*^9}, {3.9512113174774103`*^9, 
   3.951211319144833*^9}},
 CellLabel->
  "In[125]:=",ExpressionUUID->"52021b7e-bece-436c-b228-076b6c722055"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Algorithm", "Section",
 CellChangeTimes->{{3.932177970725307*^9, 3.9321779720559883`*^9}, {
  3.9508509057472887`*^9, 
  3.950850909097567*^9}},ExpressionUUID->"be19843a-e765-47f1-9747-\
2d6834a73a9e"],

Cell[CellGroupData[{

Cell["Resolve a single FDOp", "Subsection",
 CellChangeTimes->{{3.9512328702638407`*^9, 
  3.951232879465557*^9}},ExpressionUUID->"e3f3669e-621b-4b13-b56e-\
3deed41d0aba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Resolve", " ", "a", " ", "single", " ", "occurence", " ", "of", " ", 
    "FDOp"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"ResolveFDOp", "[", 
      RowBox[{"setup_", ",", "feq_FEq"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Return", "[", 
         RowBox[{"FEq", "@@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ResolveFDOp", "[", 
              RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
            RowBox[{"List", "@@", "feq"}]}], "]"}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ResolveFDOp", "[", 
     RowBox[{"setup_", ",", "term_FTerm"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"rTerm", "=", 
         RowBox[{"ReduceFTerm", "[", 
          RowBox[{"setup", ",", "term"}], "]"}]}], ",", "\[IndentingNewLine]",
         "FDOpPos", ",", "\[IndentingNewLine]", "termsNoFDOp", ",", "dF", ",",
         "\[IndentingNewLine]", "dTerms", ",", "nPre", ",", "nPost"}], "}"}], 
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "If", " ", "no", " ", "derivatives", " ", "are", " ", "present"}], 
        ",", " ", 
        RowBox[{"do", " ", "nothing"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"rTerm", ",", "FDOp", ",", "Infinity"}], "]"}], ",", 
         RowBox[{"Return", "[", "rTerm", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"FDOpPos", "=", 
        RowBox[{
         RowBox[{"Length", "[", "rTerm", "]"}], "-", 
         RowBox[{
          RowBox[{"FirstPosition", "[", 
           RowBox[{
            RowBox[{"Reverse", "@", 
             RowBox[{"(", 
              RowBox[{"List", "@@", "rTerm"}], ")"}]}], ",", 
            RowBox[{"FDOp", "[", "_", "]"}]}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"termsNoFDOp", "=", 
        RowBox[{
         RowBox[{"rTerm", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", 
            RowBox[{"FDOpPos", "-", "1"}]}], "]"}], "]"}], "**", 
         RowBox[{"rTerm", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"FDOpPos", "+", "1"}], ";;"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "If", " ", "the", " ", "derivative", " ", "operator", " ", "is", " ",
           "trailing"}], ",", " ", 
         RowBox[{"simply", " ", "remove", " ", "it"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FDOpPos", ">=", 
          RowBox[{"Length", "[", "rTerm", "]"}]}], ",", 
         RowBox[{"Return", "[", "termsNoFDOp", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"dF", "=", 
        RowBox[{"rTerm", "[", 
         RowBox[{"[", 
          RowBox[{"FDOpPos", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Perform", " ", "the", " ", "product", " ", "rule"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"nPre", "=", 
        RowBox[{"FDOpPos", "-", "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nPost", "=", 
        RowBox[{
         RowBox[{"Length", "[", "rTerm", "]"}], "-", "FDOpPos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dTerms", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"termsNoFDOp", "[", 
            RowBox[{"[", 
             RowBox[{";;", 
              RowBox[{"nPre", "+", "idx", "-", "1"}]}], "]"}], "]"}], "**", 
           RowBox[{"FTerm", "[", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], 
              RowBox[{"idx", "+", "1"}]], 
             RowBox[{"FunctionalD", "[", 
              RowBox[{
               RowBox[{"termsNoFDOp", "[", 
                RowBox[{"[", 
                 RowBox[{"nPre", "+", "idx"}], "]"}], "]"}], ",", "dF"}], 
              "]"}]}], "]"}], "**", 
           RowBox[{"termsNoFDOp", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"nPre", "+", "idx", "+", "1"}], ";;"}], "]"}], "]"}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", "nPost"}], "}"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"ReduceFEq", "[", 
         RowBox[{"setup", ",", 
          RowBox[{"FEq", "@@", "dTerms"}]}], "]"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9511105533495092`*^9, 3.9511105648525476`*^9}, {
   3.951119455805057*^9, 3.9511195617211657`*^9}, {3.951119676282247*^9, 
   3.951119712474145*^9}, {3.951119753961474*^9, 3.951119965018001*^9}, {
   3.951120276792581*^9, 3.9511205887782927`*^9}, {3.951120670947592*^9, 
   3.951120778348651*^9}, {3.951120826438107*^9, 3.951120906614008*^9}, {
   3.951120939999701*^9, 3.951120956314575*^9}, {3.951121009242169*^9, 
   3.951121081510736*^9}, {3.951121127768268*^9, 3.951121329433323*^9}, {
   3.951121359899194*^9, 3.951121425034974*^9}, {3.9511224825381813`*^9, 
   3.951122501258943*^9}, {3.951123573189911*^9, 3.951123598725543*^9}, {
   3.951123637357983*^9, 3.9511238544580727`*^9}, {3.951123926802017*^9, 
   3.9511240059898977`*^9}, {3.9511240423102016`*^9, 3.951124131010861*^9}, {
   3.9511241648535767`*^9, 3.951124227324479*^9}, {3.951199174459216*^9, 
   3.951199180926196*^9}, {3.951200228052285*^9, 3.951200273018259*^9}, {
   3.951200422144641*^9, 3.951200425300118*^9}, 3.95120094844139*^9, {
   3.9512011642699833`*^9, 3.951201182694016*^9}, 3.951201274960949*^9, {
   3.9512015178111143`*^9, 3.951201562510607*^9}, {3.9512095086440887`*^9, 
   3.951209512939533*^9}, {3.951209684117496*^9, 3.951209732155652*^9}, {
   3.95120994522215*^9, 3.951209973936924*^9}, {3.9512110641082573`*^9, 
   3.95121111673773*^9}, 3.951211153997551*^9, {3.951211324253121*^9, 
   3.951211350271022*^9}, {3.951211627960374*^9, 3.951211709649838*^9}},
 CellLabel->
  "In[313]:=",ExpressionUUID->"ac348a0a-7a6e-409c-9a98-56e5170bdbb5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ResolveDerivatives", "::", "argument"}], "=", 
    "\"\<The given argument is neither an FTerm nor a FEq.\nThe argument was \
`1`\>\""}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Iteratively", " ", "resolve", " ", "all", " ", "derivative", " ", 
    "operators", " ", "in", " ", "an", " ", "FTerm", " ", "or", " ", "FEq"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ResolveDerivatives", "[", 
    RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ret", "=", "expr"}], ",", 
       RowBox[{"i", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{"ret", ",", 
          RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ReduceFEq", "[", 
          RowBox[{"setup", ",", "ret"}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FTermQ", "[", "ret", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"ret", ",", 
              RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}], "&&", 
            RowBox[{"i", "<", "$MaxDerivativeIterations"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ret", "=", 
             RowBox[{"ResolveFDOp", "[", 
              RowBox[{"setup", ",", "ret"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "ret", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FEqQ", "[", "ret", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{"FEq", "@@", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ResolveDerivatives", "[", 
               RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
             RowBox[{"List", "@@", "ret"}]}], "]"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ResolveDerivatives", "::", "argument"}], ",", "ret"}], "]"}],
       ";", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951109126796526*^9, 3.951109162803561*^9}, {
   3.951109195696103*^9, 3.9511092753420467`*^9}, {3.951109641851746*^9, 
   3.951109708704658*^9}, {3.951109745518846*^9, 3.951109820791531*^9}, {
   3.951119472303504*^9, 3.951119473407467*^9}, {3.951201291788858*^9, 
   3.9512015119676657`*^9}, {3.951201569206512*^9, 3.951201586086426*^9}, {
   3.951206148564587*^9, 3.951206211857237*^9}, {3.9512062440841913`*^9, 
   3.951206321742989*^9}, {3.951206368639289*^9, 3.951206475591106*^9}, 
   3.951207767500757*^9, 3.9512094609041777`*^9, {3.9512095311450663`*^9, 
   3.951209577983329*^9}, {3.951209618249853*^9, 3.951209633863234*^9}, {
   3.9512097690861053`*^9, 3.9512099352835913`*^9}, {3.951209996511508*^9, 
   3.9512100677197866`*^9}, {3.9512102840601892`*^9, 3.951210369806964*^9}, 
   3.95121047975072*^9, {3.951210516428762*^9, 3.951210536552635*^9}, {
   3.951211721416297*^9, 3.9512117303764887`*^9}},
 CellLabel->
  "In[128]:=",ExpressionUUID->"b0835c23-2d69-40a7-9251-be3d8571a3bb"]
}, Closed]],

Cell[CellGroupData[{

Cell["Take several functional derivatives", "Subsection",
 CellChangeTimes->{{3.9508680530500927`*^9, 
  3.950868063045309*^9}},ExpressionUUID->"a8f64e7a-d885-45c2-99d7-\
7e2e4dc385f7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"OutputLevel", ",", "SuperIndexForm"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "TakeDerivatives", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"OutputLevel", "->", "SuperIndexForm"}], "}"}]}], ";"}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.951227336083239*^9, 3.951227337862597*^9}},
 CellLabel->
  "In[130]:=",ExpressionUUID->"bba04405-f573-40fc-9a19-18ca7de811ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Perform", " ", "multiple", " ", "functional", " ", "derivatives", " ", 
    "on", " ", "a", " ", "master", " ", 
    RowBox[{"equation", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"TakeDerivatives", "[", 
     RowBox[{"setup_", ",", "expr_", ",", "derivativeList_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "result", ",", "\[IndentingNewLine]", "externalIndexNames", ",", 
        "outputReplacements", ",", "\[IndentingNewLine]", 
        "derivativeListSIDX"}], "\[IndentingNewLine]", "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AssertFEq", "[", "expr", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"AssertDerivativeList", "[", 
        RowBox[{"setup", ",", "derivativeList"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"While", " ", "doing", " ", "the", " ", "derivatives"}], ",",
          " ", 
         RowBox[{
          RowBox[{"we", " ", "want", " ", "to", " ", "use", " ", "super"}], 
          "-", 
          RowBox[{"indices", ".", " ", "Afterwards"}]}], ",", " ", 
         RowBox[{
         "we", " ", "can", " ", "replace", " ", "these", " ", "again", " ", 
          "with", " ", "the", " ", "given", " ", "indices"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"externalIndexNames", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", "\"\<eI\>\"", "]"}], "&"}], ",", 
          "derivativeList"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"outputReplacements", "=", 
        RowBox[{"Thread", "[", 
         RowBox[{"externalIndexNames", "->", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"FieldIndices", "@@", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"Head", "[", "#", "]"}], ",", 
                RowBox[{"List", "@@", "#"}]}], "]"}]}], "&"}], ",", 
            "derivativeList"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"derivativeListSIDX", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", 
            RowBox[{"derivativeList", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "[", 
           RowBox[{"externalIndexNames", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "derivativeList", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "We", " ", "take", " ", "them", " ", "in", " ", "reverse", " ", 
         RowBox[{"order", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"derivativeListSIDX", "=", 
        RowBox[{"Reverse", "[", "derivativeListSIDX", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"First", ",", " ", 
         RowBox[{
         "fix", " ", "the", " ", "indices", " ", "in", " ", "the", " ", 
          "input", " ", "equation"}], ",", " ", 
         RowBox[{
          RowBox[{"i", ".", "e", ".", " ", "make"}], " ", "everything", " ", 
          "have", " ", "unique", " ", "names"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"result", "=", 
        RowBox[{"FixIndices", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Perform", " ", "all", " ", "the", " ", "derivatives"}], ",",
          " ", 
         RowBox[{"one", " ", "after", " ", "the", " ", "other"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"result", "=", 
          RowBox[{"ResolveDerivatives", "[", 
           RowBox[{"setup", ",", 
            RowBox[{
             RowBox[{"FTerm", "[", 
              RowBox[{"FDOp", "[", 
               RowBox[{"derivativeListSIDX", "[", 
                RowBox[{"[", "pass", "]"}], "]"}], "]"}], "]"}], "**", 
             "result"}]}], "]"}]}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"pass", ",", "1", ",", 
           RowBox[{"Length", "[", "derivativeList", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "OutputLevel", "]"}], "===", 
          "SuperIndexForm"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Return", "[", " ", 
           RowBox[{"{", 
            RowBox[{"result", ",", "outputReplacements"}], "}"}], "]"}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"result", "//.", "outputReplacements"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.95086807399784*^9, 3.950868101837797*^9}, {
   3.950868135961317*^9, 3.950868153423587*^9}, {3.950868228217888*^9, 
   3.950868269490148*^9}, {3.95086841046174*^9, 3.950868424387451*^9}, {
   3.950873786052535*^9, 3.950873787662897*^9}, {3.950874377585595*^9, 
   3.950874378821952*^9}, {3.950875285850876*^9, 3.950875301335219*^9}, {
   3.950875343786489*^9, 3.9508753492991743`*^9}, {3.9508754834989862`*^9, 
   3.950875487444517*^9}, {3.9508932689591846`*^9, 3.950893303250742*^9}, {
   3.950893467838776*^9, 3.950893530412135*^9}, {3.950951875092435*^9, 
   3.950951917051467*^9}, {3.950951969983094*^9, 3.950951982885131*^9}, {
   3.950953049415739*^9, 3.9509530566618147`*^9}, {3.9509576893692417`*^9, 
   3.950957693641984*^9}, {3.950957869930423*^9, 3.9509578703743134`*^9}, {
   3.951205890224668*^9, 3.951205922452134*^9}, {3.9512059655680513`*^9, 
   3.951205987956233*^9}, {3.9512060250926027`*^9, 3.951206037771141*^9}, {
   3.9512060757270203`*^9, 3.9512061056706333`*^9}, {3.951210129116617*^9, 
   3.951210160246964*^9}, {3.951210230711794*^9, 3.951210261583102*^9}, {
   3.951210487269314*^9, 3.9512104881636333`*^9}, 3.951210648908422*^9, {
   3.951210922739853*^9, 3.951210952732194*^9}, {3.9512110036490707`*^9, 
   3.9512110540158043`*^9}, {3.951211364096175*^9, 3.951211371087821*^9}, {
   3.9512114169092283`*^9, 3.951211492808696*^9}, {3.951211535712715*^9, 
   3.951211602095957*^9}, {3.951211800213296*^9, 3.951211815568632*^9}, {
   3.9512134241932383`*^9, 3.951213498323842*^9}, {3.9512273400034513`*^9, 
   3.9512273627572317`*^9}},
 CellLabel->
  "In[132]:=",ExpressionUUID->"fcb7ecd2-adb3-4b5a-a94f-8080924ea319"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Pretty printing and LaTeX", "Section",
 CellChangeTimes->{{3.951227153497263*^9, 
  3.9512271630776052`*^9}},ExpressionUUID->"8a7de2d4-4e3d-41aa-8f92-\
19d8c0694994"],

Cell[CellGroupData[{

Cell["Load packages", "Subsection",
 CellChangeTimes->{{3.951227218290779*^9, 
  3.9512272199386797`*^9}},ExpressionUUID->"fe6211e7-4eaf-4c19-8e0e-\
b2242a07760b"],

Cell[BoxData[{
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"Length", "@", 
     RowBox[{"PacletFind", "[", "\"\<MaTeX\>\"", "]"}]}], "===", "0"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<MaTeXInstall\>\"", "]"}], "[", 
    "]"}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", "\"\<MaTeX`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Import", "[", 
  RowBox[{
  "$FunKitDirectory", "<>", "\"\</utils/MathematicaTeXUtilities.m\>\""}], 
  "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951220603320554*^9, 3.9512206398339787`*^9}, {
  3.951222619623927*^9, 3.951222619860894*^9}, {3.951226869940086*^9, 
  3.9512268782989798`*^9}, {3.951226922919786*^9, 3.951226955627511*^9}, {
  3.951227017444984*^9, 3.951227033537813*^9}, {3.9512270906128063`*^9, 
  3.951227103820059*^9}},
 CellLabel->
  "In[133]:=",ExpressionUUID->"4cb64dde-a02d-401c-87bd-c89d5d2cf484"]
}, Closed]],

Cell[CellGroupData[{

Cell["Index list formatting", "Subsection",
 CellChangeTimes->{{3.951227218290779*^9, 3.951227234130476*^9}, {
  3.951228264410342*^9, 
  3.951228264818948*^9}},ExpressionUUID->"b673667e-d925-4d48-9d93-\
4211a3ceb4cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MakeTexIndexList", "[", 
   RowBox[{"{", "i__", "}"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ni", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"{", "i", "}"}], "]"}]}], ",", "\[IndentingNewLine]", 
      "isLower", ",", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", 
       RowBox[{"{", "i", "}"}]}], ",", "\[IndentingNewLine]", "lowerList", 
      ",", "\[IndentingNewLine]", "upperList", ",", "\[IndentingNewLine]", 
      "removeTrailingPhantoms"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"isLower", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Times", "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "i", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"indices", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", 
          RowBox[{"-", 
           RowBox[{"indices", "[", 
            RowBox[{"[", "idx", "]"}], "]"}]}], ",", 
          RowBox[{"indices", "[", 
           RowBox[{"[", "idx", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"lowerList", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ToString", "@", 
           RowBox[{"TeXForm", "[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<\\\\phantom{\>\"", "<>", 
           RowBox[{"ToString", "@", 
            RowBox[{"TeXForm", "[", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], "]"}]}], "<>", 
           "\"\<}\>\""}]}], "\[IndentingNewLine]", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"upperList", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<\\\\phantom{\>\"", "<>", 
           RowBox[{"ToString", "@", 
            RowBox[{"TeXForm", "[", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], "]"}]}], "<>", "\"\<}\>\""}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"ToString", "@", 
           RowBox[{"TeXForm", "[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"removeTrailingPhantoms", "[", "l_", "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ret", "=", "l"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"StringContainsQ", "[", 
            RowBox[{
             RowBox[{"ret", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\<\\\\phantom\>\""}],
             "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ret", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"ret", ",", 
               RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "ret", "]"}], "===", "0"}], ",", 
              RowBox[{"Return", "[", 
               RowBox[{"{", "\"\<\>\"", "}"}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "ret", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"upperList", "=", 
      RowBox[{"removeTrailingPhantoms", "@", "upperList"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lowerList", "=", 
      RowBox[{"removeTrailingPhantoms", "@", "lowerList"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"StringJoin", "@@", "lowerList"}], ",", 
        RowBox[{"StringJoin", "@@", "upperList"}]}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9512279900434513`*^9, 3.951228079647861*^9}, {
  3.9512281378398447`*^9, 3.951228205003704*^9}},
 CellLabel->
  "In[136]:=",ExpressionUUID->"2757d6ff-49bf-4f75-b9da-02f06924b8e7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MakeIdxField", "[", 
   RowBox[{"f_", ",", "i_", ",", "up"}], "]"}], ":=", 
  RowBox[{"MakeIdxField", "[", 
   RowBox[{"f", ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MatchQ", "[", 
       RowBox[{"i", ",", 
        RowBox[{"Times", "[", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}], ",", 
      RowBox[{"-", "i"}], ",", "i"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeIdxField", "[", 
   RowBox[{"f_", ",", "i_", ",", "down"}], "]"}], ":=", 
  RowBox[{"MakeIdxField", "[", 
   RowBox[{"f", ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MatchQ", "[", 
       RowBox[{"i", ",", 
        RowBox[{"Times", "[", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}], ",", "i", ",", 
      RowBox[{"-", "i"}]}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MakeIdxField", "[", 
    RowBox[{"f_", ",", "i_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"isLower", ",", "idx", ",", "idxStr", ",", "subSuper"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"isLower", "=", 
       RowBox[{"MatchQ", "[", 
        RowBox[{"i", ",", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"idx", "=", 
       RowBox[{"If", "[", 
        RowBox[{"isLower", ",", 
         RowBox[{"-", "i"}], ",", "i"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"f", "===", "AnyField"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "[", 
          RowBox[{"TeXForm", "[", "idx", "]"}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"idxStr", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Depth", "[", "idx", "]"}], ">", "1"}], ",", 
         RowBox[{"\"\<{\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"TeXForm", "[", "idx", "]"}], "]"}], "<>", "\"\<}\>\""}], 
         ",", 
         RowBox[{"ToString", "[", 
          RowBox[{"TeXForm", "[", "idx", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"subSuper", "=", 
       RowBox[{"If", "[", 
        RowBox[{"isLower", ",", "\"\<_\>\"", ",", "\"\<^\>\""}], "]"}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ToString", "[", 
        RowBox[{"TeXForm", "[", "f", "]"}], "]"}], "<>", "subSuper", "<>", 
       "idxStr"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeTexIndexList", "[", 
   RowBox[{
    RowBox[{"{", "f__", "}"}], ",", 
    RowBox[{"{", "i__", "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ni", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"{", "f", "}"}], "]"}]}], ",", "\[IndentingNewLine]", 
      "isLower", ",", "\[IndentingNewLine]", 
      RowBox[{"fields", "=", 
       RowBox[{"{", "f", "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", 
       RowBox[{"{", "i", "}"}]}], ",", "\[IndentingNewLine]", "lowerList", 
      ",", "\[IndentingNewLine]", "upperList", ",", "\[IndentingNewLine]", 
      "removeTrailingPhantoms"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"isLower", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Times", "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "i", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"lowerList", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"MakeIdxField", "[", 
           RowBox[{
            RowBox[{"fields", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], ",", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], ",", "up"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<\\\\phantom{\>\"", "<>", 
           RowBox[{"MakeIdxField", "[", 
            RowBox[{
             RowBox[{"fields", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], ",", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], ",", "up"}], "]"}], "<>", 
           "\"\<}\>\""}]}], "\[IndentingNewLine]", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"upperList", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<\\\\phantom{\>\"", "<>", 
           RowBox[{"MakeIdxField", "[", 
            RowBox[{
             RowBox[{"fields", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], ",", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], ",", "up"}], "]"}], "<>", 
           "\"\<}\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{"MakeIdxField", "[", 
           RowBox[{
            RowBox[{"fields", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], ",", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], ",", "up"}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"removeTrailingPhantoms", "[", "l_", "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ret", "=", "l"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"StringContainsQ", "[", 
            RowBox[{
             RowBox[{"ret", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\<\\\\phantom\>\""}],
             "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ret", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"ret", ",", 
               RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "ret", "]"}], "===", "0"}], ",", 
              RowBox[{"Return", "[", 
               RowBox[{"{", "\"\<\>\"", "}"}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "ret", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"upperList", "=", 
      RowBox[{"removeTrailingPhantoms", "@", "upperList"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lowerList", "=", 
      RowBox[{"removeTrailingPhantoms", "@", "lowerList"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"StringJoin", "@@", "lowerList"}], ",", 
        RowBox[{"StringJoin", "@@", "upperList"}]}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951224453339987*^9, 3.951224504011447*^9}, {
   3.9512245836998873`*^9, 3.951225183586688*^9}, {3.9512252226473923`*^9, 
   3.951225289991295*^9}, {3.951225357167528*^9, 3.95122546150375*^9}, {
   3.95122549194619*^9, 3.951225913224032*^9}, {3.9512259438888283`*^9, 
   3.951226154260346*^9}, {3.951226184420576*^9, 3.9512261923833513`*^9}, {
   3.951226294902279*^9, 3.951226427296379*^9}, {3.95122645762057*^9, 
   3.951226633727709*^9}, 3.9512267993502274`*^9, {3.951227949864423*^9, 
   3.951227987338913*^9}},
 CellLabel->
  "In[137]:=",ExpressionUUID->"c206a11f-7558-4843-a213-55c609b89e58"]
}, Closed]],

Cell[CellGroupData[{

Cell["Prettify closed indices", "Subsection",
 CellChangeTimes->{{3.9512282799668913`*^9, 
  3.951228284818677*^9}},ExpressionUUID->"c85a5823-b0b0-4a54-a9b5-\
b6ecf5b7d25d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"prettyIndices", "[", 
    RowBox[{"setup_", ",", "expr_FEq"}], "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"prettyIndices", "[", 
       RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettyIndices", "[", 
    RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "closedIndices", ",", "openIndices", ",", "repl", ",", "indices"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"closedIndices", "=", 
       RowBox[{"GetClosedSuperIndices", "[", 
        RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"openIndices", "=", 
       RowBox[{"GetOpenIndices", "[", 
        RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", 
       RowBox[{"Alphabet", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"indices", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"indices", ",", 
           RowBox[{
            RowBox[{"#", "=!=", 
             RowBox[{"ToString", "[", 
              RowBox[{"openIndices", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}], ",",
         "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "openIndices", "]"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"repl", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"closedIndices", "->", 
         RowBox[{"indices", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", 
            RowBox[{"Length", "[", "closedIndices", "]"}]}], "]"}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"expr", "//.", "repl"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951228520702806*^9, 3.9512287157941008`*^9}, {
  3.9512289543471107`*^9, 3.95122895739114*^9}, {3.95122898752525*^9, 
  3.951229005782969*^9}, {3.9512293949001007`*^9, 3.951229396595858*^9}, {
  3.9512303490830173`*^9, 3.9512307057859497`*^9}, {3.951231190652398*^9, 
  3.951231217683535*^9}, {3.951232463495397*^9, 3.9512325501930227`*^9}, {
  3.95123292322405*^9, 3.951232962305142*^9}, {3.951233478552884*^9, 
  3.951233506821313*^9}},
 CellLabel->
  "In[443]:=",ExpressionUUID->"4689a3d2-e2b9-43c0-abfa-435e5632834b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["General formatting definitions", "Subsection",
 CellChangeTimes->{{3.951227218290779*^9, 
  3.951227251130701*^9}},ExpressionUUID->"1c82d10b-061e-41f5-a731-\
b8174ae16e8f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Unprotect", "[", 
    RowBox[{
    "GammaN", ",", "Propagator", ",", "Rdot", ",", "FTerm", ",", "FEq", ",", 
     "\[Gamma]", ",", "\[Delta]"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"GammaN", "[", 
      RowBox[{
       RowBox[{"{", "f__", "}"}], ",", 
       RowBox[{"{", "i__", "}"}]}], "]"}], ",", "TeXForm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"sub", ",", "sup", ",", "ret"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sub", ",", "sup"}], "}"}], "=", 
       RowBox[{"MakeTexIndexList", "[", 
        RowBox[{
         RowBox[{"{", "f", "}"}], ",", 
         RowBox[{"{", "i", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ret", "=", "\"\<\\\\Gamma\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sub", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<_{\>\"", "<>", "sub", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sup", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<^{\>\"", "<>", "sup", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"TeXVerbatim", "[", "ret", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"Propagator", "[", 
      RowBox[{
       RowBox[{"{", "f__", "}"}], ",", 
       RowBox[{"{", "i__", "}"}]}], "]"}], ",", "TeXForm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"sub", ",", "sup", ",", "ret"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sub", ",", "sup"}], "}"}], "=", 
       RowBox[{"MakeTexIndexList", "[", 
        RowBox[{
         RowBox[{"{", "f", "}"}], ",", 
         RowBox[{"{", "i", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ret", "=", "\"\<G\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sub", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<_{\>\"", "<>", "sub", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sup", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<^{\>\"", "<>", "sup", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"TeXVerbatim", "[", "ret", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"Rdot", "[", 
      RowBox[{
       RowBox[{"{", "f__", "}"}], ",", 
       RowBox[{"{", "i__", "}"}]}], "]"}], ",", "TeXForm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"sub", ",", "sup", ",", "ret"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sub", ",", "sup"}], "}"}], "=", 
       RowBox[{"MakeTexIndexList", "[", 
        RowBox[{
         RowBox[{"{", "f", "}"}], ",", 
         RowBox[{"{", "i", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ret", "=", "\"\<\\\\partial_t R\>\""}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sub", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<_{\>\"", "<>", "sub", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sup", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<^{\>\"", "<>", "sup", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"TeXVerbatim", "[", "ret", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"\[Delta]", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ",", "TeXForm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"isLower", ",", "sub", ",", "sup", ",", "ret"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sub", ",", "sup"}], "}"}], "=", 
       RowBox[{"MakeTexIndexList", "[", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"ret", "=", "\"\<\\\\delta\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sub", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<_{\>\"", "<>", "sub", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sup", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<^{\>\"", "<>", "sup", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"TeXVerbatim", "[", "ret", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"\[Gamma]", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], ",", "TeXForm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"isLower", ",", "sub", ",", "sup", ",", "ret"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sub", ",", "sup"}], "}"}], "=", 
       RowBox[{"MakeTexIndexList", "[", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"ret", "=", "\"\<\\\\gamma\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sub", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<_{\>\"", "<>", "sub", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"StringLength", "[", "sup", "]"}], "=!=", "0"}], ",", 
        RowBox[{"ret", "=", 
         RowBox[{
         "ret", "<>", "\"\<^{\>\"", "<>", "sup", "<>", "\"\<}\>\""}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"TeXVerbatim", "[", "ret", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "a__", "]"}], ",", "TeXForm"}], "]"}], ":=", 
  RowBox[{"TeXDelimited", "[", 
   RowBox[{"\"\<\>\"", ",", "a", ",", "\"\<\>\"", ",", 
    RowBox[{"\"\<DelimSeparator\>\"", "->", "\"\<\>\""}], ",", 
    RowBox[{"\"\<BodySeparator\>\"", "->", "\"\<\>\""}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"FEq", "[", "a___", "]"}], ",", "TeXForm"}], "]"}], ":=", 
   RowBox[{"TeXDelimited", "[", 
    RowBox[{"\"\<\>\"", ",", "a", ",", "\"\<\>\"", ",", 
     RowBox[{"\"\<DelimSeparator\>\"", "->", "\"\<\>\""}], ",", 
     RowBox[{"\"\<BodySeparator\>\"", "->", "\"\<\n\\,+\\,\>\""}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{
   "GammaN", ",", "Propagator", ",", "Rdot", ",", "FTerm", ",", "FEq", ",", 
    "\[Gamma]", ",", "\[Delta]"}], "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951223302279481*^9, 3.951223365666438*^9}, 
   3.951223448487712*^9, {3.951223520738687*^9, 3.9512235436795464`*^9}, {
   3.951223580644545*^9, 3.951223702875143*^9}, {3.951223781979072*^9, 
   3.9512239278539047`*^9}, {3.951226172034417*^9, 3.951226245691415*^9}, {
   3.95122649515267*^9, 3.95122650002048*^9}, {3.951226539549152*^9, 
   3.951226540239016*^9}, {3.951226672419936*^9, 3.951226788180599*^9}, {
   3.951227127728176*^9, 3.95122713458395*^9}, {3.9512272581117373`*^9, 
   3.951227258523254*^9}, {3.951227545212324*^9, 3.9512275769163637`*^9}, {
   3.9512277385558987`*^9, 3.95122777945168*^9}, {3.9512278585108223`*^9, 
   3.95122793987572*^9}, {3.9512282149424257`*^9, 3.95122821959562*^9}, {
   3.9512335760396547`*^9, 3.951233588723529*^9}},
 CellLabel->
  "In[488]:=",ExpressionUUID->"54a8c1ed-ea4c-48f3-8ca0-31b66c1b5f4b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["FPrint and FTex commands", "Subsection",
 CellChangeTimes->{{3.951227276578141*^9, 
  3.9512272950223837`*^9}},ExpressionUUID->"0d7ca62e-6e69-4f36-a53a-\
dfb5b1d4f0f7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", 
    RowBox[{"FPrint", ",", "FTex"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTex", "[", 
    RowBox[{"setup_", ",", "expr_", ",", 
     RowBox[{"replacements_", ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"prExp", "=", 
        RowBox[{"expr", "//.", "replacements"}]}], ",", "fields"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"prExp", "=", 
       RowBox[{"prettyIndices", "[", 
        RowBox[{"setup", ",", "prExp"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"fields", "=", 
       RowBox[{"GetAllFields", "[", "setup", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"prExp", "=", 
       RowBox[{
        RowBox[{"prExp", "//.", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"Times", "[", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "a_"}], "]"}], "]"}], ":>", 
             RowBox[{"Subscript", "[", 
              RowBox[{"#", ",", "a"}], "]"}]}], "&"}], ",", "fields"}], 
          "]"}]}], "//.", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "a_", "]"}], ":>", 
            RowBox[{"Superscript", "[", 
             RowBox[{"#", ",", "a"}], "]"}]}], "&"}], ",", "fields"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"prExp", "//", "TeXForm"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FPrint", "[", 
   RowBox[{"setup_", ",", "expr_", ",", 
    RowBox[{"replacements_", ":", 
     RowBox[{"{", "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"FTex", "[", 
      RowBox[{"setup", ",", "expr", ",", "replacements"}], "]"}], "//", 
     "MaTeX"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.951227286303012*^9, {3.951228303119562*^9, 3.9512283513756*^9}, {
   3.951228389390807*^9, 3.951228426136969*^9}, {3.951228721777083*^9, 
   3.951228779050777*^9}, {3.951228815247923*^9, 3.9512289293188562`*^9}, {
   3.951228970431391*^9, 3.9512289803586397`*^9}, {3.951229222517618*^9, 
   3.951229333300802*^9}, {3.9512293650158653`*^9, 3.951229412171332*^9}, {
   3.951229444928987*^9, 3.951229582788172*^9}, {3.951229640384007*^9, 
   3.9512297215006104`*^9}, {3.9512297734391537`*^9, 3.951229881327454*^9}, {
   3.951229913367536*^9, 3.9512299416277037`*^9}, {3.951229977681635*^9, 
   3.951230059503622*^9}, {3.951230107314933*^9, 3.951230224783657*^9}, {
   3.9512302576264553`*^9, 3.951230266125228*^9}, {3.951230306720083*^9, 
   3.95123031791667*^9}, {3.951230514287863*^9, 3.951230519751683*^9}, {
   3.9512307119179*^9, 3.951230781095096*^9}, {3.951230845660459*^9, 
   3.951230852027361*^9}, {3.9512308966076593`*^9, 3.9512309257438374`*^9}, {
   3.9512319258913*^9, 3.951231987536601*^9}, {3.9512324462397842`*^9, 
   3.951232454463108*^9}, {3.951233522832571*^9, 3.951233545111067*^9}, {
   3.951233639456409*^9, 3.95123364193568*^9}},
 CellLabel->
  "In[502]:=",ExpressionUUID->"391fa561-d2b8-480b-bb8c-11da575eb488"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing", "Title",
 CellChangeTimes->{{3.9508681098093233`*^9, 
  3.950868110913395*^9}},ExpressionUUID->"7a24c792-7a48-4e73-8b88-\
7b56966e439b"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"fields", "=", " ", 
   RowBox[{"<|", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<cField\>\"", "\[Rule]", " ", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"A", "[", 
         RowBox[{"p", ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", " ", "c"}], "}"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[Phi]", "[", "p", "]"}], ",", 
          RowBox[{"\[Phi]x", "[", "p", "]"}]}], "}"}]}], 
       "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<Grassmann\>\"", "\[Rule]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"cb", "[", 
          RowBox[{"p", ",", 
           RowBox[{"{", "c", "}"}]}], "]"}], ",", 
         RowBox[{"c", "[", 
          RowBox[{"p", ",", 
           RowBox[{"{", "c", "}"}]}], "]"}]}], "}"}], "\[IndentingNewLine]", 
       "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"masterEquation", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", "2"], 
        RowBox[{"A", "[", "x", "]"}], 
        RowBox[{"VBasis", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"A", ",", "A"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "x"}], ",", 
            RowBox[{"-", "y"}]}], "}"}]}], "]"}], 
        RowBox[{"A", "[", "y", "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          RowBox[{"cb", "[", "x", "]"}]}], 
         RowBox[{"VBasis", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"cb", ",", "c"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "x"}], ",", 
             RowBox[{"-", "y"}]}], "}"}]}], "]"}]}], ",", 
        RowBox[{"c", "[", "y", "]"}]}], "}"}]}], "\[IndentingNewLine]", 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Setup", "=", 
    RowBox[{"<|", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<MasterEquation\>\"", "->", "masterEquation"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<FieldSpace\>\"", "->", "fields"}]}], "\[IndentingNewLine]",
      "|>"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TakeDerivatives", "[", 
    RowBox[{"Setup", ",", "\[IndentingNewLine]", 
     RowBox[{"FEq", "[", "\[IndentingNewLine]", 
      RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Propagator", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"AnyField", ",", "AnyField"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}]}], "]"}], 
        RowBox[{"Rdot", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"AnyField", ",", "AnyField"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
       "]"}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"A", "[", 
       RowBox[{"p", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}]}], "]"}], "}"}]}], 
    "\[IndentingNewLine]", "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}], "//", 
  RowBox[{
   RowBox[{"FPrint", "[", 
    RowBox[{"Setup", ",", "#"}], "]"}], "&"}]}]}], "Input",
 CellChangeTimes->{{3.9507856762700357`*^9, 3.9507858002547617`*^9}, {
  3.9509731139899683`*^9, 3.950973140087144*^9}, {3.9512274397433567`*^9, 
  3.951227441558628*^9}, {3.951227486267386*^9, 3.951227497450511*^9}, {
  3.951227632078931*^9, 3.951227677663128*^9}, {3.951228330842969*^9, 
  3.951228340299478*^9}},
 CellLabel->
  "In[505]:=",ExpressionUUID->"2632f66f-a425-44c8-b21c-333bdd8417c4"],

Cell[BoxData[
 GraphicsBox[
  {Thickness[0.007666947788085562], 
   FilledCurveBox[{{{1, 4, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1,
     3, 3}}}, {{{9.29219, 8.2875}, {9.29219, 8.526560000000002}, {
    9.065629999999997, 8.526560000000002}, {8.898439999999999, 
    8.526560000000002}, {2.3859399999999997`, 8.526560000000002}, {
    2.2187499999999996`, 8.526560000000002}, {1.99219, 8.526560000000002}, {
    1.99219, 8.2875}, {1.99219, 8.04844}, {2.2187499999999996`, 8.04844}, {
    2.3859399999999997`, 8.04844}, {8.898439999999999, 8.04844}, {
    9.065629999999997, 8.04844}, {9.29219, 8.04844}, {9.29219, 8.2875}}}], 
   FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {0,
     1, 0}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {0, 1, 
    0}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {0, 
    1, 0}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGIlIGYC4mgFx4/JMoYOMybwV5l1qzqcAQMDh/8gcF/L
ITP/Q+vJKaoYfBbOLvlkPS0IzacG53vsr5W1OK4O588EgZvqDhLz4jRPf9CE
85nB+hD8NgV21TNXJOD8vohuf0YBcbh5X/Z93Jo+TQxuH4wPcw8638QYBEQh
+tXVHKru/7hl7C3qMGeR8s4/7hpwvtzyFx56/xF8nxPstrOvasL5x3ft6GX7
oA3nP4gQ335xgQ7cfBgfZn98SJD6gpfacD7MPBi//rdVwbkTmg4an1ReztIU
h/OD317+OOOhBJw/AxQOlppw/o+3rw9YMmvBzYOFr8TUK5wZj7QQfFA4F+jC
+cVbRX+fjjOA80HOZVhn4OB3cWLMv8caDhpvefcZ3DSAxz96egAAjjnr7A==

    "]], FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 
     3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1,
      3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
     0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1,
      3, 3}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}}, {CompressedData["
1:eJxTTMoPSmViYGBwAGIQPSG4RGX6enOH67y3xVLNOB1g/DkzgUCSy+GOdE2i
0VQE/0CtrEV6CRqfBcGXmHqFM4PJ3OF57ePs82u4HDbq5S1m/GPm0CBey5rp
xuOg+qR53tkoMweQ8pkvFRwMtFYKXwgxczAGAWdFh4Nty8NPBZk5/AeBeEWQ
MxkYDBB8h6ZHx2dwI/hPEhdeM/lv6sAfG3DfyFzR4RBI/ydTh7VCOnzpfFDz
hIwdvuz7uDV9Gr/DbZB/tho59Ed0+zN+4HL48630wZxEI4czIODD5ZAce8eN
WcII7p/F9/fxzWE2clD/pPJyFieXw/QJ/FVmrw0dtnttsJjzkxPOP9i9r8nk
MQecD/bPZg6I+94bQtz7n93h84aA7FnsRnA+t5tqKZMUgp+eBgRqRg59IPcZ
cMDdC+OD48feGM4v2Sr6+3SeMVx/7W+rgnMVCL4JyB3NCD7Yvwsx+bD4h/Fh
/m1kOdpv2G4MDw9wONUg+MtfeOj9DzR24HHk85qhCVWvbgyPfxjf/4nnJVNh
HjhfA2w+LyQ8zI0d7Esca0/f4XU4fdhpbWYc1D3b+B3qQf55YewQoxohcy5G
2OELSL24GZwPTm9OZhB/fuaG80uWl2z4x8/tECG+/SKDnBncvZEg/j5TOB8c
P/MRfHB6bMHkw+IXxj8A5d8Q+uR4vs0UHp6fQO5bjuCD0/8eBB+c7jnNHGQ2
is1nUuCApGdpM3h8xig4fkyeg+AvAaW/YHM4H5Q80srM4eZB7EfwwemhD8GH
5Wd0Piy+AR2Fz5Q=
     "], {{22.060899999999997`, 5.10313}, {20.0766, 5.10313}, {
     21.726599999999998`, 7.72344}, {22.060899999999997`, 5.10313}}}], 
   FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0,
      1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}}, {{0, 2, 
     0}, {1, 3, 3}, {1, 3, 3}}}, {CompressedData["
1:eJxTTMoPSmViYGBQAGIQvUUvbzHjHyuHB67xjrMEJRxg/PsgvqGEg/pb3n0G
P60cWhXYVc+USDg8SVx4zeQ+gj9lAn+V2WkEPyX2jhvzCSuHvohuf8YACYfl
Lzz0/h+0ckhPAwI2CQefixNj/k22cmAAAQcxhx6vVywmilYOZ8BA1EH9SfO8
s7cs4XyQtrQ2BP/UYae1mXaWDiKVk0rOpog5LL6/j2+OsKVD0NvLH2c4ijuo
gvVbQPiJEnD+l30ft6Z/k4Tz37TldhvNlnI4ATLvnBWc/x8E3iP4sPBA58vv
WrAvVU8azk8F+0/WYYv5j0Mpu6wc1gjp8KXfk4fI77GE871PsNvOfmoB588E
AU8Lh15weMnC+f0gfoEUnH8W5P0ccQj/J8w/Ig5/vpU+mHPREs4PF99+kWGd
FZwPc1/l/R+3jLvFHdDjGwBBP+jn
     "], {{26.5484, 6.831250000000001}, {24.867199999999997`, 
     6.831250000000001}, {24.9328, 7.632809999999998}, {25.4828, 7.77656}, {
     25.728099999999998`, 7.77656}, {26.499999999999996`, 7.77656}, {
     26.542199999999994`, 7.00469}, {26.5484, 6.831250000000001}}}], 
   FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {0,
     1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 
    3}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
    0}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGJpIGYC4qdZ2t+m19o6mBiDgKgDjB/y9vLHGYpiDj1e
r1hMAhF88alXODMu2WDwq+7/uGWcjeB/2fdxa7qZOJx/W1N2zf/DinD+TBDQ
VILz1wrp8KX7KcHtg/Fh7kHn78mveTvzqJKDzwl229mtNg4zQObtVHJ4DpLv
tYbLw/gw/RxuqqVMuxB89be8+wwsbTD4MPfB+DD3w/gw/8H4MP/D+LDwgdkH
48Pcg86HhT/MP2DzvBHxAZMHAFCds8s=
    "]], FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
     3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}}, {{1, 4, 3}, {
     0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}}, {{1, 4, 3}, {1, 3, 3}, {1, 3,
      3}, {0, 1, 0}, {1, 3, 3}}}, {CompressedData["
1:eJxTTMoPSmViYGCQBWIQHSG+/SLDNAcH4cpJJWddJB1g/Jr7P24Zv5ZykHf8
mHym1MEhPQ0Inkk7iE+9wpmR5eAQ8vbyxxmOMg6VEStMz0Y7OPRGdPszbpBx
8D7Bbjvb1MHhTVtut1G0rMPyFx56/yUdHL7s+7g1/ZqswxvefQYzgxwc/oPA
fDmI+loHhzNgIA/nG4PAYQU4P5xTrN34vaLDTemaRCNdB4e1Qjp86X1KDipP
mued3WUP54Pdz4fgp8TecWOusIPw9ynC+e8XrVc426EA54PdN03e4brQJ8fz
2+wg/imQg/C/2cHdv8X8x6EUK3uHGNUImXM2sg43QO65aucgAgq/JTIOV0Hq
3ewg/vGRhvMPdu9rMnksAeeDzRMTc0gFhSubvYMJyL+bRSDu2YHgX86PZz/n
6ADnw+IHbP8cMQf0+AMAKa/BYg==
     "], {{32.64529999999999, 8.374999999999998}, {32.64529999999999, 
     7.914059999999999}, {32.1484, 7.668749999999999}, {31.981299999999994`, 
     7.5843799999999995`}, {31.1203, 8.05156}, {31.107799999999994`, 
     8.057809999999998}, {30.80309999999999, 8.225}, {30.80309999999999, 
     8.499999999999998}, {30.80309999999999, 8.889059999999999}, {
     31.27659999999999, 9.081249999999999}, {31.7188, 9.081249999999999}, {
     32.184400000000004`, 9.081249999999999}, {32.64529999999999, 8.82344}, {
     32.64529999999999, 8.374999999999998}}, {{32.78909999999999, 6.10781}, {
     32.78909999999999, 5.63438}, {32.2391, 5.389060000000001}, {
     31.729699999999994`, 5.389060000000001}, {31.1734, 5.389060000000001}, {
     30.659399999999994`, 5.7125}, {30.659399999999994`, 6.22188}, {
     30.659399999999994`, 6.7296900000000015`}, {31.137500000000003`, 
     7.064060000000001}, {31.467200000000005`, 7.184380000000001}, {
     32.33440000000001, 6.706250000000001}, {32.4609, 6.628129999999999}, {
     32.78909999999999, 6.4484400000000015`}, {32.78909999999999, 6.10781}}}],
    FilledCurveBox[{{{0, 2, 0}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {
    1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
    3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}, {0, 
    1, 0}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGI9IGYC4o16eYsZY5wczoDAGkmHzxsCsmfZI/iR4tsv
Mtg5OXze93FrepikQ3oaEJg5ORzs3tdkcljc4XdM7tF/Wk4ODCDQIO7gfYLd
draqk8Obttxuo2hxiHnPHeF8sLl3EHywel9HVPXrHR3c1xxdznBD0mEmCJx0
dIhRjZA5VyPlIO/4MfkMr5ODSOWkkrMsMnD7wPJ7ZBwmf2OLn2Hj5NCqwK56
pkTWAdV/cnA+2L0GCnD+WiEdvvR1ig7CnxzPp7FC+X1KDsVbRX+fnucI54PV
2yD4TxIXXjP57gBxZ6cinO88oVkoLUsBzgf7b7a8w38QEHd0+AIKzzJ5Bx7/
9VNSFRB8+6ZHx2cYI/gX8+PZz3k6Qvz7BMFf+e1lxZkEBTj/jqbsmv+LFRyO
a1pNOm3v6JAKiic2RQf9CQt+GMoh+GB5fUeHThvPXWmLFCHxGefowB8bcN9I
XMkhm/PngvTJCH5FxArTs48R/Pk2Oldm8TlB4kdDEc6HhSeMDwvvN7z7DGa+
cnSQ3bVgX+o7GQfWxZOsGLc6QuxNk4bE938HSHyZiEHcBwwvD5D5P0Th4ffA
Nd5x1kcE38QYBEQd2peHnzJycYLz0dMzAMnFM0w=
    "]], FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
    3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 
    3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {
    1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}}}, CompressedData["
1:eJxd031IU1EUAPA3s4aBg3QfDtt6T7ZKErG2YAyDs92tRkGLklgQGOE+KmxR
CzFchtKgFiOG0baiIguDCo3SPhmCiIbOGIp/VNCyIA1XuuwDRq3d9/beBQ/c
P37c+94999xzmcPevc4VFEWJ8sOUH0X5MehXGdz1FvgRX+x371cC7yVseSVE
cayxgOrFrbjz21pwu/IxgEDaGvYl7qgge7B5+F+mYIsaHtUe7xZpLDDOxjrB
KWujKfaRFsz+Z5rh/B7Bw7IaiTtUBRSOc8TsuvXEiitTJZ4ZMyzc7qUTs4zg
lqEBazRNC0aXO8tcR2mAjpmRSNYMr7xt6aiV5vJdjQSf6pdlx9TE7HodggRO
v414x4PhHmqW2Inz2s7AfGm8LlqFuP39DDgUT5OUBHF1u8BAz6ytNre54Ooq
WOrbcyzWQnyzvmYqdpZ416h427W7y+anEeRwfGAE8/Xk/R3Xw0CDD58njqCJ
rZsaUnHJdd1JBA3pycWISA1dv1Y1RpoQzAeag1uyKhitNobH7Khwvypo8Gmu
5mzEl3Z+LdabEGzIaOZicyrwZ40nJgwIBoPxDv0nYrYeAWK2HzTke97sfe4m
1n7uvJE4Q9zquLc18ZL4+duLf51fEDzbZ3TkRioF8/3KO0CLteNP5LCyO2wU
9SOgcf4hGRRj+4lL7b1dTg/xoaHJTU4lAr0uH49lcD/4zkP9Nhf6X8H1sRRB
yBG0i+oUEMTnYQrfTxCfx/v7KgSXs+9ByfWXpHBfSSWUZ0xvXD/NgttxvVLE
SW+jeOK1mav3EWL2/O4KwRvxfIkcDuB+U/P5S7l6tBNbtaeLYgvE/Pu24X7+
I4fl7/8/KUvAcA==
    "]], FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 
     3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1,
      3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
     3}, {1, 3, 3}, {1, 3, 3}}, {{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 
     0}}}, {CompressedData["
1:eJxTTMoPSmViYGAwBmIQLTH1CmfGJjeHGNUImXN7eB1g/LVCOnzp8wQcVJ80
zzs7CZMPUw/jy2wUm8+kwO3g0PTo+IxmN4c5M4FAkstBb8KCH4Z5CD6v//op
qR6YfI1PKi9ncfLC+TDzYXyw/XWiqPx5Eg6fNgRkz3ru6vBl38et6WZSDmog
93Qh+Log+83Q5F+5ONx3jXecZSgJ54PlxcTh/JC3lz/OUBRzsLh2NNeEwdVB
YdeCfal9og5vePcZzJRC8J8kLrxmYo4m7+Xq8ABsvhicD5bnE0eVvyjuYGIM
BNauDtEg/8ZIOJwBARVXB5HKSSVnWyTg6h+C1AdKOoCCbWYjgl/326rgXAeC
fyk/nv3cQQT/T0zu0X+/XB1A1hgLS8D5YP+WicL5YHMrRRxOaFpNOr3f1SEI
5P9EEYcczp8L0qtdHXYGW0X8dxdxaFsefsrIxBUSPzHCkPRyy8UhPQ0I1IQc
QkpUpv8/4QLxh48AnM8AAg18cH6TeC1rJhsnRNzA1cGuxLH2dAy7A8iYtDIE
H+y/Awh+yVbR36ffuTps99pgMecnp8NN6ZpEI1Y3hxaQeW08Dg/28c0x5kKk
L0h4ujn0RXT7M25gh/gzEMGvjFhhejYawYelfzD/A4IPS48AvjBUfQ==
     "], {{43.96090000000001, 4.1234399999999996`}, {43.96090000000001, 
     3.3499999999999996`}, {43.30779999999999, 3.14375}, {42.98909999999999, 
     3.14375}, {42.574999999999996`, 3.14375}, {42.2234, 3.42188}, {42.2234, 
     3.8046899999999995`}, {42.2234, 4.32969}, {42.7172, 4.871880000000001}, {
     43.96090000000001, 4.912500000000001}, {43.96090000000001, 
     4.1234399999999996`}}}], 
   FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1,
      3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}}, {{1, 4, 
     3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1,
      3, 3}, {1, 3, 3}}}, {CompressedData["
1:eJxTTMoPSmViYGAQA2IQPRMEGD0dgt9e/jjjoZADjJ8GAs/EHFxVS5lmzfBw
OAMCPFIObcvDTxnJIPgOTY+OzzjtDudfzI9nPzfT3UF+14J9qeskHHj9109J
7XB3eNOW220kjeCvFdLhS+dTdOAB8T+4OTxwjXec9VABzq++/+OWcbSCg4Lj
x+Qzpu5wfqT49osMdlD9dgg+2P43cnD+fzBgd/A5wW47OxbBf7CPb45xk7uD
iTEQfOZ2UH3SPO/sLHcH9U8qL2ed5HR4w7vPYOYpdwe7Esfa0zHsEH38HnB+
4uHL2qkTEXxYeNmC+HN4HdDDEwA8laFv
     "], CompressedData["
1:eJxTTMoPSmViYGCQAmIQvab7dgbDcg8H9U8qL2e9FHKA8eV3LdiXqofgf933
cWv6NX6H+/v45hg3eTh8AfN5HIQ+OZ5Pi/Vw2O61wWLOT04H7xPstrN1PRzS
QECN02GDXt5iRh4E/09M7tF/t9zh/Acg8za5O8SoRsic28Pl8GVDQPas6e4O
W0HmWfI65HD+XJDe7e7QG9Htz1jAB+czgEADgn+d97ZY6jZ+OP+Ba7zjLEEx
OP8MCKxB8KPA9ok5qD5pnnd2lrtDH8j8AHEHHv/1U1J3uDtEg+RrJBwsrh3N
NXnh7rAj2Criv7qkg+6EBT8MxTzgfGMQ8Ebwf4H8V+ThUHX/xy1jbQmHnbe6
/qa2Q8PLTNzBVbWUadYMD4c3bbndRtFi8PAF+99G1AE9PgAHJbDX
     "]}], 
   FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1,
     3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
    3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
    3}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGJzIGYC4g16eYsZp/g4+Jxgt529VcVhPRr/De8+g5mT
fBzSQOCZisMZEGjB5KdC+UtfeOj9r0TIr+m+ncFQ7uOwQfVJ87yzKg5g+0p8
HMxs9gZNO6gC0Wfn43DfNd5xlqKyg6tqKdMsAR+HByB+o6LDjJlA8NMbwt+o
4PAnJvfov1veDjGqETLnbOQd3EHqV3g7bA+2ivjPLu0g8MnxfNpSbwcGEEiQ
dZCYeoUzY5E3xJ42BQfza0dzTTK8HcoPb3OduVYJYr6nt0M4p1i78X1liL9F
vR1+vn19wFJZ1SFcfPtFhmVecP5ykP9eesL52Zw/F6Q3ezoYg0CyIpx/W1N2
zf/DCnA+OJx6FBz0Jiz4YdiH4IODZRKC7wLyzwJM/odF6xXOzoC6fwWU/wLK
P+HpcAdkX7KSw/19fHOMtbwg/p+g7GDf9Oj4jMkIPsz/MH7JVtHfp9u8Hb7s
+7g1fZs8nP+mLbfb6LcUnD8THA/iDu3Lw08Z1Xg7eKw5upzhhxgkPoq8HQ52
72syYRZziACFV5i3w1mQ+3mEHXJA/lf2dvgPAvZccH7AE89LppPZ4Xywf8+w
QdSpezuYgMLzMyvEPhMEH0x7I/ghJSrT/0dA3SfJ6XAhP579XKa3w4vax9nn
3/A4zLfRuTKrz9uh+v6PW8arhRw+bAjInjXd20GkclLJ2SMiDjtudf1Nne/t
oLBrwb7UdWKQ9LnE26FNgV31zBVxiP9+IcIHln5Vrj0KZpij7DAXZH6dDyQ9
/VV2gOUncPpYrOKAnr8AUBOF9A==
    "]], FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
     3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}}, {{
     0, 2, 0}, {1, 3, 3}, {1, 3, 3}}}, {CompressedData["
1:eJxTTMoPSmViYGBQAGIQPWMmEDT6OZzYtaOXLUDNAcZnAIEENYe5NjpXZtX5
OdT+tio416HmEH/4snZqIYKvO2HBD8M0BH+DXt5ixhQ/h1fFW0V/Z6s5LH3h
ofc/0c9BtMfrFUuImoPIJ8fzabZ+DnMWKe/8c1zFwecEu+3sp74QfXtUHEyM
geAygi8AUr8UwQe7p8zX4e+30gdzBFUd/oNAOFBe9UnzvLOqDgkg91n6wt0D
44Ple9Xh/Nkg+9k1HFgWT7JiTPWD8+2bHh2fUY3gw8IDnZ8GBgi+zLw4zdMX
NB2+bAjInuXv52BuszdoWqM2xH37feF8sP2OCD7YP/d8HF5kaX+bflcTzv/1
9vUBy8fqcL4XKJyuqjqcAQEfX4h6WxWHG9I1iUZnEXywej8/OB/mvsBbQIWf
VB3Q4xsAk+rp+w==
     "], {{60.4719, 12.2234}, {58.45629999999999, 12.2234}, {
     58.528099999999995`, 13.3391}, {59.20469999999998, 
     13.529699999999998`}, {59.49999999999999, 13.529699999999998`}, {
     60.43129999999999, 13.529699999999998`}, {60.462500000000006`, 
     12.4063}, {60.4719, 12.2234}}}], 
   FilledCurveBox[{{{0, 2, 0}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1,
      3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 
     0}, {0, 1, 0}}, {{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {
     1, 3, 3}, {1, 3, 3}, {0, 1, 0}}}, {CompressedData["
1:eJxTTMoPSmViYGCQAmIQfQYEHAIc0tNAgMkBxmcAgQYWh/v7+OYYyyH4hy9r
p0pKBTiYGAPBZwTf/4nnJVNhDji/N6LbnzFA3qF9efgpozn+Dl/2fdya/k0O
zlf/pPJy1ktZhxkzgeAhgn8hP5793Et/iP4NCP5/EJCXgfN3BFtF/E8XdQgX
336R4Zi/Q4xqhMy5OWIOuhMW/DCc5g9xr4O4Q4/XKxaTRAQfYp8fnM/rv35K
aoGfgwbIfk0ROP8sKBx4BOD8JbeWPzZ05nBIBQXTNSj/MKPDmu7bGQzh/nD+
n5jco/8mIfgsiydZMR71h4RrD7PDXBudK7Oe+Tu0iNeyZh5jhfNh6tHjAwAs
KbAe
     "], CompressedData["
1:eJxTTMoPSmViYGAQB2IQPddG58qsZ/4OZ0DAh8sBxk8DATVOVP4zDocdt7r+
pl73d5DZKDafaQG7g+qT5nlnd/k7BDzxvGQqzOqwQS9vMWMP1LweZoctIH4M
gn9DuibRSBfB31sra5HOgtBfHrHC9OxrP4e+iG5/xgJ2B17/9VNSL/g5vKh9
nH3+DaeDiTEQnPZz0Pik8nIWJy+cL1w5qeQsiwCcv1ZIhy/9nqDDfpD5V/wg
9ukIw80H6/cUgdvvsebocoYKUYe7+/jmGBv5O7xpy+02ihZz0J2w4IdhGoL/
JHHhNZPpCP5/EDju7+AG0j9DFB5evSD3fxB2QA9fAJWoovU=
     "]}], 
   FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1,
     3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
    3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 
    3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {
    1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 
    3}, {1, 3, 3}}}, CompressedData["
1:eJx11H0s1GEcAPBDo3/SFue8hLu5k3PKu0m1fdWEUu73MG6jLDqv6Wq0yImR
rPyhVOOOTLWieV1NlupiZprXTNTURibcsEompdI9v9/d79mynu3547Pn/ft8
n0cQr0ByEw6HY6SrUbpqrKu8EOkv61IESYm6MsYHg71xsRDA0/Grv+XFxIo4
s0GbImK7+Sk/2yxiFS4pCLYek054mQkgS1bnOxBDXEiF3s73IrZYChxKHKbY
8XR7LzHd3rnRLxTKRdV9Puvghu5aTjIf3nan++T3UFCyN7Q9MX6jF7ZoPFTj
xA0l75M5PLTBD1e0Wf0exFkTq+Pe9Y5Qr/d5vcUBZX15mxEosftsQcZrG+b8
pGD+cnqJV4wNzLU1m8x+oIDfXqORN1mBBPevoaCIbybqv8ll4ptBTM/nT0yP
fyeFxm1u5kkXeaw7SjQFPl2OrHPw+jkCCHewSj0yL4Ufi/Mdu51ETHx8KXAT
OC6fGtvB3I+cgk8n7oz5lIqh5aP21qMGCoZGoxbcn7nCOi6fiQ/nFLqHHUKs
6TxJRWBbfVzcJ3Vh3du1vzHFwZl1y67T94yei5j9JCEIe2W2r9KXmIPLpJB1
/lrAmcE6IRNfBfF307iKsLPErZeUrx9nE9PrXUAwjc/TLITcpifxebkI5lIl
K+X2IqZ/o2F9Ceu5jFbuWpoERNOF1QMP/m+h3rN6T2jMq7zvknY6/6t07Xh9
dwl7HjpfvcUwivMvAcHR4euxfxLEUFwb3esVqcuXpRZpWoA+nn4IQl7m2vv3
uIIS759L5g8WnTNWL1Os6fenJab7BxHT962Swk58337OrOnt3OCz7sT5c8CG
mf+LFCaD4gLVnpbM/hMo1vT+1MR0fkxQcBC/NxmXiYcp0ue7NSzi92WOwGVJ
qFVfsWLy21F/38CFflyExEF4fRfirhGJ3MYVgWV2WebAyY2+VrPqOaNzrEi2
fVDJhYhMYfm6h349MY+Z3weBBe6/yZqJVyCCYvyeLO3gmy7s6nAEkYsjXys6
HZjzRiOoxO8ilM+MlyFwGpuK4MTymXwoIP/DHrc36pkiYsN/+a8N/+lfa1M7
sQ==
    "]], FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 
     3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1,
      3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
     3}, {1, 3, 3}, {1, 3, 3}}, {{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 
     0}}}, {CompressedData["
1:eJxTTMoPSmViYGAwBmIQHSG+/SLDsWAHrxPstrOvqjrA+D4g/lY1hwf7+OYY
b8Pkw9TD+CycXfLJeqoOb3n3GcxcF+xwBgTeqDg8EZE9+XQxgh9SojL9/wRM
fsNvq4JzK1ThfJj5MH4Lr//6KaqacD7EPVoO7qqlTLMSgh3MbfYGTWvUdrgP
co8Rgv8YZD87mvyjIAf55S889P5rwfl/vpU+mPNRE85vYDnab1iu6fBi+3rm
52+CHNarPmmep6vpcPiydqrkLwR/f62sRTpHMKq8ULCDHMj8egQfLP8WwX+S
uPCaib+WQ3oaEHAFO2Tkf2g9OUXLwRgE/gc51IPDQwtVPb+2w0wQ0EXwe7xe
sZgYIvhbW2oubPZF8L2rm/V9soIdju/a0ctWoAXnm4LCQ1ETzv/59vUBy8Ua
Dhsevpy6ySfYoRHk/+kaDs2BnnMbtIIdtpj/OJTSpeEwYcEPw2dswQ6ZIPeK
aEDSy60ghxkgd1WqO3xni5/hczEIEr89anB+KsifbAj+nEXKO/8sV4GoYwl2
eJGl/W26rYrDfxBQR/DB/vNF8NuXh58ySgl2MNBaKXzhiYrDzltdf1PzgyHm
tas62OhcmfWsEJG+TEDhWR/sEHBLuiYxSAUSflMRfM6fC9I3z0LwYelfYuoV
zowkBB+WHgHuC2oo
     "], {{77.66090000000001, 11.3234}, {77.66090000000001, 
     10.549999999999999`}, {77.00780000000002, 10.343800000000002`}, {
     76.68909999999998, 10.343800000000002`}, {76.27499999999999, 
     10.343800000000002`}, {75.9234, 10.6219}, {75.9234, 11.0047}, {75.9234, 
     11.5297}, {76.4172, 12.0719}, {77.66090000000001, 12.112499999999997`}, {
     77.66090000000001, 11.3234}}}], 
   FilledCurveBox[{{{0, 2, 0}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1,
      3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 
     0}, {0, 1, 0}}, {{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {
     1, 3, 3}, {1, 3, 3}, {0, 1, 0}}}, {CompressedData["
1:eJxTTMoPSmViYGCQAmIQPRME3oY4pIGBigOMfwYE3qg4rOm+ncFwGsGfsOCH
4bNjIQ4JIUHqCzhV4fy/30ofzLmI4Gfkf2g9WaIP4VeFOMxZpLzzjzuCb2qz
N2jaQT2IfXMR/K0tNRc2Lwxx0NVaKXxhCYI/pb016vIdXTj/QYT49osNWg4V
EStMz/aHOJy/GvZGX1rb4YmI7Mmn5VD35mg7iHxyPJ8Wi+CD7ZNF8ENKVKb/
fxLsYA6y/6EmnG9kDASX1eH8F1na36bfVXVgAAGJEAjfVsVhySQrRt8IBN+r
ulnfpwzBD5ATy/IFuu/Erh29bBtUHGRePzKTWhDicOqw09pMO1U4H6YePT4A
aE7HZw==
     "], CompressedData["
1:eJxTTMoPSmViYGAQB2IQLfP6kZnUghAHBhBIUHOA8XUV5b/kiCH4qWlAwKbm
oGk16XT9jBCHzPwPrSe3qDo82Mc3x7grxOHvt9IHcwRVHVSfNM87WxTicGLX
jl62DSoOaiB+FIK/81bX31RnBH9N9+0MBn2Efo6fC9I3K4U4NPy2Kji3QtUh
pERl+n+REIc5i5R3/nFXcwA5I00oxOFp4sJrJvzqqPzzCP4GvbzFjHs0IOaL
hzj8evv6gGWyJtz8PyD7PmrC7a8H2deh5WCjc2XWM9cQh5pPGwKyf2k5PBGR
Pfk0HsE/UCtrkV6B4J8BgQkhDtsdmh4dn6EFDy99rZXCF45oOqCHLwDsuaP4

     "]}], 
   FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1,
     3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
    3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 
    3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {
    1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 
    3}, {1, 3, 3}}}, CompressedData["
1:eJx11H0slVEYAPBLSn9V416f4b1zL66r5HMlbY9aolG3uOdVkaV8pNCWhrlk
CittlWq4PkZftKiWqaUSySouMrltWiP5avIHa2Kk7nnfe8/Zss72/vHb+XjO
ec5zXnFMyv7YFQKBwEj3Id1nrPtGhHbvR7eyEB+na1oGDPbCzVwM+TVsh6c3
tb/bR/WYB/XE04crxiXUeJk4CxbWRikGPU3FsFN6xli9mlphb5EYOoiIh5rX
lHtlIzKf60+j5vqTl/tlimqq9A5DvKuuvUaQwMDtIj+j0FQEhf7BTXExy/1s
4OLv2ALqjIhan6625b43+z1ds4k6fXBuwOu+A6Trnab37KrokpBGBCrsThuQ
jpyr7LqLYDI/qdDzkDU0nld9aLiAgGmqao59YAFzeHwogjzGVKq5LuLzy1Bz
640qibn5eUqoN3NbE59tSdxS2Jzr3eZAnInjZ4ph/eSwr02JEuanJlu2OEr5
/AwrwU3s8POk1pm/HzMEo0eqtd6XZZD14EnM2QMIevrRD/fnrqDBrZzaKkix
aPWL2hvfgyULNpWHZZ0KF+KOtu31x+2diB9tTL5l9ELK70fIQsg7021lPtQC
3IYkxDkLfqe6ayV8fm2p3/TJY63tqXP3BVfkOFFz8ZxZGMHneSiB3Znn3ENc
WZhIlM8W20n58QcN8eXEE6cbRQsn5DDzSHFCHfZ/T+s9rndd4ecEwV7az9V/
kK4fx3eXk/Nw9eolg5u4/taxsKf3auTSURmEp0qK/whYUOFAfvp8fkMQ9CrL
bvNbVwjG+3+NyPrCmYCeuGpq7v3doObGzyiJufsOVMIGfN++TsTcdq4xxK24
fnZY8+tXKGFoZ3SA2kPI738dIub2t4uaq49LCALxe4sQ8floMNS7FTTh9/Uc
gcuM5Lv6ggVf3xrE3zeIoBS3XmozHL+f+krVnMeYFoEwoyi169hyRyW1Lz3+
hCBSGrG+WyUCJmD6qOaLPp7Mkl//KwJzPN7Eis/XFIIC/J6EttCiS3P8IoLw
qb7pklZ7/rwmLJThecEMP38lC47a4TBBJMPXgztL/g+r56viGzypDf/Lf234
n/4FEoEzaw==
    "]], FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
    3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 
    3, 3}, {1, 3, 3}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGINIGYC4pkg4BvhcGLXjl62ADUHGP9RhPj2iw1qDmu6
b2cwuCP4Neu2JdW7Ivg2OldmPXNE8P3lxLJ87SMcprS3Rl2uUXOQd/yYfMY2
wkG0x+sVS4iaw/19fHOMrSIcTh12Wpv5T9XhPwhoRzhs0MtbzLhHxSGkRGX6
/x/hcL7QJ8fzaTcRfAYQWBMOoRtU4fwLV8Pe6N9Wh/PT04BATctha0vNhc0X
wx1+vH19wJJZG+Kf7wj+taO5Jg2/Efw3vPsMZopFwPn7a2Ut0jUiHGaAwmWn
lsPhy9qpklIRDhn5H1pPTtFykH79yExKIsKhgeVov6E5gg+2nw3BT46948Y8
Q9NBARQeihEOqSB5N02IvAGC/50tfoaPLYIPDh9g+B8Hxc8EBH+L+Y9DKVxa
cL47yKHs2g7fQPpVIxzMbfYGTWvUhoTf13A4/y3If+vQ+HXhkPjaownnN4L8
c10dzv/7rfTBnIuqDrG5R/9t2hzu8CJL+9t0WxWHJyKyJ59+RvArIlaYnrWO
gPNh6Ul2+QsPPXlE+oKlNwBW0Bhr
    "]], FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
     0}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}}, {{
     1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 
     3}, {1, 3, 3}, {1, 3, 3}}}, {CompressedData["
1:eJxTTMoPSmViYGAQA2IQfd+/d3peVaRDI8vRfsPr6g4w/oyZQHBT0+HGue/B
j10jHc6AQI62g/vDKpF17Aj+zltdf1PvR8D5TYGecxuORTg8z9L+Nn2vloO8
48fkM3sjHER6vF6xlCD4GfkfWk+W6DsogPiFEQ5zFinv/OOO4Jva7A2adlDP
Qctq0un6KQi+q2op06wZEQ66WiuFLyxB8Ke0t0ZdvqML56eBgYrD/lpZi/QV
CD7nzwXpm3dFOPx6+/qAZbKqw5ru2xkMxyMcdjg0PTp+Q8Whf8EPw2f3Ihxe
gNxvq+IACoaZjJFw/u+VHy/5OiH4sPDaoPqked5ZVQf08AQACtCmiw==
     "], CompressedData["
1:eJxTTMoPSmViYGCQAmIQ3fI6cIecb6TDhathb/RvqzvA+C+ytL9Nr0XwN+nl
LWaMUXNYNvuIwgYrKH+OqsN2udbXgRqRDgZaK4UvPFFxWPnxkm+SQKTDiV07
etk2qDh82hCQPet/BJwv7hHwR+I5gs/xc0H65ksRDj4n2G1ni6o6CH1yPJ92
NMIhM/9D68ktqg7+cmJZvvsjHCSmXuHMYFKD81PTgIANwRft8XrFEoLgP05c
eM0kXxPOn9LeGnV5D4KvD3LvEU2HNd23MxiORziwcHbJJ/NpOcg7fkw+cxUq
v0TLYWtLzYXNbyMcakAe+aXl8FLNkGMNSyScv1omKsVaHsH3752eJ2Qc6bAF
FD41Wg5A2fv+tpEO5jZ7g6YxajncOPc9+LFrJMS9UzTh4QsOPxYEHxYfAEI5
rrY=
     "]}], 
   FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1,
      3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
     3}}, {{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
     3}}}, {CompressedData["
1:eJxTTMoPSmViYGBQBWIQvf/UQtdtwdEOKbF33JhnqDrA+LW/rQrOcWg6sITx
6W4SjXY4vmtHL9sGbYcpzt05zzdHwfkLXLd9/uuC4GfsKZksoRLlkAYCyzTg
fDObvUHTGBH8LeY/DqWcUndIEIiw3KIR5eB7cWLMP2d1h/XuD6tE7BB8807H
hKcRCL69adwuz5Qoh9mLlHf+YdeA84+B7C9A8NerPmmep6vp8D348dLZPgj+
8tlHFDY4IfguQO/8Toxy8L8lXZP4SQvivjlRDlPaW6Muy2g7uAC9d2UDgg+W
/4Lgf/l7peKlXLSD9Lw4zdMFmnD+r7evD1geVoPzN+jlLWa0UXVY8fGSb5JA
tINAbMB9o3Jlh/8gwB7tIFw5qeTsFCUH9jUyUSnM0Q7V93/cMn6t7FCfBbTw
RZRDC6//+imtqg4b5r5ffmwxgg/Wb47gB+yQa319MtLBeUKzUJqUEpz/pi23
22i2DJz/wDXecdZGSYj/X0L5hiIQfmAUnJ8Oike2aDgflj7A/EAlB/T0AwAw
cQuG
     "], {{107.93299999999998`, 8.932809999999998}, {107.93299999999998`, 
     8.04844}, {107.156, 5.371880000000001}, {105.317, 5.371880000000001}, {
     104.19400000000002`, 5.371880000000001}, {104.00299999999999`, 
     6.2562500000000005`}, {104.00299999999999`, 6.757809999999998}, {
     104.00299999999999`, 7.282809999999998}, {104.33799999999997`, 
     8.514059999999999}, {104.51599999999996`, 8.956249999999999}, {
     104.67200000000001`, 9.31406}, {105.35300000000001`, 
     10.521900000000002`}, {106.59500000000001`, 10.521900000000002`}, {
     107.68299999999998`, 10.521900000000002`}, {107.93299999999998`, 
     9.57813}, {107.93299999999998`, 8.932809999999998}}}], 
   FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0,
     1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 
    3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {0, 
    1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGIzIGYC4p7peULND6Id5Hct2JfaJ+QA4+8Mtor4/1zI
YYpzd87z29EO7muOLmf4IeRg3umY8PQGgi9+89z34MsIfgdQ+sIlKP+GkMMa
magU6/PRDtGqETLnYoQcFrhu+/z3SLTDl30ft6ZfE3B4E7hDrnV1tENqGhCo
8Tqo3P5Zl9WD4NfYm8btakTw76iwNU6tjnZQ/6TychYnH5z/wDXecZagAJx/
BgTWCDi0vAZaUBvtkA7SzyboYHPfv3d6HVR9oSDEf4uh/l8n5fD898qPl64i
+CUZE9/W3EfwBZoPnFr4FJMPdo+nNJz/pi2322i3tMOTC0q3f95D8FuA0q7X
EHxQ8NxfjuD/AVrvuyvaYeW3lxVnFBQcQN733BPtsFZIhy89DsEH+6cMN1/5
2qNghjMKDj5JAhGWW6IdhCsnlZz9ogAPbxhfnCWMT3cWgg8On2nRDvyxAfeN
2hUcJPTvqrBNhNo/T97h/fJj3uaNCPdul2t9HRiA4IP1u6H5zx6T/x8E5BF8
WHjC9MP44PTjj+DD4hPG9+Bh0m6Pg6ZXdmGI/6Kh6c1GyOHL3ysVL8Ng9gnC
+bD0AeO3iNeyZrbxQtyTH+1gX+JYezqG26FGZJ37wy4E/4jChqKMgwg+LL+A
zdNB5B9YfgIAOCmDtw==
    "]], FilledCurveBox[{{{1, 4, 3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {0, 1, 
     0}, {1, 3, 3}}, {{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {
     1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 
     3}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1,
      3, 3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
     3}, {0, 1, 0}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1,
      3, 3}}}, {{{120.07, 11.8719}, {120.07, 11.262499999999998`}, {
     119.76099999999997`, 9.50625}, {117.358, 9.50625}, {116.00799999999998`, 
     9.50625}, {116.79699999999998`, 12.6484}, {116.90499999999997`, 
     13.090600000000002`}, {116.95199999999998`, 13.1141}, {
     117.41899999999997`, 13.1141}, {118.27799999999998`, 13.1141}, {
     119.30599999999998`, 13.1141}, {120.07, 12.803099999999999`}, {120.07, 
     11.8719}}, CompressedData["
1:eJx11GtIU1EcAPClkkpiYu5l8zF1ynx8sGnhC/8WPmLITM2G7N5E1AmZFkkM
2YceptkykjJTEx8Q9mFaSIYOmUnkI2xICD1QzERUXIkmpqnYvefu3gMbHbiM
H2f3nvN/nCMtrMguduLxeBeoh/6tLG34qVeR0IyGGFgHmDrMxb/EMPyhM/WN
koQYBTWO+cLYdXO7bzp2bF1KwSJg32g8YyhLJiFsI2SlZUIMny1/chaSSBjI
iVcfaMVgPTfgfyeChBGD+VaMswAyC73UcR4klNAjlA8eThG1gh2C8xf6/UVs
fXIsafpKwCQ9jNg1ga6yyWkhZxTOjgj0Pr3p8z8IZn85fkw8CwTUqw2qQw/9
4Aod7xIB1fT7uQGci+n1arDR/pewDYlnTSV9UphV1TeVmwg4oEdFEKiLEuZU
bQQ8pdcfDILSocpHoj0CerwjPbVkMFS/pTaQRsKzruDBvXQZ50hpwGZZXhhn
BRpyyKLStepOwvK1fv7uajic94zqa2snOL9Y/5RZOKXhjPI3gi10yfOMMjm6
iJhJc9Zh6zdeZV2KD2fqP4zdkz5f5WPBfkyVd2nX0QW52WEd7thaOn+j8v9a
Oe6a1NooZ/pnW8PkK07O1K9BA/kytcQyJIJaanrqngYe0PXyEsJa96jyVJ0G
Ns3r/donAqDLW5WLjep9GjtqNuTwzSRHs/3DGvWHgg90uVzSsKd1K6HRGXbz
edgoPyUaqJrb/qZQ8oHq1uetldhH1XGvxy128zPYy6HRbkYr/h7qp7/Y95vK
vW/zCM4oX26OttZcNpw4LuDMxiujPi9xwk6coxbYwvlAfTvm6Azj+27eNvb3
1IspLVeFsG9ndp49f/2/96d1E7bvnRQx8e1pYK3rZeDHu0FMPGqCM+rXTuxN
6vWVXtv5FUs5o3VUgZzZ82iU5BcldBOgo/N5xJ85L522+2FSwuyn2XYem32Z
/zcR3H3FGtUjQswZ3TejfOa+ekcw8Ub7MPXcwkbxxZCc2fsTLW8Vgf39+g94
L27R
     "]}], 
   FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1,
     3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
    3}, {1, 3, 3}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGINIGYC4rv+vdPzrOIdTuza0csWoOYA4z+KEN9+sUHN
YcPc98uPGSP4f1Z+vORrhODLtr4O3KGH4GfsKZksoRPvMKW9NepyjZrDlhNl
++ZrxTuI9ni9YglRc3hyQen2T7V4h1OHndZm/lN1cNn2+e8ViXiHDXp5ixn3
qDg8/w204GkcnD/hbY296TEEH6x+RpwDAwg0qML5F66GvdG/rQ7np6cBgZqW
gwcPk3b7vjiHH29fH7Bk1ob45zGCv10O6IEXCD77GpmoFOZ4OL9033wpfdF4
hxkzgWCnlsOXv1cqXrLFO2Tkf2g9OUXLYX1RxsS3LPEODSxH+w3NEXyw/WwI
fnLsHTfmGZoONveBAcwX75AKknfThMjLIPiqhhxrZLQQ/DMgYBLvcBwUPxMQ
/C3mPw6lcGnB+e77a2Ut2LUh+oXiHcxt9gZNa9R2EGcJ49N9FAfng/03G42f
HQeJrz2acH4jyD/X1eH8v99KH8y5qOrQMz1PqHlBnMOLLO1v021VHBIEIiy3
PEDwa7OACUAjHs6HpSfZ5S889OQR6QuW3gCn5xy5
    "]], FilledCurveBox[{{{1, 4, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 
     3}, {0, 1, 0}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}, {1, 3, 3}}, {{
     0, 2, 0}, {1, 3, 3}, {1, 3, 3}}}, {CompressedData["
1:eJxTTMoPSmViYGBQAGIQ3eGY8PSCWILDiV07etkC1BxgfAYQSFBzMInb5ckD
5Nf+tio416HmMD1PqPmAEILPr7tp7nt+BJ99jUxUCpD/qnir6O9sNYfPf69U
vORLcBDt8XrFEqLm8FUjpv8Qa4LDnEXKO/8cV3EI5QMacD/eYYNe3mLGPSoO
qWlAcA3BL8mY+LZmP4L/ZOnsIwor4h3+fit9MEdQ1cFlG9CGGUB51SfN886q
OmwFWdgZD3cPjA+W71WH82eD7GfXcDj/PfjxUqB7YfzIFOv7/qIIPiw80Plp
YIDgy8yL0zx9QdPh98qPl3y5EhzMbfYGTWvUdjgDBvFwvu5dFbbGXgQ/Y0/J
ZImYeIcXWdrfpt/VhPN/vX19wPKxOpzvdYLddvZVVQcTYyCYDFVvqwIJ78sI
Pji+gPbD+DD3Bd6Srkn8pOqAHt8AS/nmJA==
     "], {{128.172, 12.2234}, {126.156, 12.2234}, {126.22800000000001`, 
     13.3391}, {126.90499999999997`, 13.529699999999998`}, {
     127.19999999999999`, 13.529699999999998`}, {128.13099999999997`, 
     13.529699999999998`}, {128.16299999999998`, 12.4063}, {128.172, 
     12.2234}}}]},
  AspectRatio->Automatic,
  BaselinePosition->Scaled[0.3169380676693431],
  ImageSize->{130.43270734744706`, 16.723028642590286`},
  PlotRange->{{0., 130.43}, {0., 16.72}}]], "Output",
 CellChangeTimes->{{3.951227480607923*^9, 3.951227498508594*^9}, 
   3.951227590723441*^9, {3.951227661082717*^9, 3.9512276785464973`*^9}, 
   3.951228233968712*^9, {3.951228327360218*^9, 3.951228340718918*^9}, 
   3.9512283821936007`*^9, 3.9512284290396833`*^9, 3.951228862779323*^9, 
   3.951229355860683*^9, 3.951231936508786*^9, 3.951233653649911*^9},
 CellLabel->
  "Out[508]=",ExpressionUUID->"cf057ce8-39cc-4264-ad48-33e5bda69e22"]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->"FEDeriK.m",
WindowSize->{1200, 750},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
Magnification:>0.9 Inherited,
FrontEndVersion->"14.1 for Linux x86 (64-bit) (July 16, 2024)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"dfc92765-bf29-47cf-bd50-cf1f31dcd525"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 530, 10, 28, "Input",ExpressionUUID->"33cd48af-4550-42b3-9c95-127f2f1ee635"],
Cell[CellGroupData[{
Cell[1109, 34, 259, 4, 59, "Section",ExpressionUUID->"d65e8f2b-6500-4348-8918-912b67b13cd9"],
Cell[1371, 40, 827, 21, 101, "Input",ExpressionUUID->"f9a54712-bc7e-4f67-94ba-c436d6c2a287",
 InitializationCell->True],
Cell[2201, 63, 1862, 48, 144, "Input",ExpressionUUID->"66c68510-764b-433f-bf11-01c5d6a5e9c2",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[4100, 116, 230, 4, 59, "Section",ExpressionUUID->"e03db448-7a6c-4e73-9ddc-3b1976a84a81"],
Cell[CellGroupData[{
Cell[4355, 124, 190, 3, 47, "Subsection",ExpressionUUID->"35360acd-1ab3-48dc-b387-960ef784c1b9"],
Cell[4548, 129, 4418, 121, 539, "Input",ExpressionUUID->"9610d6bd-1c3a-4143-88dc-cb4244676cae",
 InitializationCell->True],
Cell[8969, 252, 9429, 238, 741, "Input",ExpressionUUID->"d8c7ad92-008a-409f-951b-580a3ca827cd",
 InitializationCell->True],
Cell[18401, 492, 151, 3, 26, "Input",ExpressionUUID->"0efd2ca7-491d-441e-bc6b-0b881437e71d"],
Cell[18555, 497, 1251, 33, 181, "Input",ExpressionUUID->"3041f1c9-2084-4cb2-9ca5-98c287d5c642",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[19843, 535, 166, 3, 33, "Subsection",ExpressionUUID->"82ef4885-2b2a-47d1-8963-133ee7a68a33"],
Cell[20012, 540, 1870, 49, 125, "Input",ExpressionUUID->"c5f93900-11a5-40d3-92c2-259b2094122d",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[21919, 594, 218, 4, 33, "Subsection",ExpressionUUID->"23b7e69d-dcbb-4fb0-a77e-b8638a031ad4"],
Cell[CellGroupData[{
Cell[22162, 602, 217, 4, 39, "Subsubsection",ExpressionUUID->"d438b387-4f31-41ce-a117-795b628d69b9"],
Cell[22382, 608, 1698, 50, 183, "Input",ExpressionUUID->"63fbe29b-4af8-405d-80e3-5cbc9aa8d1d5",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[24117, 663, 212, 4, 32, "Subsubsection",ExpressionUUID->"f52392a8-ad40-44db-871d-0651868db7ca"],
Cell[24332, 669, 7271, 167, 779, "Input",ExpressionUUID->"d2be4365-2a9f-4170-90b1-81e044dec426",
 InitializationCell->True],
Cell[31606, 838, 5708, 132, 672, "Input",ExpressionUUID->"ffdc8015-4beb-4a8a-9712-899076a5bcad",
 InitializationCell->True],
Cell[37317, 972, 149, 3, 26, "Input",ExpressionUUID->"e6fda6fb-9bcb-45a5-b801-7e006569f014"]
}, Closed]],
Cell[CellGroupData[{
Cell[37503, 980, 210, 4, 32, "Subsubsection",ExpressionUUID->"432ab124-4161-47f8-a56b-8db469a3db21"],
Cell[37716, 986, 4130, 102, 635, "Input",ExpressionUUID->"11470f5d-e2db-4aaa-9b7e-0a8c11da0687",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[41883, 1093, 270, 4, 32, "Subsubsection",ExpressionUUID->"73595dfd-e53e-4d4e-a700-40ff68a78e58"],
Cell[42156, 1099, 4286, 99, 389, "Input",ExpressionUUID->"8025941a-3caa-4a8b-a6f7-d19c65a09782",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[46479, 1203, 217, 4, 32, "Subsubsection",ExpressionUUID->"4586692a-ee51-46b9-b58e-43bcdb604423"],
Cell[46699, 1209, 3210, 77, 406, "Input",ExpressionUUID->"d04f551f-63ba-4c59-827e-89539a889eb6",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[49946, 1291, 250, 3, 32, "Subsubsection",ExpressionUUID->"bb6d67ae-94ea-4de9-ad33-f49796906916"],
Cell[50199, 1296, 1747, 49, 140, "Input",ExpressionUUID->"cec32202-2ccb-4a54-a11b-3d74e2fc5239",
 InitializationCell->True]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[52007, 1352, 156, 3, 59, "Section",ExpressionUUID->"bdee160a-1c91-4de1-b52d-86eb572207e3"],
Cell[52166, 1357, 468, 10, 42, "Input",ExpressionUUID->"8b16408f-667b-4fec-b260-6fb6db16586b",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[52659, 1371, 168, 3, 39, "Subsubsection",ExpressionUUID->"d002c263-ec1e-44d9-8d95-a0c4fe2e8e78"],
Cell[52830, 1376, 1396, 36, 124, "Input",ExpressionUUID->"f4704157-c7f9-402c-bf7c-77513ac8ecc7",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[54263, 1417, 208, 4, 47, "Subsection",ExpressionUUID->"5193f3f7-8901-4525-bbbc-d3fa4695bea7"],
Cell[54474, 1423, 15016, 344, 922, "Input",ExpressionUUID->"428f55da-c8db-4d63-89da-51a880a4e13f",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[69527, 1772, 223, 4, 47, "Subsection",ExpressionUUID->"a703f905-419d-403f-a28c-a63b6e5d0fbc"],
Cell[CellGroupData[{
Cell[69775, 1780, 159, 3, 39, "Subsubsection",ExpressionUUID->"807846d5-0a8e-42e1-8499-9436b99fe5c0"],
Cell[69937, 1785, 3735, 96, 376, "Input",ExpressionUUID->"3518af78-5ff7-49ca-9232-57a8cda2059b",
 InitializationCell->True],
Cell[73675, 1883, 5577, 155, 672, "Input",ExpressionUUID->"51b5119b-7ed2-4d4e-8157-9da88d9e51a3",
 InitializationCell->True],
Cell[79255, 2040, 2343, 58, 267, "Input",ExpressionUUID->"f9e7b8dd-479d-4f1c-b30c-43e82a8f1466",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[81635, 2103, 190, 3, 32, "Subsubsection",ExpressionUUID->"d2a5f7e9-fbf3-48fd-896b-3c3a13529cd2"],
Cell[81828, 2108, 2125, 54, 229, "Input",ExpressionUUID->"84ac980c-3e5a-487b-a821-389318a8bd26",
 InitializationCell->True],
Cell[83956, 2164, 2296, 54, 273, "Input",ExpressionUUID->"e0675219-06d7-4260-b88e-aecc77330bb2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[86289, 2223, 206, 4, 32, "Subsubsection",ExpressionUUID->"4d34a9f6-835b-4d0e-bded-e4ef20d68c82"],
Cell[CellGroupData[{
Cell[86520, 2231, 176, 3, 26, "Input",ExpressionUUID->"c5165d89-fc29-4ad4-97f2-1fb3dee0e16e"],
Cell[86699, 2236, 177, 3, 30, "Output",ExpressionUUID->"b595cd4d-42e9-403e-975e-1d70a7d367cf"]
}, Open  ]],
Cell[86891, 2242, 8147, 206, 612, "Input",ExpressionUUID->"935d09a0-331b-40fc-a467-f0134b7e4304",
 InitializationCell->True],
Cell[95041, 2450, 5911, 132, 525, "Input",ExpressionUUID->"f8e80e20-24a8-4ec6-ba4f-132db5be82fc",
 InitializationCell->True],
Cell[100955, 2584, 10668, 270, 953, "Input",ExpressionUUID->"9f3b0ea7-2af5-48b1-84b3-46146be887b3",
 InitializationCell->True],
Cell[111626, 2856, 2104, 53, 225, "Input",ExpressionUUID->"3edfcfc0-c624-46bc-ab09-a08de412f0d7",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[113779, 2915, 253, 4, 47, "Subsection",ExpressionUUID->"1785af53-7c89-486a-9e5f-2cc90ee5d4f8"],
Cell[CellGroupData[{
Cell[114057, 2923, 181, 3, 39, "Subsubsection",ExpressionUUID->"6b5ad42c-f028-4331-8dd5-edca6279d9c9"],
Cell[114241, 2928, 3693, 79, 693, "Input",ExpressionUUID->"8223ffc8-f59e-4c33-b04f-02db6763d2e2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[117971, 3012, 171, 3, 32, "Subsubsection",ExpressionUUID->"25f821ed-484b-44c3-bb3d-2285af151ba5"],
Cell[118145, 3017, 4843, 109, 565, "Input",ExpressionUUID->"4b678c74-7d06-4764-a1d3-b462e6b01ccf",
 InitializationCell->True],
Cell[122991, 3128, 2618, 65, 204, "Input",ExpressionUUID->"18065f13-e208-4ab7-83f1-35e867d53bcb",
 InitializationCell->True],
Cell[125612, 3195, 7194, 158, 584, "Input",ExpressionUUID->"4a073111-7191-4734-b32b-1a96840d6461",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[132855, 3359, 168, 3, 47, "Subsection",ExpressionUUID->"94391a5f-eb5e-4478-a534-7016e4a3f9d1"],
Cell[133026, 3364, 5023, 125, 588, "Input",ExpressionUUID->"ac314d00-9b25-4da1-be23-eabaa3a126f2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[138086, 3494, 281, 4, 33, "Subsection",ExpressionUUID->"e5244ec3-f22c-466c-9873-92eb903637b0"],
Cell[138370, 3500, 6127, 136, 670, "Input",ExpressionUUID->"3500ee75-7244-4321-ae5e-82e6897e10d7",
 InitializationCell->True],
Cell[144500, 3638, 11088, 262, 868, "Input",ExpressionUUID->"c85cfa76-e8b5-439f-9ca0-f24e64c44725",
 InitializationCell->True],
Cell[155591, 3902, 2642, 52, 303, "Input",ExpressionUUID->"52021b7e-bece-436c-b228-076b6c722055",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[158282, 3960, 207, 4, 59, "Section",ExpressionUUID->"be19843a-e765-47f1-9747-2d6834a73a9e"],
Cell[CellGroupData[{
Cell[158514, 3968, 171, 3, 47, "Subsection",ExpressionUUID->"e3f3669e-621b-4b13-b56e-3deed41d0aba"],
Cell[158688, 3973, 6805, 156, 693, "Input",ExpressionUUID->"ac348a0a-7a6e-409c-9a98-56e5170bdbb5",
 InitializationCell->True],
Cell[165496, 4131, 3904, 88, 448, "Input",ExpressionUUID->"b0835c23-2d69-40a7-9251-be3d8571a3bb",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[169437, 4224, 185, 3, 33, "Subsection",ExpressionUUID->"a8f64e7a-d885-45c2-99d7-7e2e4dc385f7"],
Cell[169625, 4229, 498, 14, 63, "Input",ExpressionUUID->"bba04405-f573-40fc-9a19-18ca7de811ab",
 InitializationCell->True],
Cell[170126, 4245, 7107, 152, 706, "Input",ExpressionUUID->"fcb7ecd2-adb3-4b5a-a94f-8080924ea319",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[177282, 4403, 172, 3, 59, "Section",ExpressionUUID->"8a7de2d4-4e3d-41aa-8f92-19d8c0694994"],
Cell[CellGroupData[{
Cell[177479, 4410, 163, 3, 47, "Subsection",ExpressionUUID->"fe6211e7-4eaf-4c19-8e0e-b2242a07760b"],
Cell[177645, 4415, 969, 22, 126, "Input",ExpressionUUID->"4cb64dde-a02d-401c-87bd-c89d5d2cf484",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[178651, 4442, 218, 4, 33, "Subsection",ExpressionUUID->"b673667e-d925-4d48-9d93-4211a3ceb4cb"],
Cell[178872, 4448, 5433, 131, 836, "Input",ExpressionUUID->"2757d6ff-49bf-4f75-b9da-02f06924b8e7",
 InitializationCell->True],
Cell[184308, 4581, 8565, 211, 1103, "Input",ExpressionUUID->"c206a11f-7558-4843-a213-55c609b89e58",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[192910, 4797, 173, 3, 33, "Subsection",ExpressionUUID->"c85a5823-b0b0-4a54-a9b5-b6ecf5b7d25d"],
Cell[193086, 4802, 2676, 65, 271, "Input",ExpressionUUID->"4689a3d2-e2b9-43c0-abfa-435e5632834b",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[195799, 4872, 178, 3, 47, "Subsection",ExpressionUUID->"1c82d10b-061e-41f5-a731-b8174ae16e8f"],
Cell[195980, 4877, 9243, 242, 983, "Input",ExpressionUUID->"54a8c1ed-ea4c-48f3-8ca0-31b66c1b5f4b",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[205260, 5124, 174, 3, 47, "Subsection",ExpressionUUID->"0d7ca62e-6e69-4f36-a53a-dfb5b1d4f0f7"],
Cell[205437, 5129, 3568, 85, 290, "Input",ExpressionUUID->"391fa561-d2b8-480b-bb8c-11da575eb488",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[209054, 5220, 152, 3, 86, "Title",ExpressionUUID->"7a24c792-7a48-4e73-8b88-7b56966e439b"],
Cell[CellGroupData[{
Cell[209231, 5227, 3987, 108, 597, "Input",ExpressionUUID->"2632f66f-a425-44c8-b21c-333bdd8417c4"],
Cell[213221, 5337, 27985, 460, 31, "Output",ExpressionUUID->"cf057ce8-39cc-4264-ad48-33e5bda69e22"]
}, Open  ]]
}, Open  ]]
}
]
*)

