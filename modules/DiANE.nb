(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[    138602,       3284]
NotebookOptionsPosition[    134461,       3198]
NotebookOutlinePosition[    134916,       3216]
CellTagsIndexPosition[    134873,       3213]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
   RowBox[{"AutoGeneratedPackage", "->", "\"\<DiANE.m\>\""}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.933907062001917*^9, 3.933907088477437*^9}, 
   3.9356618434708548`*^9, 3.935744927606638*^9, {3.935833716539812*^9, 
   3.93583371672362*^9}, {3.9507222866535883`*^9, 3.95072228934137*^9}, {
   3.950850838405504*^9, 3.950850842475651*^9}, {3.951279221542409*^9, 
   3.9512792233223047`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"33cd48af-4550-42b3-9c95-127f2f1ee635"],

Cell[CellGroupData[{

Cell["DiANE - Diagram Arts and Notation of Equations", "Title",
 CellChangeTimes->{{3.951632773924431*^9, 
  3.951632786588077*^9}},ExpressionUUID->"3adee82b-d00f-476a-af78-\
ba612f7e0c90"],

Cell[CellGroupData[{

Cell["Exports", "Section",
 CellChangeTimes->{{3.951720124067935*^9, 
  3.951720130162963*^9}},ExpressionUUID->"e2e97282-8cb5-4dd8-b8c5-\
4d8e24bfcc91"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FPrint", "::", "usage"}], "=", "\"\<\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FTex", "::", "usage"}], "=", "\"\<\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FPlot", "::", "usage"}], "=", "\"\<\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddTexStyles", "::", "usage"}], "=", "\"\<\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetTexStyles", "::", "usage"}], "=", "\"\<\>\""}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9517201332352953`*^9, 3.951720142672062*^9}, {
  3.951720194210237*^9, 3.951720206986915*^9}, {3.952164918178347*^9, 
  3.952164935653339*^9}, {3.9525769246423807`*^9, 3.952576925604577*^9}, {
  3.953394968660967*^9, 3.953394981428334*^9}, {3.953437211576027*^9, 
  3.9534372186463947`*^9}},ExpressionUUID->"2a2ae6a7-637a-4243-b50c-\
1e49ec8b1691"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Begin Private", "Section",
 CellChangeTimes->{{3.9509597231601686`*^9, 3.950959732923991*^9}, {
  3.951108540108012*^9, 3.9511085438759727`*^9}, {3.951210853720582*^9, 
  3.95121085660688*^9}, {3.951719085230523*^9, 3.951719086330667*^9}, {
  3.95339039462521*^9, 3.953390408535656*^9}, {3.953391063947679*^9, 
  3.953391064411661*^9}},ExpressionUUID->"e5ee7da4-2a11-4b1a-84fd-\
ce2ad36975c7"],

Cell[BoxData[
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]], "Code",
 CellChangeTimes->{
  3.933840441045422*^9, {3.953390410137535*^9, 3.953390412999981*^9}, {
   3.9533910663320923`*^9, 
   3.95339107121176*^9}},ExpressionUUID->"f9299154-a429-45d2-bf15-\
d674018e46ff"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Global setup redefinitions", "Section",
 CellChangeTimes->{{3.9509597231601686`*^9, 3.950959732923991*^9}, {
  3.951108540108012*^9, 3.9511085438759727`*^9}, {3.951210853720582*^9, 
  3.95121085660688*^9}, {3.95343637598921*^9, 
  3.9534363794891653`*^9}},ExpressionUUID->"6f43b5d1-27bc-4a4c-8139-\
18239437158c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FPrint", "[", "expr_", "]"}], "/;", 
     RowBox[{
      RowBox[{"Head", "[", "$GlobalSetup", "]"}], "=!=", "Symbol"}]}], ":=", 
    RowBox[{"FPrint", "[", 
     RowBox[{"$GlobalSetup", ",", "expr"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FTex", "[", "expr_", "]"}], "/;", 
     RowBox[{
      RowBox[{"Head", "[", "$GlobalSetup", "]"}], "=!=", "Symbol"}]}], ":=", 
    RowBox[{"FTex", "[", 
     RowBox[{"$GlobalSetup", ",", "expr"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FPlot", "[", "expr_", "]"}], "/;", 
    RowBox[{
     RowBox[{"Head", "[", "$GlobalSetup", "]"}], "=!=", "Symbol"}]}], ":=", 
   RowBox[{"FPlot", "[", 
    RowBox[{"$GlobalSetup", ",", "expr"}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.953436381825996*^9, 3.95343638686135*^9}, {
  3.953437179947053*^9, 
  3.9534372229257517`*^9}},ExpressionUUID->"56027adb-0dfe-40b9-83db-\
f07ecfaa805a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Global variables", "Section",
 CellChangeTimes->{{3.9509597231601686`*^9, 3.950959732923991*^9}, {
  3.951108540108012*^9, 3.9511085438759727`*^9}, {3.951210853720582*^9, 
  3.95121085660688*^9}},ExpressionUUID->"d65e8f2b-6500-4348-8918-\
912b67b13cd9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ModuleLoaded", "::", "dependency"}], "=", 
    "\"\<The module `1` requires `2`, which has not been loaded.\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ModuleLoaded", "[", "FunKit", "]"}], "=!=", "True"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ModuleLoaded", "::", "dependency"}], ",", "\"\<DiANE\>\"", 
        ",", "\"\<FunKit\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ModuleLoaded", "[", "FEDeriK", "]"}], "=!=", "True"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ModuleLoaded", "::", "dependency"}], ",", "\"\<DiANE\>\"", 
        ",", "\"\<FEDeriK\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ModuleLoaded", "[", "AnSEL", "]"}], "=!=", "True"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ModuleLoaded", "::", "dependency"}], ",", "\"\<DiANE\>\"", 
        ",", "\"\<AnSEL\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ModuleLoaded", "[", "DiANE", "]"}], "=", "True"}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951279357886877*^9, 3.951279421240814*^9}, {
   3.9512794606622543`*^9, 3.951279475842711*^9}, {3.951279581390761*^9, 
   3.9512796611981983`*^9}, {3.9512797916680803`*^9, 
   3.9512797949459953`*^9}, {3.9533944009525757`*^9, 3.9533944021288843`*^9}, 
   3.953394502872796*^9, {3.9534503987003393`*^9, 
   3.9534504189356413`*^9}},ExpressionUUID->"3b72c183-b427-41fc-97f5-\
14c39b5b43de"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Pretty printing and LaTeX", "Section",
 CellChangeTimes->{{3.951227153497263*^9, 
  3.9512271630776052`*^9}},ExpressionUUID->"8a7de2d4-4e3d-41aa-8f92-\
19d8c0694994"],

Cell[CellGroupData[{

Cell["Index list formatting", "Subsection",
 CellChangeTimes->{{3.951227218290779*^9, 3.951227234130476*^9}, {
  3.951228264410342*^9, 
  3.951228264818948*^9}},ExpressionUUID->"b673667e-d925-4d48-9d93-\
4211a3ceb4cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MakeTexIndexList", "[", 
   RowBox[{"{", "i__", "}"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ni", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"{", "i", "}"}], "]"}]}], ",", "\[IndentingNewLine]", 
      "isLower", ",", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", 
       RowBox[{"{", "i", "}"}]}], ",", "\[IndentingNewLine]", "lowerList", 
      ",", "\[IndentingNewLine]", "upperList", ",", "\[IndentingNewLine]", 
      "removeTrailingPhantoms"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"isLower", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Times", "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "i", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"indices", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", 
          RowBox[{"-", 
           RowBox[{"indices", "[", 
            RowBox[{"[", "idx", "]"}], "]"}]}], ",", 
          RowBox[{"indices", "[", 
           RowBox[{"[", "idx", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"lowerList", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ToString", "@", 
           RowBox[{"TeXForm", "[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<\\\\phantom{\>\"", "<>", 
           RowBox[{"ToString", "@", 
            RowBox[{"TeXForm", "[", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], "]"}]}], "<>", 
           "\"\<}\>\""}]}], "\[IndentingNewLine]", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"upperList", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<\\\\phantom{\>\"", "<>", 
           RowBox[{"ToString", "@", 
            RowBox[{"TeXForm", "[", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], "]"}]}], "<>", "\"\<}\>\""}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"ToString", "@", 
           RowBox[{"TeXForm", "[", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"removeTrailingPhantoms", "[", "l_", "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ret", "=", "l"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"StringContainsQ", "[", 
            RowBox[{
             RowBox[{"ret", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\<\\\\phantom\>\""}],
             "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ret", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"ret", ",", 
               RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "ret", "]"}], "===", "0"}], ",", 
              RowBox[{"Return", "[", 
               RowBox[{"{", "\"\<\>\"", "}"}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "ret", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"upperList", "=", 
      RowBox[{"removeTrailingPhantoms", "@", "upperList"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lowerList", "=", 
      RowBox[{"removeTrailingPhantoms", "@", "lowerList"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"StringJoin", "@@", "lowerList"}], ",", 
        RowBox[{"StringJoin", "@@", "upperList"}]}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9512279900434513`*^9, 3.951228079647861*^9}, {
  3.9512281378398447`*^9, 3.951228205003704*^9}},
 CellLabel->
  "In[1095]:=",ExpressionUUID->"2757d6ff-49bf-4f75-b9da-02f06924b8e7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MakeIdxField", "[", 
   RowBox[{"f_", ",", "i_", ",", "up"}], "]"}], ":=", 
  RowBox[{"MakeIdxField", "[", 
   RowBox[{"f", ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MatchQ", "[", 
       RowBox[{"i", ",", 
        RowBox[{"Times", "[", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}], ",", 
      RowBox[{"-", "i"}], ",", "i"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeIdxField", "[", 
   RowBox[{"f_", ",", "i_", ",", "down"}], "]"}], ":=", 
  RowBox[{"MakeIdxField", "[", 
   RowBox[{"f", ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MatchQ", "[", 
       RowBox[{"i", ",", 
        RowBox[{"Times", "[", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}], ",", "i", ",", 
      RowBox[{"-", "i"}]}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MakeIdxField", "[", 
    RowBox[{"f_", ",", "i_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"isLower", ",", "idx"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"isLower", "=", 
       RowBox[{"MatchQ", "[", 
        RowBox[{"i", ",", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"idx", "=", 
       RowBox[{"If", "[", 
        RowBox[{"isLower", ",", 
         RowBox[{"-", "i"}], ",", "i"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"f", "===", "AnyField"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "[", 
          RowBox[{"TeXForm", "[", "idx", "]"}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"isLower", ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "@", 
          RowBox[{"TeXForm", "[", 
           RowBox[{"Subscript", "[", 
            RowBox[{"f", ",", "idx"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"ToString", "@", 
        RowBox[{"TeXForm", "[", 
         RowBox[{"Superscript", "[", 
          RowBox[{"f", ",", "idx"}], "]"}], "]"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeTexIndexList", "[", 
   RowBox[{
    RowBox[{"{", "f__", "}"}], ",", 
    RowBox[{"{", "i__", "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ni", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"{", "f", "}"}], "]"}]}], ",", "\[IndentingNewLine]", 
      "isLower", ",", "\[IndentingNewLine]", 
      RowBox[{"fields", "=", 
       RowBox[{"{", "f", "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", 
       RowBox[{"{", "i", "}"}]}], ",", "\[IndentingNewLine]", "lowerList", 
      ",", "\[IndentingNewLine]", "upperList", ",", "\[IndentingNewLine]", 
      "removeTrailingPhantoms"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"isLower", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Times", "[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "_"}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "i", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"lowerList", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"MakeIdxField", "[", 
           RowBox[{
            RowBox[{"fields", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], ",", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], ",", "up"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<\\\\phantom{\>\"", "<>", 
           RowBox[{"MakeIdxField", "[", 
            RowBox[{
             RowBox[{"fields", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], ",", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], ",", "up"}], "]"}], "<>", 
           "\"\<}\>\""}]}], "\[IndentingNewLine]", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"upperList", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isLower", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<\\\\phantom{\>\"", "<>", 
           RowBox[{"MakeIdxField", "[", 
            RowBox[{
             RowBox[{"fields", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], ",", 
             RowBox[{"indices", "[", 
              RowBox[{"[", "idx", "]"}], "]"}], ",", "up"}], "]"}], "<>", 
           "\"\<}\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{"MakeIdxField", "[", 
           RowBox[{
            RowBox[{"fields", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], ",", 
            RowBox[{"indices", "[", 
             RowBox[{"[", "idx", "]"}], "]"}], ",", "up"}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "ni"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"removeTrailingPhantoms", "[", "l_", "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ret", "=", "l"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"StringContainsQ", "[", 
            RowBox[{
             RowBox[{"ret", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\<\\\\phantom\>\""}],
             "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ret", "=", 
             RowBox[{"Delete", "[", 
              RowBox[{"ret", ",", 
               RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "ret", "]"}], "===", "0"}], ",", 
              RowBox[{"Return", "[", 
               RowBox[{"{", "\"\<\>\"", "}"}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "ret", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"upperList", "=", 
      RowBox[{"removeTrailingPhantoms", "@", "upperList"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lowerList", "=", 
      RowBox[{"removeTrailingPhantoms", "@", "lowerList"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"StringJoin", "@@", "lowerList"}], ",", 
        RowBox[{"StringJoin", "@@", "upperList"}]}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951224453339987*^9, 3.951224504011447*^9}, {
   3.9512245836998873`*^9, 3.951225183586688*^9}, {3.9512252226473923`*^9, 
   3.951225289991295*^9}, {3.951225357167528*^9, 3.95122546150375*^9}, {
   3.95122549194619*^9, 3.951225913224032*^9}, {3.9512259438888283`*^9, 
   3.951226154260346*^9}, {3.951226184420576*^9, 3.9512261923833513`*^9}, {
   3.951226294902279*^9, 3.951226427296379*^9}, {3.95122645762057*^9, 
   3.951226633727709*^9}, 3.9512267993502274`*^9, {3.951227949864423*^9, 
   3.951227987338913*^9}, {3.951374305386952*^9, 
   3.9513743624549017`*^9}},ExpressionUUID->"c206a11f-7558-4843-a213-\
55c609b89e58"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Prettify closed indices", "Subsection",
 CellChangeTimes->{{3.9512282799668913`*^9, 
  3.951228284818677*^9}},ExpressionUUID->"c85a5823-b0b0-4a54-a9b5-\
b6ecf5b7d25d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$availableIndices", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Alphabet", "[", "\"\<English\>\"", "]"}], ",", 
     RowBox[{"Alphabet", "[", 
      RowBox[{"\"\<English\>\"", ",", "\"\<CommonAlphabetUpper\>\""}], "]"}], 
     ",", 
     RowBox[{"Alphabet", "[", "\"\<Greek\>\"", "]"}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.95368986031362*^9, 
  3.953689864804793*^9}},ExpressionUUID->"b3119a3f-7e18-47c2-b2f5-\
197ff4b7d629"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"prettySuperIndices", ",", "prettyExplicitIndices"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"prettySuperIndices", "::", "type"}], "=", 
    "\"\<Unknown type `1`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettySuperIndices", "[", 
    RowBox[{"setup_", ",", "expr_FEq"}], "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"prettySuperIndices", "[", 
       RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettySuperIndices", "[", 
    RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "closedIndices", ",", "openIndices", ",", "repl", ",", "indices"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"closedIndices", "=", 
       RowBox[{"GetClosedSuperIndices", "[", 
        RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"openIndices", "=", 
       RowBox[{"GetOpenSuperIndices", "[", 
        RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", "$availableIndices"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"indices", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"indices", ",", 
           RowBox[{
            RowBox[{"#", "=!=", 
             RowBox[{"ToString", "[", 
              RowBox[{"openIndices", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}], ",",
         "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "openIndices", "]"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"repl", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"closedIndices", "->", 
         RowBox[{"indices", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", 
            RowBox[{"Length", "[", "closedIndices", "]"}]}], "]"}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"expr", "//.", "repl"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettySuperIndices", "[", 
    RowBox[{"setup_", ",", "expr_Association"}], "]"}], "/;", 
   RowBox[{"isLoopAssociation", "[", "expr", "]"}]}], ":=", 
  RowBox[{"Association", "[", 
   RowBox[{
    RowBox[{"Normal", "[", "expr", "]"}], "/.", 
    RowBox[{
     RowBox[{"FEq", "[", "a___", "]"}], ":>", 
     RowBox[{"prettySuperIndices", "[", 
      RowBox[{"setup", ",", 
       RowBox[{
        RowBox[{"Print", "[", "1", "]"}], ";", 
        RowBox[{"FEq", "[", "a", "]"}]}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettySuperIndices", "[", 
    RowBox[{"setup_", ",", "expr_List"}], "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"prettySuperIndices", "[", 
       RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
     RowBox[{
      RowBox[{"Print", "[", "3", "]"}], ";", "expr"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"prettySuperIndices", "[", 
     RowBox[{"setup_", ",", "expr_Association"}], "]"}], "/;", 
    RowBox[{"isRoutedAssociation", "[", "expr", "]"}]}], ":=", 
   RowBox[{"Association", "@", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"prettySuperIndices", "[", 
        RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
      RowBox[{
       RowBox[{"Print", "[", "2", "]"}], ";", 
       RowBox[{"Normal", "@", "expr"}]}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"prettySuperIndices", "[", 
   RowBox[{"setup_", ",", "a_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"prettySuperIndices", "::", "type"}], ",", 
      RowBox[{"Head", "@", "a"}]}], "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951228520702806*^9, 3.9512287157941008`*^9}, {
   3.9512289543471107`*^9, 3.95122895739114*^9}, {3.95122898752525*^9, 
   3.951229005782969*^9}, {3.9512293949001007`*^9, 3.951229396595858*^9}, {
   3.9512303490830173`*^9, 3.9512307057859497`*^9}, {3.951231190652398*^9, 
   3.951231217683535*^9}, {3.951232463495397*^9, 3.9512325501930227`*^9}, {
   3.95123292322405*^9, 3.951232962305142*^9}, {3.951233478552884*^9, 
   3.951233506821313*^9}, 3.9512372221659317`*^9, {3.951821904218615*^9, 
   3.951821908322106*^9}, {3.9518350958045883`*^9, 3.9518351242879868`*^9}, {
   3.952574723161179*^9, 3.952574727553052*^9}, {3.952574773025329*^9, 
   3.95257480450905*^9}, {3.952574836685486*^9, 3.952574837853788*^9}, {
   3.952574875741961*^9, 3.952574895873581*^9}, {3.952575286969192*^9, 
   3.952575293897101*^9}, {3.952575615793373*^9, 3.9525756840811*^9}, {
   3.952575723328244*^9, 3.95257583109693*^9}, {3.952575878278241*^9, 
   3.952575883977687*^9}, {3.952576603406372*^9, 3.952576605698044*^9}, 
   3.953689874004224*^9, {3.9536956455335617`*^9, 3.953695697433535*^9}, {
   3.953695750999921*^9, 3.953695846329637*^9}, {3.9536968902309113`*^9, 
   3.953696911282401*^9}},ExpressionUUID->"4689a3d2-e2b9-43c0-abfa-\
435e5632834b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"prettyExplicitIndices", "::", "type"}], "=", 
    "\"\<Unknown type `1`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettyExplicitIndices", "[", 
    RowBox[{"setup_", ",", "expr_FEq"}], "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"prettyExplicitIndices", "[", 
       RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettyExplicitIndices", "[", 
    RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "allIndices", ",", "closedIndices", ",", "openIndices", ",", "repl", 
       ",", "indices", ",", 
       RowBox[{"ret", "=", "expr"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"allIndices", "=", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ExtractObjectsAndIndices", "[", 
           RowBox[{"setup", ",", "expr"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "#", "]"}], "===", "List"}], "&"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"allIndices", "=", 
       RowBox[{"Map", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], "===", "2"}], ",", 
            "\[IndentingNewLine]", "#", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ret", "=", 
              RowBox[{"ret", "/.", 
               RowBox[{"#", "->", 
                RowBox[{"Join", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"{", 
                   RowBox[{"Hash", "[", 
                    RowBox[{"Sort", "@", 
                    RowBox[{"{", 
                    RowBox[{"#", ",", 
                    RowBox[{"-", "#"}]}], "}"}]}], "]"}], "}"}]}], 
                 "]"}]}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Join", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"Hash", "[", 
                 RowBox[{"Sort", "@", 
                  RowBox[{"{", 
                   RowBox[{"#", ",", 
                    RowBox[{"-", "#"}]}], "}"}]}], "]"}], "}"}]}], "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], "&"}], ",", "allIndices"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"allIndices", "=", 
       RowBox[{"allIndices", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"closedIndices", "=", 
       RowBox[{"Pick", "[", 
        RowBox[{"allIndices", ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Count", "[", 
             RowBox[{"allIndices", ",", "#"}], "]"}], "===", "2"}], "&"}], "/@",
           "allIndices"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"openIndices", "=", 
       RowBox[{"Pick", "[", 
        RowBox[{"allIndices", ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Count", "[", 
             RowBox[{"allIndices", ",", "#"}], "]"}], "=!=", "2"}], "&"}], "/@",
           "allIndices"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"indices", "=", "$availableIndices"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"repl", "=", 
       RowBox[{
        RowBox[{"Thread", "[", 
         RowBox[{"closedIndices", "->", 
          RowBox[{"indices", "[", 
           RowBox[{"[", 
            RowBox[{"1", ";;", 
             RowBox[{"Length", "[", "closedIndices", "]"}]}], "]"}], "]"}]}], 
         "]"}], "\[Union]", 
        RowBox[{"Thread", "[", 
         RowBox[{"openIndices", "->", 
          RowBox[{"indices", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "closedIndices", "]"}], "+", "1"}], ";;", 
             RowBox[{
              RowBox[{"Length", "[", "closedIndices", "]"}], "+", 
              RowBox[{"Length", "[", "openIndices", "]"}]}]}], "]"}], "]"}]}],
          "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"ret", "//.", "repl"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettyExplicitIndices", "[", 
    RowBox[{"setup_", ",", "expr_Association"}], "]"}], "/;", 
   RowBox[{"isLoopAssociation", "[", "expr", "]"}]}], ":=", 
  RowBox[{"Association", "[", 
   RowBox[{
    RowBox[{"Normal", "[", "expr", "]"}], "/.", 
    RowBox[{
     RowBox[{"FEq", "[", "a___", "]"}], ":>", 
     RowBox[{"prettyExplicitIndices", "[", 
      RowBox[{"setup", ",", 
       RowBox[{"FEq", "[", 
        RowBox[{
         RowBox[{"Print", "[", "1", "]"}], ";", "a"}], "]"}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"prettyExplicitIndices", "[", 
    RowBox[{"setup_", ",", "expr_List"}], "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"prettyExplicitIndices", "[", 
       RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"prettyExplicitIndices", "[", 
     RowBox[{"setup_", ",", "expr_Association"}], "]"}], "/;", 
    RowBox[{"isRoutedAssociation", "[", "expr", "]"}]}], ":=", 
   RowBox[{"Association", "@", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"prettyExplicitIndices", "[", 
        RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
      RowBox[{
       RowBox[{"Print", "[", "2", "]"}], ";", 
       RowBox[{"Normal", "@", "expr"}]}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"prettyExplicitIndices", "[", 
   RowBox[{"setup_", ",", "a_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"prettyExplicitIndices", "::", "type"}], ",", 
      RowBox[{"Head", "@", "a"}]}], "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951228520702806*^9, 3.9512287157941008`*^9}, {
   3.9512289543471107`*^9, 3.95122895739114*^9}, {3.95122898752525*^9, 
   3.951229005782969*^9}, {3.9512293949001007`*^9, 3.951229396595858*^9}, {
   3.9512303490830173`*^9, 3.9512307057859497`*^9}, {3.951231190652398*^9, 
   3.951231217683535*^9}, {3.951232463495397*^9, 3.9512325501930227`*^9}, {
   3.95123292322405*^9, 3.951232962305142*^9}, {3.951233478552884*^9, 
   3.951233506821313*^9}, 3.9512372221659317`*^9, {3.951821904218615*^9, 
   3.951821945816298*^9}, {3.951821990859137*^9, 3.9518221328909388`*^9}, {
   3.951822173738544*^9, 3.9518222209616537`*^9}, {3.951822267344976*^9, 
   3.9518224117108603`*^9}, {3.951822481371584*^9, 3.951822537871127*^9}, {
   3.9518226065267057`*^9, 3.951822636809944*^9}, {3.951835022560855*^9, 
   3.951835060395239*^9}, {3.952574730414097*^9, 3.952574732096843*^9}, {
   3.952574862313363*^9, 3.952574872281196*^9}, {3.952575297817463*^9, 
   3.952575298637271*^9}, {3.9525756130191727`*^9, 3.9525756142728653`*^9}, {
   3.95257583670992*^9, 3.952575866113743*^9}, {3.9525765962302713`*^9, 
   3.952576599586089*^9}, {3.953632448227233*^9, 3.9536324818299522`*^9}, {
   3.953632520775103*^9, 3.953632545498705*^9}, {3.953632730234137*^9, 
   3.953632870239377*^9}, 3.953632965162177*^9, {3.953633004038471*^9, 
   3.953633078718328*^9}, {3.9536331291090918`*^9, 3.953633133938148*^9}, {
   3.953633166934259*^9, 3.953633172678028*^9}, {3.953633233746716*^9, 
   3.953633240178186*^9}, {3.953633337574533*^9, 3.953633428753626*^9}, 
   3.9536898788359337`*^9, {3.953695852078054*^9, 3.953695881266787*^9}, {
   3.953696822225802*^9, 
   3.953696841005733*^9}},ExpressionUUID->"4bbbadda-4abc-48b8-bbe3-\
4a25e59f380b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["General formatting definitions", "Subsection",
 CellChangeTimes->{{3.951227218290779*^9, 
  3.951227251130701*^9}},ExpressionUUID->"1c82d10b-061e-41f5-a731-\
b8174ae16e8f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$TexStyles", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$Fields", "=", 
   RowBox[{"{", "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.951839231004553*^9},ExpressionUUID->"6bb84f5e-6a14-4388-9a5c-\
aeffe2a30746"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddTexStyles", "::", "invalidRule"}], "=", 
    "\"\<The given set of style rules does not follow the pattern \
Symbol->String.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AddTexStyles", "[", "a__Rule", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Or", "@@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "=!=", "String"}], "&"}], ",", 
           RowBox[{"Values", "[", 
            RowBox[{"{", "a", "}"}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"AddTexStyles", "::", "invalidRule"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"$TexStyles", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Join", "[", 
         RowBox[{"$TexStyles", ",", 
          RowBox[{"{", "a", "}"}]}], "]"}], "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetTexStyles", "[", "a__Rule", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Or", "@@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "=!=", "String"}], "&"}], ",", 
           RowBox[{"Values", "[", 
            RowBox[{"{", "a", "}"}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"AddTexStyles", "::", "invalidRule"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"$TexStyles", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"{", "a", "}"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetTexStyles", "[", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$TexStyles", "=", 
      RowBox[{"{", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.95137263181005*^9, 3.951372647385743*^9}, {
  3.951372713714319*^9, 3.951372752297573*^9}, {3.951372830177681*^9, 
  3.951372957961604*^9}, {3.9513730522534437`*^9, 3.9513733154194107`*^9}, {
  3.9518339072710953`*^9, 3.951833929706975*^9}, {3.951839229781232*^9, 
  3.9518392328778477`*^9}},ExpressionUUID->"b47c8098-cb50-46d8-b369-\
2238ea569892"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"isLoopAssociation", "[", "expr_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "expr", "]"}], "=!=", "Association"}], ",", 
        RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{
          RowBox[{"Keys", "[", "expr", "]"}], ",", "\"\<Expression\>\""}], 
         "]"}], ",", 
        RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{
          RowBox[{"Keys", "[", "expr", "]"}], ",", 
          "\"\<ExternalIndices\>\""}], "]"}], ",", 
        RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{
          RowBox[{"Keys", "[", "expr", "]"}], ",", "\"\<LoopMomenta\>\""}], 
         "]"}], ",", 
        RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"isRoutedAssociation", "[", "expr_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "expr", "]"}], "=!=", "Association"}], ",", 
        RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "@", 
       RowBox[{"AllTrue", "[", 
        RowBox[{"expr", ",", "isLoopAssociation"}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951834614676776*^9, 3.9518346959769793`*^9}, {
   3.951834870784346*^9, 3.951834873738884*^9}, {3.951835280872603*^9, 
   3.951835283287242*^9}, {3.953695278453631*^9, 3.953695354785406*^9}, 
   3.953695626441084*^9, 
   3.953697727850717*^9},ExpressionUUID->"f3846674-a6a9-49fc-bc6d-\
87117bab43dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RenewFormatDefinitions", "[", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Unprotect", "[", 
       RowBox[{
       "FDOp", ",", "GammaN", ",", "Propagator", ",", "Rdot", ",", "FTerm", 
        ",", "FEq", ",", "\[Gamma]", ",", "\[Delta]", ",", "FMinus", ",", 
        "S"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Unprotect", "@@", "$allObjects"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Field", " ", "formatting", " ", "with", " ", "superindices"}],
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Format", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Keys", "[", "#", "]"}], "[", "any_", "]"}], ",", 
              "TeXForm"}], "]"}], ":=", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"head", ",", "arg"}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"head", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Keys", "[", "#", "]"}], "//.", "$TexStyles"}], "//.",
                  "$Fields"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"arg", "=", 
                RowBox[{
                 RowBox[{"Format", "[", 
                  RowBox[{"any", ",", "TeXForm"}], "]"}], "//", 
                 "ToString"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"TeXUtilities`TeXVerbatim", "[", 
                RowBox[{"head", "<>", "arg"}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Format", "[", 
             RowBox[{
              RowBox[{"Superscript", "[", 
               RowBox[{
                RowBox[{"Keys", "[", "#", "]"}], ",", "any_"}], "]"}], ",", 
              "TeXForm"}], "]"}], ":=", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"head", ",", "arg"}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"head", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Keys", "[", "#", "]"}], "//.", "$TexStyles"}], "//.",
                  "$Fields"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"arg", "=", 
                RowBox[{
                 RowBox[{"Format", "[", 
                  RowBox[{"any", ",", "TeXForm"}], "]"}], "//", 
                 "ToString"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"TeXUtilities`TeXVerbatim", "[", 
                RowBox[{
                "head", "<>", "\"\<^{\>\"", "<>", "arg", "<>", "\"\<}\>\""}], 
                "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Format", "[", 
             RowBox[{
              RowBox[{"Subscript", "[", 
               RowBox[{
                RowBox[{"Keys", "[", "#", "]"}], ",", "any_"}], "]"}], ",", 
              "TeXForm"}], "]"}], ":=", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"head", ",", "arg"}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"head", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Keys", "[", "#", "]"}], "//.", "$TexStyles"}], "//.",
                  "$Fields"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"arg", "=", 
                RowBox[{
                 RowBox[{"Format", "[", 
                  RowBox[{"any", ",", "TeXForm"}], "]"}], "//", 
                 "ToString"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"TeXUtilities`TeXVerbatim", "[", 
                RowBox[{
                "head", "<>", "\"\<_{\>\"", "<>", "arg", "<>", "\"\<}\>\""}], 
                "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
          "\[IndentingNewLine]", ")"}], "&"}], ",", "\[IndentingNewLine]", 
        RowBox[{"$TexStyles", "\[Union]", 
         RowBox[{"Select", "[", 
          RowBox[{"$Fields", ",", 
           RowBox[{
            RowBox[{"FreeQ", "[", 
             RowBox[{
              RowBox[{"Keys", "[", "$TexStyles", "]"}], ",", 
              RowBox[{"Keys", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Field", " ", "formatting", " ", "with", " ", "explicit", " ", 
        "indices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Format", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Keys", "[", "#", "]"}], "[", 
               RowBox[{"{", 
                RowBox[{"p_", ",", "indices_"}], "}"}], "]"}], ",", 
              "TeXForm"}], "]"}], ":=", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"head", ",", "arg"}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"head", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Keys", "[", "#", "]"}], "//.", "$TexStyles"}], "//.",
                  "$Fields"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"arg", "=", 
                RowBox[{
                 RowBox[{"Format", "[", 
                  RowBox[{"indices", ",", "TeXForm"}], "]"}], "//", 
                 "ToString"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"TeXUtilities`TeXVerbatim", "[", 
                RowBox[{"head", "<>", "arg", "<>", "\"\<(\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"TeXForm", "[", "p", "]"}], "]"}], "<>", 
                 "\"\<)\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Format", "[", 
             RowBox[{
              RowBox[{"Superscript", "[", 
               RowBox[{
                RowBox[{"Keys", "[", "#", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"p_", ",", "indices_"}], "}"}]}], "]"}], ",", 
              "TeXForm"}], "]"}], ":=", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"head", ",", "arg"}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"head", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Keys", "[", "#", "]"}], "//.", "$TexStyles"}], "//.",
                  "$Fields"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"arg", "=", 
                RowBox[{
                 RowBox[{"Format", "[", 
                  RowBox[{"indices", ",", "TeXForm"}], "]"}], "//", 
                 "ToString"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"TeXUtilities`TeXVerbatim", "[", 
                RowBox[{
                "head", "<>", "\"\<^{\>\"", "<>", "arg", "<>", "\"\<}(\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"TeXForm", "[", "p", "]"}], "]"}], "<>", 
                 "\"\<)\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Format", "[", 
             RowBox[{
              RowBox[{"Subscript", "[", 
               RowBox[{
                RowBox[{"Keys", "[", "#", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"p_", ",", "indices_"}], "}"}]}], "]"}], ",", 
              "TeXForm"}], "]"}], ":=", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"head", ",", "arg"}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"head", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Keys", "[", "#", "]"}], "//.", "$TexStyles"}], "//.",
                  "$Fields"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"arg", "=", 
                RowBox[{
                 RowBox[{"Format", "[", 
                  RowBox[{"indices", ",", "TeXForm"}], "]"}], "//", 
                 "ToString"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"TeXUtilities`TeXVerbatim", "[", 
                RowBox[{
                "head", "<>", "\"\<_{\>\"", "<>", "arg", "<>", "\"\<}(\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"TeXForm", "[", "p", "]"}], "]"}], "<>", 
                 "\"\<)\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
           ";"}], "\[IndentingNewLine]", ")"}], "&"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"$TexStyles", "\[Union]", 
         RowBox[{"Select", "[", 
          RowBox[{"$Fields", ",", 
           RowBox[{
            RowBox[{"FreeQ", "[", 
             RowBox[{
              RowBox[{"Keys", "[", "$TexStyles", "]"}], ",", 
              RowBox[{"Keys", "[", "#", "]"}]}], "]"}], "&"}]}], "]"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Other", " ", "formatting"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Format", "[", 
        RowBox[{
         RowBox[{"FDOp", "[", "f_", "]"}], ",", "TeXForm"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"TeXUtilities`TeXDelimited", "[", 
          RowBox[{
          "\"\<\\\\frac{\\\\delta}{\\\\delta\>\"", ",", "f", ",", 
           "\"\<}\>\""}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Format", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{
               RowBox[{"{", "f__", "}"}], ",", 
               RowBox[{"{", "i__", "}"}]}], "]"}], ",", "TeXForm"}], "]"}], ":=", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"sub", ",", "sup", ",", "ret"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"sub", ",", "sup"}], "}"}], "=", 
               RowBox[{"MakeTexIndexList", "[", 
                RowBox[{
                 RowBox[{"{", "f", "}"}], ",", 
                 RowBox[{"{", "i", "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"ret", "=", 
               RowBox[{"Switch", "[", 
                RowBox[{
                "#", ",", "\[IndentingNewLine]", "Propagator", ",", 
                 "\"\<G\>\"", ",", "\[IndentingNewLine]", "FMinus", ",", 
                 "\"\<(-1)\>\"", ",", "\[IndentingNewLine]", "Rdot", ",", 
                 "\"\<\\\\partial_t R\>\"", ",", "\[IndentingNewLine]", 
                 "GammaN", ",", "\"\<\\\\Gamma\>\"", ",", 
                 "\[IndentingNewLine]", "S", ",", "\"\<S\>\"", ",", 
                 "\[IndentingNewLine]", "_", ",", 
                 RowBox[{
                  RowBox[{"TeXForm", "[", "#", "]"}], "//", "ToString"}]}], 
                "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "//.", "$TexStyles"}], ")"}], "=!=", "#"}], 
                ",", 
                RowBox[{"ret", "=", 
                 RowBox[{"(", 
                  RowBox[{"#", "//.", "$TexStyles"}], ")"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"StringLength", "[", "sub", "]"}], "=!=", "0"}], ",", 
                RowBox[{"ret", "=", 
                 RowBox[{
                 "ret", "<>", "\"\<_{\>\"", "<>", "sub", "<>", 
                  "\"\<}\>\""}]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"StringLength", "[", "sup", "]"}], "=!=", "0"}], ",", 
                RowBox[{"ret", "=", 
                 RowBox[{
                 "ret", "<>", "\"\<^{\>\"", "<>", "sup", "<>", 
                  "\"\<}\>\""}]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"TeXUtilities`TeXVerbatim", "[", "ret", "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], ")"}], "&"}], ",", 
        "\[IndentingNewLine]", "$allObjects"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Format", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{
                RowBox[{"{", "f__", "}"}], ",", 
                RowBox[{"{", "i__", "}"}]}], "]"}], ",", "TeXForm"}], "]"}], "/;", 
            RowBox[{"AllTrue", "[", 
             RowBox[{
              RowBox[{"{", "i", "}"}], ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ")"}], 
               "&"}]}], "]"}]}], ":=", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"sub", ",", "sup", ",", "ret"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"sub", ",", "sup"}], "}"}], "=", 
               RowBox[{"MakeTexIndexList", "[", 
                RowBox[{
                 RowBox[{"{", "f", "}"}], ",", 
                 RowBox[{"-", 
                  RowBox[{
                   RowBox[{"{", "i", "}"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "]"}]}], ";",
               "\[IndentingNewLine]", 
              RowBox[{"ret", "=", 
               RowBox[{"Switch", "[", 
                RowBox[{
                "#", ",", "\[IndentingNewLine]", "Propagator", ",", 
                 "\"\<G\>\"", ",", "\[IndentingNewLine]", "FMinus", ",", 
                 "\"\<(-1)\>\"", ",", "\[IndentingNewLine]", "Rdot", ",", 
                 "\"\<\\\\partial_t R\>\"", ",", "\[IndentingNewLine]", 
                 "GammaN", ",", "\"\<\\\\Gamma\>\"", ",", 
                 "\[IndentingNewLine]", "S", ",", "\"\<S\>\"", ",", 
                 "\[IndentingNewLine]", "_", ",", 
                 RowBox[{
                  RowBox[{"TeXForm", "[", "#", "]"}], "//", "ToString"}]}], 
                "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "//.", "$TexStyles"}], ")"}], "=!=", "#"}], 
                ",", 
                RowBox[{"ret", "=", 
                 RowBox[{"(", 
                  RowBox[{"#", "//.", "$TexStyles"}], ")"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"StringLength", "[", "sub", "]"}], "=!=", "0"}], ",", 
                RowBox[{"ret", "=", 
                 RowBox[{
                 "ret", "<>", "\"\<_{\>\"", "<>", "sub", "<>", 
                  "\"\<}\>\""}]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"StringLength", "[", "sup", "]"}], "=!=", "0"}], ",", 
                RowBox[{"ret", "=", 
                 RowBox[{
                 "ret", "<>", "\"\<^{\>\"", "<>", "sup", "<>", 
                  "\"\<}\>\""}]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"TeXUtilities`TeXVerbatim", "[", 
               RowBox[{"ret", "<>", "\"\<(\>\"", "<>", 
                RowBox[{"StringRiffle", "[", 
                 RowBox[{
                  RowBox[{"Map", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ToString", "@", 
                    RowBox[{"TeXForm", "[", "#", "]"}]}], "&"}], ",", 
                    RowBox[{
                    RowBox[{"{", "i", "}"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
                  "\"\<,\>\""}], "]"}], "<>", "\"\<)\>\""}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], ")"}], "&"}], ",", 
        "\[IndentingNewLine]", "$allObjects"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Format", "[", 
        RowBox[{
         RowBox[{"FTerm", "[", "a__", "]"}], ",", "TeXForm"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "obj", ",", "integrals", ",", "replNames", ",", "idx", ",", 
           "prefix", ",", "postfix", ",", 
           RowBox[{"body", "=", 
            RowBox[{"{", "a", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"integrals", "=", 
           RowBox[{"Pick", "[", 
            RowBox[{"$availableLoopMomenta", ",", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{
                  RowBox[{"{", "a", "}"}], ",", "#", ",", "Infinity"}], "]"}],
                 "&"}], ",", "$availableLoopMomenta"}], "]"}]}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"replNames", "=", 
           RowBox[{"Thread", "[", 
            RowBox[{"$availableLoopMomenta", "->", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Subscript", "[", 
                RowBox[{
                 RowBox[{"Symbol", "[", "$loopMomentumName", "]"}], ",", 
                 "idx"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"idx", ",", "1", ",", 
                 RowBox[{"Length", "[", "$availableLoopMomenta", "]"}]}], 
                "}"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"prefix", "=", 
           RowBox[{"StringJoin", "[", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"\"\<\\\\int_{\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"TeXForm", "[", "#", "]"}], "]"}], "<>", 
                "\"\<}\>\""}], "&"}], ",", 
              RowBox[{"integrals", "//.", "replNames"}]}], "]"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"postfix", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MatchQ", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", "a", "}"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"b_", "/;", 
               RowBox[{
                RowBox[{"NumericQ", "[", "b", "]"}], "&&", 
                RowBox[{"b", "<", "0"}]}]}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", "a", "}"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "===", 
               RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"prefix", "=", 
                RowBox[{"prefix", "<>", "\"\<(-\>\""}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"postfix", "=", 
                RowBox[{"\"\<)\>\"", "<>", "postfix"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"body", "=", 
                RowBox[{"body", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ";;"}], "]"}], "]"}]}], ";"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"prefix", "=", 
                RowBox[{"prefix", "<>", "\"\<(\>\""}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"postfix", "=", 
                RowBox[{"\"\<)\>\"", "<>", "postfix"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"body", "=", 
           RowBox[{"body", "//.", "replNames"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"body", "=", 
           RowBox[{"body", "//.", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "->", 
                RowBox[{"Subscript", "[", 
                 RowBox[{
                  RowBox[{"Symbol", "[", 
                   RowBox[{"StringTake", "[", 
                    RowBox[{
                    RowBox[{"SymbolName", "[", "#", "]"}], ",", 
                    RowBox[{"{", "1", "}"}]}], "]"}], "]"}], ",", 
                  RowBox[{"ToExpression", "@", 
                   RowBox[{"StringTake", "[", 
                    RowBox[{
                    RowBox[{"SymbolName", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}]}], "]"}]}], "&"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"GetAllSymbols", "[", "body", "]"}], ",", 
                RowBox[{
                 RowBox[{"StringMatchQ", "[", 
                  RowBox[{
                   RowBox[{"SymbolName", "[", "#", "]"}], ",", 
                   RowBox[{"LetterCharacter", "~~", 
                    RowBox[{"DigitCharacter", ".."}]}]}], "]"}], "&"}]}], 
               "]"}]}], "\[IndentingNewLine]", "]"}]}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"TeXUtilities`TeXDelimited", "[", 
             RowBox[{
             "prefix", ",", "##", ",", "postfix", ",", "\[IndentingNewLine]", 
              
              RowBox[{"\"\<DelimSeparator\>\"", "->", "\"\<\>\""}], ",", 
              RowBox[{"\"\<BodySeparator\>\"", "->", "\"\<\\\\,\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "It", " ", "is", " ", "not", " ", "clear", " ", "why", " ", 
                 "the", " ", "call", " ", "to", " ", 
                 RowBox[{"RenewFormatDefinitions", "[", "]"}], " ", "is", " ",
                  "necessary", " ", 
                 RowBox[{"here", ".", " ", "However"}]}], ",", " ", 
                RowBox[{
                "removing", " ", "it", " ", "leads", " ", "to", " ", 
                 "TeXForm", " ", "ignoring", " ", "all", " ", "custom", " ", 
                 RowBox[{"TeXStyles", "."}]}]}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"\"\<BodyConverter\>\"", "->", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{
                   RowBox[{"RenewFormatDefinitions", "[", "]"}], ";", 
                   RowBox[{"Format", "[", 
                    RowBox[{"#", ",", "TeXForm"}], "]"}]}], "]"}], "&"}], 
                ")"}]}]}], "\[IndentingNewLine]", "]"}], "&"}], "@@", 
           "body"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Format", "[", 
        RowBox[{
         RowBox[{"FTerm", "[", "]"}], ",", "TeXForm"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"TeXUtilities`TeXVerbatim", "[", "\"\<1\>\"", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Format", "[", 
        RowBox[{
         RowBox[{"FEq", "[", "a___", "]"}], ",", "TeXForm"}], "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"List", "@@", "#"}], "&"}], ")"}], "/@", 
             RowBox[{"{", "a", "}"}]}], "]"}], "]"}], "<=", "9"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"TeXUtilities`TeXDelimited", "[", 
          RowBox[{
          "\"\<\>\"", ",", "a", ",", "\"\<\>\"", ",", "\[IndentingNewLine]", 
           RowBox[{"\"\<DelimSeparator\>\"", "->", "\"\<\\n\>\""}], ",", 
           RowBox[{
           "\"\<BodySeparator\>\"", "->", "\"\<\\n\\\\,+\\\\,\\n\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<BodyConverter\>\"", "->", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"Format", "[", 
                RowBox[{"#", ",", "TeXForm"}], "]"}], "]"}], "&"}], ")"}]}]}],
           "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"TeXUtilities`TeXDelimited", "[", 
          RowBox[{
          "\"\<\\\\begin{aligned}&\>\"", ",", "a", ",", 
           "\"\<\\\\end{aligned}\>\"", ",", "\[IndentingNewLine]", 
           RowBox[{"\"\<DelimSeparator\>\"", "->", "\"\<\\n\>\""}], ",", 
           RowBox[{
           "\"\<BodySeparator\>\"", "->", 
            "\"\<\\n\\\\\\\\ &\\\\,+\\\\,\\n\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<BodyConverter\>\"", "->", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"Format", "[", 
                RowBox[{"#", ",", "TeXForm"}], "]"}], "]"}], "&"}], ")"}]}]}],
           "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Unprotect", "[", "Association", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Format", "[", 
         RowBox[{
          RowBox[{"Association", "[", "a__", "]"}], ",", "TeXForm"}], "]"}], "/;", 
        RowBox[{"isRoutedAssociation", "[", 
         RowBox[{"Association", "[", "a", "]"}], "]"}]}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "parts", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"parts", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"List", "@@", 
              RowBox[{"Association", "[", "a", "]"}]}], ")"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{"Key", "[", "\"\<Expression\>\"", "]"}]}], "]"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"parts", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"TeXForm", "[", 
               RowBox[{"FEq", "[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
            "parts"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"parts", "=", 
           RowBox[{"Join", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"parts", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Map", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"StringTake", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "17"}], "}"}]}], "]"}], "===", 
                   "\"\<\\\\begin{aligned}&\\n\>\""}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"StringJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "\"\<\\\\begin{aligned}&\\n\\\\,+\\\\,\>\"", ",", 
                    RowBox[{"StringTake", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"18", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], "}"}], "]"}], ",",
                   "\[IndentingNewLine]", 
                  RowBox[{"StringJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{"\"\<\\\\,+\\\\,\>\"", ",", "#"}], "}"}], "]"}]}],
                  "]"}], "&"}], ",", "\[IndentingNewLine]", 
               RowBox[{"parts", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}]}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"TeXUtilities`TeXVerbatim", "[", 
           RowBox[{
           "\"\<\\\\begin{aligned}&\\n\>\"", "<>", "\[IndentingNewLine]", 
            RowBox[{"StringRiffle", "[", 
             RowBox[{"parts", ",", "\"\<\\n \\\\\\&\\n\>\""}], "]"}], "<>", 
            "\[IndentingNewLine]", "\"\<\\n\\\\end{aligned}\>\""}], "]"}]}]}],
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Protect", "[", "Association", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Protect", "[", 
       RowBox[{
       "FDOp", ",", "GammaN", ",", "Propagator", ",", "Rdot", ",", "FTerm", 
        ",", "FEq", ",", "\[Gamma]", ",", "\[Delta]", ",", "FMinus", ",", 
        "S"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Protect", "@@", "$allObjects"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951223302279481*^9, 3.951223365666438*^9}, 
   3.951223448487712*^9, {3.951223520738687*^9, 3.9512235436795464`*^9}, {
   3.951223580644545*^9, 3.951223702875143*^9}, {3.951223781979072*^9, 
   3.9512239278539047`*^9}, {3.951226172034417*^9, 3.951226245691415*^9}, {
   3.95122649515267*^9, 3.95122650002048*^9}, {3.951226539549152*^9, 
   3.951226540239016*^9}, {3.951226672419936*^9, 3.951226788180599*^9}, {
   3.951227127728176*^9, 3.95122713458395*^9}, {3.9512272581117373`*^9, 
   3.951227258523254*^9}, {3.951227545212324*^9, 3.9512275769163637`*^9}, {
   3.9512277385558987`*^9, 3.95122777945168*^9}, {3.9512278585108223`*^9, 
   3.95122793987572*^9}, {3.9512282149424257`*^9, 3.95122821959562*^9}, {
   3.9512335760396547`*^9, 3.951233588723529*^9}, {3.951285981077655*^9, 
   3.951286078310421*^9}, {3.9512885981204576`*^9, 3.951288765653043*^9}, {
   3.951292239838394*^9, 3.951292257905764*^9}, {3.951372787090849*^9, 
   3.9513728140132504`*^9}, {3.951372970471052*^9, 3.951373037847145*^9}, {
   3.951373386749419*^9, 3.951373398207224*^9}, {3.9513734304187098`*^9, 
   3.951373451970018*^9}, {3.951373511587613*^9, 3.951373583588833*^9}, 
   3.951373669147984*^9, {3.951373807966013*^9, 3.951373896111038*^9}, {
   3.951373969907007*^9, 3.951373981665738*^9}, {3.951374057931175*^9, 
   3.95137407584649*^9}, {3.951374109742488*^9, 3.9513741526433973`*^9}, {
   3.9513746064441566`*^9, 3.951374607767682*^9}, {3.951466169353013*^9, 
   3.95146623999717*^9}, {3.951466415677396*^9, 3.951466460044804*^9}, {
   3.951466493504018*^9, 3.95146650916255*^9}, 3.951467220326228*^9, {
   3.95146748725136*^9, 3.9514675358170424`*^9}, {3.951467581445314*^9, 
   3.951467595257019*^9}, {3.951467633295251*^9, 3.951467823541483*^9}, 
   3.951467868479622*^9, {3.951467931937364*^9, 3.95146793313251*^9}, {
   3.951472333605647*^9, 3.951472335186781*^9}, {3.951472365263262*^9, 
   3.951472368768124*^9}, {3.9515439223283777`*^9, 3.951543932575914*^9}, {
   3.951557476625897*^9, 3.9515574812944117`*^9}, {3.951631895382804*^9, 
   3.951631896502469*^9}, {3.951631967546723*^9, 3.9516320201067257`*^9}, {
   3.951723504315639*^9, 3.951723582217185*^9}, {3.9517238033145027`*^9, 
   3.9517238074706717`*^9}, {3.951725581632217*^9, 3.951725593839814*^9}, {
   3.951725924820092*^9, 3.951725927292171*^9}, {3.9517259661845303`*^9, 
   3.951726038744493*^9}, {3.951726076867971*^9, 3.9517260930523*^9}, {
   3.9517261985647583`*^9, 3.951726223057527*^9}, 3.951726253781413*^9, {
   3.951731865393304*^9, 3.951731890857095*^9}, 3.9517319624333887`*^9, {
   3.9517319929812403`*^9, 3.9517321065416183`*^9}, {3.951732151833169*^9, 
   3.9517321551892242`*^9}, {3.951732230293491*^9, 3.95173229434615*^9}, {
   3.9517323987061462`*^9, 3.9517323996541233`*^9}, {3.951732455689672*^9, 
   3.951732516905793*^9}, 3.95173262904812*^9, {3.951732838521454*^9, 
   3.951732848666205*^9}, {3.9517329158497753`*^9, 3.9517329223219833`*^9}, {
   3.951733061925632*^9, 3.95173314268189*^9}, {3.951733248297453*^9, 
   3.951733274777748*^9}, 3.95173330873355*^9, {3.9517382534046183`*^9, 
   3.951738303286145*^9}, {3.951738368542759*^9, 3.95173837237061*^9}, {
   3.9518209148284073`*^9, 3.951820922488799*^9}, {3.951820969863806*^9, 
   3.95182101720472*^9}, {3.951821628465248*^9, 3.951821631925077*^9}, 
   3.95182167175025*^9, {3.9518217128202257`*^9, 3.951821779328442*^9}, {
   3.951822678324483*^9, 3.951822700123749*^9}, 3.951822731348442*^9, {
   3.951822763580241*^9, 3.951822811242262*^9}, {3.951822852496138*^9, 
   3.951822947349473*^9}, {3.951829945257484*^9, 3.951829962262321*^9}, {
   3.951830258677856*^9, 3.951830311910739*^9}, {3.951830393806645*^9, 
   3.951830453173794*^9}, {3.951832637921609*^9, 3.951832681145553*^9}, {
   3.951832788773849*^9, 3.951832903929698*^9}, {3.951832951533869*^9, 
   3.9518330852425547`*^9}, {3.951833126726266*^9, 3.95183334199378*^9}, {
   3.951833418846169*^9, 3.9518334263216352`*^9}, {3.951833458861239*^9, 
   3.951833749518537*^9}, {3.9518337947653303`*^9, 3.951833801179736*^9}, {
   3.951833935434594*^9, 3.951833936517025*^9}, {3.951834214137281*^9, 
   3.9518344543561687`*^9}, {3.951834490705801*^9, 3.951834536642311*^9}, {
   3.951834570518832*^9, 3.9518346037541924`*^9}, {3.951834707879212*^9, 
   3.95183486419481*^9}, {3.951834930372662*^9, 3.9518349524767847`*^9}, {
   3.9518351592414513`*^9, 3.951835182676937*^9}, {3.951835327889214*^9, 
   3.9518353335423107`*^9}, {3.951835417817787*^9, 3.951835447197702*^9}, {
   3.9518355490586*^9, 3.951835570464057*^9}, {3.951835619632997*^9, 
   3.9518356213844023`*^9}, {3.951835669150548*^9, 3.951835883420065*^9}, {
   3.951835915663184*^9, 3.9518359169580727`*^9}, {3.951835965030582*^9, 
   3.951836050512637*^9}, {3.951836091393773*^9, 3.9518360953529797`*^9}, {
   3.9518361648121643`*^9, 3.951836182384706*^9}, 3.951836248126774*^9, {
   3.951836284673668*^9, 3.951836331364614*^9}, {3.951836478034746*^9, 
   3.9518364802610893`*^9}, {3.95183653488538*^9, 3.951836624980103*^9}, {
   3.9518366751375647`*^9, 3.951836676129059*^9}, {3.951836744016436*^9, 
   3.951836794803944*^9}, 3.951836825345516*^9, {3.951836871811821*^9, 
   3.951836878746376*^9}, 3.951837029345621*^9, 3.951837091281859*^9, {
   3.951837134831439*^9, 3.951837157600964*^9}, {3.951837209478311*^9, 
   3.951837514077598*^9}, {3.951837560191766*^9, 3.9518376980750504`*^9}, {
   3.951837742298602*^9, 3.951837768490664*^9}, {3.951837820860238*^9, 
   3.95183782508493*^9}, {3.951837865490492*^9, 3.951837871248529*^9}, {
   3.951838005382984*^9, 3.951838082777966*^9}, {3.9518381417828617`*^9, 
   3.951838150057334*^9}, {3.9518381883318357`*^9, 3.95183822526928*^9}, {
   3.951838270240326*^9, 3.9518382876646442`*^9}, 3.9518387620037518`*^9, {
   3.951838799512101*^9, 3.951838804668652*^9}, {3.951839154137125*^9, 
   3.951839208469392*^9}, {3.9518435012574453`*^9, 3.951843625530487*^9}, {
   3.951843658305655*^9, 3.95184375388585*^9}, {3.951843787722974*^9, 
   3.951843915714733*^9}, {3.9518439729696493`*^9, 3.9518440363029633`*^9}, {
   3.951844081735375*^9, 3.951844173682263*^9}, {3.951844219696177*^9, 
   3.951844234886259*^9}, {3.951844306069223*^9, 3.951844330166308*^9}, 
   3.951903158570623*^9, 3.952575234085486*^9, {3.9525764751648197`*^9, 
   3.952576477732362*^9}, 3.952576579517846*^9, {3.95261765374754*^9, 
   3.952617662485376*^9}, {3.952617830757423*^9, 3.952617886195921*^9}, {
   3.952705784037977*^9, 3.952705811831262*^9}, 3.9527059153835707`*^9, {
   3.953394735774811*^9, 3.953394769935151*^9}, {3.953395455447678*^9, 
   3.95339546615126*^9}, {3.953395502636004*^9, 3.953395526803581*^9}, {
   3.953395572944229*^9, 3.953395606220477*^9}, 3.9534445933379173`*^9, {
   3.953610261585145*^9, 3.9536102925545483`*^9}, {3.953624034487673*^9, 
   3.953624091343685*^9}, {3.953632344649561*^9, 3.953632355340391*^9}, 
   3.953632553389306*^9, {3.953632629923526*^9, 3.953632649806642*^9}, {
   3.953632686229211*^9, 3.953632689164485*^9}, {3.953695492929446*^9, 
   3.953695547588438*^9}, 3.953696419432181*^9, {3.953696650697691*^9, 
   3.9536966743494167`*^9}, {3.9536967199121857`*^9, 3.9536967303320637`*^9}, 
   3.9536977286370487`*^9},ExpressionUUID->"54a8c1ed-ea4c-48f3-8ca0-\
31b66c1b5f4b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["FPrint and FTex commands", "Subsection",
 CellChangeTimes->{{3.951227276578141*^9, 
  3.9512272950223837`*^9}},ExpressionUUID->"0d7ca62e-6e69-4f36-a53a-\
dfb5b1d4f0f7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Turn", " ", "a", " ", "given", " ", "expression", " ", "into", " ", 
    "LaTeX", " ", "code"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FTex", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"prExp", "=", "expr"}], ",", "fields"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fields", "=", 
         RowBox[{"GetAllFields", "[", "setup", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"FunKitDebug", "[", 
         RowBox[{"1", ",", "\"\<Creating LaTeX expression\>\""}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "update", " ", "the", " ", "formatting", " ", "definitions", " ", 
          "for", " ", "TeXForm"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"$Fields", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"fields", "->", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"TeXForm", "[", "#", "]"}], "]"}], "&"}], ",", 
             "fields"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"RenewFormatDefinitions", "[", "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Assign", " ", "human"}], "-", 
          RowBox[{"readable", " ", "superindices"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"prExp", "=", 
         RowBox[{"prettySuperIndices", "[", 
          RowBox[{"setup", ",", "prExp"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"prExp", "=", 
         RowBox[{"prettyExplicitIndices", "[", 
          RowBox[{"setup", ",", "prExp"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "make", " ", "fields", " ", "with", " ", "indices", " ", "to", " ", 
           "sub"}], "-", 
          RowBox[{"/", "super"}], "-", "script"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"prExp", "=", 
         RowBox[{
          RowBox[{"prExp", "//.", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"Times", "[", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "a_"}], "]"}], "]"}], ":>", 
               RowBox[{"Subscript", "[", 
                RowBox[{"#", ",", "a"}], "]"}]}], "&"}], ",", "fields"}], 
            "]"}]}], "//.", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "a_", "]"}], ":>", 
              RowBox[{"Superscript", "[", 
               RowBox[{"#", ",", "a"}], "]"}]}], "&"}], ",", "fields"}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"For", " ", "correct", " ", "rendering"}], ",", " ", 
          RowBox[{"fully", " ", "expand", " ", "any", " ", "FTerms"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"prExp", "=", 
         RowBox[{"prExp", "//.", 
          RowBox[{
           RowBox[{"FTerm", "[", 
            RowBox[{"pre___", ",", 
             RowBox[{"Times", "[", 
              RowBox[{"a_", ",", "b_"}], "]"}], ",", "post___"}], "]"}], ":>", 
           RowBox[{"FTerm", "[", 
            RowBox[{"pre", ",", "a", ",", "b", ",", "post"}], "]"}]}]}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"prExp", "//", "TeXForm"}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"FTex", "[", 
       RowBox[{"setup_", ",", "expr_List"}], "]"}], "/;", 
      RowBox[{"AllTrue", "[", 
       RowBox[{"expr", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "===", "FEq"}], "||", 
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "===", "FTerm"}]}], ")"}], 
         "&"}]}], "]"}]}], ":=", 
     RowBox[{"FTex", "[", 
      RowBox[{"setup", ",", 
       RowBox[{"FEq", "@@", "expr"}]}], "]"}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "For", " ", "the", " ", "output", " ", "of", " ", "a", " ", "full", " ", 
     "routing"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"FTex", "[", 
       RowBox[{"setup_", ",", "expr_Association"}], "]"}], "/;", 
      RowBox[{"isRoutedAssociation", "@", "expr"}]}], ":=", 
     RowBox[{"FTex", "[", 
      RowBox[{"setup", ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"List", "@@", "expr"}], ")"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"Key", "[", "\"\<Expression\>\"", "]"}]}], "]"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"FTex", "[", 
       RowBox[{"setup_", ",", "expr_Association"}], "]"}], "/;", 
      RowBox[{"isLoopAssociation", "@", "expr"}]}], ":=", 
     RowBox[{"FTex", "[", 
      RowBox[{"setup", ",", 
       RowBox[{"expr", "[", "\"\<Expression\>\"", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"For", " ", "direct", " ", "printing"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FPrint", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{
         RowBox[{"FTex", "[", 
          RowBox[{"setup", ",", "expr"}], "]"}], "//", "MaTeX`MaTeX"}], "]"}],
        ";", 
       RowBox[{"Return", "[", "expr", "]"}]}], ")"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.951227286303012*^9, {3.951228303119562*^9, 3.9512283513756*^9}, {
   3.951228389390807*^9, 3.951228426136969*^9}, {3.951228721777083*^9, 
   3.951228779050777*^9}, {3.951228815247923*^9, 3.9512289293188562`*^9}, {
   3.951228970431391*^9, 3.9512289803586397`*^9}, {3.951229222517618*^9, 
   3.951229333300802*^9}, {3.9512293650158653`*^9, 3.951229412171332*^9}, {
   3.951229444928987*^9, 3.951229582788172*^9}, {3.951229640384007*^9, 
   3.9512297215006104`*^9}, {3.9512297734391537`*^9, 3.951229881327454*^9}, {
   3.951229913367536*^9, 3.9512299416277037`*^9}, {3.951229977681635*^9, 
   3.951230059503622*^9}, {3.951230107314933*^9, 3.951230224783657*^9}, {
   3.9512302576264553`*^9, 3.951230266125228*^9}, {3.951230306720083*^9, 
   3.95123031791667*^9}, {3.951230514287863*^9, 3.951230519751683*^9}, {
   3.9512307119179*^9, 3.951230781095096*^9}, {3.951230845660459*^9, 
   3.951230852027361*^9}, {3.9512308966076593`*^9, 3.9512309257438374`*^9}, {
   3.9512319258913*^9, 3.951231987536601*^9}, {3.9512324462397842`*^9, 
   3.951232454463108*^9}, {3.951233522832571*^9, 3.951233545111067*^9}, {
   3.951233639456409*^9, 3.95123364193568*^9}, {3.9512887786122837`*^9, 
   3.951288780671873*^9}, {3.9513725915739727`*^9, 3.9513726300413218`*^9}, 
   3.951631752752861*^9, {3.951720162815097*^9, 3.951720175210793*^9}, {
   3.95172105640731*^9, 3.9517210576670628`*^9}, {3.9517263193663816`*^9, 
   3.951726328123725*^9}, {3.951726359381937*^9, 3.9517263620024242`*^9}, {
   3.9517316156916933`*^9, 3.9517316193954573`*^9}, 3.951738351212677*^9, {
   3.9517410374730587`*^9, 3.951741041453054*^9}, {3.9517410773930187`*^9, 
   3.951741109853744*^9}, {3.9517411546449823`*^9, 3.951741158880941*^9}, {
   3.951741309236899*^9, 3.951741349364913*^9}, {3.951741380284896*^9, 
   3.951741393200844*^9}, 3.951741801081101*^9, 3.951821925509116*^9, {
   3.951822543994802*^9, 3.951822554458557*^9}, {3.951832688325346*^9, 
   3.951832689259428*^9}, {3.951833814303755*^9, 3.951833816935343*^9}, {
   3.9518341242405643`*^9, 3.951834156387426*^9}, {3.9518344643275537`*^9, 
   3.951834482860668*^9}, {3.951834888541211*^9, 3.9518349180552063`*^9}, {
   3.95183496340777*^9, 3.951835000207477*^9}, {3.951835301361877*^9, 
   3.95183530524646*^9}, 3.951835404593992*^9, {3.951838849339798*^9, 
   3.951839034273012*^9}, {3.9518390705280533`*^9, 3.951839089420747*^9}, {
   3.952574376741588*^9, 3.9525743806452208`*^9}, {3.952574480130579*^9, 
   3.952574494205843*^9}, {3.9525747427386827`*^9, 3.952574743770475*^9}, 
   3.9525751916812487`*^9, {3.952575905390394*^9, 3.952575908302548*^9}, {
   3.952575942366788*^9, 3.952575984231545*^9}, {3.952576093734404*^9, 
   3.952576251110784*^9}, {3.952576314215534*^9, 3.9525764162889547`*^9}, {
   3.952576446958785*^9, 3.952576458102038*^9}, {3.952576518990857*^9, 
   3.952576553915189*^9}, {3.952576621967369*^9, 3.952576624466804*^9}, {
   3.9525766792947407`*^9, 3.9525767098465137`*^9}, {3.9525768102719307`*^9, 
   3.9525768736058292`*^9}, {3.953394136358446*^9, 3.953394136813064*^9}, 
   3.953394234609881*^9, {3.953394671381165*^9, 3.953394675313176*^9}, {
   3.953448027236142*^9, 3.953448031267166*^9}, {3.953695552813901*^9, 
   3.9536956140461693`*^9}, 3.953696045842103*^9, {3.953696119246128*^9, 
   3.953696140314081*^9}, {3.9536962281018667`*^9, 3.953696229105681*^9}, {
   3.9536962723098297`*^9, 3.953696296038096*^9}, 3.953696583913473*^9, {
   3.9536967618898*^9, 3.953696768027923*^9}, {3.953696937798266*^9, 
   3.953696944410101*^9}, {3.9536970226434793`*^9, 3.953697060244833*^9}, {
   3.953697104658577*^9, 3.9536971945344954`*^9}, {3.9536972340825644`*^9, 
   3.95369724678881*^9}, {3.953697729266687*^9, 
   3.953697729974547*^9}},ExpressionUUID->"391fa561-d2b8-480b-bb8c-\
11da575eb488"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Diagram drawing", "Section",
 CellChangeTimes->{{3.93221911591842*^9, 
  3.932219119839135*^9}},ExpressionUUID->"e7b15865-c8ea-45b8-8460-\
46b36cdd33e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MakeEdgeRule", "[", 
    RowBox[{"setup_", ",", "obj_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"IsAntiFermion", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"obj", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}], "&&", 
         RowBox[{"IsFermion", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"obj", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"Return", " ", "[", 
         RowBox[{
          RowBox[{"makePosIdx", "@", 
           RowBox[{"obj", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "->", 
          RowBox[{"makePosIdx", "@", 
           RowBox[{"obj", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"IsFermion", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"obj", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}], "&&", 
         RowBox[{"IsAntiFermion", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"obj", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"Return", " ", "[", 
         RowBox[{
          RowBox[{"makePosIdx", "@", 
           RowBox[{"obj", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "->", 
          RowBox[{"makePosIdx", "@", 
           RowBox[{"obj", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", " ", "[", 
       RowBox[{
        RowBox[{"makePosIdx", "@", 
         RowBox[{"obj", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "<->", 
        RowBox[{"makePosIdx", "@", 
         RowBox[{"obj", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.952152658768813*^9, 3.9521527426885557`*^9}, {
   3.952153302196697*^9, 3.95215336044423*^9}, {3.9521534187618017`*^9, 
   3.952153488748294*^9}, {3.952153807093525*^9, 3.95215381349407*^9}, {
   3.952160691743935*^9, 3.9521607028997507`*^9}, {3.9521607413424377`*^9, 
   3.952160796320828*^9}, {3.952162116811489*^9, 3.9521621220016937`*^9}, {
   3.9521624859906693`*^9, 3.952162534809951*^9}, 3.952162769203609*^9, {
   3.952163092211384*^9, 3.95216309718598*^9}, {3.952163368374517*^9, 
   3.952163368549529*^9}, {3.9521634127623777`*^9, 3.952163415537889*^9}, {
   3.9521636393633137`*^9, 3.952163640866045*^9}, {3.952164543270164*^9, 
   3.952164543882249*^9}, 3.952165948079136*^9, 3.952166188508767*^9, 
   3.952166561439118*^9, 3.952166606121491*^9, {3.9521668019896317`*^9, 
   3.952166882630528*^9}, {3.9521669240030327`*^9, 3.952166956906559*^9}, {
   3.953454350784556*^9, 
   3.953454361268076*^9}},ExpressionUUID->"16fb7091-8e31-42c5-b0bb-\
b727d450d12a"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"crosscircle", "[", "r_", "]"}], " ", ":=", " ", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", 
       RowBox[{"Thick", ",", " ", 
        RowBox[{"Line", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", " ", 
             RowBox[{"r", " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}]}], "\n", "            ", 
            "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "r"}], " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"-", "r"}], " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}]}], "}"}]}], "}"}], "]"}], ",",
         " ", 
        RowBox[{"Line", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"-", "r"}], " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}]}], "}"}], ",", "\n", 
           "             ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "r"}], " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", " ", 
             RowBox[{"r", " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}]}], "}"}]}], "}"}], "]"}], ",",
         " ", 
        RowBox[{"Circle", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", " ", "0"}], "}"}], ",", " ", "r"}], "]"}]}], 
       "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"cross", "[", "r_", "]"}], " ", ":=", " ", 
     RowBox[{"Graphics", "[", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"Line", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", " ", 
             RowBox[{"r", " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}]}], "\n", "            ", 
            "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "r"}], " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"-", "r"}], " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}]}], "}"}]}], "}"}], "]"}], ",",
         " ", 
        RowBox[{"Line", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"-", "r"}], " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}]}], "}"}], ",", "\n", 
           "             ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "r"}], " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", " ", 
             RowBox[{"r", " ", "/", " ", 
              RowBox[{"Sqrt", "[", "2", "]"}]}]}], "}"}]}], "}"}], "]"}]}], 
       "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$standardVertexStyles", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"GammaN", "->", 
        RowBox[{"Graphics", "@", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Disk", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", "0.5"}], "]"}], ",", 
           "Gray"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"S", "->", 
        RowBox[{"Graphics", "@", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"Disk", "[", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}], "]"}], ",", "Black"}], "]"}]}]}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"Rdot", "->", 
        RowBox[{"crosscircle", "[", "1", "]"}]}], ",", "\[IndentingNewLine]", 
       
       RowBox[{"Field", "->", 
        RowBox[{"cross", "[", "1", "]"}]}]}], "\[IndentingNewLine]", "}"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$standardVertexSize", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"GammaN", "->", "0.15"}], ",", "\[IndentingNewLine]", 
       RowBox[{"S", "->", "0.05"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Rdot", "->", "0.25"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Field", "->", "0.1"}]}], "\[IndentingNewLine]", "}"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9521799022978983`*^9, 3.952179927984076*^9}, {
  3.95218023415273*^9, 3.952180239164085*^9}, {3.952180374714531*^9, 
  3.9521803749713573`*^9}, {3.9521804185909357`*^9, 3.952180428550908*^9}},
 CellLabel->
  "In[179]:=",ExpressionUUID->"d522fb05-5ff9-495d-a416-b1efe35e553a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FPlot", "::", "FDOp"}], "=", 
    "\"\<Cannot plot diagrams with unresolved derivative operators!\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetDiagram", "[", 
     RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "PossibleVertices", ",", "PossibleEdges", ",", "Styles", ",", "diag", 
        ",", "\[IndentingNewLine]", "allObj", ",", "fieldObj", ",", 
        "vertices", ",", "edges", ",", "vertexReplacements", ",", "graph", 
        ",", "phantomVertices", ",", "edgeFields", ",", "\[IndentingNewLine]",
         "fieldVertices", ",", "fieldEdges", ",", "fieldEdgeFields", ",", 
        "oidx", ",", "\[IndentingNewLine]", "externalVertices", ",", 
        "externalEdges", ",", "externalFields", ",", "idx", ",", "prefactor", 
        ",", "doFields", ",", "eWeights", ",", 
        RowBox[{"addVertexSizes", "=", 
         RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"expr", ",", 
           RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"FPlot", "::", "FDOp"}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"diag", "=", 
        RowBox[{"FUnroute", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"doFields", "=", 
        RowBox[{"replFields", "[", "setup", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PossibleVertices", "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"GammaN", ",", "S", ",", "Rdot", ",", "Field"}], "}"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"KeyExistsQ", "[", 
              RowBox[{"setup", ",", "\"\<DiagramStyling\>\""}], "]"}], "&&", 
             RowBox[{"KeyExistsQ", "[", 
              RowBox[{
               RowBox[{"setup", "[", "\"\<DiagramStyling\>\"", "]"}], ",", 
               "\"\<Vertices\>\""}], "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"setup", "[", "\"\<DiagramStyling\>\"", "]"}], "[", 
             "\"\<Vertices\>\"", "]"}], ",", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"PossibleEdges", "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "Propagator", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"KeyExistsQ", "[", 
              RowBox[{"setup", ",", "\"\<DiagramStyling\>\""}], "]"}], "&&", 
             RowBox[{"KeyExistsQ", "[", 
              RowBox[{
               RowBox[{"setup", "[", "\"\<DiagramStyling\>\"", "]"}], ",", 
               "\"\<Edges\>\""}], "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"setup", "[", "\"\<DiagramStyling\>\"", "]"}], "[", 
             "\"\<Edges\>\"", "]"}], ",", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Styles", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"KeyExistsQ", "[", 
            RowBox[{"setup", ",", "\"\<DiagramStyling\>\""}], "]"}], "&&", 
           RowBox[{"KeyExistsQ", "[", 
            RowBox[{
             RowBox[{"setup", "[", "\"\<DiagramStyling\>\"", "]"}], ",", 
             "\"\<Styles\>\""}], "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"setup", "[", "\"\<DiagramStyling\>\"", "]"}], "[", 
           "\"\<Styles\>\"", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"#", "->", 
               RowBox[{
                RowBox[{"ColorData", "[", 
                 RowBox[{"97", ",", "\"\<ColorList\>\""}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", 
                  RowBox[{"Length", "[", "#", "]"}]}], "]"}], "]"}]}], ")"}], 
             "&"}], "@", 
            RowBox[{"DeleteDuplicates", "[", 
             RowBox[{
              RowBox[{"GetAllFields", "[", "setup", "]"}], "/.", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "->", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ",", 
                RowBox[{"GetFieldPairs", "[", "setup", "]"}]}], "]"}]}], 
             "]"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Styles", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"Styles", ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"GetPartnerField", "[", 
               RowBox[{"setup", ",", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "->", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ",", 
            RowBox[{"Select", "[", 
             RowBox[{"Styles", ",", 
              RowBox[{
               RowBox[{"HasPartnerField", "[", 
                RowBox[{"setup", ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}]}], "]"}]}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"allObj", "=", 
        RowBox[{
         RowBox[{"ExtractObjectsWithIndex", "[", 
          RowBox[{"setup", ",", "diag"}], "]"}], "//.", "doFields"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fieldObj", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"allObj", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", "#", "]"}], "===", "Field"}], "&"}]}], 
           "]"}], "/.", 
          RowBox[{
           RowBox[{"Field", "[", 
            RowBox[{
             RowBox[{"{", "f_", "}"}], ",", 
             RowBox[{"{", "i_", "}"}]}], "]"}], ":>", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", "oi", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Propagator", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"f", ",", 
                   RowBox[{"GetPartnerField", "[", 
                    RowBox[{"setup", ",", "f"}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"oi", ",", "i"}], "}"}]}], "]"}], ",", 
               RowBox[{"Field", "[", 
                RowBox[{
                 RowBox[{"{", "f", "}"}], ",", 
                 RowBox[{"{", "oi", "}"}]}], "]"}]}], "}"}]}], "]"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"allObj", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"allObj", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "=!=", "Field"}], "&"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"prepare", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"vertices", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"allObj", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"PossibleVertices", ",", 
              RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&&", 
            "\[IndentingNewLine]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"FreeQ", "[", 
               RowBox[{"PossibleEdges", ",", 
                RowBox[{"Head", "[", "#", "]"}]}], "]"}], "||", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "=!=", "2"}]}], 
             ")"}]}], "&"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vertexReplacements", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", "v", "}"}], ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"v", "=", 
                 RowBox[{"Unique", "[", "\"\<v\>\"", "]"}]}], ";", 
                RowBox[{"Map", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"makePosIdx", "[", "#", "]"}], "->", "v"}], ")"}],
                    "&"}], ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "&"}], 
             ",", "vertices"}], "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vertices", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"makePosIdx", "/@", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "/.", 
                "vertexReplacements"}], ")"}], "//", "DeleteDuplicates"}], 
             ")"}]}], "&"}], ",", "vertices"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Props", " ", "and", " ", "vertices", " ", "for", " ", "attached", 
         " ", "fields"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"fieldVertices", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"fieldObj", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "===", "Field"}], ")"}], 
           "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"fieldVertices", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"makePosIdx", "/@", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "/.", 
                "vertexReplacements"}], ")"}], "//", "DeleteDuplicates"}], 
             ")"}]}], "&"}], ",", "fieldVertices"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fieldEdges", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"fieldObj", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "=!=", "Field"}], ")"}], 
           "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"fieldEdgeFields", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"SelectFirst", "[", 
           RowBox[{
            RowBox[{"fieldEdges", "[", 
             RowBox[{"[", 
              RowBox[{"idx", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{"Styles", ",", "#", ",", "Infinity"}], "]"}], "&"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "fieldEdges", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"fieldEdges", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MakeEdgeRule", "[", 
            RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
          RowBox[{"fieldEdges", "/.", "vertexReplacements"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fieldEdges", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"fieldEdges", "[", 
               RowBox[{"[", "idx", "]"}], "]"}], ",", "##"}], "]"}], "&"}], "@@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"fieldEdgeFields", "[", 
               RowBox[{"[", "idx", "]"}], "]"}], "/.", "Styles"}], "}"}]}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "fieldEdges", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"prepare", " ", "edges"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"edges", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"allObj", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"PossibleEdges", ",", 
              RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&&", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "===", "2"}]}], "&"}]}],
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"edgeFields", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"SelectFirst", "[", 
           RowBox[{
            RowBox[{"edges", "[", 
             RowBox[{"[", 
              RowBox[{"idx", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{"Styles", ",", "#", ",", "Infinity"}], "]"}], "&"}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"edges", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MakeEdgeRule", "[", 
            RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
          RowBox[{"edges", "/.", "vertexReplacements"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"edges", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"edges", "[", 
               RowBox[{"[", "idx", "]"}], "]"}], ",", "##"}], "]"}], "&"}], "@@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"edgeFields", "[", 
               RowBox[{"[", "idx", "]"}], "]"}], "/.", "Styles"}], "}"}]}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Add", " ", "additional", " ", "vertices", " ", "for", " ", 
         "external", " ", "indices"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"externalVertices", "=", 
        RowBox[{"GetOpenSuperIndices", "[", 
         RowBox[{"setup", ",", "diag"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"externalFields", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"SelectFirst", "[", 
           RowBox[{"allObj", ",", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"makePosIdx", "/@", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", 
               RowBox[{"externalVertices", "[", 
                RowBox[{"[", "idx", "]"}], "]"}]}], "]"}], "&"}]}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "externalVertices", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"externalFields", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"externalFields", "[", 
           RowBox[{"[", 
            RowBox[{"idx", ",", "1", ",", 
             RowBox[{
              RowBox[{"FirstPosition", "[", 
               RowBox[{
                RowBox[{"makePosIdx", "/@", 
                 RowBox[{"externalFields", "[", 
                  RowBox[{"[", 
                   RowBox[{"idx", ",", "2"}], "]"}], "]"}]}], ",", 
                RowBox[{"externalVertices", "[", 
                 RowBox[{"[", "idx", "]"}], "]"}]}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "externalVertices", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"externalVertices", "=", 
        RowBox[{"Unique", "/@", "externalVertices"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"externalEdges", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"MakeEdgeRule", "[", 
           RowBox[{"setup", ",", 
            RowBox[{"Propagator", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"GetPartnerField", "[", 
                 RowBox[{"setup", ",", 
                  RowBox[{"externalFields", "[", 
                   RowBox[{"[", "idx", "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"externalFields", "[", 
                 RowBox[{"[", "idx", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"externalVertices", "[", 
                 RowBox[{"[", "idx", "]"}], "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"GetOpenSuperIndices", "[", 
                   RowBox[{"setup", ",", "diag"}], "]"}], "[", 
                  RowBox[{"[", "idx", "]"}], "]"}], "/.", 
                 "vertexReplacements"}]}], "}"}]}], "]"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "externalVertices", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"externalEdges", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"externalEdges", "[", 
               RowBox[{"[", "idx", "]"}], "]"}], ",", "##"}], "]"}], "&"}], "@@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"externalFields", "[", 
               RowBox[{"[", "idx", "]"}], "]"}], "/.", "Styles"}], "}"}]}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "externalEdges", "]"}]}], "}"}]}], "]"}]}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"phantomVertices", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Symbol", "[", 
           RowBox[{"\"\<phantom\>\"", "<>", 
            RowBox[{"ToString", "[", "idx", "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"idx", ",", "1", ",", 
            RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"edges", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"Head", "[", 
                 RowBox[{"edges", "[", 
                  RowBox[{"[", "idx", "]"}], "]"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"edges", "[", 
                  RowBox[{"[", 
                   RowBox[{"idx", ",", "1"}], "]"}], "]"}], ",", 
                 RowBox[{"phantomVertices", "[", 
                  RowBox[{"[", "idx", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{
                RowBox[{"Head", "[", 
                 RowBox[{"edges", "[", 
                  RowBox[{"[", "idx", "]"}], "]"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"phantomVertices", "[", 
                  RowBox[{"[", "idx", "]"}], "]"}], ",", 
                 RowBox[{"edges", "[", 
                  RowBox[{"[", 
                   RowBox[{"idx", ",", "2"}], "]"}], "]"}]}], "]"}]}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"idx", ",", "1", ",", 
               RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "]"}]}]}], 
         ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"get", " ", "the", " ", "prefactor"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"prefactor", "=", 
        RowBox[{"Times", "@@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"diag", "/.", "doFields"}], "/.", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Blank", "[", "#", "]"}], "->", "1"}], "&"}], ",", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", "Field", "}"}], ",", "$allObjects"}], "]"}]}], 
            "]"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"oidx", "=", 
        RowBox[{"GetOpenSuperIndices", "[", 
         RowBox[{"setup", ",", "diag"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"externalEdges", ",", 
              RowBox[{"oidx", "[", 
               RowBox[{"[", "idx", "]"}], "]"}], ",", "Infinity"}], "]"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"addVertexSizes", ",", 
              RowBox[{
               RowBox[{"oidx", "[", 
                RowBox[{"[", "idx", "]"}], "]"}], "->", "0.00001"}]}], 
             "]"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"idx", ",", "1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"GetOpenSuperIndices", "[", 
             RowBox[{"setup", ",", "diag"}], "]"}], "]"}]}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"prefactor", "*", 
        RowBox[{"Graph", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"vertices", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
            "externalVertices", ",", 
            RowBox[{"fieldVertices", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"Join", "[", 
           RowBox[{"edges", ",", "externalEdges", ",", "fieldEdges"}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"VertexShape", "->", 
           RowBox[{"Join", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{
               RowBox[{"vertices", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "->", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"vertices", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "0"}], "]"}], "]"}], "/.", 
                 "$standardVertexStyles"}], ")"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Thread", "[", 
              RowBox[{"externalVertices", "->", 
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Graphics", "@", 
                   RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Disk", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], ",", "0.0"}], "]"}], ",", 
                    "Gray"}], "]"}]}], "&"}], ",", "externalVertices"}], 
                "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"Thread", "[", 
              RowBox[{
               RowBox[{"fieldVertices", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "->", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"fieldVertices", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "0"}], "]"}], "]"}], "/.", 
                 "$standardVertexStyles"}], ")"}]}], "]"}]}], 
            "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"VertexSize", "->", 
           RowBox[{"Join", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{
               RowBox[{"vertices", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "->", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"vertices", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "0"}], "]"}], "]"}], "/.", 
                 "$standardVertexSize"}], ")"}]}], "]"}], ",", 
             "\[IndentingNewLine]", "addVertexSizes"}], "\[IndentingNewLine]",
             "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"GraphLayout", "->", 
           RowBox[{"{", "\"\<SpringElectricalEmbedding\>\"", "}"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"PerformanceGoal", "->", "\"\<Quality\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Small"}], ",", "\[IndentingNewLine]", 
          RowBox[{"EdgeStyle", "->", 
           RowBox[{"Arrowheads", "[", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{".07", ",", ".6"}], "}"}], "}"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FPlot", "[", 
     RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"GetDiagram", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "@", "expr"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FPlot", "[", 
     RowBox[{"setup_", ",", "expr_FEq"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"Plus", "@@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"GetDiagram", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", "expr"}], 
          ")"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "@", "expr"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FPlot", "[", 
      RowBox[{"setup_", ",", "expr_Association"}], "]"}], "/;", 
     RowBox[{"isLoopAssociation", "[", "expr", "]"}]}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FPlot", "[", 
        RowBox[{"setup", ",", 
         RowBox[{"expr", "[", "\"\<Expression\>\"", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "@", "expr"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FPlot", "[", 
      RowBox[{"setup_", ",", "expr_Association"}], "]"}], "/;", 
     RowBox[{"isRoutedAssociation", "@", "expr"}]}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FPlot", "[", 
        RowBox[{"setup", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", "@@", "routedAssociation"}], ")"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"Key", "[", "\"\<Expression\>\"", "]"}]}], "]"}], "]"}]}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "@", "expr"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FPlot", "::", "type"}], "=", "\"\<Unknown type `1`\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FPlot", "[", 
   RowBox[{"setup_", ",", "a_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"FPlot", "::", "type"}], ",", 
      RowBox[{"Head", "[", "a", "]"}]}], "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.952152460964925*^9, 3.952152514468886*^9}, {
   3.952152554316844*^9, 3.952152636693309*^9}, {3.9521527625054693`*^9, 
   3.952152839269813*^9}, {3.95215288557335*^9, 3.9521531712040377`*^9}, {
   3.9521534964253187`*^9, 3.952153503588785*^9}, {3.95215354264533*^9, 
   3.952153608438096*^9}, {3.95215366222612*^9, 3.9521536654973097`*^9}, {
   3.952153699191906*^9, 3.952153773076386*^9}, {3.952153818894291*^9, 
   3.9521538349754343`*^9}, {3.9521551020550747`*^9, 3.952155136457157*^9}, {
   3.9521584429144783`*^9, 3.952158447933817*^9}, {3.952158555625746*^9, 
   3.9521585773338823`*^9}, {3.95215883637433*^9, 3.9521592828435907`*^9}, {
   3.9521597535511436`*^9, 3.952159903983079*^9}, {3.9521599388705587`*^9, 
   3.9521601657670393`*^9}, {3.952160496640254*^9, 3.952160684364685*^9}, {
   3.952160726160882*^9, 3.9521607270547857`*^9}, 3.952160801978627*^9, {
   3.9521608849263697`*^9, 3.952160958558505*^9}, {3.952160993555583*^9, 
   3.952161074283044*^9}, {3.952161923162402*^9, 3.952162099034666*^9}, {
   3.9521621525329857`*^9, 3.952162165210656*^9}, {3.952162196399763*^9, 
   3.952162232420073*^9}, {3.952162649506996*^9, 3.9521628654797564`*^9}, {
   3.9521628977210407`*^9, 3.952162900686998*^9}, {3.952162956412883*^9, 
   3.9521630850559387`*^9}, {3.952163128495308*^9, 3.952163142852316*^9}, {
   3.952163202142255*^9, 3.9521633568393087`*^9}, {3.952163397168042*^9, 
   3.95216340814921*^9}, {3.952163465816785*^9, 3.952163612423523*^9}, {
   3.952163683171771*^9, 3.952163687991354*^9}, {3.9521639007156267`*^9, 
   3.952164105139443*^9}, {3.952164153028245*^9, 3.952164342743621*^9}, {
   3.9521644023858767`*^9, 3.952164501891127*^9}, {3.9521645611691113`*^9, 
   3.952164902606182*^9}, {3.952165027524662*^9, 3.952165132390606*^9}, {
   3.952165230259284*^9, 3.9521654021123533`*^9}, {3.952165511312428*^9, 
   3.952165527512054*^9}, 3.952165569565442*^9, {3.952165619649095*^9, 
   3.952165685200365*^9}, {3.952165723588578*^9, 3.952165774064949*^9}, {
   3.952165820728022*^9, 3.952165965183634*^9}, {3.9521660089305162`*^9, 
   3.9521660782091427`*^9}, {3.9521661359326344`*^9, 3.952166180116426*^9}, {
   3.952166216526518*^9, 3.952166258227413*^9}, {3.952166340079199*^9, 
   3.952166375298787*^9}, {3.9521664101834993`*^9, 3.95216646223348*^9}, {
   3.9521665118079653`*^9, 3.952166586597268*^9}, {3.9521666250323887`*^9, 
   3.952166625700055*^9}, {3.952166758900363*^9, 3.952166782318074*^9}, {
   3.952166933439806*^9, 3.952166949024472*^9}, 3.952167000873608*^9, {
   3.952167246326283*^9, 3.9521672776202307`*^9}, {3.9521673201495647`*^9, 
   3.9521673329045773`*^9}, {3.952167377355794*^9, 3.95216737768056*^9}, {
   3.9521796859166813`*^9, 3.952179695712667*^9}, {3.952179731031681*^9, 
   3.952179731232378*^9}, {3.952179766187818*^9, 3.9521797691115828`*^9}, {
   3.952179807364016*^9, 3.952179861725246*^9}, {3.952179952439814*^9, 
   3.9521800813483686`*^9}, {3.952180171863996*^9, 3.952180207763936*^9}, {
   3.95218030329496*^9, 3.952180363936771*^9}, {3.952180708725082*^9, 
   3.952180723741644*^9}, 3.952244436445387*^9, {3.95224458940934*^9, 
   3.9522446107917967`*^9}, {3.952244656553426*^9, 3.9522450930205173`*^9}, {
   3.952245137349025*^9, 3.952245162164495*^9}, {3.952245211521447*^9, 
   3.952245268033386*^9}, {3.95224545440184*^9, 3.952245507783472*^9}, {
   3.952245559175042*^9, 3.952245571106854*^9}, {3.9522456535647707`*^9, 
   3.952245684395914*^9}, {3.952245716196707*^9, 3.952245748975175*^9}, {
   3.952245780137751*^9, 3.952245831371913*^9}, {3.952245955972472*^9, 
   3.952246105631989*^9}, {3.9522461393274117`*^9, 3.952246276036954*^9}, {
   3.952246334251801*^9, 3.952246366075059*^9}, {3.952246438156581*^9, 
   3.952246496703326*^9}, 3.952262742662116*^9, {3.952576926363027*^9, 
   3.9525769269538507`*^9}, {3.95257701959412*^9, 3.952577064745826*^9}, 
   3.952617635149626*^9, {3.95344806644307*^9, 3.953448084366973*^9}, {
   3.953450277411104*^9, 3.953450293786352*^9}, {3.9534504663234377`*^9, 
   3.953450616715619*^9}, 3.953450680192854*^9, {3.953450761051681*^9, 
   3.953450785203587*^9}, {3.953450914058667*^9, 3.953450991767845*^9}, 
   3.953451021975512*^9, {3.9534548818096457`*^9, 3.953454884210239*^9}, {
   3.953523788262926*^9, 3.953523816435204*^9}, {3.953523897335341*^9, 
   3.953523899955461*^9}, {3.953523942967217*^9, 3.953523969276698*^9}, 
   3.9535248443208923`*^9, {3.953525055716085*^9, 3.9535250700084343`*^9}, 
   3.9535313756094217`*^9, {3.953624327587385*^9, 3.953624373547431*^9}, {
   3.953627783215707*^9, 3.953627811517541*^9}, {3.9536279046441193`*^9, 
   3.953627906471612*^9}, {3.953627938153282*^9, 3.9536279416784067`*^9}, {
   3.953628336119358*^9, 3.953628349091543*^9}, 3.9536283946437063`*^9, {
   3.953628432107826*^9, 3.95362851273265*^9}, {3.95362861062805*^9, 
   3.953628634151634*^9}, 3.953628680938396*^9, {3.953628721956905*^9, 
   3.953628769064755*^9}, 3.953628841025858*^9, {3.953628967737691*^9, 
   3.9536289775093603`*^9}, {3.953629010797647*^9, 3.9536290951025743`*^9}, {
   3.953629740952836*^9, 3.953629837027649*^9}, {3.9536298708046417`*^9, 
   3.9536299186277313`*^9}, {3.953630072152544*^9, 3.953630291803937*^9}, {
   3.953695917538652*^9, 3.953696057617152*^9}, {3.953697730659154*^9, 
   3.953697731269145*^9}},ExpressionUUID->"b418b13c-926d-4bba-aa56-\
0b557db0f3a7"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Private", "Section",
 CellChangeTimes->{{3.9509597231601686`*^9, 3.950959732923991*^9}, {
  3.951108540108012*^9, 3.9511085438759727`*^9}, {3.951210853720582*^9, 
  3.95121085660688*^9}, {3.951719085230523*^9, 3.951719086330667*^9}, {
  3.95339039462521*^9, 
  3.953390408535656*^9}},ExpressionUUID->"ca2026b5-7ed6-4941-a57a-\
35062d7325da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Code",
 CellChangeTimes->{
  3.933840441045422*^9, {3.953390410137535*^9, 
   3.953390412999981*^9}},ExpressionUUID->"572650f1-255e-412f-86a9-\
43a44c871c76"]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->"DiANE.m",
WindowSize->{708.75, 861},
WindowMargins->{{1200, -708.75}, {Automatic, 0}},
Magnification:>0.7 Inherited,
FrontEndVersion->"14.1 for Linux x86 (64-bit) (July 16, 2024)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"dfc92765-bf29-47cf-bd50-cf1f31dcd525"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 580, 11, 21, "Input",ExpressionUUID->"33cd48af-4550-42b3-9c95-127f2f1ee635"],
Cell[CellGroupData[{
Cell[1159, 35, 189, 3, 67, "Title",ExpressionUUID->"3adee82b-d00f-476a-af78-ba612f7e0c90"],
Cell[CellGroupData[{
Cell[1373, 42, 152, 3, 46, "Section",ExpressionUUID->"e2e97282-8cb5-4dd8-b8c5-4d8e24bfcc91"],
Cell[1528, 47, 1120, 31, 144, "Input",ExpressionUUID->"2a2ae6a7-637a-4243-b50c-1e49ec8b1691",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[2685, 83, 399, 6, 46, "Section",ExpressionUUID->"e5ee7da4-2a11-4b1a-84fd-ce2ad36975c7"],
Cell[3087, 91, 276, 6, 37, "Code",ExpressionUUID->"f9299154-a429-45d2-bf15-d674018e46ff"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3400, 102, 319, 5, 46, "Section",ExpressionUUID->"6f43b5d1-27bc-4a4c-8139-18239437158c"],
Cell[3722, 109, 1139, 33, 92, "Input",ExpressionUUID->"56027adb-0dfe-40b9-83db-f07ecfaa805a",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[4898, 147, 259, 4, 46, "Section",ExpressionUUID->"d65e8f2b-6500-4348-8918-912b67b13cd9"],
Cell[5160, 153, 2327, 60, 288, "Input",ExpressionUUID->"3b72c183-b427-41fc-97f5-14c39b5b43de",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[7524, 218, 172, 3, 46, "Section",ExpressionUUID->"8a7de2d4-4e3d-41aa-8f92-19d8c0694994"],
Cell[CellGroupData[{
Cell[7721, 225, 218, 4, 37, "Subsection",ExpressionUUID->"b673667e-d925-4d48-9d93-4211a3ceb4cb"],
Cell[7942, 231, 5434, 131, 628, "Input",ExpressionUUID->"2757d6ff-49bf-4f75-b9da-02f06924b8e7",
 InitializationCell->True],
Cell[13379, 364, 8240, 204, 784, "Input",ExpressionUUID->"c206a11f-7558-4843-a213-55c609b89e58",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[21656, 573, 173, 3, 37, "Subsection",ExpressionUUID->"c85a5823-b0b0-4a54-a9b5-b6ecf5b7d25d"],
Cell[21832, 578, 518, 14, 32, "Input",ExpressionUUID->"b3119a3f-7e18-47c2-b2f5-197ff4b7d629",
 InitializationCell->True],
Cell[22353, 594, 5568, 138, 389, "Input",ExpressionUUID->"4689a3d2-e2b9-43c0-abfa-435e5632834b",
 InitializationCell->True],
Cell[27924, 734, 8042, 197, 450, "Input",ExpressionUUID->"4bbbadda-4abc-48b8-bbe3-4a25e59f380b",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[36003, 936, 178, 3, 37, "Subsection",ExpressionUUID->"1c82d10b-061e-41f5-a731-b8174ae16e8f"],
Cell[36184, 941, 319, 10, 45, "Input",ExpressionUUID->"6bb84f5e-6a14-4388-9a5c-aeffe2a30746",
 InitializationCell->True],
Cell[36506, 953, 2934, 77, 277, "Input",ExpressionUUID->"b47c8098-cb50-46d8-b369-2238ea569892",
 InitializationCell->True],
Cell[39443, 1032, 2349, 63, 190, "Input",ExpressionUUID->"f3846674-a6a9-49fc-bc6d-87117bab43dd",
 InitializationCell->True],
Cell[41795, 1097, 37682, 796, 2465, "Input",ExpressionUUID->"54a8c1ed-ea4c-48f3-8ca0-31b66c1b5f4b",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[79514, 1898, 174, 3, 37, "Subsection",ExpressionUUID->"0d7ca62e-6e69-4f36-a53a-dfb5b1d4f0f7"],
Cell[79691, 1903, 10099, 219, 556, "Input",ExpressionUUID->"391fa561-d2b8-480b-bb8c-11da575eb488",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[89839, 2128, 159, 3, 46, "Section",ExpressionUUID->"e7b15865-c8ea-45b8-8460-46b36cdd33e6"],
Cell[90001, 2133, 3400, 83, 127, "Input",ExpressionUUID->"16fb7091-8e31-42c5-b0bb-b727d450d12a",
 InitializationCell->True],
Cell[93404, 2218, 5172, 137, 294, "Input",ExpressionUUID->"d522fb05-5ff9-495d-a416-b1efe35e553a",
 InitializationCell->True],
Cell[98579, 2357, 35243, 818, 2052, "Input",ExpressionUUID->"b418b13c-926d-4bba-aa56-0b557db0f3a7",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[133859, 3180, 351, 6, 46, "Section",ExpressionUUID->"ca2026b5-7ed6-4941-a57a-35062d7325da"],
Cell[134213, 3188, 220, 6, 37, "Code",ExpressionUUID->"572650f1-255e-412f-86a9-43a44c871c76"]
}, Open  ]]
}, Open  ]]
}
]
*)

