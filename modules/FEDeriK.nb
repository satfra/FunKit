(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[    322675,       7703]
NotebookOptionsPosition[    309385,       7453]
NotebookOutlinePosition[    309839,       7471]
CellTagsIndexPosition[    309796,       7468]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
   RowBox[{"AutoGeneratedPackage", "->", "\"\<FEDeriK.m\>\""}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.933907062001917*^9, 3.933907088477437*^9}, 
   3.9356618434708548`*^9, 3.935744927606638*^9, {3.935833716539812*^9, 
   3.93583371672362*^9}, {3.9507222866535883`*^9, 3.95072228934137*^9}, {
   3.950850838405504*^9, 3.950850842475651*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"33cd48af-4550-42b3-9c95-127f2f1ee635"],

Cell[CellGroupData[{

Cell["FEDeriK - Functional Equation Derivation Kit", "Title",
 CellChangeTimes->{{3.95163275148967*^9, 
  3.951632763152072*^9}},ExpressionUUID->"e8eab254-3b4c-449c-9b09-\
2a41fc81e9e2"],

Cell[CellGroupData[{

Cell["Global variables", "Section",
 CellChangeTimes->{{3.9509597231601686`*^9, 3.950959732923991*^9}, {
  3.951108540108012*^9, 3.9511085438759727`*^9}, {3.951210853720582*^9, 
  3.95121085660688*^9}},ExpressionUUID->"d65e8f2b-6500-4348-8918-\
912b67b13cd9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ModuleLoaded", "::", "dependency"}], "=", 
    "\"\<The module `1` requires `2`, which has not been loaded.\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ModuleLoaded", "[", "FunKit", "]"}], "=!=", "True"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ModuleLoaded", "::", "dependency"}], ",", "\"\<FEDeriK\>\"", 
        ",", "\"\<FunKit\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ModuleLoaded", "[", "FEDeriK", "]"}], "=", "True"}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951279357886877*^9, 3.951279421240814*^9}, {
  3.9512794606622543`*^9, 3.951279475842711*^9}, {3.951279581390761*^9, 
  3.9512796956111917`*^9}, {3.951279782883439*^9, 3.9512797869913473`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"0a00f2e0-9e12-4855-8a8a-da6773cee6a6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$userCorrelationFunctions", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$userIndexedObjects", "=", 
    RowBox[{"{", "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$CorrelationFunctions", ":=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Propagator", ",", "GammaN"}], "}"}], "\[Union]", 
    "$userCorrelationFunctions"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$OrderedObjects", ":=", 
   RowBox[{"$CorrelationFunctions", "\[Union]", 
    RowBox[{"{", 
     RowBox[{"Rdot", ",", "S"}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$indexedObjects", ":=", 
   RowBox[{"$OrderedObjects", "\[Union]", 
    RowBox[{"{", 
     RowBox[{"ABasis", ",", "VBasis", ",", "\[Gamma]"}], "}"}], "\[Union]", 
    "$userIndexedObjects"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$allObjects", ":=", 
   RowBox[{
    RowBox[{"{", "FMinus", "}"}], "\[Union]", "$indexedObjects"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$MaxDerivativeIterations", "=", "500"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$CanonicalOrdering", "=", "\"\<f>af>b\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "@@", "$allObjects"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951210756011141*^9, 3.951210767816422*^9}, {
  3.951210812202783*^9, 3.951210812369783*^9}, {3.9512108663431187`*^9, 
  3.9512108750394697`*^9}, {3.951288819743936*^9, 3.9512888255679903`*^9}, {
  3.951292005911707*^9, 3.951292009096613*^9}, {3.951389228290406*^9, 
  3.951389341305668*^9}, {3.9515365783899803`*^9, 3.951536592486267*^9}, {
  3.951656994065312*^9, 3.9516570184174*^9}},
 CellLabel->
  "In[2852]:=",ExpressionUUID->"f9a54712-bc7e-4f67-94ba-c436d6c2a287"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AddIndexedObject", "[", "name_Symbol", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AppendTo", "[", 
       RowBox[{"$userIndexedObjects", ",", "name"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"$userIndexedObjects", "=", 
       RowBox[{"DeleteDuplicates", "[", "$userIndexedObjects", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Protect", "@@", "$allObjects"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9512888041247883`*^9, 3.951288852682535*^9}, {
   3.951292978856127*^9, 3.9512929928318167`*^9}, {3.951389349775201*^9, 
   3.951389352618557*^9}, 3.951657025190865*^9},
 CellLabel->
  "In[2851]:=",ExpressionUUID->"9f23e5c2-affb-4cab-9de6-acd7510a1543"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$FunKitDirectory", "=", 
   RowBox[{
    RowBox[{"SelectFirst", "[", 
     RowBox[{
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$UserBaseDirectory", ",", "\"\<Applications\>\"", ",", 
             "\"\<FunKit\>\""}], "}"}], "]"}], ",", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$BaseDirectory", ",", "\"\<Applications\>\"", ",", 
             "\"\<FunKit\>\""}], "}"}], "]"}], ",", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$InstallationDirectory", ",", "\"\<AddOns\>\"", ",", 
             "\"\<Applications\>\"", ",", "\"\<FunKit\>\""}], "}"}], "]"}], 
          ",", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$InstallationDirectory", ",", "\"\<AddOns\>\"", ",", 
             "\"\<Packages\>\"", ",", "\"\<FunKit\>\""}], "}"}], "]"}], ",", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$InstallationDirectory", ",", "\"\<AddOns\>\"", ",", 
             "\"\<ExtraPackages\>\"", ",", "\"\<FunKit\>\""}], "}"}], "]"}]}],
          "}"}], ",", 
        RowBox[{"Select", "[", 
         RowBox[{"$Path", ",", 
          RowBox[{
           RowBox[{"StringContainsQ", "[", 
            RowBox[{"#", ",", "\"\<FunKit\>\""}], "]"}], "&"}]}], "]"}]}], 
       "]"}], ",", 
      RowBox[{
       RowBox[{"DirectoryQ", "[", "#", "]"}], "&"}]}], "]"}], "<>", 
    "\"\</\>\""}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951226996707944*^9, 3.951227003475544*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"66c68510-764b-433f-bf11-01c5d6a5e9c2"]
}, Closed]],

Cell[CellGroupData[{

Cell["FDOp, FTerm and FEq definitions ", "Section",
 CellChangeTimes->{{3.9509597231601686`*^9, 3.950959732923991*^9}, {
  3.951108540108012*^9, 
  3.9511085438759727`*^9}},ExpressionUUID->"e03db448-7a6c-4e73-9ddc-\
3b1976a84a81"],

Cell[CellGroupData[{

Cell["Basic definitions", "Subsection",
 CellChangeTimes->{{3.950959776616251*^9, 3.950959779850823*^9}, 
   3.9509598524176817`*^9},ExpressionUUID->"35360acd-1ab3-48dc-b387-\
960ef784c1b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"type", "::", "error"}], "=", 
   "\"\<The expression given is neither an FEq nor an FTerm.\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.95164957384892*^9, 3.951649609076728*^9}},
 CellLabel->
  "In[2019]:=",ExpressionUUID->"3f16da75-51f5-4748-90ba-22ae1854030a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "FTerm", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "FTerm", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FTimesPowerPatternaToFTermb", "=", 
   TagBox[
    StyleBox[
     RowBox[{"Power", "[", 
      RowBox[{"a", ",", 
       RowBox[{"FTerm", "[", "b_", "]"}]}], "]"}],
     ShowSpecialCharacters->False,
     ShowStringCharacters->True,
     NumberMarks->True],
    FullForm]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTimesPowerPatternFTermbtoa", "=", 
    TagBox[
     StyleBox[
      RowBox[{"Power", "[", 
       RowBox[{"a", ",", 
        RowBox[{"FTerm", "[", "b_", "]"}]}], "]"}],
      ShowSpecialCharacters->False,
      ShowStringCharacters->True,
      NumberMarks->True],
     FullForm]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "::", "TimesError"}], "=", 
   "\"\<An FTerm cannot be multiplied using Times[__]. To multiply FTerms, \
use term1**term2, also with scalars, a**term. Error in expression\n`1`\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FTerm", "::", "FTermPowerError"}], "=", 
    "\"\<An FTerm cannot be taken to a power of an FTerm.\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Multiplication", " ", "of", " ", "FTerms"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"FTerm", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "a__", "]"}], ",", 
    RowBox[{"FTerm", "[", "b__", "]"}]}], "]"}], ":=", 
  RowBox[{"FTerm", "[", 
   RowBox[{"a", ",", "b"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"FTerm", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "]"}], ",", 
    RowBox[{"FTerm", "[", "b__", "]"}]}], "]"}], ":=", 
  RowBox[{"FTerm", "[", "b", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"FTerm", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "b__", "]"}], ",", 
    RowBox[{"FTerm", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"FTerm", "[", "b", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FTerm", "/:", 
   RowBox[{
    RowBox[{"NonCommutativeMultiply", "[", 
     RowBox[{"a_", ",", 
      RowBox[{"FTerm", "[", "b__", "]"}]}], "]"}], "/;", 
    RowBox[{"NumericQ", "[", "a", "]"}]}], ":=", 
   RowBox[{"FTerm", "[", 
    RowBox[{"a", ",", "b"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FTerm", "[", 
   RowBox[{"pre___", ",", 
    RowBox[{"NonCommutativeMultiply", "[", "in___", "]"}], ",", "post___"}], 
   "]"}], ":=", 
  RowBox[{"FTerm", "[", 
   RowBox[{"pre", ",", "in", ",", "post"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FTerm", "[", 
   RowBox[{"pre___", ",", 
    RowBox[{"Times", "[", 
     RowBox[{"inpre__", ",", 
      RowBox[{"NonCommutativeMultiply", "[", "in___", "]"}], ",", 
      "inpost__"}], "]"}], ",", "post___"}], "]"}], ":=", 
  RowBox[{"FTerm", "[", 
   RowBox[{"pre", ",", 
    RowBox[{"inpre", "*", "inpost"}], ",", "in", ",", "post"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{"1", ",", "post___"}], "]"}], ":=", 
   RowBox[{"FTerm", "[", "post", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{"first_", ",", "pre___", ",", 
     RowBox[{"Times", "[", 
      RowBox[{"a_", ",", "other2_"}], "]"}], ",", "post___"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"NumericQ", "[", "first", "]"}], "&&", 
    RowBox[{"NumericQ", "[", "a", "]"}], "&&", 
    RowBox[{
     RowBox[{"Head", "[", "first", "]"}], "=!=", "FDOp"}]}]}], ":=", 
  RowBox[{"FTerm", "[", 
   RowBox[{
    RowBox[{"first", "*", "a"}], ",", "pre", ",", "other2", ",", "post"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{"first_", ",", "pre___", ",", 
     RowBox[{"Times", "[", 
      RowBox[{"a_", ",", "other2_"}], "]"}], ",", "post___"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Not", "[", 
     RowBox[{"NumericQ", "[", "first", "]"}], "]"}], "&&", 
    RowBox[{"NumericQ", "[", "a", "]"}], "&&", 
    RowBox[{
     RowBox[{"Head", "[", "first", "]"}], "=!=", "FDOp"}]}]}], ":=", 
  RowBox[{"FTerm", "[", 
   RowBox[{"a", ",", "first", ",", "pre", ",", "other2", ",", "post"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{"first_", ",", "pre___", ",", "a_", ",", "post___"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"NumericQ", "[", "first", "]"}], "&&", 
    RowBox[{"NumericQ", "[", "a", "]"}]}]}], ":=", 
  RowBox[{"FTerm", "[", 
   RowBox[{
    RowBox[{"first", "*", "a"}], ",", "pre", ",", "post"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FTerm", "[", 
     RowBox[{"first_", ",", "pre___", ",", "a_", ",", "post___"}], "]"}], "/;", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{"NumericQ", "[", "first", "]"}], "]"}], "&&", 
     RowBox[{"NumericQ", "[", "a", "]"}]}]}], ":=", 
   RowBox[{"FTerm", "[", 
    RowBox[{"a", ",", "first", ",", "pre", ",", "post"}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Pre", "-", 
    RowBox[{"reduction", " ", "of", " ", "zero", " ", "FTerms"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{"___", ",", "0", ",", "___"}], "]"}], ":=", 
   RowBox[{"FTerm", "[", "0", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Reduction", " ", "of", " ", "immediately", " ", "nested", " ", "FTerms"}],
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{"pre___", ",", 
     RowBox[{"FTerm", "[", "in__", "]"}], ",", "post___"}], "]"}], ":=", 
   RowBox[{"FTerm", "[", 
    RowBox[{"pre", ",", "in", ",", "post"}], "]"}]}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "/:", 
    RowBox[{"Power", "[", 
     RowBox[{
      RowBox[{"FTerm", "[", "a___", "]"}], ",", 
      RowBox[{"FTerm", "[", "b___", "]"}]}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"FTerm", "::", "FTermPowerError"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FTerm", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951108570921122*^9, 3.9511086067410803`*^9}, {
   3.9511206459063587`*^9, 3.951120660081051*^9}, {3.951195864716386*^9, 
   3.951195886154029*^9}, {3.951196961507043*^9, 3.951197010834494*^9}, {
   3.951197041118517*^9, 3.9511971060976057`*^9}, {3.951197479182197*^9, 
   3.951197519394229*^9}, {3.951219979402542*^9, 3.951219993857942*^9}, {
   3.951220337986998*^9, 3.9512203916636333`*^9}, {3.951283991688099*^9, 
   3.951284016560318*^9}, {3.951571021780089*^9, 3.951571143048658*^9}, {
   3.9515711780006027`*^9, 3.951571192024541*^9}, {3.951571279210537*^9, 
   3.951571416231798*^9}, {3.951571449224962*^9, 3.951571472133533*^9}, 
   3.951571523976795*^9, 3.951571593594584*^9, 3.951631240825395*^9, {
   3.951631348126128*^9, 3.951631395598153*^9}, {3.951631431509983*^9, 
   3.951631590061954*^9}, {3.9516317014739428`*^9, 3.951631719844562*^9}, {
   3.951632092468995*^9, 3.951632204046055*^9}, {3.951653371490522*^9, 
   3.95165338938937*^9}, {3.951656052666871*^9, 3.9516561059991426`*^9}, 
   3.9516561467264338`*^9, {3.951656273678815*^9, 3.951656293710493*^9}, {
   3.951656356950194*^9, 3.951656419995286*^9}},
 CellLabel->
  "In[2020]:=",ExpressionUUID->"9610d6bd-1c3a-4143-88dc-cb4244676cae"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{
  3.951656144805879*^9, {3.951656279373445*^9, 3.951656281613195*^9}, {
   3.9516563975619497`*^9, 3.951656412682748*^9}},
 CellLabel->
  "In[2041]:=",ExpressionUUID->"19c9f74f-289c-4a22-b75e-e5109d618ef0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "FEq", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "FEq", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FEq", "::", "TimesError"}], "=", 
    "\"\<A FEq cannot be multiplied using Times[__]. To multiply FEqs, use \
eq1**eq2, also with scalars, a**eq. Error in expression\n`1`\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Removal", " ", "of", " ", "zero", " ", "FTerms"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"pre___", ",", 
     RowBox[{"FTerm", "[", 
      RowBox[{"___", ",", "0", ",", "___"}], "]"}], ",", "post___"}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"pre", ",", "post"}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Sum", " ", "splitting", " ", "of", " ", "FTerms"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"preEq___", ",", 
     RowBox[{"FTerm", "[", 
      RowBox[{"preTerm___", ",", 
       RowBox[{"Plus", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], ",", "postTerm___"}], "]"}], ",", 
     "postEq___"}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"preEq", ",", 
     RowBox[{"FTerm", "[", 
      RowBox[{"preTerm", ",", "a", ",", "postTerm"}], "]"}], ",", 
     RowBox[{"FTerm", "[", 
      RowBox[{"preTerm", ",", 
       RowBox[{"Plus", "[", "b", "]"}], ",", "postTerm"}], "]"}], ",", 
     "postEq"}], "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Sums", " ", "of", " ", "FTerms"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "[", 
   RowBox[{"preEq___", ",", 
    RowBox[{"Plus", "[", 
     RowBox[{
      RowBox[{"FTerm", "[", "a__", "]"}], ",", 
      RowBox[{"FTerm", "[", "b__", "]"}], ",", "c___"}], "]"}], ",", 
    "postEq___"}], "]"}], ":=", 
  RowBox[{"FEq", "[", 
   RowBox[{"preEq", ",", 
    RowBox[{"FTerm", "[", "a", "]"}], ",", 
    RowBox[{"Plus", "[", 
     RowBox[{
      RowBox[{"FTerm", "[", "b", "]"}], ",", "c"}], "]"}], ",", "postEq"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "/:", 
   RowBox[{"Plus", "[", 
    RowBox[{
     RowBox[{"FEq", "[", "a___", "]"}], ",", 
     RowBox[{"FTerm", "[", "b__", "]"}]}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"a", ",", 
     RowBox[{"FTerm", "[", "b", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Sums", " ", "of", " ", "FEqs"}], "*)"}]}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{"FEq", "/:", 
   RowBox[{"Plus", "[", 
    RowBox[{"preEq___", ",", 
     RowBox[{"FEq", "[", "terms1___", "]"}], ",", "midEq___", ",", 
     RowBox[{"FEq", "[", "terms2___", "]"}], ",", "postEq___"}], "]"}], ":=", 
   
   RowBox[{"Plus", "[", 
    RowBox[{"preEq", ",", "midEq", ",", "postEq", ",", 
     RowBox[{"FEq", "[", 
      RowBox[{"terms1", ",", "terms2"}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Multiplication", " ", "of", " ", "FEqs"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"Times", "[", 
   RowBox[{"pre___", ",", 
    RowBox[{"FEq", "[", "a__", "]"}], ",", "post___"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"FEq", "::", "TimesError"}], ",", 
      RowBox[{"{", 
       RowBox[{"pre", ",", 
        RowBox[{"FEq", "[", "a", "]"}], ",", "post"}], "}"}]}], "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"prefeq__", ",", 
     RowBox[{"Times", "[", 
      RowBox[{"pre___", ",", 
       RowBox[{"FTerm", "[", "a__", "]"}], ",", "post___"}], "]"}], ",", 
     "postfeq__"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"FTerm", "::", "TimesError"}], ",", 
       RowBox[{"{", 
        RowBox[{"pre", ",", 
         RowBox[{"FTerm", "[", "a", "]"}], ",", "post"}], "}"}]}], "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "b__", "]"}], ",", 
    RowBox[{"FEq", "[", "c__", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"FTerm", "[", "b", "]"}], "**", "#"}], "&"}], ",", 
     RowBox[{"FEq", "[", "c", "]"}]}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FEq", "[", "a__", "]"}], ",", 
    RowBox[{"FEq", "[", "b__", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "@@", 
   RowBox[{"(", 
    RowBox[{"Flatten", "@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"FEq", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "a", "}"}], "[", 
          RowBox[{"[", "i", "]"}], "]"}], "**", 
         RowBox[{
          RowBox[{"{", "b", "}"}], "[", 
          RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"{", "a", "}"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "1", ",", 
         RowBox[{"Length", "[", 
          RowBox[{"{", "b", "}"}], "]"}]}], "}"}]}], "]"}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "b___", "]"}], ",", 
    RowBox[{"FEq", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "[", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "]"}], ",", 
    RowBox[{"FEq", "[", "b___", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "[", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"FEq", "/:", 
  RowBox[{"NonCommutativeMultiply", "[", 
   RowBox[{
    RowBox[{"FTerm", "[", "0", "]"}], ",", 
    RowBox[{"FEq", "[", "b___", "]"}]}], "]"}], ":=", 
  RowBox[{"FEq", "[", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "/:", 
   RowBox[{"FTerm", "[", 
    RowBox[{"FEq", "[", "a__", "]"}], "]"}], ":=", 
   RowBox[{"FEq", "[", "a", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FEq", "/:", 
   RowBox[{"FTerm", "[", 
    RowBox[{
     RowBox[{"FEq", "[", "a__", "]"}], ",", 
     RowBox[{"FEq", "[", "b__", "]"}]}], "]"}], ":=", 
   RowBox[{"FEq", "@@", 
    RowBox[{"(", 
     RowBox[{"Flatten", "@", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"FEq", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", "a", "}"}], "[", 
           RowBox[{"[", "i", "]"}], "]"}], "**", 
          RowBox[{
           RowBox[{"{", "b", "}"}], "[", 
           RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"{", "a", "}"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"{", "b", "}"}], "]"}]}], "}"}]}], "]"}]}], ")"}]}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Reduction", " ", "of", " ", "immediately", " ", "nested", " ", "FEqs"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"pre___", ",", 
     RowBox[{"FEq", "[", "in___", "]"}], ",", "post___"}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"pre", ",", "in", ",", "post"}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Expand", " ", "nested", " ", "FEq", " ", "in", " ", "sub"}], "-",
     "terms"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "[", 
    RowBox[{"pre___", ",", 
     RowBox[{"FTerm", "[", 
      RowBox[{"prein___", ",", 
       RowBox[{"FEq", "[", "in___", "]"}], ",", "postin___"}], "]"}], ",", 
     "post___"}], "]"}], ":=", 
   RowBox[{"FEq", "[", 
    RowBox[{"pre", ",", 
     RowBox[{"NonCommutativeMultiply", "[", 
      RowBox[{"prein", ",", 
       RowBox[{"Plus", "[", "in", "]"}], ",", "postin"}], "]"}], ",", 
     "post"}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FEq", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509578761709423`*^9, 3.950957973036676*^9}, {
   3.9509590689899607`*^9, 3.9509591157318487`*^9}, {3.9509591472919817`*^9, 
   3.950959252858809*^9}, {3.9509592907067623`*^9, 3.9509592957039757`*^9}, {
   3.950959501450481*^9, 3.95095951130514*^9}, {3.950959686410345*^9, 
   3.950959714174095*^9}, 3.950959773470724*^9, {3.951034884384832*^9, 
   3.951034890869*^9}, {3.951035198689001*^9, 3.951035207408928*^9}, {
   3.951035268197209*^9, 3.951035301400906*^9}, {3.951035981870775*^9, 
   3.9510360006370783`*^9}, {3.951036246658142*^9, 3.95103626460588*^9}, {
   3.95103649033849*^9, 3.951036598302443*^9}, {3.951036633594223*^9, 
   3.951036785006905*^9}, {3.9510368169549932`*^9, 3.951036830730741*^9}, {
   3.951037206113153*^9, 3.95103734490982*^9}, {3.951037380987048*^9, 
   3.951037383677424*^9}, {3.951037439125901*^9, 3.951037496838653*^9}, {
   3.95103754050202*^9, 3.9510375690137587`*^9}, {3.9510376206837482`*^9, 
   3.951037625335888*^9}, {3.95103780882169*^9, 3.951037937002328*^9}, {
   3.951045322817977*^9, 3.95104532318824*^9}, {3.9510453867665377`*^9, 
   3.9510456103940287`*^9}, {3.95104564974853*^9, 3.951045666800379*^9}, {
   3.9510457134141083`*^9, 3.951045873397193*^9}, {3.951045915058331*^9, 
   3.9510460013306837`*^9}, {3.95104607626162*^9, 3.951046274552978*^9}, {
   3.951046466112495*^9, 3.951046728989846*^9}, {3.951046767530278*^9, 
   3.951046934066455*^9}, {3.9511072891096373`*^9, 3.951107324549317*^9}, {
   3.951107379842474*^9, 3.951107392161078*^9}, {3.951107584300604*^9, 
   3.95110759264114*^9}, {3.951107680371338*^9, 3.951107740154788*^9}, {
   3.951107781351058*^9, 3.9511077883787947`*^9}, {3.951107886223928*^9, 
   3.951107886588614*^9}, {3.951107926025846*^9, 3.951107950114067*^9}, {
   3.951108556054607*^9, 3.951108598328257*^9}, {3.9511196059065237`*^9, 
   3.951119683559124*^9}, {3.9511198861915407`*^9, 3.951119888700102*^9}, {
   3.951195813278051*^9, 3.95119584540624*^9}, {3.9511975255885773`*^9, 
   3.9511975266179333`*^9}, {3.95121043539817*^9, 3.951210463363813*^9}, 
   3.951285698816757*^9, 3.9512857380318813`*^9, {3.951287820920479*^9, 
   3.951287878783401*^9}, {3.9512879154103193`*^9, 3.951287918549728*^9}, {
   3.9516532485413647`*^9, 3.951653248737965*^9}, {3.95165327911305*^9, 
   3.951653350604937*^9}, {3.951653397693386*^9, 3.9516534251929893`*^9}, 
   3.951656422798077*^9},
 CellLabel->
  "In[2042]:=",ExpressionUUID->"d8c7ad92-008a-409f-951b-580a3ca827cd"]
}, Closed]],

Cell[CellGroupData[{

Cell["Checks and assertions", "Subsection",
 CellChangeTimes->{{3.932178009618313*^9, 3.932178022055203*^9}, {
  3.950801118933737*^9, 
  3.950801121691584*^9}},ExpressionUUID->"23b7e69d-dcbb-4fb0-a77e-\
b8638a031ad4"],

Cell[CellGroupData[{

Cell["FTerm and FEq", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, {
  3.950964433513967*^9, 
  3.9509644360831413`*^9}},ExpressionUUID->"d438b387-4f31-41ce-a117-\
795b628d69b9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FTermQ", "[", "expr_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Head", "[", "expr", "]"}], "===", "FTerm"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "::", "notFTerm"}], "=", 
   "\"\<The term `1` is not an FTerm.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AssertFTerm", "[", "expr_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"Not", "@", 
       RowBox[{"FTermQ", "[", "expr", "]"}]}], ",", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"FTerm", "::", "notFTerm"}], ",", "expr"}], "]"}], ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEqQ", "[", "expr_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Head", "[", "expr", "]"}], "===", "FEq"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FEq", "::", "notFEq"}], "=", 
   "\"\<The term `1` is not an FEq.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AssertFEq", "[", "expr_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"FEqQ", "[", "expr", "]"}]}], ",", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"FEq", "::", "notFEq"}], ",", "expr"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950959791226129*^9, 3.950959819925836*^9}, {
  3.950959877202113*^9, 3.950959965968995*^9}},
 CellLabel->
  "In[2062]:=",ExpressionUUID->"63fbe29b-4af8-405d-80e3-5cbc9aa8d1d5"]
}, Closed]],

Cell[CellGroupData[{

Cell["FMinus", "Subsubsection",
 CellChangeTimes->{{3.951536606989263*^9, 
  3.951536607857354*^9}},ExpressionUUID->"5aaf8220-7538-47a5-abd1-\
41964a7a0f89"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "FMinus", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "FMinus", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Grassmann", " ", "minus", " ", "signs", " ", "do", " ", "not", " ", 
    "care", " ", "about", " ", "index", " ", 
    RowBox[{"positioning", ".", " ", "We"}], " ", "force", " ", "them", " ", 
    "always", " ", "up"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FMinus", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a_", ",", "b_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Times", "[", 
       RowBox[{
        RowBox[{"-", "1"}], ",", "ia_"}], "]"}], ",", "ib_"}], "}"}]}], "]"}],
   ":=", 
  RowBox[{"FMinus", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", "b"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ia", ",", "ib"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FMinus", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a_", ",", "b_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ia_", ",", 
       RowBox[{"Times", "[", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "ib_"}], "]"}]}], "}"}]}], "]"}], ":=", 
   RowBox[{"FMinus", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ia", ",", "ib"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Powers", " ", "are", " ", "simple"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"FMinus", "/:", 
  RowBox[{
   RowBox[{"Power", "[", 
    RowBox[{
     RowBox[{"FMinus", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"a_", ",", "b_"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"ia_", ",", "ib_"}], "}"}]}], "]"}], ",", "n_Integer"}], 
    "]"}], "/;", 
   RowBox[{"EvenQ", "[", "n", "]"}]}], ":=", "1"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FMinus", "/:", 
   RowBox[{
    RowBox[{"Power", "[", 
     RowBox[{
      RowBox[{"FMinus", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"ia_", ",", "ib_"}], "}"}]}], "]"}], ",", "n_Integer"}], 
     "]"}], "/;", 
    RowBox[{"OddQ", "[", "n", "]"}]}], ":=", 
   RowBox[{"FMinus", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"ia", ",", "ib"}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FMinus", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951536611653261*^9, 3.9515366974936333`*^9}, 
   3.9515368878019114`*^9, {3.951536921249876*^9, 3.9515369735174932`*^9}, {
   3.9515396697259274`*^9, 3.951539675921421*^9}, {3.951556097757165*^9, 
   3.9515562592624826`*^9}},
 CellLabel->
  "In[2068]:=",ExpressionUUID->"2c28ad8a-8cd0-4b1c-b0b8-25b7da74a5a5"]
}, Closed]],

Cell[CellGroupData[{

Cell["Field Space", "Subsubsection",
 CellChangeTimes->{{3.950801271735565*^9, 3.95080128037481*^9}, {
  3.9508933727376747`*^9, 
  3.950893373722165*^9}},ExpressionUUID->"f52392a8-ad40-44db-871d-\
0651868db7ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Check", " ", "if", " ", "a", " ", "given", " ", "field", " ", 
     "definition", " ", "is", " ", 
     RowBox[{"valid", ".", " ", "Can"}], " ", "be", " ", "either", " ", "its",
      " ", "own", " ", "anti"}], "-", 
    RowBox[{"field", " ", "or", " ", "a", " ", "pair", " ", 
     RowBox[{"{", 
      RowBox[{"af", ",", "f"}], "}"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FieldDefQ", "[", "expr_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "expr", "]"}], "===", "List"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "expr", "]"}], "=!=", "2"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<A field definition must be either of form f[x...] or \
{af[x...],f[x...]}. \\\"\>\"", ",", "expr", ",", 
                "\"\<\\\" does not fit.\>\""}], "]"}], ";", 
              RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{"expr", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "===", 
              RowBox[{"Head", "[", 
               RowBox[{"expr", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<A field definition {af[x...],f[x...]} must have different \
field names af and f. \\\"\>\"", ",", "expr", ",", 
                "\"\<\\\" does not fit.\>\""}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Not", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"List", "@@", 
                 RowBox[{"(", 
                  RowBox[{"expr", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "===", 
                RowBox[{"List", "@@", 
                 RowBox[{"(", 
                  RowBox[{"expr", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ")"}]}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<A field definition {af[x...],f[x...]} must have identical \
indices. \\\"\>\"", ",", "expr", ",", "\"\<\\\" does not fit.\>\""}], "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Not", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MatchQ", "[", 
                   RowBox[{
                    RowBox[{"expr", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"_Symbol", "[", 
                    RowBox[{"_", ",", 
                    RowBox[{"{", "__Symbol", "}"}]}], "]"}]}], "]"}], "||", 
                  RowBox[{"MatchQ", "[", 
                   RowBox[{
                    RowBox[{"expr", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"_Symbol", "[", "_", "]"}]}], "]"}]}], ")"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{
                 "\"\<A field definition f[x...] must have indices f[p] or \
f[p,{a,b,...}]. \\\"\>\"", ",", 
                  RowBox[{"expr", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  "\"\<\\\" does not fit.\>\""}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "True", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"_Symbol", "[", 
                RowBox[{"_", ",", 
                 RowBox[{"{", "__Symbol", "}"}]}], "]"}]}], "]"}], "||", 
             RowBox[{"MatchQ", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"_Symbol", "[", "_", "]"}]}], "]"}]}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<A field definition f[x...] must have indices f[p] or \
f[p,{a,b,...}]. \\\"\>\"", ",", "expr", ",", "\"\<\\\" does not fit.\>\""}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FieldDef", "::", "invalidFieldDefinition"}], "=", 
     "\"\<The given field definition `1` is not valid.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssertFieldDef", "[", "expr_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"FieldDefQ", "[", "expr", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FieldDefinition", "::", "invalidFieldDefinition"}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509723959533377`*^9, 3.950972498533544*^9}, {
  3.9509725391754503`*^9, 3.950972839103818*^9}, {3.95097289590053*^9, 
  3.950973043727556*^9}, {3.9509730775238113`*^9, 3.9509730807717524`*^9}, {
  3.950973155496664*^9, 3.950973196313613*^9}, {3.950973268996133*^9, 
  3.950973292848659*^9}, {3.950973323914188*^9, 3.950973407746553*^9}, {
  3.9509734394970713`*^9, 3.950973519577339*^9}, {3.950973729052182*^9, 
  3.9509737667166567`*^9}, {3.950976938011018*^9, 3.950976940198797*^9}},
 CellLabel->
  "In[2075]:=",ExpressionUUID->"d2be4365-2a9f-4170-90b1-81e044dec426"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Check", " ", "if", " ", "a", " ", "given", " ", "field", " ", "space", 
    " ", "definition", " ", "is", " ", "valid"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FieldSpaceDefQ", "[", "fieldSpace_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "fieldSpace", "]"}], "=!=", "Association"}], 
          ",", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<An FSetup must be an association\>\"", "]"}], 
           ";", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Keys", "[", "fieldSpace", "]"}], "===", 
             RowBox[{"{", 
              RowBox[{"\"\<cField\>\"", ",", "\"\<Grassmann\>\""}], "}"}]}], 
            ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<fields must contain the two keys \
{\\\"cField\\\",\\\"Grassmann\\\"}!\>\"", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"ListQ", "[", 
            RowBox[{"fieldSpace", "[", "\"\<cField\>\"", "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<fields[\\\"cField\\\"] must be a list!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{"And", "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"FieldDefQ", ",", 
               RowBox[{"fieldSpace", "[", "\"\<cField\>\"", "]"}]}], "]"}]}], 
            ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<fields[\\\"cField\\\"] must contain valid fields!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"ListQ", "[", 
            RowBox[{"fieldSpace", "[", "\"\<Grassmann\>\"", "]"}], "]"}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<fields[\\\"Grassmann\\\"] must be a list!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{"And", "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"FieldDefQ", ",", 
               RowBox[{"fieldSpace", "[", "\"\<Grassmann\>\"", "]"}]}], 
              "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<fields[\\\"Grassmann\\\"] must contain valid fields!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FieldSpaceDefinition", "::", "invalidFieldDefinition"}], "=", 
     "\"\<The given field space definition is invalid.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssertFieldSpaceDef", "[", "fields_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"FieldSpaceDefQ", "[", "fields", "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FieldSpaceDefinition", "::", "invalidFieldDefinition"}], 
         "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950785803281868*^9, 3.950785830855114*^9}, {
   3.950786297997837*^9, 3.9507864029709253`*^9}, {3.950787129958323*^9, 
   3.9507871301602573`*^9}, {3.950795998774166*^9, 3.950796005485301*^9}, {
   3.9507965324786587`*^9, 3.950796562931445*^9}, {3.950796680245487*^9, 
   3.950796684703451*^9}, 3.950801142187722*^9, {3.9508637092253017`*^9, 
   3.950863710048918*^9}, {3.9508933587966433`*^9, 3.950893362683991*^9}, {
   3.950964560883992*^9, 3.9509647260060463`*^9}, 3.9509709919521027`*^9, {
   3.95097119902899*^9, 3.950971269684161*^9}, {3.950972406057185*^9, 
   3.950972419055738*^9}, {3.9509729891057043`*^9, 3.9509729901532373`*^9}, {
   3.950973052932276*^9, 3.950973069072235*^9}, {3.950973542193096*^9, 
   3.9509735933051243`*^9}, {3.9509736291278887`*^9, 
   3.9509737236713676`*^9}, {3.950973781220873*^9, 3.950973802678894*^9}, {
   3.950973984287372*^9, 3.950974058340818*^9}},
 CellLabel->
  "In[2078]:=",ExpressionUUID->"ffdc8015-4beb-4a8a-9712-899076a5bcad"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.9509737011024*^9},
 CellLabel->
  "In[2081]:=",ExpressionUUID->"e6fda6fb-9bcb-45a5-b801-7e006569f014"]
}, Closed]],

Cell[CellGroupData[{

Cell["FSetup", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, 
   3.950964437586562*^9, 3.9509736149796743`*^9, 
   3.9515759690172*^9},ExpressionUUID->"432ab124-4161-47f8-a56b-8db469a3db21"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FSetup", "::", "notFSetup"}], "=", 
    "\"\<The given setup is not valid!\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FSetupQ", "[", "setup_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Head", "[", "setup", "]"}], "===", "Association"}], 
           ")"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<A valid setup must be an Association!\>\"", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"Keys", "[", "setup", "]"}], ",", "\"\<FieldSpace\>\""}], 
           "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<A valid setup must have the key \\\"FieldSpace\\\"!\>\"", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"FieldSpaceDefQ", "[", 
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AssertFSetup", "[", "setup_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Head", "[", "setup", "]"}], "===", "Association"}], 
          ")"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "Print", "[", "\"\<A valid setup must be an Association!\>\"", "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"Message", "[", 
          RowBox[{"FSetup", "::", "notFSetup"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Keys", "[", "setup", "]"}], ",", "\"\<FieldSpace\>\""}], 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<A valid setup must have the key \\\"FieldSpace\\\"!\>\"", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Message", "[", 
          RowBox[{"FSetup", "::", "notFSetup"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"AssertFieldSpaceDef", "[", 
       RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950864013876114*^9, 3.950864178121345*^9}, {
  3.950866123517272*^9, 3.9508661552146883`*^9}, {3.95096155740795*^9, 
  3.950961589920692*^9}, {3.9509635332623377`*^9, 3.95096359322543*^9}, {
  3.9509709220279417`*^9, 3.950970986439794*^9}, {3.9509710317799788`*^9, 
  3.950971170043336*^9}, {3.950973871588525*^9, 3.950973901835678*^9}, {
  3.9509739679684*^9, 3.950973970944644*^9}},
 CellLabel->
  "In[2082]:=",ExpressionUUID->"11470f5d-e2db-4aaa-9b7e-0a8c11da0687"]
}, Closed]],

Cell[CellGroupData[{

Cell["Existence of a field", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, 
   3.950964437586562*^9, 3.9509736149796743`*^9, {3.951109567275919*^9, 
   3.951109569556551*^9}},ExpressionUUID->"73595dfd-e53e-4d4e-a700-\
40ff68a78e58"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Check", " ", "if", " ", "a", " ", "given", " ", "field", " ", 
     "definition", " ", "is", " ", 
     RowBox[{"valid", ".", " ", "Can"}], " ", "be", " ", "either", " ", "its",
      " ", "own", " ", "anti"}], "-", 
    RowBox[{"field", " ", "or", " ", "a", " ", "pair", " ", 
     RowBox[{"{", 
      RowBox[{"af", ",", "f"}], "}"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FieldQ", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"_Symbol", "[", 
                RowBox[{"_", ",", 
                 RowBox[{"{", "__Symbol", "}"}]}], "]"}]}], "]"}], "||", 
             RowBox[{"MatchQ", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"_Symbol", "[", "_", "]"}]}], "]"}]}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<A field f[x...] must have indices f[p] or f[p,{a,b,...}]. \\\
\"\>\"", ",", "expr", ",", "\"\<\\\" does not fit.\>\""}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Head", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "//", 
                  "Values"}], "//", "Flatten"}]}], "]"}], ",", 
              RowBox[{"Head", "[", "expr", "]"}]}], "]"}], ")"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<The field \\\"\>\"", ",", "expr", ",", 
             "\"\<\\\" is not contained in the field space.\>\""}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Field", "::", "invalidField"}], "=", 
     "\"\<The given field `1` does not exist.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssertField", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"FieldQ", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FieldDefinition", "::", "invalidField"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509723959533377`*^9, 3.950972498533544*^9}, {
  3.9509725391754503`*^9, 3.950972839103818*^9}, {3.95097289590053*^9, 
  3.950973043727556*^9}, {3.9509730775238113`*^9, 3.9509730807717524`*^9}, {
  3.950973155496664*^9, 3.950973196313613*^9}, {3.950973268996133*^9, 
  3.950973292848659*^9}, {3.950973323914188*^9, 3.950973407746553*^9}, {
  3.9509734394970713`*^9, 3.950973519577339*^9}, {3.950973729052182*^9, 
  3.9509737667166567`*^9}, {3.9509741552332573`*^9, 3.9509741985720987`*^9}, {
  3.9509742355449142`*^9, 3.9509742565395184`*^9}, {3.9509766019032183`*^9, 
  3.9509766041301928`*^9}, {3.9509766344861717`*^9, 3.950976637210259*^9}, {
  3.9509766769979153`*^9, 3.950976779031054*^9}, {3.9509769256787357`*^9, 
  3.9509769282539797`*^9}, {3.9510498517763968`*^9, 3.951049854349081*^9}},
 CellLabel->
  "In[2085]:=",ExpressionUUID->"8025941a-3caa-4a8b-a6f7-d19c65a09782"]
}, Closed]],

Cell[CellGroupData[{

Cell["Derivative List", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, {
  3.950893338644219*^9, 
  3.950893340478217*^9}},ExpressionUUID->"4586692a-ee51-46b9-b58e-\
43bcdb604423"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Check", " ", "a", " ", "derivative", " ", "list", " ", "for", " ", 
    "correct", " ", 
    RowBox[{"formatting", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DerivativeListQ", "[", 
      RowBox[{"setup_", ",", "derivativeList_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Head", "[", "derivativeList", "]"}], "===", "List"}], 
            ")"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<A valid derivativeList must be an List!\>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"AllTrue", "[", 
            RowBox[{"derivativeList", ",", 
             RowBox[{
              RowBox[{"FieldQ", "[", 
               RowBox[{"setup", ",", "#"}], "]"}], "&"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<A valid derivativeList must be an List of fields \
f_[p_,{___}] of f_[p_] which have been defined in the setup!\>\"", "]"}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DeriveEquation", "::", "invalidDerivativeList"}], "=", 
     "\"\<The given derivativeList `1` is not valid.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"AssertDerivativeList", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"DerivativeListQ", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"DeriveEquation", "::", "invalidDerivativeList"}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950864234236211*^9, 3.9508644603567677`*^9}, {
   3.950864514373273*^9, 3.950864523736723*^9}, {3.950865674724793*^9, 
   3.9508656803898973`*^9}, {3.950866001476939*^9, 3.950866011277586*^9}, {
   3.950866277809552*^9, 3.950866291301694*^9}, 3.9508663653146677`*^9, 
   3.95086639713623*^9, {3.95097396076858*^9, 3.950973963799748*^9}, {
   3.9509740743483953`*^9, 3.95097409846065*^9}, {3.9509767888540382`*^9, 
   3.95097688937116*^9}},
 CellLabel->
  "In[2088]:=",ExpressionUUID->"d04f551f-63ba-4c59-827e-89539a889eb6"]
}, Closed]],

Cell[CellGroupData[{

Cell["FDOp", "Subsubsection",
 CellChangeTimes->{{3.9508642163296537`*^9, 3.950864226113566*^9}, {
  3.950964433513967*^9, 3.9509644360831413`*^9}, {3.951109340007738*^9, 
  3.9511093407521*^9}},ExpressionUUID->"bb6d67ae-94ea-4de9-ad33-f49796906916"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "FDOp", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearAll", "[", "FDOp", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FDOp", "::", "invalid"}], "=", 
   "\"\<`1` is not a valid FDOp.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FDOp", "::", "invalidArguments"}], "=", 
   "\"\<`1` is not a valid FDOp. FDOp takes a single field with an index as \
argument.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FDOp", "::", "arithmetic"}], "=", 
    "\"\<An FDOp cannot be included as anything but a factor in an FTerm. \
Error in \n  `1`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"FDOp", "/:", 
  RowBox[{"Times", "[", 
   RowBox[{"a___", ",", 
    RowBox[{"FDOp", "[", "b___", "]"}], ",", "c___"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"FDOp", "::", "arithmetic"}], ",", 
      RowBox[{"StringTake", "[", 
       RowBox[{
        RowBox[{"ToString", "@", 
         RowBox[{"(", 
          RowBox[{"Hold", "@", 
           RowBox[{"Times", "[", 
            RowBox[{"a", ",", 
             RowBox[{"FDOp", "[", "b", "]"}], ",", "c"}], "]"}]}], ")"}]}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", 
          RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FDOp", "/:", 
   RowBox[{"Plus", "[", 
    RowBox[{"a___", ",", 
     RowBox[{"FDOp", "[", "b___", "]"}], ",", "c___"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"FDOp", "::", "arithmetic"}], ",", 
       RowBox[{"StringTake", "[", 
        RowBox[{
         RowBox[{"ToString", "@", 
          RowBox[{"(", 
           RowBox[{"Hold", "@", 
            RowBox[{"Plus", "[", 
             RowBox[{"a", ",", 
              RowBox[{"FDOp", "[", "b", "]"}], ",", "c"}], "]"}]}], ")"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", 
           RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FDOp", "[", 
    RowBox[{"a_", ",", "b__"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"FDOp", "::", "invalidArguments"}], ",", 
       RowBox[{"StringTake", "[", 
        RowBox[{
         RowBox[{"ToString", "@", 
          RowBox[{"(", 
           RowBox[{"Hold", "@", 
            RowBox[{"FDOp", "[", 
             RowBox[{"a", ",", "b"}], "]"}]}], ")"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", 
           RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FDOpQ", "[", 
    RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Head", "[", "expr", "]"}], "===", "FDOp"}], ")"}], "&&", 
      RowBox[{"MatchQ", "[", 
       RowBox[{"expr", ",", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"_", "[", 
           RowBox[{"_", ",", 
            RowBox[{"{", "__", "}"}]}], "]"}], "|", 
          RowBox[{"_", "[", "_", "]"}]}], ")"}]}], "]"}], "&&", 
      RowBox[{"FieldQ", "[", 
       RowBox[{"setup", ",", "#"}], "]"}]}], "&"}], "@@", "expr"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AssertFDOp", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"Not", "@", 
       RowBox[{"FDOpQ", "[", 
        RowBox[{"setup", ",", "expr"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"FDOp", "::", "invalid"}], ",", "expr"}], "]"}], ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FDOp", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950959791226129*^9, 3.950959819925836*^9}, {
   3.950959877202113*^9, 3.950959965968995*^9}, {3.951109344001295*^9, 
   3.9511093512403717`*^9}, {3.951109385069475*^9, 3.951109490384367*^9}, {
   3.951109575180601*^9, 3.951109623509289*^9}, {3.9512836351836367`*^9, 
   3.951283964372046*^9}, {3.951284035067808*^9, 3.951284092700465*^9}, {
   3.951284638235787*^9, 3.951284775688508*^9}, 3.9512848078377867`*^9, {
   3.951284931040797*^9, 3.951284940471984*^9}, {3.951284975621332*^9, 
   3.951285244742639*^9}, {3.951286114829897*^9, 3.9512862662903748`*^9}, 
   3.9512863198820457`*^9, {3.9512863705738792`*^9, 3.951286468490302*^9}, 
   3.9512866511509457`*^9},
 CellLabel->
  "In[2091]:=",ExpressionUUID->"cec32202-2ccb-4a54-a11b-3d74e2fc5239"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Utilities", "Section",
 CellChangeTimes->{{3.932177970725307*^9, 
  3.9321779720559883`*^9}},ExpressionUUID->"bdee160a-1c91-4de1-b52d-\
86eb572207e3"],

Cell[CellGroupData[{

Cell["Getting symbols", "Subsubsection",
 CellChangeTimes->{{3.951227382795168*^9, 
  3.9512273921081133`*^9}},ExpressionUUID->"d002c263-ec1e-44d9-8d95-\
a0c4fe2e8e78"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"exclusions", "[", "a_", "]"}], ":=", 
  RowBox[{"And", "@@", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"a", "=!=", "List"}], ",", 
     RowBox[{"a", "=!=", "Complex"}], ",", 
     RowBox[{"a", "=!=", "Plus"}], ",", 
     RowBox[{"a", "=!=", "Power"}], ",", 
     RowBox[{"a", "=!=", "Times"}]}], "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetAllSymbols", "[", "expr_", "]"}], ":=", 
  RowBox[{"DeleteDuplicates", "@", 
   RowBox[{"Cases", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "expr", "}"}], "//.", 
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{"a_", ",", "b__"}], "]"}], ":>", 
         RowBox[{"{", 
          RowBox[{"a", ",", "b"}], "}"}]}]}], "//.", 
       RowBox[{
        RowBox[{
         RowBox[{"a_Symbol", "[", "b__", "]"}], "/;", 
         RowBox[{"exclusions", "[", "a", "]"}]}], ":>", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}]}]}], "]"}], ",", 
     "\[IndentingNewLine]", "_Symbol", ",", "\[IndentingNewLine]", 
     "Infinity"}], "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9510242717398663`*^9, 3.951024280343438*^9}, 
   3.951024444887616*^9, {3.951229169059124*^9, 3.9512291793424377`*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"f4704157-c7f9-402c-bf7c-77513ac8ecc7"]
}, Closed]],

Cell[CellGroupData[{

Cell["FunctionalD", "Subsection",
 CellChangeTimes->{{3.932178009618313*^9, 3.932178022055203*^9}, {
  3.950801118933737*^9, 
  3.950801154023693*^9}},ExpressionUUID->"5193f3f7-8901-4525-bbbc-\
d3fa4695bea7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FunctionalD", "::", "malformed"}], "=", 
    "\"\<Cannot take a derivative of `1`. Expression is either malformed or \
this is a bug.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearAll", "[", "FunctionalD", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FunctionalD", "[", 
     RowBox[{"expr_", ",", 
      RowBox[{"v", ":", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"f_", "[", "_", "]"}], "|", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"f_", "[", "_", "]"}], ",", "_Integer"}], "}"}]}], ")"}], 
        ".."}]}], ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"Internal`InheritedBlock", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "f", ",", "GammaN", ",", "Propagator", ",", "nonConst", ",", "FTerm", 
        ",", "FEq", ",", "AnyField"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nonConst", "=", 
        RowBox[{"Sort", "@", 
         RowBox[{"{", 
          RowBox[{"f", ",", "GammaN", ",", "Propagator", ",", "Power"}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Unprotect", "[", 
        RowBox[{
        "GammaN", ",", "Propagator", ",", "FTerm", ",", "FEq", ",", 
         "AnyField"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Rule", " ", "for", " ", "normal", " ", "functional", " ", 
         "derivatives"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"f", "[", "x_", "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"\[Gamma]", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", ",", "f"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "y"}], ",", "x"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Rule", " ", "for", " ", "normal", " ", "functional", " ", 
          "derivatives"}], ",", " ", 
         RowBox[{"but", " ", "AnyField"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"AnyField", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"AnyField", "[", "x_", "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"\[Gamma]", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", ",", "AnyField"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "y"}], ",", "x"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Ignore", " ", "fields", " ", "without", " ", 
         RowBox[{"indices", ".", " ", "These"}], " ", "are", " ", "usually", 
         " ", "tags"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{"f", ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", "0"}], 
       ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Delta]", "[", 
           RowBox[{"#", ",", "y"}], "]"}], "&"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Derivative", " ", "rule", " ", "for", " ", "GammaN"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"GammaN", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"GammaN", "[", 
           RowBox[{
            RowBox[{"{", "a__", "}"}], ",", 
            RowBox[{"{", "b__", "}"}]}], "]"}], ",", 
          RowBox[{"f", "[", "if_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"GammaN", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", ",", "a"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "if"}], ",", "b"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Derivative", " ", "rule", " ", "for", " ", "Propagators"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Propagator", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Propagator", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"b_", ",", "a_"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"ib_", ",", "ia_"}], "}"}]}], "]"}], ",", 
          RowBox[{"f", "[", "if_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"Module", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ic", ",", "id", ",", "ie", ",", "ig"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"-", "1"}], ")"}], 
             RowBox[{"FMinus", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"a", ",", "a"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"id", ",", "id"}], "}"}]}], "]"}], 
             RowBox[{"FMinus", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"f", ",", "b"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"if", ",", "ib"}], "}"}]}], "]"}]}], ")"}], "**", 
           "\[IndentingNewLine]", 
           RowBox[{"Propagator", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"b", ",", "AnyField"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ib", ",", "ic"}], "}"}]}], "]"}], "**", 
           "\[IndentingNewLine]", 
           RowBox[{"GammaN", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"AnyField", ",", "f", ",", "AnyField"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "ic"}], ",", 
               RowBox[{"-", "if"}], ",", 
               RowBox[{"-", "id"}]}], "}"}]}], "]"}], "**", 
           "\[IndentingNewLine]", 
           RowBox[{"Propagator", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"AnyField", ",", "a"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"id", ",", "ia"}], "}"}]}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"No", " ", "derivatives", " ", "of", " ", "FTerm"}], ",", 
         " ", "FEq"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"FTerm", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"FTerm", "[", "a___", "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"FunctionalD", "::", "malformed"}], ",", 
            RowBox[{"FTerm", "[", "a", "]"}]}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"FEq", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"FEq", "[", "a___", "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"FunctionalD", "::", "malformed"}], ",", 
            RowBox[{"FEq", "[", "a", "]"}]}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Chain", " ", "rules"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"g_", "[", 
           RowBox[{"FTerm", "[", "a___", "]"}], "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"g", "'"}], "[", 
            RowBox[{"FTerm", "[", "a", "]"}], "]"}], "]"}], "**", 
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"FDOp", "[", 
             RowBox[{"f", "[", "y", "]"}], "]"}], ",", "a"}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"FTerm", "[", "a___", "]"}], ",", "b_"}], "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"FTerm", "[", 
           RowBox[{"b", ",", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"FTerm", "[", "a", "]"}], ",", 
              RowBox[{"b", "-", "1"}]}], "]"}]}], "]"}], "**", 
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"FDOp", "[", 
             RowBox[{"f", "[", "y", "]"}], "]"}], ",", "a"}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_", ",", 
            RowBox[{"FTerm", "[", "b___", "]"}]}], "]"}], ",", 
          RowBox[{"f", "[", "y_", "]"}], ",", 
          RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}], ":=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"Log", "[", "a", "]"}], ",", 
            RowBox[{"Power", "[", 
             RowBox[{"a", ",", 
              RowBox[{"FTerm", "[", "b", "]"}]}], "]"}]}], "]"}], "**", 
          RowBox[{"FTerm", "[", 
           RowBox[{
            RowBox[{"FDOp", "[", 
             RowBox[{"f", "[", "y", "]"}], "]"}], ",", "b"}], "]"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Protect", "[", 
        RowBox[{
        "GammaN", ",", "Propagator", ",", "FTerm", ",", "FEq", ",", 
         "AnyField"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"D", "[", 
        RowBox[{"expr", ",", "v", ",", 
         RowBox[{"NonConstants", "->", "nonConst"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FunctionalD", "::", "badArgumentFTerm"}], "=", 
   "\"\<Cannot take derivative of an FTerm. Use TakeDerivatives \
instead.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FunctionalD", "[", 
     RowBox[{
      RowBox[{"FTerm", "[", "expr_", "]"}], ",", 
      RowBox[{"v", ":", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"f_", "[", "_", "]"}], "|", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"f_", "[", "_", "]"}], ",", "_Integer"}], "}"}]}], ")"}], 
        ".."}]}], ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"FunctionalD", "::", "badArgumentFTerm"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FunctionalD", "::", "badArgumentFEq"}], "=", 
   "\"\<Cannot take derivative of an FEq. Use TakeDerivatives instead.\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FunctionalD", "[", 
    RowBox[{
     RowBox[{"FEq", "[", "___", "]"}], ",", 
     RowBox[{"v", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"f_", "[", "_", "]"}], "|", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"f_", "[", "_", "]"}], ",", "_Integer"}], "}"}]}], ")"}], 
       ".."}]}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"FunctionalD", "::", "badArgumentFEq"}], "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950801155924999*^9, 3.950801156180604*^9}, 
   3.9508745541091022`*^9, {3.950874630546281*^9, 3.9508746344224*^9}, {
   3.9508746716147623`*^9, 3.950874843953817*^9}, {3.950874911320944*^9, 
   3.950874967970771*^9}, {3.9508750098040237`*^9, 3.9508750233744373`*^9}, {
   3.9508750787554817`*^9, 3.950875148206582*^9}, 3.9508752181802464`*^9, {
   3.9508940369998207`*^9, 3.9508941754057407`*^9}, {3.950894207218882*^9, 
   3.950894268707493*^9}, {3.9508943099823914`*^9, 3.950894364887673*^9}, {
   3.950894405287778*^9, 3.9508945587833138`*^9}, {3.9508969076834803`*^9, 
   3.9508969664507713`*^9}, {3.950897004655106*^9, 3.950897015070427*^9}, 
   3.9508971564032593`*^9, {3.950897870040359*^9, 3.950897884551845*^9}, {
   3.950897973224579*^9, 3.9508980022919607`*^9}, {3.9509326427332706`*^9, 
   3.95093266159977*^9}, {3.950939662750992*^9, 3.950939674049011*^9}, {
   3.950939753193946*^9, 3.950939895705489*^9}, {3.95093993866444*^9, 
   3.950939957812808*^9}, {3.9509401218698893`*^9, 3.9509401363101273`*^9}, {
   3.950952533276232*^9, 3.950952545138974*^9}, {3.95095258820336*^9, 
   3.950952722829163*^9}, {3.950952869771017*^9, 3.950953031163056*^9}, {
   3.950977047894329*^9, 3.950977350633822*^9}, {3.951195240203231*^9, 
   3.951195388802322*^9}, {3.951195471889974*^9, 3.951195473766608*^9}, {
   3.9511956520381613`*^9, 3.951195788170877*^9}, {3.9511959410810537`*^9, 
   3.951196141638171*^9}, {3.951196344392086*^9, 3.951196366474864*^9}, {
   3.951196844077084*^9, 3.951196875012323*^9}, {3.951197122093006*^9, 
   3.9511971892386637`*^9}, {3.951197222455007*^9, 3.9511972662623672`*^9}, 
   3.951197330985343*^9, {3.951197540127527*^9, 3.951197713002768*^9}, {
   3.9511977856706*^9, 3.951197818994656*^9}, {3.951197859170909*^9, 
   3.9511978849442472`*^9}, {3.951197917748715*^9, 3.951197953999455*^9}, {
   3.951198041247632*^9, 3.951198053693543*^9}, {3.951198099815494*^9, 
   3.951198115660613*^9}, {3.951198148168233*^9, 3.9511981579505587`*^9}, {
   3.9511981890961323`*^9, 3.95119819493015*^9}, {3.951198226487218*^9, 
   3.9511983610114326`*^9}, {3.951212249172265*^9, 3.9512122738997297`*^9}, {
   3.951212336789455*^9, 3.95121235450749*^9}, {3.9512124129764843`*^9, 
   3.951212432487711*^9}, {3.951212477416629*^9, 3.951212621805851*^9}, {
   3.951212679266748*^9, 3.951212717406486*^9}, {3.9512127594075603`*^9, 
   3.951212800564825*^9}, {3.951212848069742*^9, 3.951212852984906*^9}, {
   3.9512128925965843`*^9, 3.9512128932405643`*^9}, 3.951212942528529*^9, {
   3.951213304723278*^9, 3.9512133814804163`*^9}, {3.9512135401374474`*^9, 
   3.9512135831050463`*^9}, {3.9512136829537783`*^9, 3.95121377398514*^9}, {
   3.951213841275055*^9, 3.9512138820107107`*^9}, {3.951214165220489*^9, 
   3.951214166107987*^9}, {3.951214264868593*^9, 3.951214265319968*^9}, {
   3.951214410771542*^9, 3.951214552289424*^9}, {3.951214666616063*^9, 
   3.951214683032452*^9}, {3.9512147251411657`*^9, 3.9512148731638536`*^9}, 
   3.951214948313456*^9, {3.951215032782189*^9, 3.9512150650325613`*^9}, 
   3.9512151161690197`*^9, {3.9512152756823273`*^9, 3.951215285333046*^9}, 
   3.951215323874226*^9, {3.951215389461582*^9, 3.951215459245329*^9}, {
   3.9512155060238323`*^9, 3.9512155379434958`*^9}, {3.95121557326906*^9, 
   3.951215573427577*^9}, {3.9512156059663343`*^9, 3.95121587158613*^9}, {
   3.951215903365415*^9, 3.951215904513631*^9}, {3.951215980269064*^9, 
   3.9512159890299873`*^9}, {3.9512160291775017`*^9, 3.95121607124547*^9}, {
   3.951216118275013*^9, 3.95121623279858*^9}, {3.951219946242391*^9, 
   3.951219968247802*^9}, {3.951220438913568*^9, 3.9512204416073923`*^9}, {
   3.9512205345107737`*^9, 3.95122053549841*^9}, {3.951231437902248*^9, 
   3.9512314416134233`*^9}, {3.9512866947259703`*^9, 3.951286717389337*^9}, {
   3.951286755884138*^9, 3.951286756498644*^9}, {3.95129203442869*^9, 
   3.951292045360529*^9}, {3.951292102401136*^9, 3.951292133419026*^9}, {
   3.951292166228506*^9, 3.951292188249078*^9}, {3.951472587322197*^9, 
   3.9514726326342583`*^9}, {3.95149772033794*^9, 3.951497721822504*^9}, {
   3.951497802562875*^9, 3.9514978209064083`*^9}, {3.951497873570528*^9, 
   3.9514978869903917`*^9}, {3.95153655969942*^9, 3.9515365601060047`*^9}, {
   3.951543506835311*^9, 3.951543543583538*^9}, {3.951543745675208*^9, 
   3.95154377351899*^9}, {3.951544136050173*^9, 3.951544206579444*^9}, {
   3.951544963068859*^9, 3.95154500678379*^9}, {3.9515479236521587`*^9, 
   3.9515479281020403`*^9}, {3.951570842769438*^9, 3.951570871893484*^9}, {
   3.9515709505292788`*^9, 3.951570975792498*^9}, {3.951572796620995*^9, 
   3.951572836188469*^9}, {3.951572911993609*^9, 3.9515729166937027`*^9}, {
   3.9515729702709723`*^9, 3.951572978286055*^9}, 3.951573012346457*^9, {
   3.951573061386097*^9, 3.95157311145203*^9}, {3.95157371529758*^9, 
   3.951573727665247*^9}, {3.95157602148418*^9, 3.951576023159663*^9}, {
   3.9515762896646013`*^9, 3.951576372761286*^9}, {3.951577711973123*^9, 
   3.951577717925125*^9}, {3.951577870229261*^9, 3.951577870865844*^9}, {
   3.951581048813326*^9, 3.951581049557222*^9}, {3.951581086133473*^9, 
   3.9515810875012197`*^9}, {3.951628698753456*^9, 3.951628722485477*^9}, {
   3.95162875891761*^9, 3.9516287643371353`*^9}, {3.951629095381487*^9, 
   3.951629120689402*^9}, {3.951629184689608*^9, 3.951629189551814*^9}, {
   3.951655780650485*^9, 3.951655807774994*^9}, {3.9516644337347317`*^9, 
   3.951664454978928*^9}, {3.951664533640307*^9, 3.951664569084996*^9}, {
   3.951664611652972*^9, 3.951664693343053*^9}, {3.951664735823987*^9, 
   3.951664750131467*^9}, {3.951664782619955*^9, 3.951664783842967*^9}},
 CellLabel->
  "In[859]:=",ExpressionUUID->"428f55da-c8db-4d63-89da-51a880a4e13f"]
}, Closed]],

Cell[CellGroupData[{

Cell["Field and index information", "Subsection",
 CellChangeTimes->{{3.932178009618313*^9, 3.932178022055203*^9}, {
  3.95097752282972*^9, 
  3.950977525821363*^9}},ExpressionUUID->"a703f905-419d-403f-a28c-\
a63b6e5d0fbc"],

Cell[CellGroupData[{

Cell["Fields", "Subsubsection",
 CellChangeTimes->{{3.950977858978568*^9, 
  3.9509778685688467`*^9}},ExpressionUUID->"807846d5-0a8e-42e1-8499-\
9436b99fe5c0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetcFields", "[", "setup_", "]"}], ":=", 
   RowBox[{"Map", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
        RowBox[{"Head", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
      "\"\<cField\>\"", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetAnticFields", "[", "setup_", "]"}], ":=", 
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
           RowBox[{"Head", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", "}"}]}], "]"}], "&"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
         "\"\<cField\>\"", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
      RowBox[{
       RowBox[{"#", "=!=", 
        RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetGrassmanns", "[", "setup_", "]"}], ":=", 
   RowBox[{"Map", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
        RowBox[{"Head", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
      "\"\<Grassmann\>\"", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetAntiGrassmanns", "[", "setup_", "]"}], ":=", 
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
           RowBox[{"Head", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", "}"}]}], "]"}], "&"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
         "\"\<Grassmann\>\"", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
      RowBox[{
       RowBox[{"#", "=!=", 
        RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetCommuting", "[", "setup_", "]"}], ":=", 
    RowBox[{"Flatten", "@", 
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{"Map", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
              RowBox[{"Head", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
          "\"\<cField\>\"", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
       RowBox[{
        RowBox[{"#", "=!=", 
         RowBox[{"{", "}"}]}], "&"}]}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetAntiCommuting", "[", "setup_", "]"}], ":=", 
   RowBox[{"Flatten", "@", 
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Head", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
             RowBox[{"Head", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"Head", "[", "#", "]"}]}], "]"}], "&"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
         "\"\<Grassmann\>\"", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
      RowBox[{
       RowBox[{"#", "=!=", 
        RowBox[{"{", "}"}]}], "&"}]}], "]"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.932178093219666*^9, {3.932220707851465*^9, 3.932220747249592*^9}, {
   3.950800893485785*^9, 3.950800987632131*^9}, {3.9508016274975567`*^9, 
   3.950801660952232*^9}, {3.95086373016462*^9, 3.95086377625705*^9}, {
   3.950977908402094*^9, 3.9509779098545*^9}, {3.95097858078232*^9, 
   3.950978634866104*^9}, {3.950978675954303*^9, 3.9509786993099747`*^9}, 
   3.950978744078698*^9, {3.951022968366856*^9, 3.951023141306739*^9}, {
   3.9510232320318317`*^9, 3.951023236902824*^9}, {3.951023401747789*^9, 
   3.951023405927434*^9}, {3.951023697339532*^9, 3.9510237141319427`*^9}, {
   3.9510240171202173`*^9, 3.951024058934989*^9}, {3.951458822832425*^9, 
   3.951458835269506*^9}, {3.951459469924613*^9, 3.951459511306715*^9}, {
   3.951459545917614*^9, 3.951459580182859*^9}},
 CellLabel->
  "In[4513]:=",ExpressionUUID->"3518af78-5ff7-49ca-9232-57a8cda2059b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetFieldPairs", "[", "setup_", "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Head", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
         RowBox[{"Head", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Select", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
           "\"\<Grassmann\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
           "\"\<cField\>\"", "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "===", "List"}], "&"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetSingleFields", "[", "setup_", "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "#", "]"}], "&"}], ",", 
      RowBox[{"Select", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
           "\"\<Grassmann\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{"setup", "[", "\"\<FieldSpace\>\"", "]"}], "[", 
           "\"\<cField\>\"", "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], "=!=", "List"}], "&"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetAllFields", "[", "setup_", "]"}], ":=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Flatten", "@", 
       RowBox[{"GetFieldPairs", "[", "setup", "]"}]}], ",", 
      RowBox[{"GetSingleFields", "[", "setup", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HasPartnerField", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Flatten", "@", 
      RowBox[{"GetFieldPairs", "[", "setup", "]"}]}], ",", 
     "\[IndentingNewLine]", "field"}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HasPartnerField", "[", 
     RowBox[{"setup_", ",", 
      RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
    RowBox[{"HasPartnerField", "[", 
     RowBox[{"setup", ",", "field"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsGrassmann", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"GetGrassmanns", "[", "setup", "]"}], ",", "field"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IsGrassmann", "[", 
     RowBox[{"setup_", ",", 
      RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
    RowBox[{"IsGrassmann", "[", 
     RowBox[{"setup", ",", "field"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsAntiGrassmann", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"GetAntiGrassmanns", "[", "setup", "]"}], ",", "field"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IsAntiGrassmann", "[", 
     RowBox[{"setup_", ",", 
      RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
    RowBox[{"IsAntiGrassmann", "[", 
     RowBox[{"setup", ",", "field"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IscField", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"GetcFields", "[", "setup", "]"}], ",", "field"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IscField", "[", 
     RowBox[{"setup_", ",", 
      RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
    RowBox[{"IscField", "[", 
     RowBox[{"setup", ",", "field"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsAnticField", "[", 
    RowBox[{"setup_", ",", "field_"}], "]"}], ":=", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"GetAnticFields", "[", "setup", "]"}], ",", "field"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IsAnticField", "[", 
    RowBox[{"setup_", ",", 
     RowBox[{"field_", "[", "__", "]"}]}], "]"}], ":=", 
   RowBox[{"IsAnticField", "[", 
    RowBox[{"setup", ",", "field"}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951023163939932*^9, 3.951023253706765*^9}, {
  3.9510232893183107`*^9, 3.9510233580953617`*^9}, {3.951023414375457*^9, 
  3.951023635439684*^9}, {3.951023724604463*^9, 3.951023800417603*^9}, {
  3.951024061485753*^9, 3.9510240986479816`*^9}, {3.951458840289402*^9, 
  3.95145886349677*^9}},
 CellLabel->
  "In[4264]:=",ExpressionUUID->"51b5119b-7ed2-4d4e-8157-9da88d9e51a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetPartnerField", "[", 
    RowBox[{"setup_", ",", "field_Symbol"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pairs", ",", "sel"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"HasPartnerField", "[", 
          RowBox[{"setup", ",", "field"}], "]"}]}], ",", 
        RowBox[{"Return", "[", "field", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"pairs", "=", 
       RowBox[{"GetFieldPairs", "[", "setup", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"sel", "=", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"pairs", ",", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"#", ",", "field", ",", "Infinity"}], "]"}], "&"}]}], 
         "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sel", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"sel", ",", "field"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "sel", "]"}], ">", "0"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"sel", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<field \>\"", ",", "field", ",", "\"\< not found!\>\""}], 
       "]"}], ";", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetPartnerField", "[", 
   RowBox[{"setup_", ",", 
    RowBox[{"field_Symbol", "[", "i__", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"GetPartnerField", "[", 
    RowBox[{"setup", ",", "field"}], "]"}], "[", "i", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.932310703182301*^9, {3.9508008732217073`*^9, 3.950800905255765*^9}, 
   3.950874299413641*^9, {3.951023598531598*^9, 3.951023612563867*^9}, {
   3.951023642999547*^9, 3.9510236672477427`*^9}, {3.951023815416168*^9, 
   3.951023941927535*^9}},
 CellLabel->
  "In[105]:=",ExpressionUUID->"f9e7b8dd-479d-4f1c-b30c-43e82a8f1466"]
}, Closed]],

Cell[CellGroupData[{

Cell["Checking field content of expressions", "Subsubsection",
 CellChangeTimes->{{3.9510239782885523`*^9, 
  3.951023985187344*^9}},ExpressionUUID->"d2a5f7e9-fbf3-48fd-896b-\
3c3a13529cd2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExtractFields", "[", 
    RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Return", "@", 
       RowBox[{"(", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Head", "/@", 
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"{", "expr", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Alternatives", "@@", 
             RowBox[{"Map", "[", 
              RowBox[{"Blank", ",", 
               RowBox[{"GetAllFields", "[", "setup", "]"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", "Infinity"}], "\[IndentingNewLine]", 
           "]"}]}], "]"}], ")"}]}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtractFieldsWithIndex", "[", 
    RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Return", "@", 
       RowBox[{"Cases", "[", 
        RowBox[{
         RowBox[{"{", "expr", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Alternatives", "@@", 
          RowBox[{"Map", "[", 
           RowBox[{"Blank", ",", 
            RowBox[{"GetAllFields", "[", "setup", "]"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", "Infinity"}], "\[IndentingNewLine]", "]"}]}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951024006516164*^9, 3.951024008440085*^9}, {
  3.951024116163844*^9, 3.951024187756226*^9}, {3.951024231427863*^9, 
  3.951024239820277*^9}, {3.951024468384468*^9, 3.951024487333744*^9}, {
  3.9514080190148897`*^9, 3.9514081257981586`*^9}, {3.951408190094103*^9, 
  3.95140858075986*^9}},
 CellLabel->
  "In[2633]:=",ExpressionUUID->"84ac980c-3e5a-487b-a821-389318a8bd26"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ContainsGrassmann", "[", 
   RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Return", "@", "\[IndentingNewLine]", 
      RowBox[{"AnyTrue", "[", 
       RowBox[{
        RowBox[{"ExtractFields", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"IsGrassmann", "[", 
           RowBox[{"setup", ",", "#"}], "]"}], "||", 
          RowBox[{"IsAntiGrassmann", "[", 
           RowBox[{"setup", ",", "#"}], "]"}]}], "&"}]}], "]"}]}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GrassmannCount", "[", 
   RowBox[{"setup_Association", ",", "expr_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Return", "[", 
      RowBox[{"Length", "@", "\[IndentingNewLine]", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"ExtractFieldsWithIndex", "[", 
          RowBox[{"setup", ",", "expr"}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"IsGrassmann", "[", 
            RowBox[{"setup", ",", 
             RowBox[{"Head", "[", "#", "]"}]}], "]"}], "||", 
           RowBox[{"IsAntiGrassmann", "[", 
            RowBox[{"setup", ",", 
             RowBox[{"Head", "[", "#", "]"}]}], "]"}]}], "&"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950801014829342*^9, 3.950801089487433*^9}, {
   3.9508016734862947`*^9, 3.950801789647143*^9}, {3.950802396390094*^9, 
   3.95080251586098*^9}, {3.9508025705613623`*^9, 3.9508025986163673`*^9}, {
   3.950802685581463*^9, 3.950802850019553*^9}, {3.95080288950806*^9, 
   3.950802891116541*^9}, 3.950977841322421*^9, 3.9510239548515882`*^9, {
   3.951047050359741*^9, 3.951047092694622*^9}, {3.95140861814279*^9, 
   3.951408655758883*^9}},
 CellLabel->
  "In[2637]:=",ExpressionUUID->"e0675219-06d7-4260-b88e-aecc77330bb2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Indices", "Subsubsection",
 CellChangeTimes->{{3.950801271735565*^9, 3.95080128037481*^9}, {
  3.950854198551154*^9, 
  3.950854199116568*^9}},ExpressionUUID->"4d34a9f6-835b-4d0e-bded-\
e4ef20d68c82"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Get", " ", "a", " ", "list", " ", "of", " ", "all", " ", "unique", " ", 
     "super"}], "-", 
    RowBox[{
    "indices", " ", "within", " ", "the", " ", "expression", " ", "expr"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GetAllSuperIndices", "[", 
      RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"idxO", ",", "idxF"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"idxO", "=", 
         RowBox[{"Cases", "[", 
          RowBox[{"expr", ",", "\[IndentingNewLine]", 
           RowBox[{"Alternatives", "@@", 
            RowBox[{"(", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Blank", "[", "#", "]"}], "&"}], ",", 
               "$indexedObjects"}], "]"}], ")"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"idxF", "=", 
         RowBox[{"Cases", "[", 
          RowBox[{"expr", ",", "\[IndentingNewLine]", 
           RowBox[{"Alternatives", "@@", 
            RowBox[{"(", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Blank", "[", "#", "]"}], "&"}], ",", 
               RowBox[{"GetAllFields", "[", "setup", "]"}]}], "]"}], ")"}]}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{
          RowBox[{"makePosIdx", "/@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"idxF", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], "\[Union]", 
             RowBox[{"Flatten", "[", 
              RowBox[{"idxO", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ")"}]}], "//",
           "DeleteDuplicates"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"GetAllSuperIndices", "[", 
      RowBox[{"setup_Association", ",", "expr_FEq"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"GetAllSuperIndices", "[", 
            RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{"List", "@@", "expr"}], ")"}]}], ")"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951107115870104*^9, 3.951107119664289*^9}, {
   3.951232666728512*^9, 3.9512327307721777`*^9}, {3.951232768256838*^9, 
   3.951232797687828*^9}, {3.951232852977048*^9, 3.951232854904772*^9}, 
   3.951232896832637*^9, {3.951233051337117*^9, 3.9512330784720984`*^9}, {
   3.9512331145693483`*^9, 3.951233116819352*^9}, {3.951233193304516*^9, 
   3.9512332286202087`*^9}, {3.9512332870017033`*^9, 3.951233461017544*^9}, {
   3.9514079645986423`*^9, 3.951407975597652*^9}, 3.9514088692135553`*^9, {
   3.951408933818221*^9, 3.9514089639024887`*^9}, {3.951408997255925*^9, 
   3.951409058190572*^9}, {3.9514091191566887`*^9, 3.951409220406929*^9}, {
   3.951409355132435*^9, 3.951409406053235*^9}, {3.951412988403317*^9, 
   3.951413058400049*^9}, {3.951413093253529*^9, 3.95141312835893*^9}, {
   3.951453001969294*^9, 3.9514530782332687`*^9}, {3.9514531134928913`*^9, 
   3.951453151297193*^9}, {3.951453182355892*^9, 3.9514532015598783`*^9}, {
   3.9516483952285557`*^9, 3.951648418393405*^9}},
 CellLabel->
  "In[477]:=",ExpressionUUID->"935d09a0-331b-40fc-a467-f0134b7e4304"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExtractObjectsWithIndex", "[", 
    RowBox[{"setup_Association", ",", "expr_FTerm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Return", "@", 
       RowBox[{"Cases", "[", 
        RowBox[{"expr", ",", "\[IndentingNewLine]", 
         RowBox[{"Alternatives", "@@", 
          RowBox[{"(", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Blank", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"$indexedObjects", "\[Union]", 
              RowBox[{"GetAllFields", "[", "setup", "]"}]}]}], "]"}], ")"}]}],
          ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtractObjectsWithIndex", "[", 
    RowBox[{"setup_Association", ",", "expr_FEq"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Return", "@", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"ExtractObjectsWithIndex", "[", 
           RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{"List", "@@", "expr"}], ")"}]}], ")"}], 
       "\[IndentingNewLine]", ")"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950854493144973*^9, 3.950854569452779*^9}, {
   3.950854604452739*^9, 3.950854680324503*^9}, {3.950854996656869*^9, 
   3.9508550481848717`*^9}, {3.950859645548572*^9, 3.950859785007856*^9}, {
   3.950860303344551*^9, 3.9508603107335377`*^9}, {3.950861168268649*^9, 
   3.950861274048501*^9}, {3.950861304120777*^9, 3.9508613153605413`*^9}, {
   3.950861367012312*^9, 3.9508614126049147`*^9}, {3.950861453960935*^9, 
   3.9508615591409407`*^9}, {3.950861602551324*^9, 3.9508616765664988`*^9}, {
   3.950873227322419*^9, 3.950873227634747*^9}, {3.9508733445328627`*^9, 
   3.9508733890321093`*^9}, {3.9508734300279284`*^9, 
   3.9508735030787888`*^9}, {3.950873533774803*^9, 3.950873574626863*^9}, {
   3.950873628353125*^9, 3.950873634368539*^9}, {3.9508736653917418`*^9, 
   3.950873725638062*^9}, {3.950977542870824*^9, 3.950977615051394*^9}, 
   3.950977666576852*^9, {3.950977824426978*^9, 3.950977824803349*^9}, {
   3.951048475057866*^9, 3.9510485002012367`*^9}, {3.951048586276622*^9, 
   3.951048595044265*^9}, {3.95104863795863*^9, 3.951048654139003*^9}, {
   3.951048871382616*^9, 3.951049094164*^9}, {3.951049522508106*^9, 
   3.951049543225523*^9}, {3.95104967655072*^9, 3.9510497051863403`*^9}, {
   3.9511067302213497`*^9, 3.951106791491743*^9}, {3.951287544996215*^9, 
   3.951287549952241*^9}, {3.951287602973113*^9, 3.9512876756527433`*^9}, {
   3.951287719050293*^9, 3.951287723077393*^9}, {3.951407484798896*^9, 
   3.951407586422956*^9}, {3.951407635742136*^9, 3.9514077332682333`*^9}, {
   3.9514078317148857`*^9, 3.951407913024342*^9}, {3.951413243484696*^9, 
   3.951413259965719*^9}, {3.951413311019375*^9, 3.9514133275446873`*^9}, {
   3.9514134074685583`*^9, 3.951413426750424*^9}, {3.9514134572011023`*^9, 
   3.951413461935947*^9}, {3.951451475336604*^9, 3.951451484252874*^9}, {
   3.951451529112577*^9, 3.9514515550855007`*^9}, {3.951451601183958*^9, 
   3.951451628235566*^9}, {3.9514516656367683`*^9, 3.951451781545533*^9}, {
   3.951453230928925*^9, 3.951453255911845*^9}, 3.951453300685562*^9, {
   3.951648389864277*^9, 3.9516483899840717`*^9}},
 CellLabel->
  "In[479]:=",ExpressionUUID->"618c6cea-155d-41cc-8d73-a5fa44e0f55c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExtractObjectsAndIndices", "[", 
    RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"idxO", ",", "idxF"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"idxO", "=", 
       RowBox[{"Cases", "[", 
        RowBox[{"expr", ",", "\[IndentingNewLine]", 
         RowBox[{"Alternatives", "@@", 
          RowBox[{"(", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Blank", "[", "#", "]"}], "&"}], ",", 
             "$indexedObjects"}], "]"}], ")"}]}], ",", "\[IndentingNewLine]", 
         
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"idxF", "=", 
       RowBox[{"Cases", "[", 
        RowBox[{"expr", ",", "\[IndentingNewLine]", 
         RowBox[{"Alternatives", "@@", 
          RowBox[{"(", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Blank", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"GetAllFields", "[", "setup", "]"}]}], "]"}], ")"}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"idxO", "\[Union]", "idxF"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"makePosIdx", "/@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"idxF", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}], "\[Union]", 
              RowBox[{"Flatten", "[", 
               RowBox[{"idxO", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ")"}]}], "//",
            "DeleteDuplicates"}], ")"}]}], "}"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtractObjectsAndIndices", "[", 
    RowBox[{"setup_Association", ",", "expr_FEq"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Return", "@", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], "&"}],
          "@", "\[IndentingNewLine]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"ExtractObjectsAndIndices", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{"List", "@@", "expr"}], ")"}]}], ")"}]}], 
        "\[IndentingNewLine]", ")"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951451835619858*^9, 3.9514518674001627`*^9}, {
   3.951451915752914*^9, 3.951452124020727*^9}, {3.951452162352051*^9, 
   3.951452268020783*^9}, 3.951452299725769*^9, {3.951453103077381*^9, 
   3.9514531064646683`*^9}, {3.951453311264482*^9, 3.95145331685712*^9}, {
   3.95164807637239*^9, 3.951648232560545*^9}, {3.951648273328508*^9, 
   3.951648280964575*^9}, {3.951648363533064*^9, 3.951648372816523*^9}, 
   3.951648431940979*^9, {3.951648483088426*^9, 3.95164849624159*^9}, 
   3.9516485369412537`*^9},
 CellLabel->
  "In[496]:=",ExpressionUUID->"2083da28-6459-42c3-a41e-477af9394ced"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SuperIndices", "::", "undeterminedSums"}], "=", 
   "\"\<There are indices with count > 2 in the expression\n    `1`\nThis is \
not allowed for valid terms/equation. Problematic indices:\n    `2`\>\""}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[3515]:=",ExpressionUUID->"d22ab83c-b759-4f78-bd4e-b187d181367e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Get", " ", "a", " ", "list", " ", "of", " ", "all", " ", "closed", " ", 
     "super"}], "-", 
    RowBox[{
    "indices", " ", "within", " ", "the", " ", "expression", " ", "expr"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"GetClosedSuperIndices", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"objects", ",", "indices", ",", "count"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"objects", ",", "indices"}], "}"}], "=", 
        RowBox[{"ExtractObjectsAndIndices", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"count", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{"objects", ",", "#", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "5"}], "}"}]}], "]"}], "&"}], ",", 
          "indices"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "\[IndentingNewLine]", 
        RowBox[{"Pick", "[", 
         RowBox[{"indices", ",", "\[IndentingNewLine]", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{"#", ",", "2"}], "]"}], "===", "0"}], "&"}], ",", 
            "count"}], "]"}]}], "\[IndentingNewLine]", "]"}], 
        "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951451501561377*^9, 3.951451510252924*^9}, {
   3.951451795040955*^9, 3.951451809344687*^9}, {3.951452323832529*^9, 
   3.95145249361165*^9}, {3.951452618306072*^9, 3.951452735673223*^9}, {
   3.9516479327083397`*^9, 3.951648064029566*^9}, {3.951648567488967*^9, 
   3.9516487786445417`*^9}, {3.951648808809355*^9, 3.951648810436421*^9}, 
   3.9516488526567698`*^9, 3.951648921073379*^9},
 CellLabel->
  "In[583]:=",ExpressionUUID->"52f45ee5-d229-4150-80ad-0fd4a5239cf9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Get", " ", "a", " ", "list", " ", "of", " ", "all", " ", "open", " ", 
     "super"}], "-", 
    RowBox[{
    "indices", " ", "within", " ", "the", " ", "expression", " ", "expr"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"GetOpenSuperIndices", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"objects", ",", "indices", ",", "count"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"objects", ",", "indices"}], "}"}], "=", 
        RowBox[{"ExtractObjectsAndIndices", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"count", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Count", "[", 
            RowBox[{"objects", ",", "#", ",", "Infinity"}], "]"}], "&"}], ",",
           "indices"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "\[IndentingNewLine]", 
        RowBox[{"Pick", "[", 
         RowBox[{"indices", ",", "\[IndentingNewLine]", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{"#", ",", "2"}], "]"}], "=!=", "0"}], "&"}], ",", 
            "count"}], "]"}]}], "\[IndentingNewLine]", "]"}], 
        "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9508542004410467`*^9, 3.9508544749252157`*^9}, {
   3.950861781076435*^9, 3.950861866017157*^9}, {3.950861904572686*^9, 
   3.950862122741899*^9}, 3.950862250128793*^9, {3.9508623533294363`*^9, 
   3.950862473344803*^9}, {3.950862503549046*^9, 3.950862504168859*^9}, {
   3.950862808761071*^9, 3.95086284882382*^9}, {3.9508724621909122`*^9, 
   3.9508725163422728`*^9}, {3.950872679755715*^9, 3.950872742486643*^9}, {
   3.950873274979582*^9, 3.9508733202595463`*^9}, {3.9508736487671967`*^9, 
   3.950873654067449*^9}, {3.9510491583749323`*^9, 3.951049163421998*^9}, {
   3.951049235218823*^9, 3.951049243994762*^9}, {3.951049428748899*^9, 
   3.951049437502572*^9}, {3.951049503039259*^9, 3.951049505389997*^9}, 
   3.9510495609135113`*^9, {3.9510495984105787`*^9, 3.9510496300825567`*^9}, {
   3.9510497431225443`*^9, 3.951049751762602*^9}, 3.951049797343923*^9, 
   3.951057349023424*^9, {3.951106795019677*^9, 3.951106799162589*^9}, {
   3.951106990904499*^9, 3.951107063520145*^9}, {3.951229079559609*^9, 
   3.9512291363161707`*^9}, {3.951229194557047*^9, 3.9512291970249243`*^9}, {
   3.9512309838719883`*^9, 3.9512310891132097`*^9}, {3.95123115620091*^9, 
   3.951231159935547*^9}, {3.951232161292356*^9, 3.9512322491452513`*^9}, {
   3.951232297416614*^9, 3.951232398748467*^9}, {3.951237216865061*^9, 
   3.951237217320691*^9}, {3.9512874864801893`*^9, 3.951287499658772*^9}, {
   3.9512877098305883`*^9, 3.9512877121256933`*^9}, {3.951413482725192*^9, 
   3.951413510918292*^9}, {3.951450333937282*^9, 3.951450357753048*^9}, {
   3.951450402573718*^9, 3.9514505262460318`*^9}, {3.951451117552815*^9, 
   3.951451153249962*^9}, {3.951451293496265*^9, 3.951451338911901*^9}, {
   3.95145141155457*^9, 3.951451471189353*^9}, {3.9514527479095592`*^9, 
   3.9514528367339*^9}, {3.951452918860742*^9, 3.9514529256252413`*^9}, {
   3.951648930048634*^9, 3.9516489317160797`*^9}},
 CellLabel->
  "In[584]:=",ExpressionUUID->"9f3b0ea7-2af5-48b1-84b3-46146be887b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Check", " ", "whether", " ", "all", " ", "indices", " ", "are", " ", 
     "closed", " ", "within", " ", 
     RowBox[{"expr", ".", " ", "\[IndentingNewLine]", "This"}], " ", 
     "disallows", " ", "also", " ", "multiple", " ", "use", " ", "of", " ", 
     "a", " ", "single", " ", "index", " ", "name"}], ",", " ", 
    RowBox[{"!", 
     RowBox[{"anywhere", "!"}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"AllIndicesClosed", "[", 
      RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"objects", ",", "indices", ",", "count"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"objects", ",", "indices"}], "}"}], "=", 
         RowBox[{"ExtractObjectsAndIndices", "[", 
          RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"count", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Count", "[", 
             RowBox[{"objects", ",", "#", ",", "Infinity"}], "]"}], "&"}], 
           ",", "indices"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"AllTrue", "[", 
          RowBox[{"count", ",", 
           RowBox[{
            RowBox[{"#", "==", "2"}], "&"}]}], "]"}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AllIndicesClosed", "[", 
     RowBox[{"setup_", ",", "expr_FEq"}], "]"}], ":=", 
    RowBox[{"And", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"AllIndicesClosed", "[", 
         RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", "expr"}], ")"}]}]}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AllIndicesClosed", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"type", "::", "error"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SuperIndicesValid", "[", 
      RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"objects", ",", "indices", ",", "count"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"objects", ",", "indices"}], "}"}], "=", 
         RowBox[{"ExtractObjectsAndIndices", "[", 
          RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"count", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Count", "[", 
             RowBox[{"objects", ",", "#", ",", "Infinity"}], "]"}], "&"}], 
           ",", "indices"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"AnyTrue", "[", 
           RowBox[{"count", ",", 
            RowBox[{
             RowBox[{"#", ">", "2"}], "&"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"SuperIndices", "::", "undeterminedSums"}], ",", "expr", 
             ",", 
             RowBox[{"Pick", "[", 
              RowBox[{"indices", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", ">", "2"}], "&"}], "/@", "count"}]}], "]"}]}], 
            "]"}], ";", 
           RowBox[{"Return", "[", "False", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "True", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SuperIndicesValid", "[", 
     RowBox[{"setup_", ",", "expr_FEq"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"SuperIndicesValid", "[", 
       RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", "expr"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SuperIndicesValid", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"type", "::", "error"}], "]"}], ";", 
      RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.950862410027896*^9, {3.9508628529163237`*^9, 3.9508628920401497`*^9}, 
   3.9510491668196583`*^9, {3.951232402828401*^9, 3.9512324069834948`*^9}, {
   3.9514529291901073`*^9, 3.9514529673086042`*^9}, {3.9516489435447187`*^9, 
   3.951649009673064*^9}, {3.951649055184802*^9, 3.951649057744557*^9}, {
   3.951649618260614*^9, 
   3.9516496277563887`*^9}},ExpressionUUID->"3edfcfc0-c624-46bc-ab09-\
a08de412f0d7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Ordering", "Subsection",
 CellChangeTimes->{{3.932178009618313*^9, 3.932178022055203*^9}, {
  3.950801118933737*^9, 3.950801154023693*^9}, {3.9509401502822638`*^9, 
  3.950940151040942*^9}},ExpressionUUID->"1785af53-7c89-486a-9e5f-\
2cc90ee5d4f8"],

Cell[CellGroupData[{

Cell["Setting the canonical ordering", "Subsubsection",
 CellChangeTimes->{{3.950940652516369*^9, 
  3.950940658984301*^9}},ExpressionUUID->"6b5ad42c-f028-4331-8dd5-\
edca6279d9c9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$AvailableCanonicalOrderings", "=", 
    RowBox[{"{", 
     RowBox[{
     "\"\<f>af>b\>\"", ",", "\"\<af>f>b\>\"", ",", "\"\<b>f>af\>\"", ",", 
      "\"\<b>af>f\>\""}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CanonicalOrdering", "::", "unknownInteger"}], "=", 
   "\"\<The integer `1` should be between 1 and 4.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CanonicalOrdering", "::", "unknownString"}], "=", 
    RowBox[{"\"\<The expression `1` should be one of \>\"", "<>", 
     RowBox[{"ToString", "[", "$AvailableCanonicalOrderings", "]"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SetCanonicalOrdering", "[", "a_Integer", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Switch", "[", 
        RowBox[{"a", ",", "\[IndentingNewLine]", "1", ",", 
         RowBox[{"$CanonicalOrdering", "=", "\"\<f>af>b\>\""}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "2", ",", 
         RowBox[{"$CanonicalOrdering", "=", "\"\<af>f>b\>\""}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "3", ",", 
         RowBox[{"$CanonicalOrdering", "=", "\"\<b>f>af\>\""}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "4", ",", 
         RowBox[{"$CanonicalOrdering", "=", "\"\<b>af>f\>\""}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "_", ",", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"CanonicalOrdering", "::", "unknownInteger"}], ",", "a"}], 
          "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<Canonical ordering set to \>\"", ",", "$CanonicalOrdering"}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetCanonicalOrdering", "[", "a_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Switch", "[", 
       RowBox[{"a", ",", "\[IndentingNewLine]", "\"\<f>af>b\>\"", ",", 
        RowBox[{"$CanonicalOrdering", "=", "\"\<f>af>b\>\""}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\"\<af>f>b\>\"", ",", 
        RowBox[{"$CanonicalOrdering", "=", "\"\<af>f>b\>\""}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\"\<b>f>af\>\"", ",", 
        RowBox[{"$CanonicalOrdering", "=", "\"\<b>f>af\>\""}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\"\<b>af>f\>\"", ",", 
        RowBox[{"$CanonicalOrdering", "=", "\"\<b>af>f\>\""}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "_", ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"CanonicalOrdering", "::", "unknownString"}], ",", "a"}], 
         "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Canonical ordering set to \>\"", ",", "$CanonicalOrdering"}], 
       "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950940153137643*^9, 3.950940313248869*^9}, {
  3.950940364396865*^9, 3.950940626082654*^9}, {3.950947877407638*^9, 
  3.9509478851616173`*^9}, {3.950947925430534*^9, 3.950947963989278*^9}, {
  3.951210780223824*^9, 3.9512107812072353`*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"8223ffc8-f59e-4c33-b04f-02db6763d2e2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Ordering expressions", "Subsubsection",
 CellChangeTimes->{{3.950940652516369*^9, 
  3.950940676916478*^9}},ExpressionUUID->"25f821ed-484b-44c3-bb3d-\
2285af151ba5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Returns", " ", "true", " ", "if", " ", "f1"}], " ", "<", " ", 
     "f2"}], ",", " ", 
    RowBox[{
     RowBox[{"and", " ", "false", " ", "if", " ", "f1"}], " ", ">", " ", 
     "f2"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"FieldOrderLess", "[", 
     RowBox[{"setup_", ",", "f1_Symbol", ",", "f2_Symbol"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kind1", ",", "kind2", ",", "\[IndentingNewLine]", "idxOrder", ",", 
        "\[IndentingNewLine]", "n1", ",", "n2"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"kind1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"IsGrassmann", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IsAntiGrassmann", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IscField", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IsAnticField", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"#", "===", "AnyField"}]}], "}"}], "&"}], "[", "f1", 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kind2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"IsGrassmann", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IsAntiGrassmann", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IscField", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"IsAnticField", "[", 
             RowBox[{"setup", ",", "#"}], "]"}], ",", 
            RowBox[{"#", "===", "AnyField"}]}], "}"}], "&"}], "[", "f2", 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Switch", "[", 
        RowBox[{
        "$CanonicalOrdering", ",", "\[IndentingNewLine]", "\"\<f>af>b\>\"", 
         ",", "\[IndentingNewLine]", 
         RowBox[{"idxOrder", "=", 
          RowBox[{"{", 
           RowBox[{"4", ",", "3", ",", "2", ",", "1", ",", "0"}], "}"}]}], 
         ",", "\[IndentingNewLine]", "\"\<af>f>b\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"idxOrder", "=", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4", ",", "1", ",", "2", ",", "0"}], "}"}]}], 
         ",", "\[IndentingNewLine]", "\"\<b>f>af\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"idxOrder", "=", 
          RowBox[{"{", 
           RowBox[{"2", ",", "1", ",", "4", ",", "3", ",", "0"}], "}"}]}], 
         ",", "\[IndentingNewLine]", "\"\<b>af>f\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"idxOrder", "=", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "0"}], "}"}]}], 
         ",", "\[IndentingNewLine]", "_", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<Order failure: order \\\"\>\"", "<>", "$CanonicalOrdering", 
            "<>", "\"\<\\\" unknown.\>\""}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"n1", "=", 
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"idxOrder", ",", "kind1"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"n2", "=", 
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"idxOrder", ",", "kind2"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n1", "===", "n2"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{"OrderedQ", "[", 
           RowBox[{"{", 
            RowBox[{"f1", ",", "f2"}], "}"}], "]"}], "]"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"n1", "<", "n2"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509469386341343`*^9, 3.9509471834252987`*^9}, {
   3.950947223313903*^9, 3.950947224742805*^9}, {3.950947263353957*^9, 
   3.950947275621757*^9}, {3.950947319094739*^9, 3.9509474205587378`*^9}, 
   3.95094746109451*^9, {3.950947500069725*^9, 3.950947678289824*^9}, {
   3.950947722074582*^9, 3.950947766347187*^9}, {3.950947800639678*^9, 
   3.9509478705099792`*^9}, {3.9509479131384983`*^9, 3.950947918497128*^9}, {
   3.950947973835105*^9, 3.950948031631962*^9}, 3.950948064688114*^9, {
   3.951053680094369*^9, 3.951053686753499*^9}, {3.951054284810362*^9, 
   3.9510543614021463`*^9}, {3.951054405821702*^9, 3.951054431637821*^9}, {
   3.9510544720659943`*^9, 3.951054727167162*^9}, {3.951211269076701*^9, 
   3.951211288852489*^9}, {3.951657721477734*^9, 3.951657734365893*^9}, {
   3.951657775817823*^9, 3.951657809073967*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"4b678c74-7d06-4764-a1d3-b462e6b01ccf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Returns", " ", "the", " ", "sign", " ", "that", " ", "results", " ", 
    "from", " ", "exchanging", " ", "the", " ", "two", " ", "fields", " ", 
    "f1", " ", "and", " ", "f2"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"CommuteSign", "[", 
     RowBox[{"setup_", ",", "f1_", ",", "f2_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Return", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "2"}], "*", 
          RowBox[{"Boole", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"GetAntiCommuting", "[", "setup", "]"}], ",", "f1"}], 
             "]"}], "&&", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"GetAntiCommuting", "[", "setup", "]"}], ",", "f2"}], 
             "]"}]}], "]"}]}], "+", "1"}], "\[IndentingNewLine]", "]"}], 
       ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9509491238971243`*^9, 3.950949126229731*^9}, {
  3.950949179705824*^9, 3.950949242101665*^9}, {3.9509494626505527`*^9, 
  3.950949470925414*^9}, {3.950951603853833*^9, 3.9509516215042048`*^9}, {
  3.951054737038*^9, 3.951054767618724*^9}, {3.951459375105747*^9, 
  3.951459426767087*^9}, {3.951459589403475*^9, 3.951459670238989*^9}, {
  3.951460182646307*^9, 3.951460198891129*^9}},
 CellLabel->
  "In[4713]:=",ExpressionUUID->"18065f13-e208-4ab7-83f1-35e867d53bcb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Find", " ", "all", " ", "instances", " ", "of", " ", "$OrderedObjects", 
    " ", "and", " ", "order", " ", "their", " ", "field", " ", "value", " ", 
    "according", " ", "to", " ", "the", " ", "canonical", " ", "scheme"}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"OrderObject", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", "expr"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderObject", "[", 
      RowBox[{"setup_", ",", 
       RowBox[{
        RowBox[{"obj_", "[", 
         RowBox[{"fields_List", ",", "indices_List"}], "]"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"$OrderedObjects", ",", "obj"}], "]"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "i", ",", "curi", ",", "prefactor", ",", "pref", ",", "reverse", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"nfields", "=", "fields"}], ",", 
         RowBox[{"nindices", "=", "indices"}]}], "}"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Do", " ", "not", " ", "order", " ", "if", " ", "there", " ", "is", 
         " ", "an", " ", "undetermined", " ", 
         RowBox[{"field", "!"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"nfields", ",", "AnyField"}], "]"}], "||", 
           RowBox[{"FreeQ", "[", 
            RowBox[{"$indexedObjects", ",", "obj"}], "]"}]}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"obj", "[", 
            RowBox[{"nfields", ",", "nindices"}], "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "The", " ", "propagator", " ", "gets", " ", "a", " ", "reverse", " ",
           "ordering"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"reverse", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"obj", "===", "Propagator"}], ",", "True", ",", "False"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pref", "=", 
         RowBox[{"If", "[", 
          RowBox[{"reverse", ",", "Identity", ",", "Not"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"prefactor", "=", "1"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Always", " ", "compare", " ", "the", " ", "ith", " ", "field", " ",
            "with", " ", "all", " ", "previous", " ", "fields", " ", "and", 
           " ", "put", " ", "it", " ", "in", " ", "the", " ", "right", " ", 
           RowBox[{"place", ".", "\[IndentingNewLine]", "Iterate"}], " ", 
           "until", " ", "one", " ", "reaches", " ", "the", " ", "end", " ", 
           "of", " ", "the", " ", "array"}], ",", " ", 
          RowBox[{"then", " ", "it", " ", "is", " ", 
           RowBox[{"sorted", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<=", 
           RowBox[{"Length", "[", "nfields", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"curi", "=", "i"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "Check", " ", "if", " ", "we", " ", "should", " ", "switch", " ",
               "curi", " ", "and", " ", "curi"}], "-", "1"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"While", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"curi", ">=", "2"}], "&&", 
              RowBox[{"pref", "@", 
               RowBox[{"FieldOrderLess", "[", 
                RowBox[{"setup", ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", "curi", "]"}], "]"}], ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", 
                   RowBox[{"curi", "-", "1"}], "]"}], "]"}]}], "]"}]}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"nfields", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"curi", ",", 
                   RowBox[{"curi", "-", "1"}]}], "}"}], "]"}], "]"}], "=", 
               RowBox[{"nfields", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"curi", "-", "1"}], ",", "curi"}], "}"}], "]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"nindices", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"curi", ",", 
                   RowBox[{"curi", "-", "1"}]}], "}"}], "]"}], "]"}], "=", 
               RowBox[{"nindices", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"curi", "-", "1"}], ",", "curi"}], "}"}], "]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"prefactor", "*=", 
               RowBox[{"CommuteSign", "[", 
                RowBox[{"setup", ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", "curi", "]"}], "]"}], ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", 
                   RowBox[{"curi", "-", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"curi", "--"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"prefactor", "*", 
          RowBox[{"obj", "[", 
           RowBox[{"nfields", ",", "nindices"}], "]"}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderFieldList", "[", 
      RowBox[{"setup_", ",", "fields_List"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "curi", ",", 
         RowBox[{"nfields", "=", "fields"}]}], "}"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Always", " ", "compare", " ", "the", " ", "ith", " ", "field", " ", 
          "with", " ", "all", " ", "previous", " ", "fields", " ", "and", " ",
           "put", " ", "it", " ", "in", " ", "the", " ", "right", " ", 
          RowBox[{"place", ".", "\[IndentingNewLine]", "Iterate"}], " ", 
          "until", " ", "one", " ", "reaches", " ", "the", " ", "end", " ", 
          "of", " ", "the", " ", "array"}], ",", " ", 
         RowBox[{"then", " ", "it", " ", "is", " ", 
          RowBox[{"sorted", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<=", 
           RowBox[{"Length", "[", "nfields", "]"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"curi", "=", "i"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "Check", " ", "if", " ", "we", " ", "should", " ", "switch", " ",
               "curi", " ", "and", " ", "curi"}], "-", "1"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"While", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"curi", ">=", "2"}], "&&", 
              RowBox[{"Not", "@", 
               RowBox[{"FieldOrderLess", "[", 
                RowBox[{"setup", ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", "curi", "]"}], "]"}], ",", 
                 RowBox[{"nfields", "[", 
                  RowBox[{"[", 
                   RowBox[{"curi", "-", "1"}], "]"}], "]"}]}], "]"}]}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"nfields", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"curi", ",", 
                   RowBox[{"curi", "-", "1"}]}], "}"}], "]"}], "]"}], "=", 
               RowBox[{"nfields", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"curi", "-", "1"}], ",", "curi"}], "}"}], "]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"curi", "--"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "nfields", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OrderFields", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"OrderObject", "[", 
         RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr", ",", 
       "Infinity"}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950940680637898*^9, 3.950940703340807*^9}, {
   3.950940753433639*^9, 3.950940770880921*^9}, {3.950940820604183*^9, 
   3.9509408314803343`*^9}, {3.950946867725016*^9, 3.950946867879279*^9}, {
   3.950946910845818*^9, 3.950946916669503*^9}, {3.950948080113351*^9, 
   3.950948364054194*^9}, {3.950948431170244*^9, 3.9509484424895906`*^9}, {
   3.9509487711183453`*^9, 3.9509487713973417`*^9}, {3.950948804373925*^9, 
   3.95094881228995*^9}, {3.950948873358161*^9, 3.950948881330065*^9}, {
   3.950948915158443*^9, 3.950948973463738*^9}, {3.9509490347704144`*^9, 
   3.950949146503368*^9}, {3.950949262758871*^9, 3.9509492803297586`*^9}, {
   3.9509493130620728`*^9, 3.950949346226811*^9}, {3.950949378638241*^9, 
   3.950949437598216*^9}, {3.950949479001645*^9, 3.950949676303194*^9}, {
   3.950949797286953*^9, 3.950949915654313*^9}, {3.95095042176271*^9, 
   3.95095044922293*^9}, {3.950951143743619*^9, 3.950951153673574*^9}, {
   3.9509511839493093`*^9, 3.950951479581605*^9}, {3.950951572049883*^9, 
   3.9509515917025433`*^9}, {3.9509516327864656`*^9, 3.950951696541771*^9}, {
   3.950977443735013*^9, 3.950977444242279*^9}, {3.951054819394979*^9, 
   3.951054841695517*^9}, 3.95121074104852*^9, {3.951545685082767*^9, 
   3.951545717482501*^9}, {3.95154579762779*^9, 3.951545831539317*^9}, {
   3.9516571946742563`*^9, 3.9516573934698143`*^9}, {3.951657676837923*^9, 
   3.951657677762052*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"4a073111-7191-4734-b32b-1a96840d6461"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["QMeS Compatibility", "Subsection",
 CellChangeTimes->{{3.950951779978003*^9, 
  3.9509517862440367`*^9}},ExpressionUUID->"94391a5f-eb5e-4478-a534-\
7016e4a3f9d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Compatibility", ":", " ", 
    RowBox[{
    "Output", " ", "any", " ", "expression", " ", "in", " ", "a", " ", "Form",
      " ", "which", " ", "looks", " ", "like", " ", "QMeS", " ", "output"}]}],
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"QMeSNaming", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", "expr"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"QMeSNaming", "[", 
      RowBox[{"setup_", ",", 
       RowBox[{
        RowBox[{"obj_", "[", 
         RowBox[{"fields_List", ",", "indices_List"}], "]"}], "/;", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"$OrderedObjects", ",", "obj"}], "]"}]}]}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "oldCanonicalOrdering", ",", "transf", ",", "prefactor", ",", 
         "\[IndentingNewLine]", "mobj", ",", "mfields", ",", "mindices", ",", 
         "\[IndentingNewLine]", "prefix", ",", "fieldPart", ",", 
         "indexPart"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"QMeS", " ", "follows", " ", "b"}], ">", "af", ">", "f"}], 
         ",", " ", 
         RowBox[{"so", " ", "we", " ", "switch", " ", 
          RowBox[{"temporarily", "!"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", "$CanonicalOrdering", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$CanonicalOrdering", "=", "\"\<b>af>f\>\""}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"transf", "=", 
            RowBox[{"OrderObject", "[", 
             RowBox[{"setup", ",", 
              RowBox[{"obj", "[", 
               RowBox[{"fields", ",", "indices"}], "]"}]}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"prefactor", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{"transf", ",", 
            RowBox[{"Times", "[", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "a_"}], "]"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"prefactor", "=", 
            RowBox[{"-", "1"}]}], ";", 
           RowBox[{"transf", "=", 
            RowBox[{"-", "transf"}]}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"mobj", "=", 
         RowBox[{"Head", "[", "transf", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"mfields", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", "@@", "transf"}], ")"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"mindices", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", "@@", "transf"}], ")"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"prefix", "=", 
         RowBox[{"Switch", "[", 
          RowBox[{
          "obj", ",", "\[IndentingNewLine]", "Propagator", ",", "\"\<G\>\"", 
           ",", "\[IndentingNewLine]", "GammaN", ",", 
           "\"\<\[CapitalGamma]\>\"", ",", "\[IndentingNewLine]", "Rdot", 
           ",", "\"\<Rdot\>\""}], "\[IndentingNewLine]", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fieldPart", "=", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"Map", "[", 
           RowBox[{"ToString", ",", "mfields"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"indexPart", "=", 
         RowBox[{"Flatten", "[", "mindices", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"prefactor", "*", 
          RowBox[{
           RowBox[{"Symbol", "[", 
            RowBox[{"prefix", "<>", "fieldPart"}], "]"}], "[", "indexPart", 
           "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"QMeSForm", "[", 
      RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"QMeSNaming", "[", 
          RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}]}], "]"}], "//.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FEq", ":>", "List"}], ",", 
        RowBox[{"FTerm", ":>", "List"}]}], "}"}]}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950950511202754*^9, 3.950950754493911*^9}, {
  3.9509507857536583`*^9, 3.9509511203631363`*^9}, {3.950951490001182*^9, 
  3.950951554042407*^9}, {3.950951710976829*^9, 3.950951737477071*^9}, {
  3.951054861758219*^9, 3.95105491628331*^9}, {3.9514681593364897`*^9, 
  3.9514681654524403`*^9}},
 CellLabel->
  "In[128]:=",ExpressionUUID->"ac314d00-9b25-4da1-be23-eabaa3a126f2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Reduce metric factors", "Subsection",
 CellChangeTimes->{{3.950867995958111*^9, 3.9508679992839813`*^9}, {
  3.951108367695386*^9, 3.9511083702282677`*^9}, {3.951108500371646*^9, 
  3.95110850408386*^9}, {3.951293082804921*^9, 
  3.951293105795587*^9}},ExpressionUUID->"ff235384-733f-4abf-8f02-\
504f4ee478e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Is", " ", "an", " ", "index", " ", 
    RowBox[{"down", "?"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"isNeg", "[", 
      RowBox[{"-", "i_"}], "]"}], ":=", "True"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"isNeg", "[", "i_", "]"}], ":=", "False"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makePosIdx", "[", 
      RowBox[{"-", "i_"}], "]"}], ":=", "i"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makePosIdx", "[", "i_", "]"}], ":=", "i"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"AntiGrassmann", "-", 
      RowBox[{"Grassmann", " ", "gives", " ", "1"}]}], ",", " ", 
     RowBox[{"otherwise", " ", "-", "1"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"GrassOrder", "[", 
      RowBox[{"setup_", ",", "f1_", ",", "f2_", ",", "sign_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", "*", 
           RowBox[{"Boole", "[", 
            RowBox[{"IsGrassmann", "[", 
             RowBox[{"setup", ",", "f1"}], "]"}], "]"}]}], "-", "1"}], ")"}], 
        "^", 
        RowBox[{"Boole", "[", 
         RowBox[{"!", 
          RowBox[{"(", 
           RowBox[{"sign", "===", "1"}], ")"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Return", " ", 
      SubscriptBox["\[Gamma]", "ab"]}], " ", "=", " ", 
     RowBox[{
      SuperscriptBox["\[Gamma]", "ab"], " ", "=", " ", 
      RowBox[{
       RowBox[{"(", GridBox[{
          {"0", 
           RowBox[{"-", "1"}]},
          {"1", "0"}
         }], ")"}], " ", "and", " ", "ordering", " ", 
       RowBox[{"(", 
        RowBox[{"\[Psi]", ",", " ", 
         OverscriptBox["\[Psi]", "_"]}], ")"}]}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"metric", "[", 
      RowBox[{"setup_", ",", "a_", ",", "b_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"f1", "=", 
          RowBox[{"makePosIdx", "[", "a", "]"}]}], ",", 
         RowBox[{"f2", "=", 
          RowBox[{"makePosIdx", "[", "b", "]"}]}], ",", "f2p", ",", 
         "\[IndentingNewLine]", "lower", ",", "sign"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"f2p", "=", 
         RowBox[{"GetPartnerField", "[", 
          RowBox[{"setup", ",", "f2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"f1", "=!=", "f2p"}], "&&", 
            RowBox[{"f1", "=!=", "f2"}]}], ")"}], ",", 
          RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          SuperscriptBox[
           SubscriptBox["\[Gamma]", "a"], "b"], " ", "=", " ", 
          SuperscriptBox[
           SubscriptBox["\[Delta]", "a"], "b"]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"lower", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"isNeg", ",", 
           RowBox[{"{", 
            RowBox[{"a", ",", "b"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"f1", "===", "f2"}], "&&", 
           RowBox[{"lower", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&&", 
           RowBox[{"Not", "[", 
            RowBox[{"lower", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
          RowBox[{"Return", "[", "1", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          SubscriptBox[
           SuperscriptBox["\[Gamma]", "a"], "b"], " ", "=", " ", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"-", "1"}], ")"}], "ab"], 
           SubscriptBox[
            SuperscriptBox["\[Delta]", "a"], "b"]}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"sign", "=", 
         RowBox[{"CommuteSign", "[", 
          RowBox[{"setup", ",", "f1", ",", "f2"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"f1", "===", "f2"}], "&&", 
           RowBox[{"Not", "[", 
            RowBox[{"lower", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "&&", 
           RowBox[{"lower", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", 
          RowBox[{"Return", "[", "sign", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          SubscriptBox["\[Gamma]", "ab"], "=", 
          RowBox[{
           SuperscriptBox["\[Gamma]", "ab"], " ", "and", " ", "fields", " ", 
           "fit", " ", "with", " ", "partners"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"f1", "===", "f2p"}], "&&", 
           RowBox[{"Not", "[", 
            RowBox[{"Xor", "@@", "lower"}], "]"}]}], ",", 
          RowBox[{"Return", "@", 
           RowBox[{"GrassOrder", "[", 
            RowBox[{"setup", ",", "f1", ",", "f2", ",", "sign"}], "]"}]}]}], 
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Otherwise", ",", " ", "0"}], "*)"}], "\[IndentingNewLine]", 
        
        RowBox[{"Return", "[", "0", "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951303744159573*^9, 3.9513037989744387`*^9}, {
   3.951303843582143*^9, 3.951303870050048*^9}, {3.9513039622742357`*^9, 
   3.951304155282446*^9}, {3.951304199642703*^9, 3.951304285719481*^9}, {
   3.951304663115595*^9, 3.951304692218692*^9}, 3.951457716045754*^9, {
   3.951458354419704*^9, 3.951458371180928*^9}, {3.9514584509289513`*^9, 
   3.951458470999769*^9}, {3.951458520041458*^9, 3.951458521515368*^9}, {
   3.951458557818705*^9, 3.951458599255558*^9}, {3.951458636986669*^9, 
   3.9514586843954782`*^9}, {3.951458750928652*^9, 3.951458761469582*^9}, {
   3.9514588886328287`*^9, 3.9514589608075523`*^9}, {3.951459055355339*^9, 
   3.951459064542293*^9}, {3.9514591995979767`*^9, 3.951459201399353*^9}, {
   3.951459266969933*^9, 3.951459341786765*^9}, {3.951460014179521*^9, 
   3.951460055857315*^9}, {3.951460110843073*^9, 3.9514601516914883`*^9}, {
   3.951460220073299*^9, 3.951460221951055*^9}, {3.9514602753077707`*^9, 
   3.951460331022794*^9}, {3.9514690818850327`*^9, 3.9514695028892307`*^9}, {
   3.9514695374968843`*^9, 3.951469566433015*^9}, {3.951469601749508*^9, 
   3.951469684325183*^9}, {3.9514698291337633`*^9, 3.9514701296579657`*^9}, {
   3.951470318377425*^9, 3.951470348534276*^9}, {3.951471866082131*^9, 
   3.9514719013978567`*^9}, {3.951648310235367*^9, 3.951648329328693*^9}, {
   3.951649675397249*^9, 3.951649688728838*^9}},
 CellLabel->
  "In[801]:=",ExpressionUUID->"b7774a84-ac87-42fd-842d-b4b0fef4ae7a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ReduceIndices", "::", "FTermFEq"}], "=", 
   "\"\<The given expression is neither an FTerm nor an FEq:\n`1`\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ReduceIndices", "[", 
     RowBox[{"setup_", ",", "term_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ReduceIndices", "::", "FTermFEq"}], ",", "term"}], "]"}], 
      ";", 
      RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReduceIndices", "[", 
    RowBox[{"setup_", ",", "term_FTerm"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "closedSIndices", ",", "cases", ",", "closed", ",", 
       "\[IndentingNewLine]", "i", ",", "both", ",", 
       RowBox[{"result", "=", "term"}], ",", "casesFMinus"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"closedSIndices", "=", 
       RowBox[{"GetClosedSuperIndices", "[", 
        RowBox[{"setup", ",", "term"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"cases", "=", 
       RowBox[{"Cases", "[", 
        RowBox[{"term", ",", 
         RowBox[{
          RowBox[{"\[Gamma]", "[", "__", "]"}], "|", 
          RowBox[{"FMinus", "[", "__", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cases", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"cases", ",", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "AnyField"}], "]"}], 
          "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"casesFMinus", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"cases", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "#", "]"}], "===", "FMinus"}], "&"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cases", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"cases", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "#", "]"}], "===", "\[Gamma]"}], "&"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"closed", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"MemberQ", "[", 
           RowBox[{"closedSIndices", ",", 
            RowBox[{"makePosIdx", "[", "#", "]"}]}], "]"}], "&"}], ",", 
         RowBox[{"cases", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"cases", "=", 
       RowBox[{"Pick", "[", 
        RowBox[{"cases", ",", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "||", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ",", "closed"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"closed", "=", 
       RowBox[{"Pick", "[", 
        RowBox[{"closed", ",", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "||", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ",", "closed"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "replace", " ", "the", " ", "terms", " ", "in", " ", "question", " ", 
        "by", " ", "the", " ", "evaluated", " ", "metric", " ", "factor"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"result", "=", 
       RowBox[{"result", "/.", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", ":>", 
            RowBox[{"metric", "[", 
             RowBox[{"setup", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "2"}], "*", 
                  RowBox[{"Boole", "[", 
                   RowBox[{"isNeg", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], 
                 "+", "1"}], ")"}], 
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "2"}], "*", 
                  RowBox[{"Boole", "[", 
                   RowBox[{"isNeg", "[", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", "2"}], "]"}], "]"}], "]"}], "]"}]}], 
                 "+", "1"}], ")"}], 
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}]}], "&"}], ",", "cases"}], "]"}]}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"replace", " ", "the", " ", "remaining", " ", 
         RowBox[{"indices", ".", " ", "If"}], " ", "both", " ", "are", " ", 
         "up", " ", "or", " ", "both", " ", "or", " ", "down"}], ",", " ", 
        RowBox[{"the", " ", "remaining", " ", "indices", " ", "change", " ", 
         RowBox[{"signs", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"result", "=", 
       RowBox[{"result", "/.", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"both", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"Xor", "[", 
                RowBox[{
                 RowBox[{"isNeg", "[", 
                  RowBox[{"cases", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2", ",", "1"}], "]"}], "]"}], "]"}], 
                 ",", 
                 RowBox[{"isNeg", "[", 
                  RowBox[{"cases", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2", ",", "2"}], "]"}], "]"}], "]"}]}], 
                "]"}]}], ",", 
              RowBox[{"-", "1"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"closed", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"makePosIdx", "[", 
               RowBox[{"cases", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2", ",", "1"}], "]"}], "]"}], "]"}], "->", 
              RowBox[{"both", "*", 
               RowBox[{"makePosIdx", "[", 
                RowBox[{"cases", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2", ",", "2"}], "]"}], "]"}], "]"}]}]}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"makePosIdx", "[", 
               RowBox[{"cases", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2", ",", "2"}], "]"}], "]"}], "]"}], "->", 
              RowBox[{"both", "*", 
               RowBox[{"makePosIdx", "[", 
                RowBox[{"cases", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2", ",", "1"}], "]"}], "]"}], 
                "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "cases", "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Resolve", " ", "all", " ", "FMinus", " ", "factors"}], "*)"}],
       "\[IndentingNewLine]", 
      RowBox[{"result", "=", 
       RowBox[{"result", "/.", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "->", 
            RowBox[{"CommuteSign", "[", 
             RowBox[{"setup", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}]}], "&"}], ",", 
          "casesFMinus"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "result", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReduceIndices", "[", 
    RowBox[{"setup_", ",", "eq_FEq"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ReduceIndices", "[", 
         RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "eq"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951300785349235*^9, 3.9513009564539337`*^9}, {
   3.951301035377817*^9, 3.9513011665740213`*^9}, {3.951301225543013*^9, 
   3.951301236678216*^9}, {3.951301282098599*^9, 3.951301346441934*^9}, {
   3.9513014157148848`*^9, 3.951301622525878*^9}, {3.951304318827338*^9, 
   3.95130433289494*^9}, {3.951304377102706*^9, 3.9513044134229794`*^9}, {
   3.951304453206748*^9, 3.951304456090837*^9}, {3.95130449455897*^9, 
   3.9513045456587973`*^9}, {3.951304582937003*^9, 3.9513046552791443`*^9}, {
   3.951304700567832*^9, 3.951304762946992*^9}, {3.951372121123035*^9, 
   3.9513721333441067`*^9}, {3.951372211526342*^9, 3.9513722402137547`*^9}, {
   3.951372273065372*^9, 3.951372299070169*^9}, 3.9513725050296164`*^9, {
   3.951450844720209*^9, 3.95145107361679*^9}, {3.951451167541079*^9, 
   3.9514512736973*^9}, {3.951453576273809*^9, 3.951453580164226*^9}, {
   3.951457491539401*^9, 3.951457604562931*^9}, {3.95145764810745*^9, 
   3.951457648171651*^9}, {3.9514578884009542`*^9, 3.95145791878762*^9}, {
   3.9514579692345953`*^9, 3.951458073957879*^9}, {3.951458193652005*^9, 
   3.951458204649975*^9}, {3.951458268935926*^9, 3.951458343633585*^9}, {
   3.951459700995335*^9, 3.9514597851084538`*^9}, {3.951459841021542*^9, 
   3.951459916726817*^9}, {3.951460427440955*^9, 3.951460433805822*^9}, {
   3.9514604946443768`*^9, 3.951460521436384*^9}, {3.9514605769314833`*^9, 
   3.951460580823366*^9}, {3.951460632423612*^9, 3.951460731968226*^9}, {
   3.951460767943199*^9, 3.951460773440178*^9}, {3.9514608134388657`*^9, 
   3.951460845374309*^9}, {3.951460969151451*^9, 3.951461071281893*^9}, 
   3.951468706761716*^9, 3.951468857778056*^9, {3.951471235837472*^9, 
   3.951471237953371*^9}, {3.951471351649811*^9, 3.951471388405759*^9}, {
   3.951471938269614*^9, 3.9514719388614683`*^9}, {3.9515397231504917`*^9, 
   3.951539787126141*^9}, {3.951539854222691*^9, 3.951539923582129*^9}, {
   3.95154010247478*^9, 3.951540209358204*^9}, {3.9515402484037447`*^9, 
   3.951540318290903*^9}, {3.951540448042314*^9, 3.9515405181549377`*^9}, 
   3.9515440442495947`*^9, {3.9515737495323143`*^9, 3.951573767439993*^9}, 
   3.9515761891287117`*^9, {3.951649454592554*^9, 3.9516495066452723`*^9}, {
   3.951649538122303*^9, 3.951649539913146*^9}, {3.951649711253118*^9, 
   3.9516499337025557`*^9}, {3.951649972297798*^9, 3.951650224094323*^9}, {
   3.9516503037904177`*^9, 3.9516503623780413`*^9}, {3.95165039793025*^9, 
   3.951650405841606*^9}, {3.951650522034171*^9, 3.951650524141621*^9}, {
   3.951650578069748*^9, 3.9516506062705393`*^9}, {3.951650735353997*^9, 
   3.9516507376976843`*^9}, {3.951650781779787*^9, 3.951650932582657*^9}, {
   3.951650976987129*^9, 3.95165102293432*^9}},
 CellLabel->
  "In[1124]:=",ExpressionUUID->"43985720-cee5-4d43-b10f-0ff857cd9f45"]
}, Closed]],

Cell[CellGroupData[{

Cell["Truncate", "Subsection",
 CellChangeTimes->{{3.950867995958111*^9, 3.9508679992839813`*^9}, {
  3.951108367695386*^9, 3.9511083702282677`*^9}, {3.951108500371646*^9, 
  3.95110850408386*^9}, {3.951293082804921*^9, 3.951293105795587*^9}, {
  3.951374660985827*^9, 
  3.951374662670094*^9}},ExpressionUUID->"1622282e-4fbd-4217-bd6f-\
b09735bb31ad"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"truncationPass", "[", 
    RowBox[{"setup_", ",", "expr_FEq"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"truncationPass", "[", 
        RowBox[{"Setup", ",", "#"}], "]"}], "&"}], "/@", "expr"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"truncationPass", "[", 
    RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ret", "=", "expr"}], ",", "i", ",", "corrF"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Get", " ", "rid", " ", "of", " ", "any", " ", "truncated", " ", 
       "ordered", " ", "functions"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ret", "=", 
       RowBox[{"ret", "/.", 
        RowBox[{"Map", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"f_", ",", "i_"}], "]"}], "/;", 
             RowBox[{"FreeQ", "[", 
              RowBox[{"f", ",", "AnyField"}], "]"}]}], ":>", 
            RowBox[{"If", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"FreeQ", "[", 
               RowBox[{
                RowBox[{"Sort", "/@", 
                 RowBox[{
                  RowBox[{"setup", "[", "\"\<Truncation\>\"", "]"}], "[", "#",
                   "]"}]}], ",", 
                RowBox[{"Sort", "@", "f"}]}], "]"}], ",", 
              "\[IndentingNewLine]", "0", ",", 
              RowBox[{"#", "[", 
               RowBox[{"f", ",", "i"}], "]"}]}], "\[IndentingNewLine]", 
             "]"}]}], "&"}], ",", "$OrderedObjects"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Finally", ",", " ", 
        RowBox[{"remove", " ", "the", " ", "metric", " ", "factors"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ret", "=", 
       RowBox[{"ReduceIndices", "[", 
        RowBox[{"setup", ",", "ret"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "ret", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951389581416955*^9, 3.951389950797908*^9}, 
   3.951389987668315*^9, 3.95139004606415*^9, {3.951403689085683*^9, 
   3.9514036913662033`*^9}, 3.951405137092505*^9, {3.951405226410903*^9, 
   3.951405241959279*^9}, {3.9514052854747047`*^9, 3.951405387375243*^9}, 
   3.951405429748548*^9, {3.9514058726757803`*^9, 3.9514060201555*^9}, {
   3.9514062911372623`*^9, 3.951406451202593*^9}, {3.951450653772773*^9, 
   3.951450658920052*^9}, {3.951450727641428*^9, 3.951450729263782*^9}, {
   3.951453546890149*^9, 3.951453610424754*^9}, {3.951453653246344*^9, 
   3.951453665240487*^9}, {3.951463489468478*^9, 3.951463507224358*^9}, {
   3.951464567628628*^9, 3.9514645928922977`*^9}, {3.951464661733588*^9, 
   3.9514646963096848`*^9}, {3.9514647999140244`*^9, 3.9514648068937063`*^9}, 
   3.95146490526134*^9, {3.951465442089321*^9, 3.951465481752432*^9}, 
   3.95146565274448*^9, 3.9514658679805727`*^9, {3.951465916312339*^9, 
   3.9514659319403152`*^9}, {3.951465993581708*^9, 3.9514660113063803`*^9}, {
   3.951466070086101*^9, 3.951466078384225*^9}, {3.951468459225561*^9, 
   3.9514684614726477`*^9}, 3.951468517333744*^9, {3.9516301820127697`*^9, 
   3.951630216357292*^9}, {3.951630257909608*^9, 3.951630272453444*^9}, {
   3.9516304191333227`*^9, 3.9516304256116858`*^9}, 3.9516492167451468`*^9, {
   3.951649292841243*^9, 3.951649433385789*^9}, 3.95165109014289*^9, {
   3.951651190134521*^9, 3.951651208173399*^9}, {3.951651261973709*^9, 
   3.9516512889494467`*^9}, {3.951651334039051*^9, 3.951651374741802*^9}, {
   3.9516514112381*^9, 3.951651424914469*^9}, {3.951651456013818*^9, 
   3.951651551130704*^9}, {3.9516515837732763`*^9, 3.9516517105143967`*^9}, {
   3.951651784778723*^9, 3.9516517859371023`*^9}, {3.9516518405773077`*^9, 
   3.951651897868972*^9}, {3.951651949470501*^9, 3.9516520788145447`*^9}, {
   3.9516521094064493`*^9, 3.951652111593318*^9}, {3.95165219314708*^9, 
   3.9516522803505077`*^9}},
 CellLabel->
  "In[1702]:=",ExpressionUUID->"7fb788c6-edd7-4326-a9a5-34ed1aaa3e34"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Truncate", "::", "wrongExpr"}], "=", 
   "\"\<Cannot truncate an expression which is neither an FEq nor an FTerm.\>\
\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Truncate", "::", "noTruncation"}], "=", 
   "\"\<The given setup does not have a key \\\"Truncation\\\"\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Truncate", "::", "missingCorrF"}], "=", 
   "\"\<The given truncation misses a truncation table for the correlation \
function `1`\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Truncate", "::", "missing"}], "=", 
   "\"\<The given truncation misses a truncation table for `1`\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Truncate", "::", "FDOp"}], "=", 
    "\"\<The given expression contains unresolved derivative operators! \
Cannot truncate before resolving all FDOp.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"indices", "::", "inconsistentContractions"}], "=", 
    "\"\<The index `1` has been contracted in an inconsistent way in the \
expression\n    `2`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"indices", "::", "inconsistentFieldContractions"}], "=", 
   "\"\<The fields `1` have been contracted in an inconsistent way in the \
expression\n    `2`\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearAll", "[", "LTrunc", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LTrunc", "[", 
    RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Print", "[", "expr", "]"}], ";", 
     RowBox[{"Message", "[", 
      RowBox[{"Truncate", "::", "wrongExpr"}], "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LTrunc", "[", 
    RowBox[{"setup_", ",", "expr_FEq"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"LTrunc", "[", 
         RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", "expr"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"LTrunc", "[", 
     RowBox[{"setup_", ",", "expr_FTerm"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ret", "=", 
         RowBox[{"List", "@@", "expr"}]}], ",", "curi", ",", 
        "\[IndentingNewLine]", "allObj", ",", "closedIndices", ",", "i", ",", 
        
        RowBox[{"allFields", "=", 
         RowBox[{"GetAllFields", "[", "setup", "]"}]}], ",", 
        "\[IndentingNewLine]", "idx", ",", "subObj", ",", "idxOccur", ",", 
        "idxPos", ",", "ignore", ",", "notFoundCuri"}], "\[IndentingNewLine]",
        "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Start", " ", "off", " ", "with", " ", "the", " ", "nested", " ", 
        "FTerms"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ret", "=", 
        RowBox[{"ret", "/.", 
         RowBox[{
          RowBox[{"FTerm", "[", "a__", "]"}], ":>", 
          RowBox[{"LTrunc", "[", 
           RowBox[{"setup", ",", 
            RowBox[{"FTerm", "[", "a", "]"}]}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Abort", " ", "if", " ", "there", " ", "is", " ", "nothing", " ", 
         "to", " ", "do"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"ret", ",", "AnyField", ",", "Infinity"}], "]"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"FTerm", "@@", "ret"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Get", " ", "all", " ", "closed", " ", "indices"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"closedIndices", "=", 
        RowBox[{"GetClosedSuperIndices", "[", 
         RowBox[{"setup", ",", 
          RowBox[{"FTerm", "@@", 
           RowBox[{"(", 
            RowBox[{"ret", "/.", 
             RowBox[{
              RowBox[{"FTerm", "[", "__", "]"}], ":>", "ignore"}]}], 
            ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Abort", " ", "if", " ", "there", " ", "is", " ", "nothing", " ", 
         "to", " ", "do"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "closedIndices", "]"}], "===", "0"}], "||", 
          
          RowBox[{"FreeQ", "[", 
           RowBox[{"ret", ",", "AnyField", ",", "Infinity"}], "]"}]}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"FTerm", "@@", "ret"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "We", " ", "have", " ", "to", " ", "update", " ", "these", " ", 
         "global", " ", "quantities", " ", "after", " ", "each", " ", 
         "iteration"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"allObj", "=", 
        RowBox[{"ExtractObjectsWithIndex", "[", 
         RowBox[{"setup", ",", 
          RowBox[{"FTerm", "@@", 
           RowBox[{"(", 
            RowBox[{"ret", "/.", 
             RowBox[{
              RowBox[{"FTerm", "[", "__", "]"}], ":>", "ignore"}]}], 
            ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Next", ",", " ", 
         RowBox[{
         "try", " ", "to", " ", "find", " ", "the", " ", "first", " ", 
          "factor", " ", "that", " ", "needs", " ", "to", " ", "be", " ", 
          "expanded"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"notFoundCuri", "=", "True"}], ";", "\[IndentingNewLine]", 
       RowBox[{"curi", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{"notFoundCuri", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"curi", ">", 
             RowBox[{"Length", "[", "closedIndices", "]"}]}], ",", 
            RowBox[{"Return", "[", 
             RowBox[{"FTerm", "@@", "ret"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"idx", "=", 
           RowBox[{"closedIndices", "[", 
            RowBox[{"[", "curi", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"subObj", "=", 
           RowBox[{"Select", "[", 
            RowBox[{"allObj", ",", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", "idx", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}]}], "]"}], "&"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"idxOccur", "=", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{
                 RowBox[{"subObj", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"-", "idx"}], ",", 
                 RowBox[{"{", "2", "}"}]}], "]"}], ",", 
               RowBox[{"-", "idx"}], ",", "idx"}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{
                 RowBox[{"subObj", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", 
                 RowBox[{"-", "idx"}], ",", 
                 RowBox[{"{", "2", "}"}]}], "]"}], ",", 
               RowBox[{"-", "idx"}], ",", "idx"}], "]"}]}], 
            "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Sort", "@", "idxOccur"}], "=!=", 
             RowBox[{"Sort", "@", 
              RowBox[{"{", 
               RowBox[{"idx", ",", 
                RowBox[{"-", "idx"}]}], "}"}]}]}], ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{
               RowBox[{"indices", "::", "inconsistentContractions"}], ",", 
               "idx", ",", "expr"}], "]"}], ";", 
             RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"idxPos", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"FirstPosition", "[", 
               RowBox[{
                RowBox[{"subObj", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                RowBox[{"idxOccur", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"FirstPosition", "[", 
               RowBox[{
                RowBox[{"subObj", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
                RowBox[{"idxOccur", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"subObj", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1", ",", 
                 RowBox[{"idxPos", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "=!=", 
              "AnyField"}], "&&", 
             RowBox[{
              RowBox[{"subObj", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "1", ",", 
                 RowBox[{"idxPos", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "=!=", 
              "AnyField"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"curi", "++"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Continue", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}],
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"notFoundCuri", "=", "False"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"subObj", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1", ",", 
              RowBox[{"idxPos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "===", 
           "AnyField"}], "&&", 
          RowBox[{
           RowBox[{"subObj", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1", ",", 
              RowBox[{"idxPos", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "===", 
           "AnyField"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ret", "=", 
           RowBox[{"FEq", "@@", 
            RowBox[{"Map", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"s1", "=", 
                    RowBox[{"subObj", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                   RowBox[{"s2", "=", 
                    RowBox[{"subObj", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "t"}], "}"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "=", 
                   "#"}], ";", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "=", 
                   "#"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"truncationPass", "[", 
                   RowBox[{"setup", ",", 
                    RowBox[{"FTerm", "@@", 
                    RowBox[{"(", 
                    RowBox[{"ret", "/.", 
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"subObj", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ":>", "s1"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"subObj", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ":>", "s2"}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a_", ",", "a_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}],
                     "]"}], ":>", 
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "#"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}],
                     "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a_", ",", "a_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}],
                     "]"}], ":>", 
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "#"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}],
                     "]"}]}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a_", ",", "b_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    "ib_"}], "}"}]}], "]"}], ":>", 
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "b"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    "ib"}], "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a_", ",", "b_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    "ib_"}], "}"}]}], "]"}], ":>", 
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "b"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    "ib"}], "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a_", ",", "b_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ia_", ",", 
                    RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}],
                     "]"}], ":>", 
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a", ",", "#"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ia", ",", 
                    RowBox[{"s1", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}],
                     "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a_", ",", "b_"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ia_", ",", 
                    RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}],
                     "]"}], ":>", 
                    RowBox[{"FMinus", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"a", ",", "#"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ia", ",", 
                    RowBox[{"s2", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"idxPos", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "}"}]}],
                     "]"}]}]}], "\[IndentingNewLine]", "}"}]}], ")"}]}]}], 
                   "]"}]}]}], "\[IndentingNewLine]", "]"}], "&"}], 
              "\[IndentingNewLine]", ",", "allFields"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"LTrunc", "[", 
            RowBox[{"setup", ",", "ret"}], "]"}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"subObj", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"idxPos", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "=!=", 
          RowBox[{"GetPartnerField", "[", 
           RowBox[{
            RowBox[{"subObj", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"idxPos", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"indices", "::", "inconsistentFieldContractions"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"subObj", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"idxPos", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"subObj", "[", 
                RowBox[{"[", 
                 RowBox[{"2", ",", "1"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"idxPos", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            "expr"}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Truncate", "[", 
    RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ret", ",", "\[IndentingNewLine]", 
       RowBox[{"mmap", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"Length", "/@", 
             RowBox[{"(", 
              RowBox[{"List", "@@", 
               RowBox[{"FEq", "[", "expr", "]"}]}], ")"}]}], "]"}], ">", 
           "10"}], ",", "ParallelMap", ",", "Map"}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"KeyFreeQ", "[", 
         RowBox[{"setup", ",", "\"\<Truncation\>\""}], "]"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"Truncate", "::", "noTruncation"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{"expr", ",", 
          RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"Truncate", "::", "FDOp"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ret", "=", 
       RowBox[{"mmap", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"LTrunc", "[", 
           RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
         RowBox[{"FEq", "[", "expr", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ret", "=", 
       RowBox[{"ReduceIndices", "[", 
        RowBox[{"setup", ",", "ret"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"OrderFields", "[", 
       RowBox[{"setup", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"FixIndices", "[", 
           RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", "ret"}]}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951380772035668*^9, 3.951381010731739*^9}, {
   3.951381042679875*^9, 3.951381109463232*^9}, {3.9513813479921417`*^9, 
   3.951381412648691*^9}, 3.9513814906183567`*^9, {3.95138153091617*^9, 
   3.951381588479537*^9}, {3.951381620923684*^9, 3.951381910027657*^9}, 
   3.951381984596449*^9, {3.9513820199843884`*^9, 3.951382035904245*^9}, {
   3.9513820662766247`*^9, 3.9513820700609627`*^9}, {3.9513821668893538`*^9, 
   3.951382231118887*^9}, {3.951382275317967*^9, 3.9513825286925697`*^9}, {
   3.951384334132821*^9, 3.951384491842533*^9}, {3.951384536869231*^9, 
   3.95138469948974*^9}, {3.951384787605556*^9, 3.951384816493434*^9}, {
   3.9513849102834167`*^9, 3.951384988413474*^9}, {3.9513851329104443`*^9, 
   3.951385165182644*^9}, {3.951385251330003*^9, 3.951385254317246*^9}, {
   3.951385288973421*^9, 3.9513853141536093`*^9}, {3.951385449049035*^9, 
   3.951385451736805*^9}, {3.9513856412577887`*^9, 3.9513856787977123`*^9}, {
   3.951385811461988*^9, 3.951385832195031*^9}, {3.951385984676014*^9, 
   3.95138605098608*^9}, {3.951386097723044*^9, 3.951386112706297*^9}, {
   3.951386155204818*^9, 3.951386165191152*^9}, {3.951386227678212*^9, 
   3.951386300331849*^9}, {3.95138636335865*^9, 3.951386454316221*^9}, {
   3.9513865951095657`*^9, 3.9513866270019903`*^9}, {3.951386657221135*^9, 
   3.9513866748094463`*^9}, {3.951386727449768*^9, 3.9513867724577417`*^9}, {
   3.951386804981512*^9, 3.951386820605565*^9}, {3.951386865728282*^9, 
   3.951386988303831*^9}, 3.951387021297584*^9, {3.951387054841675*^9, 
   3.951387105769767*^9}, {3.951387186859519*^9, 3.9513871910576057`*^9}, {
   3.9513872263599987`*^9, 3.9513872417696657`*^9}, {3.9513873062338123`*^9, 
   3.951387308125737*^9}, {3.951387362725437*^9, 3.9513874702542057`*^9}, {
   3.9513875190063267`*^9, 3.951387580657631*^9}, {3.951387625071842*^9, 
   3.951387627949842*^9}, {3.951387734894548*^9, 3.9513880530148287`*^9}, {
   3.951389155740093*^9, 3.951389208825424*^9}, {3.951389373723777*^9, 
   3.951389524548596*^9}, 3.9513895702947702`*^9, {3.951403590622168*^9, 
   3.951403595476199*^9}, {3.951403634289302*^9, 3.951403638579666*^9}, {
   3.951403700615758*^9, 3.951403717535774*^9}, {3.951403747705675*^9, 
   3.9514037707715807`*^9}, {3.951403809303505*^9, 3.951403881556388*^9}, {
   3.95140392951201*^9, 3.951403982285039*^9}, {3.9514040590122957`*^9, 
   3.951404066833372*^9}, {3.951404103080619*^9, 3.9514041049438047`*^9}, {
   3.951404143872933*^9, 3.951404187971902*^9}, {3.951404230866027*^9, 
   3.95140423100911*^9}, {3.951404327108955*^9, 3.951404329895906*^9}, {
   3.951404373372798*^9, 3.9514043811221857`*^9}, {3.951404457553458*^9, 
   3.951404465489089*^9}, {3.951404541312327*^9, 3.951404573287993*^9}, {
   3.951404624209559*^9, 3.951404625792548*^9}, {3.9514047733797626`*^9, 
   3.9514048380042477`*^9}, {3.951404945632966*^9, 3.9514049572117357`*^9}, {
   3.951405004423559*^9, 3.9514050267765093`*^9}, {3.9514054067296352`*^9, 
   3.951405415524302*^9}, {3.951405492615225*^9, 3.9514055448832073`*^9}, 
   3.9514055978539743`*^9, {3.951405646785591*^9, 3.951405660728508*^9}, {
   3.951405803062999*^9, 3.951405843462223*^9}, {3.9514060518425922`*^9, 
   3.951406104813551*^9}, {3.951406461390197*^9, 3.951406472003701*^9}, {
   3.9514068373036413`*^9, 3.951407074803554*^9}, {3.951407148577457*^9, 
   3.951407266800992*^9}, {3.951407400665495*^9, 3.951407402585394*^9}, {
   3.951450594970147*^9, 3.951450597225257*^9}, 3.951453488533142*^9, {
   3.951453538574828*^9, 3.951453538757429*^9}, {3.951463411222402*^9, 
   3.951463422012706*^9}, {3.951463553540258*^9, 3.9514636541449947`*^9}, {
   3.951463693648436*^9, 3.9514637078400097`*^9}, {3.951463778032241*^9, 
   3.9514642332885227`*^9}, {3.9514643220348177`*^9, 3.951464345845759*^9}, {
   3.951464881604883*^9, 3.9514648907840567`*^9}, 3.951465245001766*^9, {
   3.9514653087934837`*^9, 3.951465351209014*^9}, {3.951465492886239*^9, 
   3.951465573105558*^9}, 3.9514657353378687`*^9, {3.951465786869337*^9, 
   3.951465820343186*^9}, {3.951468218861102*^9, 3.951468223464347*^9}, {
   3.9514705595865583`*^9, 3.951470576658926*^9}, 3.951536872135887*^9, {
   3.951539352962751*^9, 3.951539532791051*^9}, {3.951539596815919*^9, 
   3.9515396369713297`*^9}, {3.951545090594051*^9, 3.951545139316093*^9}, {
   3.951545177597178*^9, 3.951545193108345*^9}, 3.951545238988607*^9, {
   3.951545307416244*^9, 3.9515453702135077`*^9}, 3.951629987477449*^9, {
   3.9516300422500477`*^9, 3.95163005068727*^9}, {3.951630094686998*^9, 
   3.951630099423037*^9}, {3.951630475842247*^9, 3.9516304894807873`*^9}, {
   3.9516305229798717`*^9, 3.951630524343293*^9}, {3.951630571579335*^9, 
   3.951630645934744*^9}, {3.951630725349186*^9, 3.9516307977985888`*^9}, 
   3.951630844377549*^9, {3.95163092941671*^9, 3.951630963407159*^9}, {
   3.95163103785326*^9, 3.9516310400326233`*^9}, {3.951642871477435*^9, 
   3.951643012063983*^9}, {3.9516432114377127`*^9, 3.951643285236279*^9}, {
   3.951643324765959*^9, 3.951643531406193*^9}, {3.951643591544984*^9, 
   3.9516436013376303`*^9}, {3.9516436347665586`*^9, 3.951643638573189*^9}, {
   3.951645188649561*^9, 3.951645195949748*^9}, {3.951647742323234*^9, 
   3.95164785561579*^9}, {3.951647887807033*^9, 3.951647907352118*^9}, {
   3.951649254364834*^9, 3.951649286703349*^9}, {3.951652284354485*^9, 
   3.951652290925743*^9}, {3.951652323706881*^9, 3.9516523716448097`*^9}, {
   3.9516524052250957`*^9, 3.951652500121785*^9}, {3.951652787226376*^9, 
   3.951652811247407*^9}, {3.951654378083905*^9, 3.951654456070427*^9}, 
   3.951660151240951*^9, {3.951660183863812*^9, 3.951660230012011*^9}, {
   3.951660312848188*^9, 3.9516603868401203`*^9}, 3.951660419173594*^9, {
   3.951660451552084*^9, 3.9516604670708733`*^9}, {3.951660497527368*^9, 
   3.951660550015317*^9}, {3.951674406125317*^9, 3.95167441206534*^9}, {
   3.951674475552209*^9, 3.951674523828455*^9}, {3.95167465555936*^9, 
   3.9516746566545763`*^9}, {3.951674715442371*^9, 3.9516748455702543`*^9}, {
   3.951674881354538*^9, 3.95167496844687*^9}, {3.951675027395653*^9, 
   3.951675107647696*^9}, {3.951675196527575*^9, 3.95167520763795*^9}, {
   3.951675259415392*^9, 3.951675262946023*^9}, {3.951675306530176*^9, 
   3.951675489138692*^9}, {3.9516755222545033`*^9, 3.951675618709741*^9}, {
   3.9516756509085093`*^9, 3.951675675661931*^9}, {3.951675723447097*^9, 
   3.951675792229846*^9}, {3.951675837049567*^9, 3.951675856791203*^9}, 
   3.951675958246091*^9},
 CellLabel->
  "In[1950]:=",ExpressionUUID->"6269ca75-778d-40ad-80f2-8a872a066ced"]
}, Closed]],

Cell[CellGroupData[{

Cell["Reduce FTerms and FEqs, fix Indices", "Subsection",
 CellChangeTimes->{{3.950867995958111*^9, 3.9508679992839813`*^9}, {
  3.951108367695386*^9, 3.9511083702282677`*^9}, {3.951108500371646*^9, 
  3.95110850408386*^9}},ExpressionUUID->"e5244ec3-f22c-466c-9873-\
92eb903637b0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Given", " ", "a", " ", "user"}], "-", 
     RowBox[{
     "defined", " ", "term", " ", "or", " ", "master", " ", "equation"}]}], 
    ",", " ", 
    RowBox[{"give", " ", "all", " ", 
     RowBox[{"(", "closed", ")"}], " ", "indices", " ", "unique", " ", 
     RowBox[{"names", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"FixIndices", "[", 
     RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
       "indices", ",", "newIndices", ",", "replacements", ",", 
        "indexedObjects", ",", "\[IndentingNewLine]", 
        RowBox[{"ret", "=", "expr"}]}], "\[IndentingNewLine]", "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Indices", " ", "should", " ", "be", " ", "fixed", " ", "on", " ", 
          "a", " ", "per"}], "-", 
         RowBox[{
         "term", " ", "basis", " ", "to", " ", "ensure", " ", "we", " ", "do",
           " ", "not", " ", "mess", " ", "up", " ", "things"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FEqQ", "[", "ret", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Return", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"FixIndices", "[", 
              RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", "ret"}], "]"}],
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FTermQ", "[", "ret", "]"}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"First", ",", " ", 
           RowBox[{
            RowBox[{
            "take", " ", "care", " ", "of", " ", "nested", " ", "sub"}], "-", 
            "terms"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ret", "=", 
           RowBox[{"FTerm", "@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"List", "@@", "ret"}], ")"}], "/.", 
              RowBox[{
               RowBox[{"FTerm", "[", "a__", "]"}], ":>", 
               RowBox[{"FixIndices", "[", 
                RowBox[{"setup", ",", 
                 RowBox[{"FTerm", "[", "a", "]"}]}], "]"}]}]}], ")"}]}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Now", " ", "check", " ", "if", " ", "everything", " ", "is", " ", 
            "alright"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "@", 
             RowBox[{"SuperIndicesValid", "[", 
              RowBox[{"setup", ",", "ret"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<Invalid superindices: \>\"", ",", "ret"}], "]"}], 
             ";", 
             RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"indices", "=", 
           RowBox[{"GetClosedSuperIndices", "[", 
            RowBox[{"setup", ",", "ret"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"newIndices", "=", 
           RowBox[{"Map", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Unique", "[", "\[IndentingNewLine]", 
               RowBox[{"StringReplace", "[", 
                RowBox[{
                 RowBox[{"ToString", "[", "#", "]"}], ",", 
                 RowBox[{
                  RowBox[{"i", ":", 
                   RowBox[{"DigitCharacter", ".."}]}], ":>", "\"\<\>\""}]}], 
                "]"}], "\[IndentingNewLine]", "]"}], "&"}], ",", 
             "\[IndentingNewLine]", "indices"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"replacements", "=", 
           RowBox[{"Thread", "[", 
            RowBox[{"indices", "->", "newIndices"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"ret", "/.", "replacements"}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<Expression \\\"\>\"", ",", "expr", ",", 
         "\"\<\\\" is neither a term nor a master equation!\>\""}], "]"}], 
       ";", 
       RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950861714841454*^9, 3.950861755216401*^9}, {
   3.950862487948318*^9, 3.950862798308673*^9}, {3.950862895840537*^9, 
   3.9508630357163677`*^9}, {3.9508724419777927`*^9, 
   3.9508724466302547`*^9}, {3.950872529157947*^9, 3.9508725448503036`*^9}, {
   3.9508725902304573`*^9, 3.950872613199347*^9}, {3.950872648512635*^9, 
   3.950872688616452*^9}, 3.950874347073372*^9, {3.950964034760331*^9, 
   3.950964062155575*^9}, {3.950964146531177*^9, 3.95096414932693*^9}, {
   3.950964196491962*^9, 3.950964291440217*^9}, {3.9510571582595263`*^9, 
   3.9510571726616507`*^9}, {3.95105728303815*^9, 3.951057297698251*^9}, {
   3.951106831163007*^9, 3.951106891415176*^9}, {3.951107069173294*^9, 
   3.951107093464375*^9}, {3.951107127992262*^9, 3.9511071448735332`*^9}, 
   3.951107181155599*^9, {3.9512004831787*^9, 3.951200640317047*^9}, {
   3.9512006715440273`*^9, 3.9512006882442102`*^9}, {3.95120072501525*^9, 
   3.95120073073527*^9}, {3.9512007738520927`*^9, 3.9512007765353394`*^9}, 
   3.951200836520123*^9, {3.951200877343849*^9, 3.951200929974958*^9}, {
   3.95120098569306*^9, 3.951201005326355*^9}, {3.951201043734188*^9, 
   3.951201076755189*^9}, {3.951201114535118*^9, 3.951201142462575*^9}, {
   3.9512873792240334`*^9, 3.951287432812272*^9}, {3.9512876999094963`*^9, 
   3.951287703906385*^9}, 3.9512877776883593`*^9},
 CellLabel->
  "In[132]:=",ExpressionUUID->"3500ee75-7244-4321-ae5e-82e6897e10d7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FDOp", "::", "cannotProcess"}], "=", 
   "\"\<The FDOp in `1` cannot be processed. Please expand the term \
first\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FDOpCount", "[", "expr_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"expr", "//.", 
       RowBox[{
        RowBox[{
         RowBox[{"Power", "[", 
          RowBox[{
           RowBox[{"FDOp", "[", "a__", "]"}], ",", "n_Integer"}], "]"}], "/;", 
         RowBox[{"n", "<", "0"}]}], ":>", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"FDOp", "::", "cannotProcess"}], ",", "expr"}], "]"}], 
          ";", 
          RowBox[{"Abort", "[", "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"expr", "//.", 
        RowBox[{
         RowBox[{"Power", "[", 
          RowBox[{
           RowBox[{"FDOp", "[", "a__", "]"}], ",", "n_Integer"}], "]"}], ":>", 
         RowBox[{"NonCommutativeMultiply", "@@", 
          RowBox[{"(", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"FDOp", "[", "a", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}], ")"}]}]}]}], 
       "//", 
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{"{", "#", "}"}], ",", 
          RowBox[{"FDOp", "[", "___", "]"}], ",", "Infinity"}], "]"}], 
        "&"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951282331983509*^9, 3.951282593647258*^9}, {
  3.951282798787737*^9, 3.951282799895976*^9}, {3.951283469783621*^9, 
  3.951283582313293*^9}},
 CellLabel->
  "In[133]:=",ExpressionUUID->"ec93a3ae-c758-4d49-9ec4-9c2ae2983898"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "::", "GrassmannCountError"}], "=", 
   "\"\<The factor `1` has multiple Grassmanns in a single factor.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FTerm", "::", "FDOpCountError"}], "=", 
    "\"\<The factor `1` has multiple FDOps in a single factor.\>\""}], ";", 
   RowBox[{
    RowBox[{"FTerm", "::", "GrassmannOpen"}], "=", 
    "\"\<The factor `1` has open Grassmann factors.\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Simplify", " ", "a", " ", "term", " ", "appearing", " ", "in", " ", "an",
      " ", 
     RowBox[{"equation", ".", " ", "Try"}], " ", "to", " ", "merge", " ", 
     "as", " ", "many", " ", "factors", " ", "as", " ", "possible"}], ",", 
    " ", 
    RowBox[{
    "while", " ", "not", " ", "changing", " ", "the", " ", "Grassmann", " ", 
     "structure", " ", "of", " ", "the", " ", 
     RowBox[{"term", "."}]}]}], "\[IndentingNewLine]", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReduceFTerm", "[", 
    RowBox[{"setup_", ",", "term_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"reduced", "=", 
        RowBox[{"List", "@@", "term"}]}], ",", "\[IndentingNewLine]", 
       "mergeGrassmanFactors", ",", "\[IndentingNewLine]", "curRedIg", ",", 
       "nextRedIg", ",", "curGCount", ",", "nextGCount", ",", 
       "\[IndentingNewLine]", "i", ",", "ignore"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AssertFTerm", "[", "term", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Reduce", " ", "nested", " ", "FTerms", " ", "and", " ", "such", " ", 
        "first"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"reduced", "/.", 
        RowBox[{
         RowBox[{"FEq", "[", "a__", "]"}], ":>", 
         RowBox[{"ReduceFEq", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"FEq", "[", "a", "]"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"TODO", ":", " ", 
        RowBox[{
        "find", " ", "a", " ", "way", " ", "to", " ", "not", " ", "reduce", 
         " ", "terms", " ", "twice"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"reduced", "/.", 
        RowBox[{
         RowBox[{"FTerm", "[", "a__", "]"}], ":>", 
         RowBox[{"ReduceFTerm", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"FTerm", "[", "a", "]"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"TODO", ":", " ", 
        RowBox[{
         RowBox[{
         "Ensure", " ", "that", " ", "nested", " ", "terms", " ", "are", " ", 
          "Grassmann"}], "-", "neutral"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"reduced", "/.", 
       RowBox[{
        RowBox[{"FTerm", "[", "a__", "]"}], ":>", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{"GrassmannCount", "[", 
              RowBox[{"setup", ",", 
               RowBox[{"FTerm", "[", "a", "]"}]}], "]"}], ",", "2"}], "]"}], "=!=",
            "0"}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"FTerm", "::", "GrassmannOpen"}], ",", 
             RowBox[{"FTerm", "[", "a", "]"}]}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Merge", " ", "scalar", " ", "terms", " ", "with", " ", "the", " ", 
         "closest", " ", "Grassman", " ", 
         RowBox[{"term", ".", " ", "We"}], " ", "need", " ", "to", " ", 
         "\"\<vanish\>\"", " ", "nested", " ", "FTerms"}], ",", " ", 
        RowBox[{
        "to", " ", "make", " ", "sure", " ", "we", " ", "do", " ", "not", " ", 
         RowBox[{"overcount", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"i", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"i", "<", 
         RowBox[{"Length", "[", "reduced", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"curRedIg", "=", 
          RowBox[{
           RowBox[{"reduced", "[", 
            RowBox[{"[", 
             RowBox[{"-", "i"}], "]"}], "]"}], "/.", 
           RowBox[{
            RowBox[{"FTerm", "[", "__", "]"}], ":>", "ignore"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"nextRedIg", "=", 
          RowBox[{
           RowBox[{"reduced", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"-", "i"}], "-", "1"}], "]"}], "]"}], "//.", 
           RowBox[{
            RowBox[{"FTerm", "[", "__", "]"}], ":>", "1"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"curGCount", "=", 
          RowBox[{"GrassmannCount", "[", 
           RowBox[{"setup", ",", "curRedIg"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"nextGCount", "=", 
          RowBox[{"GrassmannCount", "[", 
           RowBox[{"setup", ",", "nextRedIg"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"FDOpCount", "[", "curRedIg", "]"}], ">", "1"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Message", "[", 
             RowBox[{
              RowBox[{"FTerm", "::", "FDOpCountError"}], ",", "curRedIg"}], 
             "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"curGCount", ">", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Message", "[", 
             RowBox[{
              RowBox[{"FTerm", "::", "GrassmannCountError"}], ",", 
              RowBox[{"reduced", "[", 
               RowBox[{"[", 
                RowBox[{"-", "i"}], "]"}], "]"}]}], "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"curGCount", "==", "0"}], "||", 
              RowBox[{"nextGCount", "==", "0"}]}], ")"}], "&&", 
            "\[IndentingNewLine]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"FDOpCount", "[", "curRedIg", "]"}], "==", "0"}], "&&", 
              RowBox[{
               RowBox[{"FDOpCount", "[", "nextRedIg", "]"}], "==", "0"}]}], 
             ")"}], "&&", "\[IndentingNewLine]", 
            RowBox[{"(", 
             RowBox[{"And", "@@", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"curRedIg", ",", "#", ",", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "5"}], "}"}]}], "]"}], "&"}], ",", 
                "$OrderedObjects"}], "]"}]}], ")"}], "&&", 
            "\[IndentingNewLine]", 
            RowBox[{"(", 
             RowBox[{"And", "@@", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"nextRedIg", ",", "#", ",", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "5"}], "}"}]}], "]"}], "&"}], ",", 
                "$OrderedObjects"}], "]"}]}], ")"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"reduced", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"reduced", "[", 
               RowBox[{"[", 
                RowBox[{";;", 
                 RowBox[{
                  RowBox[{"-", "i"}], "-", "2"}]}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"reduced", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"-", "i"}], "-", "1"}], "]"}], "]"}], "*", 
                RowBox[{"reduced", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "i"}], "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"reduced", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "i"}], "+", "1"}], ";;"}], "]"}], "]"}]}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"i", "++"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FDOpCount", "[", 
          RowBox[{
           RowBox[{"reduced", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "//.", 
           RowBox[{
            RowBox[{"FTerm", "[", "__", "]"}], ":>", "1"}]}], "]"}], ">", 
         "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"FTerm", "::", "FDOpCountError"}], ",", 
           RowBox[{"reduced", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"GrassmannCount", "[", 
          RowBox[{"setup", ",", 
           RowBox[{
            RowBox[{"reduced", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "//.", 
            RowBox[{
             RowBox[{"FTerm", "[", "__", "]"}], ":>", "1"}]}]}], "]"}], ">", 
         "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"FTerm", "::", "GrassmannCountError"}], ",", 
           RowBox[{"reduced", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"OrderFields", "[", 
        RowBox[{"setup", ",", "reduced"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"FTerm", "@@", "reduced"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.950868021337243*^9, 3.950868021665371*^9}, {
   3.95086835724666*^9, 3.9508683710297613`*^9}, 3.9508700517983923`*^9, 
   3.950870106727509*^9, {3.9508701471559877`*^9, 3.9508701622890987`*^9}, 
   3.950872629945331*^9, {3.9509518447947407`*^9, 3.950951851247134*^9}, {
   3.950952161983356*^9, 3.950952217083837*^9}, {3.950953229162822*^9, 
   3.950953297847208*^9}, {3.950953495548379*^9, 3.950953510434524*^9}, 
   3.950953659948514*^9, {3.9509537192506933`*^9, 3.9509537569466476`*^9}, 
   3.95095976117029*^9, {3.950960003047349*^9, 3.950960004176173*^9}, {
   3.9509615265046177`*^9, 3.950961540864068*^9}, {3.950963643675329*^9, 
   3.9509636614251423`*^9}, {3.950963711154449*^9, 3.950963717584083*^9}, {
   3.950963775682248*^9, 3.950963816155239*^9}, {3.950963860300707*^9, 
   3.950963929362384*^9}, {3.951107234846871*^9, 3.951107272579007*^9}, {
   3.951107477640152*^9, 3.951107555487331*^9}, {3.951107981249464*^9, 
   3.951108000501011*^9}, {3.951108345993602*^9, 3.9511083754220457`*^9}, {
   3.951108466123753*^9, 3.951108473001584*^9}, {3.951120018973323*^9, 
   3.951120141322135*^9}, {3.951120175696308*^9, 3.951120258293839*^9}, {
   3.9511993173301573`*^9, 3.951199386830797*^9}, {3.951199702330996*^9, 
   3.951199863935121*^9}, {3.951199941828017*^9, 3.951200206596088*^9}, {
   3.9512007873999853`*^9, 3.951200800152265*^9}, {3.951211180189704*^9, 
   3.9512112247413692`*^9}, {3.951211306550591*^9, 3.951211312108625*^9}, {
   3.9512817944598837`*^9, 3.951281852923716*^9}, {3.951282267880844*^9, 
   3.9512822700840063`*^9}, {3.95128232715619*^9, 3.951282327704615*^9}, {
   3.95128239842417*^9, 3.951282398833179*^9}, {3.95128262267912*^9, 
   3.9512826941777477`*^9}, {3.9512827249420967`*^9, 3.951282770800105*^9}, {
   3.9512828635885363`*^9, 3.951282875043973*^9}, {3.9512829247327137`*^9, 
   3.951283058689929*^9}, {3.951283170556365*^9, 3.951283180253006*^9}, {
   3.951283286916153*^9, 3.95128336262862*^9}, {3.951287326417925*^9, 
   3.9512873368029137`*^9}, {3.951556421546236*^9, 3.951556480862215*^9}, {
   3.9515565375649977`*^9, 3.951556538880261*^9}, {3.951556576440703*^9, 
   3.951556606646467*^9}, {3.951556683541423*^9, 3.9515567087531*^9}, {
   3.9516546319185677`*^9, 3.9516546488908587`*^9}, 3.9516738679645357`*^9, {
   3.951673900413027*^9, 3.951674055156665*^9}, {3.9516740908284883`*^9, 
   3.95167419029653*^9}, {3.951674230097343*^9, 3.951674248312952*^9}, {
   3.951674315080954*^9, 3.951674332117297*^9}},
 CellLabel->
  "In[1277]:=",ExpressionUUID->"c85cfa76-e8b5-439f-9ca0-f24e64c44725"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReduceFEq", "[", 
    RowBox[{"setup_", ",", "equation_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"reduced", "=", "equation"}], "}"}], ",", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AssertFEq", "[", "reduced", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Amend", " ", "the", " ", "index", " ", "structure"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{"FixIndices", "[", 
        RowBox[{"setup", ",", "reduced"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Make", " ", "sure", " ", "all", " ", "terms", " ", "are", " ", 
        "reduced"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"reduced", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"ReduceFTerm", "[", 
          RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", "reduced"}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "reduced", "]"}], ";"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.95087005673455*^9, 3.9508700859297953`*^9}, {
   3.95087011800534*^9, 3.950870131605879*^9}, {3.950870213341543*^9, 
   3.950870277473693*^9}, {3.950870399615657*^9, 3.950870405389082*^9}, {
   3.950870442661482*^9, 3.950870496553628*^9}, {3.950870560603696*^9, 
   3.95087057682275*^9}, {3.950870622601573*^9, 3.9508706298192472`*^9}, {
   3.950870882690217*^9, 3.950870893085442*^9}, {3.950872136372311*^9, 
   3.9508721384388733`*^9}, {3.95087218393355*^9, 3.950872184825736*^9}, {
   3.950872366461809*^9, 3.950872410282044*^9}, 3.9508726043827133`*^9, {
   3.950872638854124*^9, 3.9508726391619997`*^9}, 3.950874165123219*^9, {
   3.9508742127501917`*^9, 3.950874219718197*^9}, 3.9508742837279673`*^9, {
   3.950875436534375*^9, 3.9508754560376596`*^9}, {3.950953413239159*^9, 
   3.9509534267784367`*^9}, {3.950953462892211*^9, 3.950953463787467*^9}, 
   3.950953644035307*^9, {3.9509639545923243`*^9, 3.95096400898311*^9}, {
   3.951108380757312*^9, 3.951108460175194*^9}, {3.951200372211622*^9, 
   3.951200414587019*^9}, {3.951201152993251*^9, 3.951201155424082*^9}, {
   3.9512111606396103`*^9, 3.951211178344079*^9}, {3.9512113174774103`*^9, 
   3.951211319144833*^9}, {3.951287340601552*^9, 3.951287349949945*^9}, {
   3.9512876915578947`*^9, 3.951287692487217*^9}, {3.9512877897524633`*^9, 
   3.9512877927314177`*^9}, {3.951287940608549*^9, 3.951287983978196*^9}, 
   3.951288027197757*^9, {3.951655111961887*^9, 3.951655117245121*^9}, {
   3.951655261197077*^9, 3.951655267235133*^9}, {3.951655368630995*^9, 
   3.95165537114962*^9}},
 CellLabel->
  "In[1280]:=",ExpressionUUID->"52021b7e-bece-436c-b228-076b6c722055"]
}, Closed]],

Cell[CellGroupData[{

Cell["Power expansions", "Subsection",
 CellChangeTimes->{{3.9511983853072557`*^9, 
  3.951198388520007*^9}},ExpressionUUID->"82ef4885-2b2a-47d1-8963-\
133ee7a68a33"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FExpand", "[", 
    RowBox[{"setup_", ",", "expr_", ",", "order_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ret", "=", "expr"}], ",", "n", ",", "i"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ret", "=", 
       RowBox[{"ret", "//.", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_FTerm", ",", "b_"}], "]"}], "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"FDOp", "[", "__", "]"}]}], "]"}]}], ":>", 
         RowBox[{"FEq", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"SeriesCoefficient", "[", 
               RowBox[{
                RowBox[{"a", "^", "b"}], ",", 
                RowBox[{"{", 
                 RowBox[{"a", ",", "0", ",", "n"}], "}"}]}], "]"}], "**", 
              RowBox[{"NonCommutativeMultiply", "@@", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"FixIndices", "[", 
                  RowBox[{"setup", ",", "a"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ret", "=", 
       RowBox[{"ret", "//.", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_", ",", "b_FTerm"}], "]"}], "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"b", ",", 
            RowBox[{"FDOp", "[", "__", "]"}]}], "]"}]}], ":>", 
         RowBox[{"FEq", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"SeriesCoefficient", "[", 
               RowBox[{
                RowBox[{"a", "^", "b"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "0", ",", "n"}], "}"}]}], "]"}], "**", 
              RowBox[{"NonCommutativeMultiply", "@@", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"FixIndices", "[", 
                  RowBox[{"setup", ",", "b"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ret", "=", 
       RowBox[{"ret", "//.", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_FEq", ",", "b_"}], "]"}], "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"a", ",", 
            RowBox[{"FDOp", "[", "__", "]"}], ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], ":>", 
         RowBox[{"FEq", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"SeriesCoefficient", "[", 
               RowBox[{
                RowBox[{"a", "^", "b"}], ",", 
                RowBox[{"{", 
                 RowBox[{"a", ",", "0", ",", "n"}], "}"}]}], "]"}], "**", 
              RowBox[{"NonCommutativeMultiply", "@@", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"FixIndices", "[", 
                  RowBox[{"setup", ",", "a"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ret", "=", 
       RowBox[{"ret", "//.", 
        RowBox[{
         RowBox[{
          RowBox[{"Power", "[", 
           RowBox[{"a_", ",", "b_FEq"}], "]"}], "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"b", ",", 
            RowBox[{"FDOp", "[", "__", "]"}], ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], ":>", 
         RowBox[{"FEq", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"SeriesCoefficient", "[", 
               RowBox[{
                RowBox[{"a", "^", "b"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "0", ",", "n"}], "}"}]}], "]"}], "**", 
              RowBox[{"NonCommutativeMultiply", "@@", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"FixIndices", "[", 
                  RowBox[{"setup", ",", "b"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}]}]}], 
      ";", "\[IndentingNewLine]", "ret"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951198400665941*^9, 3.951198539982102*^9}, {
   3.95119858122998*^9, 3.951198629997539*^9}, {3.951198840630013*^9, 
   3.951199103563139*^9}, {3.951199144182513*^9, 3.951199153264168*^9}, {
   3.951285293951795*^9, 3.951285618155931*^9}, {3.951285751815961*^9, 
   3.951285790905162*^9}, {3.951286919623252*^9, 3.9512869715228977`*^9}, 
   3.951287309293539*^9, 3.951288307317803*^9, {3.9516530159869947`*^9, 
   3.9516530360188017`*^9}, {3.951653186149702*^9, 3.951653186357724*^9}, {
   3.951653220973399*^9, 3.9516532416021643`*^9}, {3.951654064705368*^9, 
   3.951654085161626*^9}, {3.9516541771096573`*^9, 3.951654210069656*^9}, {
   3.9516542444262247`*^9, 3.951654340800949*^9}, {3.951654478814649*^9, 
   3.9516545016107597`*^9}},
 CellLabel->
  "In[2228]:=",ExpressionUUID->"c5f93900-11a5-40d3-92c2-259b2094122d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DExpand", "[", 
    RowBox[{"setup_", ",", "expr_", ",", "order_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ret", "=", "expr"}], ",", "n", ",", "i"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "We", " ", "need", " ", "to", " ", "block", " ", "the", " ", "FDOp", 
       " ", "definitions", " ", "to", " ", "use", " ", "SeriesCoefficient", 
       " ", "with", " ", "FDOp"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "FDOp", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ret", "=", 
          RowBox[{"ret", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"Power", "[", 
              RowBox[{"a_FTerm", ",", "b_"}], "]"}], "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", "a", "}"}], ",", 
               RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}]}], ":>", 
            RowBox[{"FEq", "@@", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"SeriesCoefficient", "[", 
                  RowBox[{
                   RowBox[{"a", "^", "b"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"a", ",", "0", ",", "n"}], "}"}]}], "]"}], "**", 
                 RowBox[{"NonCommutativeMultiply", "@@", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"FixIndices", "[", 
                    RowBox[{"setup", ",", "a"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
                "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}]}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"ret", "=", 
          RowBox[{"ret", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"Power", "[", 
              RowBox[{"a_", ",", "b_FTerm"}], "]"}], "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", "b", "}"}], ",", 
               RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}]}], ":>", 
            RowBox[{"FEq", "@@", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"SeriesCoefficient", "[", 
                  RowBox[{
                   RowBox[{"a", "^", "b"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"b", ",", "0", ",", "n"}], "}"}]}], "]"}], "**", 
                 RowBox[{"NonCommutativeMultiply", "@@", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"FixIndices", "[", 
                    RowBox[{"setup", ",", "b"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
                "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}]}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"ret", "=", 
          RowBox[{"ret", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"Power", "[", 
              RowBox[{"a_FEq", ",", "b_"}], "]"}], "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", "a", "}"}], ",", 
               RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}]}], ":>", 
            RowBox[{"FEq", "@@", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"SeriesCoefficient", "[", 
                  RowBox[{
                   RowBox[{"a", "^", "b"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"a", ",", "0", ",", "n"}], "}"}]}], "]"}], "**", 
                 RowBox[{"NonCommutativeMultiply", "@@", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"FixIndices", "[", 
                    RowBox[{"setup", ",", "a"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
                "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}]}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"ret", "=", 
          RowBox[{"ret", "//.", 
           RowBox[{
            RowBox[{
             RowBox[{"Power", "[", 
              RowBox[{"a_", ",", "b_FEq"}], "]"}], "/;", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", "b", "}"}], ",", 
               RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}]}], ":>", 
            RowBox[{"FEq", "@@", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"FTerm", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"SeriesCoefficient", "[", 
                  RowBox[{
                   RowBox[{"a", "^", "b"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"b", ",", "0", ",", "n"}], "}"}]}], "]"}], "**", 
                 RowBox[{"NonCommutativeMultiply", "@@", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"FixIndices", "[", 
                    RowBox[{"setup", ",", "b"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
                "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "order"}], "}"}]}], "]"}]}]}]}]}],
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "ret"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9512858144958143`*^9, 3.951285815620013*^9}, {
   3.951286835188345*^9, 3.9512868784211693`*^9}, {3.951286911623101*^9, 
   3.951286917760015*^9}, {3.95128697645728*^9, 3.951287305262067*^9}, {
   3.95165408960608*^9, 3.95165409716168*^9}, {3.951654823391261*^9, 
   3.951655051402672*^9}, 3.9516551499632673`*^9},
 CellLabel->
  "In[2331]:=",ExpressionUUID->"c8e3186f-3d3b-492c-8b02-56053c948bd0"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Derivative Algorithm", "Section",
 CellChangeTimes->{{3.932177970725307*^9, 3.9321779720559883`*^9}, {
  3.9508509057472887`*^9, 3.950850909097567*^9}, {3.951656809676903*^9, 
  3.951656812953093*^9}},ExpressionUUID->"be19843a-e765-47f1-9747-\
2d6834a73a9e"],

Cell[CellGroupData[{

Cell["Resolve a single FDOp", "Subsection",
 CellChangeTimes->{{3.9512328702638407`*^9, 
  3.951232879465557*^9}},ExpressionUUID->"e3f3669e-621b-4b13-b56e-\
3deed41d0aba"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ResolveFDOp", "::", "nested"}], "=", 
    "\"\<The given term contains nested FDOp. Before proceeding, you need to \
expand these with DExpand. \nError in `1`\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$t", "=", 
    RowBox[{"{", 
     RowBox[{
     "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
     "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Resolve", " ", "a", " ", "single", " ", "occurence", " ", "of", " ", 
    "FDOp"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ResolveFDOp", "[", 
    RowBox[{"setup_", ",", "feq_FEq"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Return", "[", 
       RowBox[{"FEq", "@@", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ResolveFDOp", "[", 
            RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
          RowBox[{"List", "@@", "feq"}]}], "]"}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ResolveFDOp", "[", 
    RowBox[{"setup_", ",", "term_FTerm"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"rTerm", "=", "term"}], ",", "\[IndentingNewLine]", "FDOpPos", 
       ",", "\[IndentingNewLine]", "termsNoFDOp", ",", "dF", ",", 
       "\[IndentingNewLine]", "idx", ",", "i", ",", "obj", ",", "ind", ",", 
       "a", ",", "\[IndentingNewLine]", "dTerms", ",", "nPre", ",", "nPost", 
       ",", "ret", ",", "cTerm", ",", "doFields", ",", "\[IndentingNewLine]", 
       
       RowBox[{"$s", "=", 
        RowBox[{"{", 
         RowBox[{
         "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",",
           "0"}], "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "We", " ", "cannot", " ", "proceed", " ", "if", " ", "any", " ", 
       "nested", " ", "FDOp", " ", "are", " ", "present"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", "@@", "rTerm"}], ")"}], ",", 
          RowBox[{"FTerm", "[", 
           RowBox[{"pre___", ",", 
            RowBox[{"FDOp", "[", "__", "]"}], ",", "post___"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "5"}], "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"ResolveFDOp", "::", "nested"}], ",", "term"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "If", " ", "no", " ", "derivatives", " ", "are", " ", "present"}], 
        ",", " ", 
        RowBox[{"do", " ", "nothing"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{"rTerm", ",", 
          RowBox[{"FDOp", "[", "__", "]"}]}], "]"}], ",", 
        RowBox[{"Return", "[", "rTerm", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"FDOpPos", "=", 
       RowBox[{
        RowBox[{"Length", "[", "rTerm", "]"}], "-", 
        RowBox[{
         RowBox[{"FirstPosition", "[", 
          RowBox[{
           RowBox[{"Reverse", "@", 
            RowBox[{"(", 
             RowBox[{"List", "@@", "rTerm"}], ")"}]}], ",", 
           RowBox[{"FDOp", "[", "_", "]"}]}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"termsNoFDOp", "=", 
       RowBox[{
        RowBox[{"rTerm", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", 
           RowBox[{"FDOpPos", "-", "1"}]}], "]"}], "]"}], "**", 
        RowBox[{"rTerm", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"FDOpPos", "+", "1"}], ";;"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "If", " ", "the", " ", "derivative", " ", "operator", " ", "is", " ", 
         "trailing"}], ",", " ", 
        RowBox[{"simply", " ", "remove", " ", "it"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FDOpPos", ">=", 
         RowBox[{"Length", "[", "rTerm", "]"}]}], ",", 
        RowBox[{"Return", "[", "termsNoFDOp", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"dF", "=", 
       RowBox[{"rTerm", "[", 
        RowBox[{"[", 
         RowBox[{"FDOpPos", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Perform", " ", "the", " ", "product", " ", "rule"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"nPre", "=", 
       RowBox[{"FDOpPos", "-", "1"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nPost", "=", 
       RowBox[{
        RowBox[{"Length", "[", "rTerm", "]"}], "-", "FDOpPos"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"commuting", " ", "it", " ", "past"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"cTerm", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"dTerms", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"idx", ",", "1", ",", "nPost"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"doFields", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "a__", "]"}], "&"}], "/@", 
           RowBox[{"GetAllFields", "[", "setup", "]"}]}], ")"}], "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{
              RowBox[{"{", "#", "}"}], ",", 
              RowBox[{"{", "a", "}"}]}], "]"}], "&"}], "/@", 
           RowBox[{"GetAllFields", "[", "setup", "]"}]}], ")"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"dTerms", "[", 
           RowBox[{"[", "idx", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"termsNoFDOp", "[", 
            RowBox[{"[", 
             RowBox[{";;", 
              RowBox[{"nPre", "+", "idx", "-", "1"}]}], "]"}], "]"}], "**", 
           RowBox[{"FTerm", "[", 
            RowBox[{"cTerm", "*", 
             RowBox[{"FunctionalD", "[", 
              RowBox[{
               RowBox[{"termsNoFDOp", "[", 
                RowBox[{"[", 
                 RowBox[{"nPre", "+", "idx"}], "]"}], "]"}], ",", "dF"}], 
              "]"}]}], "]"}], "**", 
           RowBox[{"termsNoFDOp", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"nPre", "+", "idx", "+", "1"}], ";;"}], "]"}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"obj", "=", 
          RowBox[{"ExtractObjectsWithIndex", "[", 
           RowBox[{"setup", ",", 
            RowBox[{"FTerm", "[", 
             RowBox[{"termsNoFDOp", "[", 
              RowBox[{"[", 
               RowBox[{"nPre", "+", "idx"}], "]"}], "]"}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"obj", "=", 
          RowBox[{"Select", "[", 
           RowBox[{"obj", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{"$OrderedObjects", ",", 
                RowBox[{"Head", "[", "#", "]"}]}], "]"}], "||", 
              RowBox[{"MatchQ", "[", 
               RowBox[{"#", ",", 
                RowBox[{"_Symbol", "[", "_", "]"}]}], "]"}]}], "&"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"obj", "=", 
          RowBox[{"obj", "/.", "doFields"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Commuting", " ", "the", " ", "next", " ", "derivative", " ", 
           "past", " ", "the", " ", "objects", " ", "in", " ", "the", " ", 
           "current", " ", "part"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"cTerm", "=", 
          RowBox[{"cTerm", "*", 
           RowBox[{"Times", "@@", 
            RowBox[{"Map", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"FMinus", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Head", "[", "dF", "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"dF", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], "&"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"obj", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], ",", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"obj", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], 
               "]"}]}], "\[IndentingNewLine]", "]"}]}]}]}], ";"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"idx", ",", "1", ",", "nPost"}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"ReduceFEq", "[", 
        RowBox[{"setup", ",", 
         RowBox[{"FEq", "@@", "dTerms"}]}], "]"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9511105533495092`*^9, 3.9511105648525476`*^9}, {
   3.951119455805057*^9, 3.9511195617211657`*^9}, {3.951119676282247*^9, 
   3.951119712474145*^9}, {3.951119753961474*^9, 3.951119965018001*^9}, {
   3.951120276792581*^9, 3.9511205887782927`*^9}, {3.951120670947592*^9, 
   3.951120778348651*^9}, {3.951120826438107*^9, 3.951120906614008*^9}, {
   3.951120939999701*^9, 3.951120956314575*^9}, {3.951121009242169*^9, 
   3.951121081510736*^9}, {3.951121127768268*^9, 3.951121329433323*^9}, {
   3.951121359899194*^9, 3.951121425034974*^9}, {3.9511224825381813`*^9, 
   3.951122501258943*^9}, {3.951123573189911*^9, 3.951123598725543*^9}, {
   3.951123637357983*^9, 3.9511238544580727`*^9}, {3.951123926802017*^9, 
   3.9511240059898977`*^9}, {3.9511240423102016`*^9, 3.951124131010861*^9}, {
   3.9511241648535767`*^9, 3.951124227324479*^9}, {3.951199174459216*^9, 
   3.951199180926196*^9}, {3.951200228052285*^9, 3.951200273018259*^9}, {
   3.951200422144641*^9, 3.951200425300118*^9}, 3.95120094844139*^9, {
   3.9512011642699833`*^9, 3.951201182694016*^9}, 3.951201274960949*^9, {
   3.9512015178111143`*^9, 3.951201562510607*^9}, {3.9512095086440887`*^9, 
   3.951209512939533*^9}, {3.951209684117496*^9, 3.951209732155652*^9}, {
   3.95120994522215*^9, 3.951209973936924*^9}, {3.9512110641082573`*^9, 
   3.95121111673773*^9}, 3.951211153997551*^9, {3.951211324253121*^9, 
   3.951211350271022*^9}, {3.951211627960374*^9, 3.951211709649838*^9}, {
   3.951554270407613*^9, 3.9515543172958727`*^9}, {3.951554353683715*^9, 
   3.9515543571516438`*^9}, {3.951554390063912*^9, 3.95155442648804*^9}, {
   3.951554479927786*^9, 3.951554491104567*^9}, {3.951554577191679*^9, 
   3.951554682156026*^9}, {3.951554745693006*^9, 3.951554885172686*^9}, {
   3.9515550214845552`*^9, 3.951555134864365*^9}, {3.951555171525795*^9, 
   3.9515552398713923`*^9}, 3.951555271689843*^9, {3.951555429992437*^9, 
   3.9515554423098392`*^9}, {3.9515554953921432`*^9, 3.951555535260868*^9}, {
   3.951555631985165*^9, 3.951555680324315*^9}, {3.951555732356125*^9, 
   3.951555740448552*^9}, {3.9515559107526197`*^9, 3.951555982780271*^9}, {
   3.951556033434119*^9, 3.951556068268579*^9}, {3.951556300906303*^9, 
   3.951556354083226*^9}, {3.951556759558256*^9, 3.9515569383356667`*^9}, {
   3.9515569690496902`*^9, 3.951556990639743*^9}, {3.95155702991029*^9, 
   3.951557035044469*^9}, {3.951557087065571*^9, 3.951557189832995*^9}, {
   3.9515721288653107`*^9, 3.951572139090004*^9}, {3.9515721799124823`*^9, 
   3.951572186940419*^9}, {3.951572296417548*^9, 3.951572332732402*^9}, {
   3.951572537139773*^9, 3.951572555755011*^9}, {3.951572669076455*^9, 
   3.95157273622784*^9}, {3.9515733148247757`*^9, 3.9515733223819513`*^9}, 
   3.951576003068783*^9, {3.951576229636738*^9, 3.951576238257304*^9}, {
   3.951576399472459*^9, 3.951576401784259*^9}, 3.951576570484728*^9, {
   3.951579640477127*^9, 3.9515796425726013`*^9}, {3.951654515015482*^9, 
   3.951654612033938*^9}, {3.9516546605474043`*^9, 3.9516548092993393`*^9}, {
   3.951654940150385*^9, 3.951654944419076*^9}, {3.951655136406476*^9, 
   3.951655193430708*^9}, {3.9516553807236433`*^9, 3.951655409397307*^9}, {
   3.9516554470218353`*^9, 3.951655478657302*^9}, {3.951655636530851*^9, 
   3.9516556576345654`*^9}, {3.951655902658242*^9, 3.951655935490138*^9}, {
   3.951655975391508*^9, 3.951655978362204*^9}, {3.9516562068028*^9, 
   3.951656218715858*^9}, {3.951656433495823*^9, 3.951656588399023*^9}, {
   3.9516641293553343`*^9, 3.9516643845117083`*^9}, {3.951668511693247*^9, 
   3.951668541668885*^9}, {3.951668624775524*^9, 3.951668682424408*^9}, {
   3.951668767769783*^9, 3.9516687901920853`*^9}, {3.951668868221581*^9, 
   3.951668885460423*^9}, 3.951668927248369*^9, {3.951668972618066*^9, 
   3.95166898470336*^9}, {3.951669020141286*^9, 3.951669212620002*^9}, {
   3.9516733904730473`*^9, 3.951673459876316*^9}, {3.9516735169933853`*^9, 
   3.951673538680743*^9}, 3.951673591533083*^9, {3.95167363935734*^9, 
   3.9516736951408567`*^9}, {3.951673748904594*^9, 3.951673788536557*^9}},
 CellLabel->
  "In[1236]:=",ExpressionUUID->"ac348a0a-7a6e-409c-9a98-56e5170bdbb5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ResolveDerivatives", "::", "argument"}], "=", 
    "\"\<The given argument is neither an FTerm nor a FEq.\nThe argument was \
`1`\>\""}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "Iteratively", " ", "resolve", " ", "all", " ", "derivative", " ", 
    "operators", " ", "in", " ", "an", " ", "FTerm", " ", "or", " ", "FEq"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ResolveDerivatives", "[", 
    RowBox[{"setup_", ",", "expr_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ret", "=", "expr"}], ",", 
       RowBox[{"i", "=", "1"}], ",", "mmap"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{"ret", ",", 
          RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ReduceFEq", "[", 
          RowBox[{"setup", ",", 
           RowBox[{"FEq", "[", "ret", "]"}]}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FTermQ", "[", "ret", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"ret", ",", 
              RowBox[{"FDOp", "[", "__", "]"}], ",", "Infinity"}], "]"}], "&&", 
            RowBox[{"i", "<", "$MaxDerivativeIterations"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ret", "=", 
             RowBox[{"ResolveFDOp", "[", 
              RowBox[{"setup", ",", "ret"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"i", "++"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "ret", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FEqQ", "[", "ret", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"mmap", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{"Length", "/@", 
               RowBox[{"(", 
                RowBox[{"List", "@@", 
                 RowBox[{"FEq", "[", "expr", "]"}]}], ")"}]}], "]"}], ">", 
             "10"}], ",", "ParallelMap", ",", "Map"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{"FEq", "@@", 
           RowBox[{"mmap", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ResolveDerivatives", "[", 
               RowBox[{"setup", ",", "#"}], "]"}], "&"}], ",", 
             RowBox[{"List", "@@", "ret"}]}], "]"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ResolveDerivatives", "::", "argument"}], ",", "ret"}], "]"}],
       ";", 
      RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951109126796526*^9, 3.951109162803561*^9}, {
   3.951109195696103*^9, 3.9511092753420467`*^9}, {3.951109641851746*^9, 
   3.951109708704658*^9}, {3.951109745518846*^9, 3.951109820791531*^9}, {
   3.951119472303504*^9, 3.951119473407467*^9}, {3.951201291788858*^9, 
   3.9512015119676657`*^9}, {3.951201569206512*^9, 3.951201586086426*^9}, {
   3.951206148564587*^9, 3.951206211857237*^9}, {3.9512062440841913`*^9, 
   3.951206321742989*^9}, {3.951206368639289*^9, 3.951206475591106*^9}, 
   3.951207767500757*^9, 3.9512094609041777`*^9, {3.9512095311450663`*^9, 
   3.951209577983329*^9}, {3.951209618249853*^9, 3.951209633863234*^9}, {
   3.9512097690861053`*^9, 3.9512099352835913`*^9}, {3.951209996511508*^9, 
   3.9512100677197866`*^9}, {3.9512102840601892`*^9, 3.951210369806964*^9}, 
   3.95121047975072*^9, {3.951210516428762*^9, 3.951210536552635*^9}, {
   3.951211721416297*^9, 3.9512117303764887`*^9}, {3.951655195541295*^9, 
   3.951655197245261*^9}, {3.9516552921494617`*^9, 3.951655358300035*^9}, {
   3.951655498721773*^9, 3.9516555310614634`*^9}, {3.951655572781617*^9, 
   3.951655578062092*^9}, 3.951655626010347*^9, {3.9516734733361053`*^9, 
   3.951673477315565*^9}, {3.951673513096444*^9, 3.951673557839615*^9}, {
   3.9516736250920362`*^9, 3.9516736330237837`*^9}, {3.951673669368897*^9, 
   3.9516737311038322`*^9}, 3.951673834905052*^9},
 CellLabel->
  "In[1252]:=",ExpressionUUID->"b0835c23-2d69-40a7-9251-be3d8571a3bb"]
}, Closed]],

Cell[CellGroupData[{

Cell["Take several functional derivatives", "Subsection",
 CellChangeTimes->{{3.9508680530500927`*^9, 
  3.950868063045309*^9}},ExpressionUUID->"a8f64e7a-d885-45c2-99d7-\
7e2e4dc385f7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"OutputLevel", ",", "SuperIndexForm", ",", "FieldIndices"}], "]"}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "TakeDerivatives", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"OutputLevel", "->", "SuperIndexForm"}], "}"}]}], ";"}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.951227336083239*^9, 3.951227337862597*^9}, {
  3.951657124373287*^9, 
  3.951657128201294*^9}},ExpressionUUID->"bba04405-f573-40fc-9a19-\
18ca7de811ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Perform", " ", "multiple", " ", "functional", " ", "derivatives", " ", 
    "on", " ", "a", " ", "master", " ", 
    RowBox[{"equation", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"TakeDerivatives", "[", 
     RowBox[{"setup_", ",", "expr_", ",", "derivativeList_", ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "result", ",", "\[IndentingNewLine]", "externalIndexNames", ",", 
        "outputReplacements", ",", "\[IndentingNewLine]", 
        "derivativeListSIDX"}], "\[IndentingNewLine]", "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AssertFEq", "[", "expr", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"AssertDerivativeList", "[", 
        RowBox[{"setup", ",", "derivativeList"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"While", " ", "doing", " ", "the", " ", "derivatives"}], ",",
          " ", 
         RowBox[{
          RowBox[{"we", " ", "want", " ", "to", " ", "use", " ", "super"}], 
          "-", 
          RowBox[{"indices", ".", " ", "Afterwards"}]}], ",", " ", 
         RowBox[{
         "we", " ", "can", " ", "replace", " ", "these", " ", "again", " ", 
          "with", " ", "the", " ", "given", " ", "indices"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"externalIndexNames", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", "\"\<eI\>\"", "]"}], "&"}], ",", 
          "derivativeList"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"outputReplacements", "=", 
        RowBox[{"Thread", "[", 
         RowBox[{"externalIndexNames", "->", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "derivativeList"}], 
           "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"derivativeListSIDX", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", 
            RowBox[{"derivativeList", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "[", 
           RowBox[{"externalIndexNames", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "derivativeList", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "We", " ", "take", " ", "them", " ", "in", " ", "reverse", " ", 
         RowBox[{"order", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"derivativeListSIDX", "=", 
        RowBox[{"Reverse", "[", "derivativeListSIDX", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"First", ",", " ", 
         RowBox[{
         "fix", " ", "the", " ", "indices", " ", "in", " ", "the", " ", 
          "input", " ", "equation"}], ",", " ", 
         RowBox[{
          RowBox[{"i", ".", "e", ".", " ", "make"}], " ", "everything", " ", 
          "have", " ", "unique", " ", "names"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"result", "=", 
        RowBox[{"FixIndices", "[", 
         RowBox[{"setup", ",", "expr"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Perform", " ", "all", " ", "the", " ", "derivatives"}], ",",
          " ", 
         RowBox[{"one", " ", "after", " ", "the", " ", "other"}]}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"result", "=", 
          RowBox[{"ResolveDerivatives", "[", 
           RowBox[{"setup", ",", 
            RowBox[{
             RowBox[{"FTerm", "[", 
              RowBox[{"FDOp", "[", 
               RowBox[{"derivativeListSIDX", "[", 
                RowBox[{"[", "pass", "]"}], "]"}], "]"}], "]"}], "**", 
             "result"}]}], "]"}]}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"pass", ",", "1", ",", 
           RowBox[{"Length", "[", "derivativeList", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "OutputLevel", "]"}], "===", 
          "SuperIndexForm"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Return", "[", " ", 
           RowBox[{"{", 
            RowBox[{"result", ",", "outputReplacements"}], "}"}], "]"}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"result", "//.", "outputReplacements"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.95086807399784*^9, 3.950868101837797*^9}, {
   3.950868135961317*^9, 3.950868153423587*^9}, {3.950868228217888*^9, 
   3.950868269490148*^9}, {3.95086841046174*^9, 3.950868424387451*^9}, {
   3.950873786052535*^9, 3.950873787662897*^9}, {3.950874377585595*^9, 
   3.950874378821952*^9}, {3.950875285850876*^9, 3.950875301335219*^9}, {
   3.950875343786489*^9, 3.9508753492991743`*^9}, {3.9508754834989862`*^9, 
   3.950875487444517*^9}, {3.9508932689591846`*^9, 3.950893303250742*^9}, {
   3.950893467838776*^9, 3.950893530412135*^9}, {3.950951875092435*^9, 
   3.950951917051467*^9}, {3.950951969983094*^9, 3.950951982885131*^9}, {
   3.950953049415739*^9, 3.9509530566618147`*^9}, {3.9509576893692417`*^9, 
   3.950957693641984*^9}, {3.950957869930423*^9, 3.9509578703743134`*^9}, {
   3.951205890224668*^9, 3.951205922452134*^9}, {3.9512059655680513`*^9, 
   3.951205987956233*^9}, {3.9512060250926027`*^9, 3.951206037771141*^9}, {
   3.9512060757270203`*^9, 3.9512061056706333`*^9}, {3.951210129116617*^9, 
   3.951210160246964*^9}, {3.951210230711794*^9, 3.951210261583102*^9}, {
   3.951210487269314*^9, 3.9512104881636333`*^9}, 3.951210648908422*^9, {
   3.951210922739853*^9, 3.951210952732194*^9}, {3.9512110036490707`*^9, 
   3.9512110540158043`*^9}, {3.951211364096175*^9, 3.951211371087821*^9}, {
   3.9512114169092283`*^9, 3.951211492808696*^9}, {3.951211535712715*^9, 
   3.951211602095957*^9}, {3.951211800213296*^9, 3.951211815568632*^9}, {
   3.9512134241932383`*^9, 3.951213498323842*^9}, {3.9512273400034513`*^9, 
   3.9512273627572317`*^9}, {3.9512928826295767`*^9, 3.951292884973175*^9}, {
   3.951553596111763*^9, 3.951553597975439*^9}, {3.951577974616782*^9, 
   3.951577997840233*^9}},ExpressionUUID->"fcb7ecd2-adb3-4b5a-a94f-\
8080924ea319"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Common Equations", "Section",
 CellChangeTimes->{{3.932177970725307*^9, 3.9321779720559883`*^9}, {
  3.9508509057472887`*^9, 3.950850909097567*^9}, {3.951656809676903*^9, 
  3.9516568235330763`*^9}},ExpressionUUID->"90f35056-189d-45d1-a3e0-\
d11e3b29b6b0"],

Cell[CellGroupData[{

Cell["Classical Action", "Subsection",
 CellChangeTimes->{{3.9516568673930283`*^9, 
  3.951656869881184*^9}},ExpressionUUID->"516f3992-f5b4-416d-be0e-\
5487233f53ee"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Map", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "[", 
     RowBox[{"#", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}], ",", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"A", ",", "A"}], "}"}], ",", "indices"}], "}"}], "]"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.9516581168016167`*^9, 3.951658187105114*^9}, {
  3.951658283665946*^9, 3.9516583511293716`*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"3d81551a-873d-445b-8d96-800f1e87038d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"A", "[", "i138", "]"}], ",", 
   RowBox[{"A", "[", "i139", "]"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.951658125069186*^9, 3.9516581308152514`*^9}, {
  3.951658169251294*^9, 3.951658187508383*^9}, {3.951658289418908*^9, 
  3.9516583513991632`*^9}},
 CellLabel->"Out[92]=",ExpressionUUID->"c730b2d6-fda3-4443-b80f-3ce27773c5d4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"indices", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Unique", "[", "\"\<i\>\"", "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"A", ",", "A"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{
     RowBox[{"S", "[", 
      RowBox[{",", "indices"}], "]"}], ",", 
     RowBox[{"FTerm", "@@", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}], ",", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "##", "}"}], ",", "indices"}], "}"}], "]"}]}], 
       "]"}]}]}], "]"}], "&"}], "@@", 
  RowBox[{"{", 
   RowBox[{"A", ",", "A"}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.951657917765491*^9, 3.951657976801922*^9}, {
  3.9516580706934958`*^9, 3.951658107137442*^9}, {3.9516583953308897`*^9, 
  3.951658398641239*^9}, {3.9516584353138037`*^9, 
  3.951658462166409*^9}},ExpressionUUID->"d629366a-c937-4d3b-8e8a-\
d8b2225aff16"],

Cell[BoxData[
 RowBox[{"FTerm", "[", 
  RowBox[{
   RowBox[{"S", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"A", ",", "A"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i176", ",", "i177"}], "}"}]}], "]"}], ",", 
   RowBox[{"A", "[", "i176", "]"}], ",", 
   RowBox[{"A", "[", "i177", "]"}]}], "]"}]], "Output",
 CellChangeTimes->{{3.951657926753359*^9, 3.951657977315074*^9}, {
  3.951658082558222*^9, 3.951658107568151*^9}, {3.9516584381793747`*^9, 
  3.9516584505814667`*^9}},
 CellLabel->"Out[98]=",ExpressionUUID->"4c8a1f00-d397-42db-b4ea-715ed3b77f00"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MakeClassicalAction", "::", "noTruncation"}], "=", 
    "\"\<The given setup does not have a truncation for S!\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MakeClassicalAction", "[", "setup_", "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "indices", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AssertFSetup", "[", "setup", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{
          RowBox[{"Keys", "[", 
           RowBox[{"setup", "[", "\"\<Truncation\>\"", "]"}], "]"}], ",", 
          "S"}], "]"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"MakeClassicalAction", "::", "noTruncation"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"FEq", "@@", 
       RowBox[{"Map", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"indices", "=", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{"Unique", "[", "\"\<i\>\"", "]"}], ",", "#"}], "]"}]}],
             ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"FTerm", "[", 
              RowBox[{"S", "[", 
               RowBox[{"#", ",", "indices"}], "]"}], "]"}], "**", 
             RowBox[{"FTerm", "[", "]"}]}]}], "\[IndentingNewLine]", ")"}], 
          "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"OrderFieldList", "[", 
            RowBox[{"setup", ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{
           RowBox[{"setup", "[", "\"\<Truncation\>\"", "]"}], "[", "S", 
           "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"MakeClassicalAction", "[", "Setup", "]"}]}], "Input",
 CellChangeTimes->{{3.951656874186051*^9, 3.9516569648534317`*^9}, {
   3.951657444249391*^9, 3.95165758515733*^9}, 3.951657657918302*^9, {
   3.951657818617861*^9, 3.951657907021595*^9}, {3.951657993849848*^9, 
   3.951658060085636*^9}, 3.9516583621269407`*^9, {3.951658468822631*^9, 
   3.951658526029583*^9}},ExpressionUUID->"6223a3d7-3feb-49eb-92b1-\
6a73f7ae78a2"],

Cell[BoxData[
 RowBox[{"FEq", "[", 
  RowBox[{
   RowBox[{"FTerm", "[", 
    RowBox[{"S", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"A", ",", "A"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"i178", "[", "A", "]"}], ",", 
        RowBox[{"i178", "[", "A", "]"}]}], "}"}]}], "]"}], "]"}], ",", 
   RowBox[{"FTerm", "[", 
    RowBox[{"S", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"A", ",", "A", ",", "A"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"i179", "[", "A", "]"}], ",", 
        RowBox[{"i179", "[", "A", "]"}], ",", 
        RowBox[{"i179", "[", "A", "]"}]}], "}"}]}], "]"}], "]"}], ",", 
   RowBox[{"FTerm", "[", 
    RowBox[{"S", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"A", ",", "A", ",", "A", ",", "A"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"i180", "[", "A", "]"}], ",", 
        RowBox[{"i180", "[", "A", "]"}], ",", 
        RowBox[{"i180", "[", "A", "]"}], ",", 
        RowBox[{"i180", "[", "A", "]"}]}], "}"}]}], "]"}], "]"}], ",", 
   RowBox[{"FTerm", "[", 
    RowBox[{"S", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"c", ",", "cb"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"i181", "[", "c", "]"}], ",", 
        RowBox[{"i181", "[", "cb", "]"}]}], "}"}]}], "]"}], "]"}], ",", 
   RowBox[{"FTerm", "[", 
    RowBox[{"S", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"c", ",", "cb", ",", "A"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"i182", "[", "c", "]"}], ",", 
        RowBox[{"i182", "[", "cb", "]"}], ",", 
        RowBox[{"i182", "[", "A", "]"}]}], "}"}]}], "]"}], "]"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{{3.9516575705713797`*^9, 3.9516575856619997`*^9}, {
   3.951657658520887*^9, 3.951657684473927*^9}, {3.951657814960875*^9, 
   3.9516579078410463`*^9}, 3.9516585052360907`*^9},
 CellLabel->
  "Out[101]=",ExpressionUUID->"e40af878-9891-4f43-8524-6badeb2b876a"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Master Equations", "Subsection",
 CellChangeTimes->{{3.951656853500956*^9, 
  3.951656855241167*^9}},ExpressionUUID->"8f0595fe-d193-4ef8-9b01-\
575af1cadb30"],

Cell[BoxData[
 RowBox[{
  RowBox[{"WetterichEquation", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"FEq", "[", 
      RowBox[{"FTerm", "[", 
       RowBox[{
        RowBox[{"Propagator", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"AnyField", ",", "AnyField"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"a", ",", "b"}], "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"Rdot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"AnyField", ",", "AnyField"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "a"}], ",", 
             RowBox[{"-", "b"}]}], "}"}]}], "]"}], "/", "2"}]}], "]"}], 
      "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.951381435797155*^9, 3.951381479547806*^9}, 
   3.951381513479992*^9, {3.951381606431676*^9, 3.951381607696101*^9}, {
   3.9514719926566677`*^9, 3.951471997604651*^9}, {3.951472100330323*^9, 
   3.9514721037204857`*^9}, 3.9515572077639647`*^9, {3.951631105124219*^9, 
   3.951631134728709*^9}, 3.9516314966686707`*^9},
 CellLabel->
  "In[832]:=",ExpressionUUID->"9d1db064-43e8-4f57-8d01-e9598ea2899c"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing", "Title",
 CellChangeTimes->{{3.9508681098093233`*^9, 
  3.950868110913395*^9}},ExpressionUUID->"7a24c792-7a48-4e73-8b88-\
7b56966e439b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Get", "[", "\"\<FunKit`\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.951280802995201*^9, 3.951280805886263*^9}, 
   3.951383832368981*^9, {3.951463430475296*^9, 3.951463433331225*^9}},
 CellLabel->
  "In[2102]:=",ExpressionUUID->"45787101-b7c2-46b3-828f-0dde391998ab"],

Cell[CellGroupData[{

Cell[BoxData["\<\"\\!\\(\\*\\nStyleBox[\\\"Loading\\\",\\nFontSize->10,\\\
nFontWeight->\\\"Plain\\\",\\nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\\
nStyleBox[\\\" \
\\\",\\nFontSize->10,\\nFontWeight->\\\"Plain\\\",\\nFontSlant->\\\"Italic\\\"\
]\\)\\!\\(\\*\\nStyleBox[\\\"modules\\\",\\nFontSize->10,\\nFontWeight->\\\"\
Plain\\\",\\nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\nStyleBox[\\\"...\\\",\\\
nFontSize->10,\\nFontWeight->\\\"Plain\\\",\\nFontSlant->\\\"Italic\\\"]\\)\"\
\>"], "Print",
 CellChangeTimes->{
  3.9512808080301123`*^9, 3.9512882856954603`*^9, 3.951293259266097*^9, 
   3.951373332641286*^9, {3.951373402827415*^9, 3.951373414654316*^9}, {
   3.9513734584063673`*^9, 3.9513734747897263`*^9}, {3.951373517690031*^9, 
   3.951373537928916*^9}, {3.95137356951661*^9, 3.9513735885425243`*^9}, 
   3.951373672432575*^9, 3.95137381858317*^9, 3.951373901873564*^9, 
   3.9513740830530233`*^9, 3.951374197561492*^9, 3.951374368594837*^9, 
   3.9513804097451973`*^9, 3.951463435188442*^9, 3.951466385305526*^9, {
   3.951466426473833*^9, 3.951466463295642*^9}, {3.951466504459938*^9, 
   3.951466511920663*^9}, {3.951467519099811*^9, 3.9514675391532288`*^9}, 
   3.9514676005173683`*^9, {3.951467691173511*^9, 3.951467721393344*^9}, {
   3.951467763053853*^9, 3.951467798219372*^9}, 3.951467831600505*^9, 
   3.9514678736965857`*^9, 3.951467937185445*^9, 3.9514723771471233`*^9, 
   3.951543954250733*^9, 3.951557487922175*^9, {3.951575981834096*^9, 
   3.9515760309783792`*^9}, 3.9516319127290583`*^9, 3.951632027332905*^9, 
   3.951642844935986*^9, {3.951655030142435*^9, 3.951655044899419*^9}, 
   3.951657439994753*^9, 3.951657603842927*^9, 3.9516760671917467`*^9, 
   3.9516761120030746`*^9},
 CellLabel->
  "During evaluation of \
In[2102]:=",ExpressionUUID->"dda21cb9-e796-4bcc-a1c0-7e0d0c921cb5"],

Cell[BoxData["\<\"\\!\\(\\*\\nStyleBox[\\\"...\\\",\\nFontSize->10,\\\
nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\nStyleBox[\\\"TensorBases\\\",\\\
nFontSize->10,\\nFontWeight->\\\"Bold\\\",\\nFontSlant->\\\"Italic\\\"]\\)\\!\
\\(\\*\\nStyleBox[\\\" \
\\\",\\nFontSize->10,\\nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\nStyleBox[\\\"\
loaded\\\",\\nFontSize->10,\\nFontWeight->\\\"Plain\\\",\\nFontSlant->\\\"\
Italic\\\"]\\)\"\>"], "Print",
 CellChangeTimes->{
  3.9512808080301123`*^9, 3.9512882856954603`*^9, 3.951293259266097*^9, 
   3.951373332641286*^9, {3.951373402827415*^9, 3.951373414654316*^9}, {
   3.9513734584063673`*^9, 3.9513734747897263`*^9}, {3.951373517690031*^9, 
   3.951373537928916*^9}, {3.95137356951661*^9, 3.9513735885425243`*^9}, 
   3.951373672432575*^9, 3.95137381858317*^9, 3.951373901873564*^9, 
   3.9513740830530233`*^9, 3.951374197561492*^9, 3.951374368594837*^9, 
   3.9513804097451973`*^9, 3.951463435188442*^9, 3.951466385305526*^9, {
   3.951466426473833*^9, 3.951466463295642*^9}, {3.951466504459938*^9, 
   3.951466511920663*^9}, {3.951467519099811*^9, 3.9514675391532288`*^9}, 
   3.9514676005173683`*^9, {3.951467691173511*^9, 3.951467721393344*^9}, {
   3.951467763053853*^9, 3.951467798219372*^9}, 3.951467831600505*^9, 
   3.9514678736965857`*^9, 3.951467937185445*^9, 3.9514723771471233`*^9, 
   3.951543954250733*^9, 3.951557487922175*^9, {3.951575981834096*^9, 
   3.9515760309783792`*^9}, 3.9516319127290583`*^9, 3.951632027332905*^9, 
   3.951642844935986*^9, {3.951655030142435*^9, 3.951655044899419*^9}, 
   3.951657439994753*^9, 3.951657603842927*^9, 3.9516760671917467`*^9, 
   3.951676113213629*^9},
 CellLabel->
  "During evaluation of \
In[2102]:=",ExpressionUUID->"94aac254-c9bd-424a-940c-076abdb0fc1a"],

Cell[BoxData["\<\"\\!\\(\\*\\nStyleBox[\\\"...\\\",\\nFontSize->10,\\\
nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\nStyleBox[\\\"FEDeriK\\\",\\\
nFontSize->10,\\nFontWeight->\\\"Bold\\\",\\nFontSlant->\\\"Italic\\\"]\\)\\!\
\\(\\*\\nStyleBox[\\\" \
\\\",\\nFontSize->10,\\nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\nStyleBox[\\\"\
loaded\\\",\\nFontSize->10,\\nFontWeight->\\\"Plain\\\",\\nFontSlant->\\\"\
Italic\\\"]\\)\"\>"], "Print",
 CellChangeTimes->{
  3.9512808080301123`*^9, 3.9512882856954603`*^9, 3.951293259266097*^9, 
   3.951373332641286*^9, {3.951373402827415*^9, 3.951373414654316*^9}, {
   3.9513734584063673`*^9, 3.9513734747897263`*^9}, {3.951373517690031*^9, 
   3.951373537928916*^9}, {3.95137356951661*^9, 3.9513735885425243`*^9}, 
   3.951373672432575*^9, 3.95137381858317*^9, 3.951373901873564*^9, 
   3.9513740830530233`*^9, 3.951374197561492*^9, 3.951374368594837*^9, 
   3.9513804097451973`*^9, 3.951463435188442*^9, 3.951466385305526*^9, {
   3.951466426473833*^9, 3.951466463295642*^9}, {3.951466504459938*^9, 
   3.951466511920663*^9}, {3.951467519099811*^9, 3.9514675391532288`*^9}, 
   3.9514676005173683`*^9, {3.951467691173511*^9, 3.951467721393344*^9}, {
   3.951467763053853*^9, 3.951467798219372*^9}, 3.951467831600505*^9, 
   3.9514678736965857`*^9, 3.951467937185445*^9, 3.9514723771471233`*^9, 
   3.951543954250733*^9, 3.951557487922175*^9, {3.951575981834096*^9, 
   3.9515760309783792`*^9}, 3.9516319127290583`*^9, 3.951632027332905*^9, 
   3.951642844935986*^9, {3.951655030142435*^9, 3.951655044899419*^9}, 
   3.951657439994753*^9, 3.951657603842927*^9, 3.9516760671917467`*^9, 
   3.951676113333033*^9},
 CellLabel->
  "During evaluation of \
In[2102]:=",ExpressionUUID->"28ee763b-ad42-4289-9ee8-d9b32dfeb190"],

Cell[BoxData["\<\"\\!\\(\\*\\nStyleBox[\\\"...\\\",\\nFontSize->10,\\\
nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\nStyleBox[\\\"AnSEL\\\",\\nFontSize->\
10,\\nFontWeight->\\\"Bold\\\",\\nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\\
nStyleBox[\\\" \\\",\\nFontSize->10,\\nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\
\\nStyleBox[\\\"loaded\\\",\\nFontSize->10,\\nFontWeight->\\\"Plain\\\",\\\
nFontSlant->\\\"Italic\\\"]\\)\"\>"], "Print",
 CellChangeTimes->{
  3.9512808080301123`*^9, 3.9512882856954603`*^9, 3.951293259266097*^9, 
   3.951373332641286*^9, {3.951373402827415*^9, 3.951373414654316*^9}, {
   3.9513734584063673`*^9, 3.9513734747897263`*^9}, {3.951373517690031*^9, 
   3.951373537928916*^9}, {3.95137356951661*^9, 3.9513735885425243`*^9}, 
   3.951373672432575*^9, 3.95137381858317*^9, 3.951373901873564*^9, 
   3.9513740830530233`*^9, 3.951374197561492*^9, 3.951374368594837*^9, 
   3.9513804097451973`*^9, 3.951463435188442*^9, 3.951466385305526*^9, {
   3.951466426473833*^9, 3.951466463295642*^9}, {3.951466504459938*^9, 
   3.951466511920663*^9}, {3.951467519099811*^9, 3.9514675391532288`*^9}, 
   3.9514676005173683`*^9, {3.951467691173511*^9, 3.951467721393344*^9}, {
   3.951467763053853*^9, 3.951467798219372*^9}, 3.951467831600505*^9, 
   3.9514678736965857`*^9, 3.951467937185445*^9, 3.9514723771471233`*^9, 
   3.951543954250733*^9, 3.951557487922175*^9, {3.951575981834096*^9, 
   3.9515760309783792`*^9}, 3.9516319127290583`*^9, 3.951632027332905*^9, 
   3.951642844935986*^9, {3.951655030142435*^9, 3.951655044899419*^9}, 
   3.951657439994753*^9, 3.951657603842927*^9, 3.9516760671917467`*^9, 
   3.951676113333789*^9},
 CellLabel->
  "During evaluation of \
In[2102]:=",ExpressionUUID->"00e3618b-15bd-40da-8e32-d056c3150845"],

Cell[BoxData["\<\"\\!\\(\\*\\nStyleBox[\\\"...\\\",\\nFontSize->10,\\\
nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\nStyleBox[\\\"DiANE\\\",\\nFontSize->\
10,\\nFontWeight->\\\"Bold\\\",\\nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\\\
nStyleBox[\\\" \\\",\\nFontSize->10,\\nFontSlant->\\\"Italic\\\"]\\)\\!\\(\\*\
\\nStyleBox[\\\"loaded\\\",\\nFontSize->10,\\nFontWeight->\\\"Plain\\\",\\\
nFontSlant->\\\"Italic\\\"]\\)\"\>"], "Print",
 CellChangeTimes->{
  3.9512808080301123`*^9, 3.9512882856954603`*^9, 3.951293259266097*^9, 
   3.951373332641286*^9, {3.951373402827415*^9, 3.951373414654316*^9}, {
   3.9513734584063673`*^9, 3.9513734747897263`*^9}, {3.951373517690031*^9, 
   3.951373537928916*^9}, {3.95137356951661*^9, 3.9513735885425243`*^9}, 
   3.951373672432575*^9, 3.95137381858317*^9, 3.951373901873564*^9, 
   3.9513740830530233`*^9, 3.951374197561492*^9, 3.951374368594837*^9, 
   3.9513804097451973`*^9, 3.951463435188442*^9, 3.951466385305526*^9, {
   3.951466426473833*^9, 3.951466463295642*^9}, {3.951466504459938*^9, 
   3.951466511920663*^9}, {3.951467519099811*^9, 3.9514675391532288`*^9}, 
   3.9514676005173683`*^9, {3.951467691173511*^9, 3.951467721393344*^9}, {
   3.951467763053853*^9, 3.951467798219372*^9}, 3.951467831600505*^9, 
   3.9514678736965857`*^9, 3.951467937185445*^9, 3.9514723771471233`*^9, 
   3.951543954250733*^9, 3.951557487922175*^9, {3.951575981834096*^9, 
   3.9515760309783792`*^9}, 3.9516319127290583`*^9, 3.951632027332905*^9, 
   3.951642844935986*^9, {3.951655030142435*^9, 3.951655044899419*^9}, 
   3.951657439994753*^9, 3.951657603842927*^9, 3.9516760671917467`*^9, 
   3.951676114008604*^9},
 CellLabel->
  "During evaluation of \
In[2102]:=",ExpressionUUID->"68d9e46f-b2cc-4cd4-b1cb-f25236063bb6"],

Cell[BoxData["\<\"Welcome to  \
\\!\\(\\*\\nStyleBox[\\\"\:2588\:2580\\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\
\\*\\nStyleBox[\\\" \
\\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\\\"\:2590\:2584\:2588\
\\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\\\" \
\\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\\\"\:2588\:259a\:258c\
\\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\\\" \
\\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\\\"\:2590\
\[FilledLeftTriangle]\\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\
\\\" \\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\\\"\:2588\\\",\\\
nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\\\" \
\\\",\\nFontColor->GrayLevel[0]]\\)\\!\\(\\*\\nStyleBox[\\\"\:2580\:2588\:2580\
\\\",\\nFontColor->GrayLevel[0]]\\)\\n\\!\\(\\*\\nStyleBox[\\\"Author\\\",\\\
nFontWeight->\\\"Bold\\\"]\\): Franz Richard \
Sattler\\n\\!\\(\\*\\nStyleBox[\\\"Version\\\",\\nFontWeight->\\\"Bold\\\"]\\)\
: 1.0\\n\\!\\(\\*\\nStyleBox[\\\"Year\\\",\\nFontWeight->\\\"Bold\\\"]\\): \
2025\\nFor more information, call \
\\!\\(\\*\\nStyleBox[\\\"FunKitInfo\\\",\\nFontColor->RGBColor[1, 0.5, \
0]]\\)[].\"\>"], "Print",
 CellChangeTimes->{
  3.9512808080301123`*^9, 3.9512882856954603`*^9, 3.951293259266097*^9, 
   3.951373332641286*^9, {3.951373402827415*^9, 3.951373414654316*^9}, {
   3.9513734584063673`*^9, 3.9513734747897263`*^9}, {3.951373517690031*^9, 
   3.951373537928916*^9}, {3.95137356951661*^9, 3.9513735885425243`*^9}, 
   3.951373672432575*^9, 3.95137381858317*^9, 3.951373901873564*^9, 
   3.9513740830530233`*^9, 3.951374197561492*^9, 3.951374368594837*^9, 
   3.9513804097451973`*^9, 3.951463435188442*^9, 3.951466385305526*^9, {
   3.951466426473833*^9, 3.951466463295642*^9}, {3.951466504459938*^9, 
   3.951466511920663*^9}, {3.951467519099811*^9, 3.9514675391532288`*^9}, 
   3.9514676005173683`*^9, {3.951467691173511*^9, 3.951467721393344*^9}, {
   3.951467763053853*^9, 3.951467798219372*^9}, 3.951467831600505*^9, 
   3.9514678736965857`*^9, 3.951467937185445*^9, 3.9514723771471233`*^9, 
   3.951543954250733*^9, 3.951557487922175*^9, {3.951575981834096*^9, 
   3.9515760309783792`*^9}, 3.9516319127290583`*^9, 3.951632027332905*^9, 
   3.951642844935986*^9, {3.951655030142435*^9, 3.951655044899419*^9}, 
   3.951657439994753*^9, 3.951657603842927*^9, 3.9516760671917467`*^9, 
   3.951676114009452*^9},
 CellLabel->
  "During evaluation of \
In[2102]:=",ExpressionUUID->"8bc22b51-f211-47d4-a45c-c5640ca33320"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Needs", "[", "\"\<QMeSderivation`\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fRGEq", " ", "=", " ", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<Prefactor\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"1", "/", "2"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<type\>\"", "\[Rule]", "\"\<Regulatordot\>\""}], ",", " ", 
       
       RowBox[{"\"\<indices\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}]}]}], "|>"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<type\>\"", "\[Rule]", "\"\<Propagator\>\""}], ",", " ", 
       RowBox[{"\"\<indices\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}]}]}], "|>"}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fields", " ", "=", " ", 
   RowBox[{"<|", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<bosonic\>\"", "\[Rule]", " ", 
      RowBox[{"{", " ", "\[IndentingNewLine]", 
       RowBox[{"A", "[", 
        RowBox[{"p", ",", 
         RowBox[{"{", 
          RowBox[{"v", ",", " ", "c"}], "}"}]}], "]"}], "\[IndentingNewLine]",
        "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<fermionic\>\"", "\[Rule]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"cb", "[", 
          RowBox[{"p", ",", 
           RowBox[{"{", "c", "}"}]}], "]"}], ",", 
         RowBox[{"c", "[", 
          RowBox[{"p", ",", 
           RowBox[{"{", "c", "}"}]}], "]"}]}], "}"}], "\[IndentingNewLine]", 
       "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Truncation", " ", "=", " ", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"A", ",", "A"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"cb", ",", "c"}], "}"}], ",", 
     RowBox[{"(*", " ", "propagators", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"cb", ",", "c", ",", "A"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"A", ",", "A", ",", "A"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"A", ",", "A", ",", "A", ",", "A"}], "}"}]}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{"glue", " ", "sector", " ", "scatterings"}], " ", "*)"}], 
    "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetupfRG", " ", "=", " ", 
    RowBox[{"<|", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<MasterEquation\>\"", "\[Rule]", "fRGEq"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<FieldSpace\>\"", "\[Rule]", "fields"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<Truncation\>\"", "\[Rule]", "Truncation"}]}], 
     "\[IndentingNewLine]", "|>"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DerivativeListAcbc", "=", 
   RowBox[{"{", " ", 
    RowBox[{
     RowBox[{"A", "[", 
      RowBox[{"p1", ",", 
       RowBox[{"{", 
        RowBox[{"v1", ",", "a1"}], "}"}]}], "]"}], ",", 
     RowBox[{"cb", "[", 
      RowBox[{"p2", ",", 
       RowBox[{"{", "a2", "}"}]}], "]"}], ",", 
     RowBox[{"c", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "p2"}], "-", "p1"}], ",", 
       RowBox[{"{", "a3", "}"}]}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DiagramsAcbcsidx", " ", "=", 
   RowBox[{
    RowBox[{"DeriveFunctionalEquation", "[", 
     RowBox[{"SetupfRG", ",", "DerivativeListAcbc", ",", 
      RowBox[{
      "\"\<OutputLevel\>\"", "\[Rule]", "\"\<SuperindexDiagrams\>\""}]}], 
     "]"}], "//", "RepeatedTiming"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"%", "[", 
  RowBox[{"[", "1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{
  3.903251165586019*^9, {3.9068258986408787`*^9, 3.906825911634159*^9}, {
   3.906826033650765*^9, 3.906826034681692*^9}, {3.906826184986546*^9, 
   3.906826186545793*^9}, {3.907313731747599*^9, 3.907313731907217*^9}, {
   3.907313818897386*^9, 3.907313823096096*^9}, 3.907314075318757*^9, {
   3.916563284434239*^9, 3.916563286251066*^9}, {3.92727474509225*^9, 
   3.927274753974639*^9}, {3.935844445304555*^9, 3.935844449065218*^9}, {
   3.936794391841364*^9, 3.936794456522777*^9}, 3.9367950222539043`*^9, {
   3.937540453915236*^9, 3.937540468257794*^9}, {3.9411026722488337`*^9, 
   3.941102676112329*^9}, {3.951659831554038*^9, 3.951659838285676*^9}, {
   3.951660006561775*^9, 3.951660014089693*^9}, 3.9516600948625937`*^9, {
   3.951676007276367*^9, 3.951676011019594*^9}},
 CellLabel->
  "In[2010]:=",ExpressionUUID->"0071dab1-7cf9-4bfe-a8e0-d804153b15a8"],

Cell[BoxData["0.15429725`"], "Output",
 CellChangeTimes->{{3.951660007537086*^9, 3.951660014642061*^9}, 
   3.951660095619244*^9, 3.9516743608612747`*^9, 3.951675968981783*^9, {
   3.951676015509426*^9, 3.951676044511201*^9}},
 CellLabel->
  "Out[2017]=",ExpressionUUID->"cf8a25ac-a60d-4e05-92b4-7f2bcae05e43"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"fields", "=", " ", 
   RowBox[{"<|", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<cField\>\"", "\[Rule]", " ", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"A", "[", 
        RowBox[{"p", ",", 
         RowBox[{"{", 
          RowBox[{"v", ",", " ", "c"}], "}"}]}], "]"}], "\[IndentingNewLine]",
        "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<Grassmann\>\"", "\[Rule]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"cb", "[", 
          RowBox[{"p", ",", 
           RowBox[{"{", "c", "}"}]}], "]"}], ",", 
         RowBox[{"c", "[", 
          RowBox[{"p", ",", 
           RowBox[{"{", "c", "}"}]}], "]"}]}], "}"}], "\[IndentingNewLine]", 
       "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"truncation", "=", 
   RowBox[{"<|", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"GammaN", "->", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"A", ",", "A"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"A", ",", "A", ",", "A"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"A", ",", "A", ",", "A", ",", "A"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"A", ",", "cb", ",", "c"}], "}"}]}], "\[IndentingNewLine]", 
       "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"Propagator", "->", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"A", ",", "A"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cb", ",", "c"}], "}"}]}], "\[IndentingNewLine]", "}"}]}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"Rdot", "->", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"A", ",", "A"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cb", ",", "c"}], "}"}]}], "\[IndentingNewLine]", "}"}]}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"S", "->", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"A", ",", "A"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"A", ",", "A", ",", "A"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"A", ",", "A", ",", "A", ",", "A"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"cb", ",", "c"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cb", ",", "c", ",", "A"}], "}"}]}], "\[IndentingNewLine]", 
       "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"masterEquation", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"A", "[", "x", "]"}], 
       RowBox[{"VBasis", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"A", ",", "A"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "x"}], ",", 
           RowBox[{"-", "y"}]}], "}"}]}], "]"}], 
       RowBox[{"A", "[", "y", "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         RowBox[{"cb", "[", "x", "]"}]}], 
        RowBox[{"VBasis", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"cb", ",", "c"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "x"}], ",", 
            RowBox[{"-", "y"}]}], "}"}]}], "]"}]}], ",", 
       RowBox[{"c", "[", "y", "]"}]}], "}"}]}], "\[IndentingNewLine]", 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Setup", ":=", 
    RowBox[{"<|", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<MasterEquation\>\"", "->", "masterEquation"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<FieldSpace\>\"", "->", "fields"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<Truncation\>\"", "->", "truncation"}]}], 
     "\[IndentingNewLine]", "|>"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TakeDerivatives", "[", 
     RowBox[{"Setup", ",", "WetterichEquation", ",", "DerivativeListAcbc"}], 
     "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}], "//", "RepeatedTiming"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"%", "[", 
  RowBox[{"[", "1", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"%%", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "//", 
    RowBox[{
     RowBox[{"Truncate", "[", 
      RowBox[{"Setup", ",", "#"}], "]"}], "&"}]}], "//", "RepeatedTiming"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"%", "[", 
  RowBox[{"[", "1", "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.951659883769759*^9, 3.951659964233618*^9}, {
  3.951660031554185*^9, 3.9516600638258877`*^9}, {3.9516601292549467`*^9, 
  3.951660129386159*^9}, {3.9516760174130907`*^9, 3.951676018676004*^9}},
 CellLabel->
  "In[2002]:=",ExpressionUUID->"cbd6f99f-e189-4d2f-9834-fb4a2f858c18"],

Cell[BoxData["0.042178125`"], "Output",
 CellChangeTimes->{{3.951659899341173*^9, 3.95165996468932*^9}, {
   3.951660043927231*^9, 3.951660075428392*^9}, {3.9516601303263474`*^9, 
   3.951660134280835*^9}, 3.951660240805541*^9, {3.951660347033659*^9, 
   3.9516603508583527`*^9}, {3.9516604059687033`*^9, 3.951660426770253*^9}, 
   3.951668912112136*^9, 3.951673524074325*^9, {3.9516735820476627`*^9, 
   3.9516735998895893`*^9}, 3.951674365221983*^9, {3.951675972677279*^9, 
   3.951676038215057*^9}},
 CellLabel->
  "Out[2007]=",ExpressionUUID->"25e5b15d-ad4e-48fa-922f-554ff67dd49e"],

Cell[BoxData["0.119014875`"], "Output",
 CellChangeTimes->{{3.951659899341173*^9, 3.95165996468932*^9}, {
   3.951660043927231*^9, 3.951660075428392*^9}, {3.9516601303263474`*^9, 
   3.951660134280835*^9}, 3.951660240805541*^9, {3.951660347033659*^9, 
   3.9516603508583527`*^9}, {3.9516604059687033`*^9, 3.951660426770253*^9}, 
   3.951668912112136*^9, 3.951673524074325*^9, {3.9516735820476627`*^9, 
   3.9516735998895893`*^9}, 3.951674365221983*^9, {3.951675972677279*^9, 
   3.951676040189024*^9}},
 CellLabel->
  "Out[2009]=",ExpressionUUID->"dc1a2419-8f4d-4360-9376-fdcaa47962a6"]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->"FEDeriK.m",
WindowSize->{1200, 750},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
Magnification:>0.9 Inherited,
FrontEndVersion->"14.1 for Linux x86 (64-bit) (July 16, 2024)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"dfc92765-bf29-47cf-bd50-cf1f31dcd525"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 530, 10, 28, "Input",ExpressionUUID->"33cd48af-4550-42b3-9c95-127f2f1ee635"],
Cell[CellGroupData[{
Cell[1109, 34, 186, 3, 86, "Title",ExpressionUUID->"e8eab254-3b4c-449c-9b09-2a41fc81e9e2"],
Cell[CellGroupData[{
Cell[1320, 41, 259, 4, 59, "Section",ExpressionUUID->"d65e8f2b-6500-4348-8918-912b67b13cd9"],
Cell[1582, 47, 1182, 29, 181, "Input",ExpressionUUID->"0a00f2e0-9e12-4855-8a8a-da6773cee6a6",
 InitializationCell->True],
Cell[2767, 78, 1920, 48, 257, "Input",ExpressionUUID->"f9a54712-bc7e-4f67-94ba-c436d6c2a287",
 InitializationCell->True],
Cell[4690, 128, 900, 21, 124, "Input",ExpressionUUID->"9f23e5c2-affb-4cab-9de6-acd7510a1543",
 InitializationCell->True],
Cell[5593, 151, 1863, 48, 144, "Input",ExpressionUUID->"66c68510-764b-433f-bf11-01c5d6a5e9c2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[7493, 204, 230, 4, 47, "Section",ExpressionUUID->"e03db448-7a6c-4e73-9ddc-3b1976a84a81"],
Cell[CellGroupData[{
Cell[7748, 212, 190, 3, 47, "Subsection",ExpressionUUID->"35360acd-1ab3-48dc-b387-960ef784c1b9"],
Cell[7941, 217, 341, 9, 41, "Input",ExpressionUUID->"3f16da75-51f5-4748-90ba-22ae1854030a",
 InitializationCell->True],
Cell[8285, 228, 7869, 206, 735, "Input",ExpressionUUID->"9610d6bd-1c3a-4143-88dc-cb4244676cae",
 InitializationCell->True],
Cell[16157, 436, 253, 5, 26, "Input",ExpressionUUID->"19c9f74f-289c-4a22-b75e-e5109d618ef0"],
Cell[16413, 443, 11070, 281, 800, "Input",ExpressionUUID->"d8c7ad92-008a-409f-951b-580a3ca827cd",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[27520, 729, 218, 4, 33, "Subsection",ExpressionUUID->"23b7e69d-dcbb-4fb0-a77e-b8638a031ad4"],
Cell[CellGroupData[{
Cell[27763, 737, 217, 4, 39, "Subsubsection",ExpressionUUID->"d438b387-4f31-41ce-a117-795b628d69b9"],
Cell[27983, 743, 1703, 51, 183, "Input",ExpressionUUID->"63fbe29b-4af8-405d-80e3-5cbc9aa8d1d5",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[29723, 799, 157, 3, 32, "Subsubsection",ExpressionUUID->"5aaf8220-7538-47a5-abd1-41964a7a0f89"],
Cell[29883, 804, 3002, 91, 263, "Input",ExpressionUUID->"2c28ad8a-8cd0-4b1c-b0b8-25b7da74a5a5",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[32922, 900, 212, 4, 32, "Subsubsection",ExpressionUUID->"f52392a8-ad40-44db-871d-0651868db7ca"],
Cell[33137, 906, 7276, 168, 779, "Input",ExpressionUUID->"d2be4365-2a9f-4170-90b1-81e044dec426",
 InitializationCell->True],
Cell[40416, 1076, 5713, 133, 672, "Input",ExpressionUUID->"ffdc8015-4beb-4a8a-9712-899076a5bcad",
 InitializationCell->True],
Cell[46132, 1211, 150, 3, 26, "Input",ExpressionUUID->"e6fda6fb-9bcb-45a5-b801-7e006569f014"]
}, Closed]],
Cell[CellGroupData[{
Cell[46319, 1219, 228, 3, 32, "Subsubsection",ExpressionUUID->"432ab124-4161-47f8-a56b-8db469a3db21"],
Cell[46550, 1224, 4135, 103, 635, "Input",ExpressionUUID->"11470f5d-e2db-4aaa-9b7e-0a8c11da0687",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[50722, 1332, 270, 4, 32, "Subsubsection",ExpressionUUID->"73595dfd-e53e-4d4e-a700-40ff68a78e58"],
Cell[50995, 1338, 4291, 100, 389, "Input",ExpressionUUID->"8025941a-3caa-4a8b-a6f7-d19c65a09782",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[55323, 1443, 217, 4, 32, "Subsubsection",ExpressionUUID->"4586692a-ee51-46b9-b58e-43bcdb604423"],
Cell[55543, 1449, 3215, 78, 406, "Input",ExpressionUUID->"d04f551f-63ba-4c59-827e-89539a889eb6",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[58795, 1532, 250, 3, 32, "Subsubsection",ExpressionUUID->"bb6d67ae-94ea-4de9-ad33-f49796906916"],
Cell[59048, 1537, 5054, 141, 425, "Input",ExpressionUUID->"cec32202-2ccb-4a54-a11b-3d74e2fc5239",
 InitializationCell->True]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[64163, 1685, 156, 3, 59, "Section",ExpressionUUID->"bdee160a-1c91-4de1-b52d-86eb572207e3"],
Cell[CellGroupData[{
Cell[64344, 1692, 168, 3, 39, "Subsubsection",ExpressionUUID->"d002c263-ec1e-44d9-8d95-a0c4fe2e8e78"],
Cell[64515, 1697, 1396, 36, 124, "Input",ExpressionUUID->"f4704157-c7f9-402c-bf7c-77513ac8ecc7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[65948, 1738, 208, 4, 33, "Subsection",ExpressionUUID->"5193f3f7-8901-4525-bbbc-d3fa4695bea7"],
Cell[66159, 1744, 18416, 413, 1004, "Input",ExpressionUUID->"428f55da-c8db-4d63-89da-51a880a4e13f",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[84612, 2162, 223, 4, 33, "Subsection",ExpressionUUID->"a703f905-419d-403f-a28c-a63b6e5d0fbc"],
Cell[CellGroupData[{
Cell[84860, 2170, 159, 3, 39, "Subsubsection",ExpressionUUID->"807846d5-0a8e-42e1-8499-9436b99fe5c0"],
Cell[85022, 2175, 6151, 161, 601, "Input",ExpressionUUID->"3518af78-5ff7-49ca-9232-57a8cda2059b",
 InitializationCell->True],
Cell[91176, 2338, 5552, 157, 672, "Input",ExpressionUUID->"51b5119b-7ed2-4d4e-8157-9da88d9e51a3",
 InitializationCell->True],
Cell[96731, 2497, 2347, 59, 267, "Input",ExpressionUUID->"f9e7b8dd-479d-4f1c-b30c-43e82a8f1466",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[99115, 2561, 190, 3, 32, "Subsubsection",ExpressionUUID->"d2a5f7e9-fbf3-48fd-896b-3c3a13529cd2"],
Cell[99308, 2566, 1985, 48, 269, "Input",ExpressionUUID->"84ac980c-3e5a-487b-a821-389318a8bd26",
 InitializationCell->True],
Cell[101296, 2616, 2163, 52, 208, "Input",ExpressionUUID->"e0675219-06d7-4260-b88e-aecc77330bb2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[103496, 2673, 206, 4, 32, "Subsubsection",ExpressionUUID->"4d34a9f6-835b-4d0e-bded-e4ef20d68c82"],
Cell[103705, 2679, 3958, 94, 293, "Input",ExpressionUUID->"935d09a0-331b-40fc-a467-f0134b7e4304",
 InitializationCell->True],
Cell[107666, 2775, 3746, 73, 231, "Input",ExpressionUUID->"618c6cea-155d-41cc-8d73-a5fa44e0f55c",
 InitializationCell->True],
Cell[111415, 2850, 3840, 98, 336, "Input",ExpressionUUID->"2083da28-6459-42c3-a41e-477af9394ced",
 InitializationCell->True],
Cell[115258, 2950, 381, 9, 97, "Input",ExpressionUUID->"d22ab83c-b759-4f78-bd4e-b187d181367e",
 InitializationCell->True],
Cell[115642, 2961, 2217, 56, 248, "Input",ExpressionUUID->"52f45ee5-d229-4150-80ad-0fd4a5239cf9",
 InitializationCell->True],
Cell[117862, 3019, 3647, 74, 248, "Input",ExpressionUUID->"9f3b0ea7-2af5-48b1-84b3-46146be887b3",
 InitializationCell->True],
Cell[121512, 3095, 4949, 130, 450, "Input",ExpressionUUID->"3edfcfc0-c624-46bc-ab09-a08de412f0d7",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[126510, 3231, 253, 4, 47, "Subsection",ExpressionUUID->"1785af53-7c89-486a-9e5f-2cc90ee5d4f8"],
Cell[CellGroupData[{
Cell[126788, 3239, 181, 3, 39, "Subsubsection",ExpressionUUID->"6b5ad42c-f028-4331-8dd5-edca6279d9c9"],
Cell[126972, 3244, 3693, 79, 693, "Input",ExpressionUUID->"8223ffc8-f59e-4c33-b04f-02db6763d2e2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[130702, 3328, 171, 3, 32, "Subsubsection",ExpressionUUID->"25f821ed-484b-44c3-bb3d-2285af151ba5"],
Cell[130876, 3333, 5270, 117, 628, "Input",ExpressionUUID->"4b678c74-7d06-4764-a1d3-b462e6b01ccf",
 InitializationCell->True],
Cell[136149, 3452, 1635, 38, 146, "Input",ExpressionUUID->"18065f13-e208-4ab7-83f1-35e867d53bcb",
 InitializationCell->True],
Cell[137787, 3492, 10980, 242, 945, "Input",ExpressionUUID->"4a073111-7191-4734-b32b-1a96840d6461",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[148816, 3740, 168, 3, 47, "Subsection",ExpressionUUID->"94391a5f-eb5e-4478-a534-7016e4a3f9d1"],
Cell[148987, 3745, 5145, 127, 607, "Input",ExpressionUUID->"ac314d00-9b25-4da1-be23-eabaa3a126f2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[154169, 3877, 316, 5, 33, "Subsection",ExpressionUUID->"ff235384-733f-4abf-8f02-504f4ee478e5"],
Cell[154488, 3884, 7404, 184, 732, "Input",ExpressionUUID->"b7774a84-ac87-42fd-842d-b4b0fef4ae7a",
 InitializationCell->True],
Cell[161895, 4070, 12300, 285, 898, "Input",ExpressionUUID->"43985720-cee5-4d43-b10f-0ff857cd9f45",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[174232, 4360, 352, 6, 33, "Subsection",ExpressionUUID->"1622282e-4fbd-4217-bd6f-b09735bb31ad"],
Cell[174587, 4368, 4507, 93, 408, "Input",ExpressionUUID->"7fb788c6-edd7-4326-a9a5-34ed1aaa3e34",
 InitializationCell->True],
Cell[179097, 4463, 31642, 700, 2009, "Input",ExpressionUUID->"6269ca75-778d-40ad-80f2-8a872a066ced",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[210776, 5168, 281, 4, 33, "Subsection",ExpressionUUID->"e5244ec3-f22c-466c-9873-92eb903637b0"],
Cell[211060, 5174, 6288, 139, 689, "Input",ExpressionUUID->"3500ee75-7244-4321-ae5e-82e6897e10d7",
 InitializationCell->True],
Cell[217351, 5315, 1916, 53, 125, "Input",ExpressionUUID->"ec93a3ae-c758-4d49-9ec4-9c2ae2983898",
 InitializationCell->True],
Cell[219270, 5370, 13292, 304, 1100, "Input",ExpressionUUID->"c85cfa76-e8b5-439f-9ca0-f24e64c44725",
 InitializationCell->True],
Cell[232565, 5676, 3011, 57, 315, "Input",ExpressionUUID->"52021b7e-bece-436c-b228-076b6c722055",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[235613, 5738, 166, 3, 33, "Subsection",ExpressionUUID->"82ef4885-2b2a-47d1-8963-133ee7a68a33"],
Cell[235782, 5743, 6285, 148, 431, "Input",ExpressionUUID->"c5f93900-11a5-40d3-92c2-259b2094122d",
 InitializationCell->True],
Cell[242070, 5893, 6772, 153, 492, "Input",ExpressionUUID->"c8e3186f-3d3b-492c-8b02-56053c948bd0",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[248891, 6052, 264, 4, 59, "Section",ExpressionUUID->"be19843a-e765-47f1-9747-2d6834a73a9e"],
Cell[CellGroupData[{
Cell[249180, 6060, 171, 3, 47, "Subsection",ExpressionUUID->"e3f3669e-621b-4b13-b56e-3deed41d0aba"],
Cell[249354, 6065, 14537, 319, 1191, "Input",ExpressionUUID->"ac348a0a-7a6e-409c-9a98-56e5170bdbb5",
 InitializationCell->True],
Cell[263894, 6386, 4910, 109, 552, "Input",ExpressionUUID->"b0835c23-2d69-40a7-9251-be3d8571a3bb",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[268841, 6500, 185, 3, 33, "Subsection",ExpressionUUID->"a8f64e7a-d885-45c2-99d7-7e2e4dc385f7"],
Cell[269029, 6505, 545, 15, 63, "Input",ExpressionUUID->"bba04405-f573-40fc-9a19-18ca7de811ab",
 InitializationCell->True],
Cell[269577, 6522, 7083, 149, 706, "Input",ExpressionUUID->"fcb7ecd2-adb3-4b5a-a94f-8080924ea319",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[276709, 6677, 262, 4, 59, "Section",ExpressionUUID->"90f35056-189d-45d1-a3e0-d11e3b29b6b0"],
Cell[CellGroupData[{
Cell[276996, 6685, 166, 3, 47, "Subsection",ExpressionUUID->"516f3992-f5b4-416d-be0e-5487233f53ee"],
Cell[CellGroupData[{
Cell[277187, 6692, 594, 17, 28, "Input",ExpressionUUID->"3d81551a-873d-445b-8d96-800f1e87038d"],
Cell[277784, 6711, 384, 8, 32, "Output",ExpressionUUID->"c730b2d6-fda3-4443-b80f-3ce27773c5d4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[278205, 6724, 1197, 35, 49, "Input",ExpressionUUID->"d629366a-c937-4d3b-8e8a-d8b2225aff16"],
Cell[279405, 6761, 569, 14, 32, "Output",ExpressionUUID->"4c8a1f00-d397-42db-b4ea-715ed3b77f00"]
}, Open  ]],
Cell[CellGroupData[{
Cell[280011, 6780, 2509, 59, 356, "Input",ExpressionUUID->"6223a3d7-3feb-49eb-92b1-6a73f7ae78a2"],
Cell[282523, 6841, 1989, 57, 53, "Output",ExpressionUUID->"e40af878-9891-4f43-8524-6badeb2b876a"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[284561, 6904, 164, 3, 33, "Subsection",ExpressionUUID->"8f0595fe-d193-4ef8-9b01-575af1cadb30"],
Cell[284728, 6909, 1309, 33, 84, "Input",ExpressionUUID->"9d1db064-43e8-4f57-8d01-e9598ea2899c",
 InitializationCell->True]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[286098, 6949, 152, 3, 86, "Title",ExpressionUUID->"7a24c792-7a48-4e73-8b88-7b56966e439b"],
Cell[CellGroupData[{
Cell[286275, 6956, 292, 5, 41, "Input",ExpressionUUID->"45787101-b7c2-46b3-828f-0dde391998ab"],
Cell[CellGroupData[{
Cell[286592, 6965, 1816, 28, 20, "Print",ExpressionUUID->"dda21cb9-e796-4bcc-a1c0-7e0d0c921cb5"],
Cell[288411, 6995, 1756, 27, 20, "Print",ExpressionUUID->"94aac254-c9bd-424a-940c-076abdb0fc1a"],
Cell[290170, 7024, 1752, 27, 20, "Print",ExpressionUUID->"28ee763b-ad42-4289-9ee8-d9b32dfeb190"],
Cell[291925, 7053, 1748, 26, 20, "Print",ExpressionUUID->"00e3618b-15bd-40da-8e32-d056c3150845"],
Cell[293676, 7081, 1748, 26, 20, "Print",ExpressionUUID->"68d9e46f-b2cc-4cd4-b1cb-f25236063bb6"],
Cell[295427, 7109, 2519, 39, 89, "Print",ExpressionUUID->"8bc22b51-f211-47d4-a45c-c5640ca33320"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[297995, 7154, 4755, 119, 589, "Input",ExpressionUUID->"0071dab1-7cf9-4bfe-a8e0-d804153b15a8"],
Cell[302753, 7275, 310, 5, 42, "Output",ExpressionUUID->"cf8a25ac-a60d-4e05-92b4-7f2bcae05e43"]
}, Open  ]],
Cell[CellGroupData[{
Cell[303100, 7285, 5079, 142, 837, "Input",ExpressionUUID->"cbd6f99f-e189-4d2f-9834-fb4a2f858c18"],
Cell[308182, 7429, 586, 9, 42, "Output",ExpressionUUID->"25e5b15d-ad4e-48fa-922f-554ff67dd49e"],
Cell[308771, 7440, 586, 9, 42, "Output",ExpressionUUID->"dc1a2419-8f4d-4360-9376-fdcaa47962a6"]
}, Open  ]]
}, Open  ]]
}
]
*)

